Artificial Intelligence 315 (2023) 103825Contents lists available at ScienceDirectArtificial Intelligencejournal homepage: www.elsevier.com/locate/artintStrategyproof Allocation Mechanisms with Endowments and M-convex Distributional Constraints ✩Takamasa Suzuki a, Akihisa Tamura b, Kentaro Yahiro c, Makoto Yokoo c, Yuzhe Zhang d,∗a Gifu Shotoku Gakuen University, Gifu, Japanb Keio University, Yokohama, Japanc Kyushu University, Fukuoka, Japand University of Groningen, Groningen, the Netherlandsa r t i c l e i n f oa b s t r a c tArticle history:Received 25 September 2020Received in revised form 17 April 2022Accepted 10 November 2022Available online 15 November 2022Keywords:Controlled school choiceM-convex setStrategyproofnessTop trading cyclesDeferred acceptanceDistributional constraints1. IntroductionWe consider an allocation problem of multiple types of objects to agents, where each type of object has multiple copies (e.g., multiple seats in a school), each agent is endowed with an object, and some distributional constraints are imposed on the allocation (e.g., minimum/maximum quotas). We develop two mechanisms that are strategyproof, feasible (they always satisfy distributional constraints), and individually rational, assuming the distributional constraints are represented by an M-convex set. One mechanism, based on Top Trading Cycles, is Pareto efficient; the other, which belongs to the mechanism class specified by Kojima et al. [1], satisfies a relaxed fairness requirement. The class of distributional constraints we consider contains many situations raised from realistic matching problems, including individual minimum/maximum quotas, regional maximum quotas, type-specific quotas, and distance constraints. Finally, we experimentally evaluate the performance of these mechanisms by a computer simulation.© 2022 The Authors. Published by Elsevier B.V. This is an open access article under the CC BY license (http://creativecommons.org/licenses/by/4.0/).The objective of this paper is to develop mechanisms for allocating indivisible objects to agents without monetary trans-fers, where each individual agent has a prior claim to some object, each type of an object has multiple copies, and some distributional constraints are imposed on the allocation. Our motivation is to apply these mechanisms to controlled school choice programs for public schools, i.e., deciding the allocation of students to schools (where each school has multiple iden-tical seats) when schools offer students the opportunity to attend their preferred public school other than the one closest to where they live, under distributional constraints (e.g., the capacity limits of schools).Our mechanisms are general enough to be applied to any reallocation problem of indivisible objects with multiple sup-plies. For example, in many Japanese universities, undergraduate engineering students must be assigned to a laboratory to This paper is based on our conference paper [2]. The following are the main differences: an extended study of TTC-M’s axiomatic properties (non-✩bossiness, group strategyproofness, weak core, and the characterization of TTC-M based on weak consistency), the introduction of a fair mechanism (DA-R), and an experimental comparison of the proposed mechanisms.* Corresponding author.yokoo@inf.kyushu-u.ac.jp (M. Yokoo), yoezy.zhang@rug.nl (Y. Zhang).E-mail addresses: t.suzuki@gifu.shotoku.ac.jp (T. Suzuki), aki-tamura@math.keio.ac.jp (A. Tamura), yahiro@agent.inf.kyushu-u.ac.jp (K. Yahiro), https://doi.org/10.1016/j.artint.2022.1038250004-3702/© 2022 The Authors. Published by Elsevier B.V. This is an open access article under the CC BY license (http://creativecommons.org/licenses/by/4.0/).T. Suzuki, A. Tamura, K. Yahiro et al.Artificial Intelligence 315 (2023) 103825conduct projects. However, some students fail to choose the laboratory of greatest interest due to limited familiarity with them. A possible remedy is to apply the following three-step procedure: (i) students are assigned to laboratories using some mechanism, (ii) they experience a certain trial period, and (iii) each student has a chance to apply to another laboratory if she changes her mind or her current laboratory fails to meet her expectations. Our new mechanisms can be used in step (iii). Naturally, no student should be mandatorily reallocated to a laboratory that is worse than her current assignment.Following a seminal work by Abdulkadiro˘glu and Sönmez [3], which formalized a school choice problem in the context of the mechanism design approach, a wide range of theoretical analysis has been conducted on the existing mechanisms used in practice.1 As the theory has been developed and applied to diverse types of environments, mechanism designers have faced a variety of forms of distributional constraints unaddressed by the standard model. For example, Biró et al. [5]was motivated by the Hungarian education system where higher education institutions can declare minimum quotas for study areas that must be satisfied to open courses. Another example is the regional maximum quotas introduced by the Japanese government to control the geographical distribution of medical residents to the country’s hospitals [6].It is well-known that in the presence of distributional constraints, a stable matching may not exist. A matching’s stability was first defined for two-sided, one-to-one matching problems [7]. In the setting of a school choice problem, stability is de-fined as the combination of individual rationality (IR), fairness, and nonwastefulness (NW) [8]. IR is a basic requirement that guarantees that a student2 can obtain a seat in a school that is at least as good as her initial endowment. Fairness ensures that when student s is not accepted by school c (which she believes to be better than her assigned school), then s is ranked lower than any student accepted by c based on c’s preference. NW is an efficiency notion that rules out incidents where a student can move unilaterally to her more preferred school without violating the underlying distributional constraints. Given the incompatibility of stability under distributional constraints, mechanism designers encounter a trade-off between fairness and efficiency. In recent literature on distributional constraints [9–16], a common approach is to weaken stability while maintaining a balance between efficiency and fairness to some extent.In this paper, we examine whether efficiency/fairness is achievable under distributional constraints while guaranteeing IR. More specifically, for efficiency, we study Pareto Efficiency (PE), a stronger welfare notion than NW, which eliminates incidents where students’ welfare can be improved without detracting from the welfare of others while satisfying distribu-tional constraints. For fairness, we study a slightly relaxed requirement such that it is compatible with IR called fairness among Non-Initial Endowment students (NIE-fairness) and examine how it is achieved without sacrificing excessive effi-ciency. It has generally remained an open question whether a Pareto Efficient (PE) mechanism (i.e., a mechanism that is guaranteed to obtain a PE matching) can satisfy some fairness property under distributional constraints [6]. Kamada and Kojima [6], one of the few studies investigating efficiency under distributional constraints, argued that PE is achievable un-der regional maximum quotas. Another study by Hamada et al. [17] develops a PE mechanism and an NIE-fair mechanism when minimum (and standard maximum) quotas are imposed on each school. As described below, the class of distributional constraints studied in this work is a strict generalization of these classes.We restrict our attention to strategyproof (SP) mechanisms, in which no student has an incentive to misreport her preference over schools. In theory, we can restrict our attention to SP mechanisms without loss of generality due to the well-known revelation principle [18]: if a certain property is achieved by a mechanism (more specifically, that property is satisfied in a dominant strategy equilibrium when using the mechanism), it can be achieved by an SP mechanism. An SP mechanism is also useful in practice since a student does not need to speculate about the actions of other students to obtain a good outcome; she only needs to truthfully report her preference.In this paper, we consider a class of distributional constraints that can be represented by an M-convex set (M stands for Matroid), a concept introduced in the field of discrete mathematics, which is a discrete counterpart of the frame-work of convex analysis [19,20]. We show that the M-convexity of the underlying distributional constraints is sufficient to guarantee the existence of mechanisms that satisfy desirable properties. The class of distributional constraints that can be represented by an M-convex set contains many situations raised from realistic matching problems, including individual minimum/maximum quotas (Fragiadakis et al. [9], Hamada et al. [17]), regional maximum quotas (Goto et al. [11], Kamada and Kojima [6]), type-specific maximum quotas (Abdulkadiro˘glu [21], Fragiadakis and Troyan [10]), and distance constraints (Kojima et al. [1]).We require an additional assumption: if every student is assigned to her initial endowment school, the underlying dis-tributional constraints are satisfied. This is an innocent requirement in the context of school choice since every student would attend her local school if there is no school choice program; assuming this default allocation satisfies distributional constraints is reasonable.Our mechanism achieving PE is based on the Top Trading Cycles (TTC) mechanism [22] developed by David Gale. TTC improves students’ welfare by trading their initial endowments. Our mechanism achieving NIE-fairness belongs to a mecha-nism class specified by Kojima et al. [1], which is a generalization of the Deferred Acceptance (DA) mechanism [7]. Both are tailored to handle IR and distributional constraints.1 For example, see Sönmez and Ünver [4] for a survey on the theoretical analysis of existing school choice mechanisms.2 For presentation clarity, even though the rest of our paper is described in the context of a school-student allocation problem, the obtained results in this paper are applicable to allocation problems in general.2T. Suzuki, A. Tamura, K. Yahiro et al.Artificial Intelligence 315 (2023) 103825Introducing a controlled school choice program can provoke controversy. People might worry that some schools are too unpopular and fail to operate because the number of students is too small. By utilizing our mechanisms, we can guarantee that nobody is worse off due to the introduction of the school choice program, i.e., each student is guaranteed an assignment to a weakly better school compared to her default school that she must attend without the school choice program, and the distributional constraints ensure that each school is assigned a sufficient number of students.This paper is organized as follows. In the rest of this section, we examine related literature. In Section 2, we introduce a general model of an allocation problem with initial endowments and distributional constraints, and define desirable prop-erties. In Section 3, we describe the notion of an M-convex set to specify the domain of the distributional constraints on which we focus as well as an impossibility result related to PE for the general model. Section 4 details some properties of an M-convex set that are used in the proof of our main theorems. In Section 5, we introduce our first main mechanism, called TTC under M-convex constraints (TTC-M), and show that it satisfies PE as well as several other desirable properties in our setting. Furthermore, we show that by restricting the flexibility of TTC-M, it degenerates into an existing mechanism called TTC among Representatives (TTC-R) [17]. In Section 6, we introduce our DA-based mechanisms, the first of which is a simple DA-based mechanism called Artificial Cap DA (ACDA), followed by our second main DA mechanism, DA based on ranks (DA-R), and show their properties. Finally we experimentally compare the mechanisms by a computer simulation in Section 7 and conclude in Section 8.1.1. Related literatureOur paper is located at the intersection of discrete mathematics and economics. The insight from the former, and discrete convex analysis in particular, has been used in a broad range of applications on discrete optimization, including scheduling, facility location, and the structural analysis of engineering systems [23–25]. Recently, discrete convex analysis has been recognized as a powerful tool for analyzing economic or game theoretic applications, including exchange economies with indivisible objects [26–29], systems analysis [27], inventory management [30,31], and auctions [32] (see Murota [33] for an extensive survey on recent developments). As suggested by this long, albeit partial list of success stories suggests, techniques from this literature can be applied to a variety of economic problems. In this paper, we add allocation problems (including school choice problems) to this list.This paper is not the first to apply discrete convex analysis to allocation problems. Fujishige and Tamura [34,35] and Murota and Yokoi [36] applied it to study two-sided matching problems. Both works dealt with many-to-many matching problems, in which a doctor/employee can work at multiple hospitals/firms. Fujishige and Tamura [34,35] addressed side payments as well.3 Kojima et al. [1] applied the concept to two-sided matching problems with distributional constraints and showed that if the preferences of schools can be represented as an M-concave function,4 the generalized deferred acceptance mechanism [38] achieves a desirable outcome. Our mechanism achieving (relaxed) fairness is based on their idea although it is tailored to satisfy IR.Shapley and Scarf [22] first introduced TTC. They investigated a housing market problem, where objects are initially owned by agents who have strict preferences over them, and there are no copies of an object in the market. TTC was further generalized to the Hierarchical Exchange mechanism [39] and the Trading Cycles mechanism5 [41]. TTC has been applied to a school choice problem [42], as well as the problem assigning teachers to schools [43,44]. TTC has been attracting attention from AI researchers [45–47].Abdulkadiro˘glu and Sönmez [48] and Guillen and Kesten [49] investigated a housing market problem with existing tenants, where some agents may not initially own a house, and some houses are not initially owned by agents.6 The differences between their setting and ours are that we consider multiple copies of an object and impose distributional constraints. Hamada et al. [17] considered individual minimum and maximum quotas where multiple copies of an object exist and agents have their initial endowments, although some objects are not initially owned by any agent. Our work is a strict extension of theirs.When TTC is applied to a housing market problem, agents sequentially form trading cycles to exchange their initial endowments. In the allocation problem, we consider that some school seats may be vacant, i.e., not initially owned by any students, and distributional constraints are imposed on the final allocation. The main challenge in this setting is how to utilize such vacant seats to improve students’ welfare without violating distributional constraints. For example, we assume the following complex distributional constraints are imposed: schools are partitioned into regions, and the total number of students allocated within a region must not exceed its maximum quota (called regional maximum quotas in the following contents). Even if a school has a vacant seat, allocating a student to the school may violate the maximum quota of the region to which the school belongs. By utilizing a common priority order over students, our TTC-based mechanism, Top Trading 3 See also an earlier contribution [37] that applied matroid theory to matching. This analysis is a special case of a more recent contribution by Fujishige and Tamura [35].4 More precisely, they used a concept called M(cid:2)-convexity, essentially an equivalent variant of M-convexity.5 Pycia and Ünver [40] extended the Trading Cycles mechanism such that each object has multiple copies. Our work is different from theirs because they only considered standard maximum quotas; we deal with more general distributional constraints that can be represented as an M-convex set.6 We can easily modify our model to describe a situation where some students do not initially own a school seat; we can assume such a student initially owns a seat in null school c∅, and for each student s, ω(s) (cid:4)s c∅ holds where ω(s) (cid:5)= c∅.3T. Suzuki, A. Tamura, K. Yahiro et al.Artificial Intelligence 315 (2023) 103825Table 1Properties of strategyproof allocation mechanisms.NIE-FairnessPENWTTC-MTTC-RDA-RACDAno (by NW)no (Ex. 5)yes (Th. 13)yes (Th. 12)yes (Th. 4)nononoyesnono (by NIE-fairness)noNW-Ryesno (Ex. 4)yes (Th. 14)no (Th. 12)GSPyes (Th. 6)yes (Th. 9)no (Ex. 8)no (Ex. 8)w-coreyes (Th. 7)yes (Th. 9)no (Ex. 8)no (Ex. 8)Cycles for M-convex constraints (TTC-M), can efficiently use vacant seats without violating the underlying distributional constraints. To the best of our knowledge, no mechanism with these desirable properties has ever been identified in this setting.We conclude this section by comparing the properties of the SP mechanisms that respect IR. Table 1 summarizes the comparison. Here NW-R stands for nonwastefulness based on ranks (Definition 8), GSP stands for group strategyproofness (Definition 9), and w-core denotes whether the mechanism’s outcome is in the weak core (Definition 10).2. ModelIn this section, we introduce our model and several desirable properties. A market is a tuple (S, C, ω, (cid:4)S , (cid:4)C , F ), where• S = {s1, . . . , sn} is a finite set of n students,• C = {c1, . . . , cm} is a finite set of m schools,• ω : S → C is an initial endowment function; ω(s) = c denotes the initial endowment school of s,• (cid:4)S = ((cid:4)s)s∈S is a profile of strict student preferences over C ,• (cid:4)C = ((cid:4)c)c∈C is a profile of strict school preferences over S, and• F ⊆ Zm≥0 (i.e., each element is a non-negative integer) is a set of school-feasible vectors. We assume distributional constraints are extensionally represented by F , and for all ν ∈ F , (cid:2)mi=1 νi = n holds.(cid:10)(cid:10)(cid:10)We follow the framework of matching with contracts [38]. Given a market, M = {(s, c) | s ∈ S, c ∈ C} is a finite set of contracts. A contract (s, c) means student s is matched to school c. For a subset of contracts μ ⊆ M, let μs = {(s, c) ∈ μ |c ∈ C} denote all the contracts in μ related to s and let μc = {(s, c) ∈ μ | s ∈ S} denote all the contracts in μ related to c. A set of contracts μ is a matching, if |μs| = 1 holds for all s ∈ S, and (s, c) ∈ μc holds if and only if μs = {(s, c)} for all s ∈ Sand c ∈ C . For matching μ, let μ(s) denote the school to which s is matched, i.e., μ(s) = c holds if μs = {(s, c)}, and let μ(c) denote the set of students matched to c, i.e., μ(c) = {s ∈ S | (s, c) ∈ μc}. For any pair of matchings μ and μ(cid:10), we write μ (cid:4)s μ(cid:10)if μ(s) (cid:4)s μ(cid:10)(s). Additionally, we denote by c (cid:11)s cif either c (cid:4)s cLet ˜μ ⊆ M denote the initial endowment matching, i.e., for all s ∈ S, ˜μ(s) = ω(s). Then we say matching μ is individually rational (IR) if μ(s) (cid:11)s ω(s) holds for all s ∈ S. In other words, IR requires that each student is matched to a school that is at least as good as her initial endowment school. Additionally, for any student s, any school, which is ranked weakly higher than ω(s), is acceptable to s.or c = cFor μ, let ν(μ) denote the m-dimensional distribution vector of μ, where its i-th element νi(μ) is |μ(ci)|. We sometimes i=1 νi(μ) = n, write νci (μ) instead of νi(μ). Matching μ is school-feasible if ν(μ) ∈ F . Note that μ is school-feasible only if i.e., each student must be matched to a school. Moreover, we assume that ˜μ is school-feasible.For s ∈ S, let ((cid:4)s, (cid:4)−s) denote the preference profile of all the students, where the preference of student s is (cid:4)s and (cid:10) ⊆ S, let the profile of the preferences of the other students is (cid:4)−s= ((cid:4)s(cid:10) )s(cid:10)∈S\{s}. Furthermore, for any set of students S((cid:4)S(cid:10) , (cid:4)−S(cid:10) ) denote the preference profile of all the students, where (cid:4)S(cid:10) is the profile of the preferences of the students in (cid:10)Sand (cid:4)−S(cid:10) is the profile of the preferences of the remaining students.A mechanism ϕ is a function that takes a profile of student preferences (cid:4)S as input and returns a matching ϕ((cid:4)S ). Let ϕs((cid:4)S ) denote the school to which s is matched, and let ϕc((cid:4)S ) denote the set of students matched to c. For any property defined on a matching (e.g., feasibility, which is defined later in this section), we say a mechanism satisfies the property (e.g., the mechanism is feasible) if it always returns a matching that satisfies the property (e.g., feasibility).(cid:2)For brevity, we write [k] = {1, . . . , k} for any k ∈ Z>0 (i.e., positive integer). With the above notations, we next introduce m.the following desirable properties.Definition 1 (Feasibility). Matching μ is feasible if it is IR and school-feasible.Next, we introduce strategyproofness (SP), which intuitively requires that a student cannot be assigned to a strictly preferred school by misreporting her preference.Definition 2 (Strategyproofness (SP)). Mechanism ϕ is strategyproof (SP) if for all s, (cid:4)s, (cid:4)(cid:10)(cid:4)−s) holds.s, and (cid:4)−s, ϕs((cid:4)s, (cid:4)−s) (cid:11)s ϕs((cid:4)(cid:10)s,4T. Suzuki, A. Tamura, K. Yahiro et al.Artificial Intelligence 315 (2023) 103825Note that the definition of SP considers only the misreport of a student; we assume schools do not act strategically.Pareto Efficiency (PE) is a natural requirement on efficiency (students’ welfare), which requires that we cannot improve the assignment of any student without hurting other students.Definition 3 (Pareto Efficiency (PE)). Matching μ Pareto dominates matching μ(cid:10)holds. School-feasible matching μ is Pareto efficient (PE) if no other school-feasible matching Pareto dominates it.7if ∀s ∈ S, μs (cid:11)s μ(cid:10)s holds, and ∃s ∈ S, μs (cid:4)s μ(cid:10)sNonwastefulness is another requirement of efficiency, which guarantees that no school seat is wasted if a student requires it.Definition 4 (Nonwastefulness (NW)). Given matching μ, any student s, such that (s, c) ∈ μ, claims an empty seat in c(cid:10)) ∈ M \ μ, c(s, can empty seat in μ.if (cid:10))} is school-feasible. Matching μ is nonwasteful (NW) if no student claims (cid:10) (cid:4)s c, and (μ \ {(s, c)}) ∪ {(s, c(cid:10)(cid:10)(cid:10)In other words, student s can claim an empty seat in school cif she prefers cdoes not violate the distributional constraints.(cid:10)unilaterally moving her from c to c(cid:10)over her currently matched school c and Note that PE implies NW, i.e., NW is a weaker requirement in terms of efficiency than PE.Next we introduce a property called fairness, which is defined through the notion of justified envy.Definition 5 (Fairness). In matching μ, where (s, c) ∈ μ, student s has justified envy toward another student s(cid:10)such that (s, cif ∃chold. Matching μ is fair if no student has justified envy in μ.(cid:10)) ∈ M \ μ, c(cid:10)) ∈ μ, and s (cid:4)c(cid:10) s(cid:10) (cid:4)s c, (s(cid:10), c(cid:10)(cid:10) ∈ C , (cid:10)In other words, s has justified envy toward another student s, if (1) s prefers cover her currently matched school, but (cid:10)(2) sis assigned to school c(cid:10).Fairness and IR are incompatible in general. Consider a market, in which S = {s1, s2}, C = {c1, c2}, ω(s1) = c1, ω(s2) = c2, and F = {(1, 1)}. Both students prefer c1 over c2, and both schools prefer s2 over s1. Since a fair matching must assign s2to c1, s1 must be assigned to c2. However, this violates IR., even though cprefers s over s(cid:10)(cid:10)Thus, we introduce a weaker version of fairness, called fairness among non-initial endowment students. Intuitively, any justified envy toward student s, who is assigned to school c, is not deemed legitimate if s is an initial endowment student of c.Definition 6 (Fairness among Non-Initial Endowment students (NIE-fairness)). In matching μ, where (s, c) ∈ μ, student s has (cid:10)) ∈ M \ μ, justified envy respecting initial endowments (RIE-envy) toward another student s(cid:10)(cid:10) (cid:4)s c, (shold. Matching μ is fair among non-initial endowment students if no student chas justified RIE-envy in μ.(cid:10) ∈ C , such that (s, c(cid:10)) /∈ ˜μ, and s (cid:4)c(cid:10) s(cid:10)) ∈ μ, (sif ∃c(cid:10), c(cid:10), c(cid:10)Unfortunately, NIE-fairness and NW are generally incompatible: a case exists where no feasible matching simultaneously satisfies both properties. This impossibility result is shown by the following example.Example 1. Consider the following market:• S = {s1, s2}• C = {c1, c2, c3}• ω(s1) = ω(s2) = c1• The following are the preferences of the students/schools:s1 : c2 (cid:4)s1 c3 (cid:4)s1 c1s2 : c3 (cid:4)s2 c2 (cid:4)s2 c1c1 : s1 (cid:4)c1 s2c2 : s2 (cid:4)c2 s1c3 : s1 (cid:4)c3 s2• The set of feasible vectors F is given as follows:(cid:6)(cid:6)(cid:6)(cid:6)(cid:6)(cid:6)⎧⎨⎩ν ∈ Z3≥0i∈[3] νi = 2,1 ≤ ν1 ≤ 2,0 ≤ ν2, ν3 ≤ 1.F =⎫⎬(cid:2)⎭7 Sometimes this property is referred to as constrained Pareto efficiency since the set of matchings is restricted to the set of school-feasible matchings.5T. Suzuki, A. Tamura, K. Yahiro et al.Artificial Intelligence 315 (2023) 103825Set F represents a situation where the minimum quota of c1 is one, i.e., at least one student must be assigned to c1 (while the other schools do not have any minimum quota). To satisfy this minimum quota, c2 and c3 can accept at most one student in total.By the student preference profile, even though c1 is the least popular school for both s1 and s2, at least one student must be assigned to it since 1 ≤ ν1 ≤ 2. Assume s1 is assigned to c1. Then s2 must be assigned to her favorite school c3, or otherwise s2 claims an empty seat in c3. However, s1 then has justified RIE-envy toward s2 since s1 (cid:4)c3 s2. Similarly, assume that s2 is assigned to c1. Then s1 must be assigned to her favorite school c2, otherwise s1 claims an empty seat in c2. However, s2 then has justified RIE-envy toward s1 since s2 (cid:4)c2 s1.Since NIE-fairness and NW are incompatible in general, we introduce a weaker version of NW called nonwastefulness based on ranks (NW-R). To define NW-R, we introduce a concept called the rank of a student for each school.Definition 7 (Rank). For any contract (s, c) ∈ M, rank((s, c)) is defined as follows:rank((s, c)) =(cid:10)0|{s(cid:10) ∈ S | ω(s(cid:10)) (cid:5)= c, sif ω(s) = c,(cid:10) (cid:4)c s}| + 1 otherwise.In other words, rank((s, c)) denotes the ranking of student s by school c based on (cid:4)c , except for c’s initial endowment students. If ω(s) = c, then rank((s, c)) = 0. If student s is ranked highest by c among all the students in {s ∈ S | ω(s) (cid:5)= c}, rank((s, c)) = 1, and if s is ranked second, rank((s, c)) = 2, and so on.Then NW-R is defined as follows.(cid:10)(cid:10)) ∈ M \ μ,based on ranks if all of the following conditions hold:Definition 8 (Nonwastefulness based on ranks (NW-R)). Given matching μ, assume that contract (s, c) ∈ μ. Student s claims an empty seat in c(i) (s, c(ii) c(iii) (μ \ {(s, c)}) ∪ {(s, c(iv) rank((s, cMatching μ is nonwasteful based on ranks if no student claims an empty seat based on ranks.(cid:10))} is school-feasible, and(cid:10))) < rank((s, c)).(cid:10) (cid:4)s c,Here conditions (i) – (iii) are equivalent to the conditions that a student claims an empty seat in Definition 4. Then based on ranks, only when she is ranked higher than c. If a mechanism is NW, it is intuitively, a student can claim an empty seat in a more preferred school cin cobviously also NW-R.than in her current allocated school c, i.e., she is more valuable/preferred by c(cid:10)(cid:10)(cid:10)Next we introduce group strategyproofness (GSP), which is a stronger property than SP.Definition 9 (Group strategyproofness (GSP)). Mechanism ϕ is group strategyproof (GSP) if for all (cid:4)S , no group of students (cid:10) ⊆ S and (cid:4)(cid:10)SS(cid:10) , (cid:4)−S(cid:10) )) (cid:11)s ϕs((cid:4)S ) holds, and ∃s ∈ SS(cid:10) , (cid:4)−S(cid:10) )) (cid:4)s ϕs((cid:4)S ) holds.S(cid:10) exist such that ∀s ∈ S, ϕs(((cid:4)(cid:10), ϕs(((cid:4)(cid:10)(cid:10)(cid:10)In other words, this property requires that no group of students can misreport their preferences to achieve that some group member is assigned to a strictly better school without worsening another member’s allocation.Next we introduce another property called core.Definition 10 (Core). School-feasible matching μ is in the strong core if no school-feasible matching μ(cid:10)(cid:10)}| and (ii) ∀s ∈ S(cid:10) ⊆ S exist such that (i) for any c ∈ C , |{(s, c) ∈ μ(cid:10) | s ∈ SSμ(cid:10)(s) (cid:4)s μ(s). School-feasible matching μ is in the weak core if no school-feasible matching μ(cid:10)exist such that (i’) for any c ∈ C , |{(s, c) ∈ μ(cid:10) | s ∈ S(cid:10)}| = |{(s, c) ∈ ˜μ | s ∈ S(cid:10)}| = |{(s, c) ∈ ˜μ | s ∈ S(cid:10)}| and (ii’) ∀s ∈ S(cid:10)and group of students , μ(cid:10)(s) (cid:11)s μ(s), and ∃s ∈ S(cid:10), (cid:10) ⊆ Sand group of students S(cid:10), μ(cid:10)(s) (cid:4)s μ(s) holds.In other words, in any matching in the strong core (respectively, weak core), no group of students can be (respectively, strictly) better off by swapping their initial endowment schools among themselves: if such a group exists, it is called a blocking coalition. The strong core is a subset of the weak core since the requirement of a legitimate blocking coalition is weaker; in the above definition, (i) and (i’) are identical, while (ii) is weaker than (ii’).Roth and Postlewaite [50] showed that the matching obtained by TTC is the unique element in the strong core when the objects assigned to the students are completely distinct (e.g., a housing market). In our setting, we allocate school seats to students. School seats are not completely distinct: all seats in a school are identical. The following example shows that the strong core can be empty in our setting.Example 2. Consider the following market:6T. Suzuki, A. Tamura, K. Yahiro et al.Artificial Intelligence 315 (2023) 103825• S = {s1, s2, s3}• C = {c1, c2}• ω(s1) = ω(s2) = c1, ω(s3) = c2• The following are the preferences of students:s1 : c2 (cid:4)s1 c1s2 : c2 (cid:4)s2 c1s3 : c1 (cid:4)s3 c2• The set of feasible vectors F contains only one element: (2, 1).Each element in the strong core must be PE; otherwise, the grand coalition (the coalition of all students, i.e., S) is a blocking coalition. There are two PE matchings:(cid:11)μ =c1{s2, s3}c2{s1}(cid:12),and(cid:11)μ(cid:10) =c1{s1, s3}c2{s2}(cid:12).For μ, s2 and s3 form a blocking coalition since by swapping their initial endowment schools, s2 becomes strictly better while s3 is indifferent. Similarly, for μ(cid:10), s1 and s3 form a blocking coalition since by swapping their initial endowment schools, s1 strictly improves while s3 is indifferent. However these two matchings are both in the weak core.Finally, we introduce some notions with which we describe our mechanism. A directed graph is a pair (V , E), where V is a set of vertices and E ⊆ V × V is a collection of directed edges, i.e., any (i, j) ∈ E is an ordered pair of vertices. A sequence of distinct vertices, (i1, . . . , ik), with k ≥ 2, is a directed path in (V , E) from i1 to ik if (ih, ih+1) ∈ E for all h ∈ [k − 1]. A directed path is a cycle if the first and last vertices coincide.3. M-convex set as a class of distributional constraintsIn this section, we describe the class of distributional constraints that is considered in our model. Let χi denote an m-element unit vector, in which the i-th element is 1 and all the other elements are 0. We sometimes write χci instead of χi .Definition 11 (M-convex set). A set of m-element vectors F is an M-convex set if for all ν, ν(cid:10) ∈ F and all i ∈ [m] with νi < ν(cid:10)i , j ∈ [m] exists with ν j > ν(cid:10)j such that ν + χi − χ j ∈ F and ν(cid:10) − χi + χ j ∈ F hold.This property characterizes an M-convex set and is called a (simultaneous) exchange property [19]. The notion of an M-convex set is analogous to that of the maximum elements of a convex set in a continuous domain, i.e., no hollow exists in a set. Next we show that several distributional constraints introduced in the literature belong to the class of M-convex set.Standard model [3]. Consider a market, where for each school c ∈ C , a maximum quota qc exists. The distributional con-straints of this market can be expressed as F whereF = {ν ∈ Zm≥0|(cid:13)c∈Cνc = n and νc ≤ qc ∀c ∈ C},and it can be verified that F is M-convex.Individual minimum/maximum quotas [9,17].school c ∈ C , a minimum quota pc exists. The distributional constraints of this market can be expressed as F whereIn addition to the maximum quotas of the standard model, we assume for each F = {ν ∈ Zm≥0|(cid:13)c∈Cνc = n and pc ≤ νc ≤ qc ∀c ∈ C},and it can be verified that F is M-convex.7T. Suzuki, A. Tamura, K. Yahiro et al.Artificial Intelligence 315 (2023) 103825Regional minimum/maximum quotas [6,11].In addition to the individual minimum/maximum quotas, capacity constraints are imposed on regions. Set of regions R ⊆ 2C \ {∅} partitions set of schools C into regions, and for each r ∈ R, there is a regional minimum quota pr and a maximum quota qr . The distributional constraints of this market can be expressed as FwhereF = {ν ∈ Zm≥0|(cid:13)c∈Cνc = n, pc ≤ νc ≤ qc and pr ≤(cid:13)c∈rνc ≤ qr ∀c ∈ C, ∀r ∈ R},and it can be verified that F is M-convex.Regional minimum/maximum quotas can be extended to the case where regions have multiple layers (e.g., cities, coun-ties, and states) [11,51]. Assuming these regions have a laminar structure,8 distributional constraints can be represented as an M-convex set [1].Type-specific quotas [21,10]. We assume each student belongs to exactly one type. A student’s type may represent her ethnicity, her gender, or her socioeconomic status. In addition to individual maximum quotas, there are additional type-specific quotas. More specifically, there exists a set of types T = {t1, . . . , tk}. Each student belongs to exactly one type, and for each c ∈ C and t ∈ T , type-specific minimum quota pc,t and maximum quota qc,t are defined. We assume distribution vector ν is represented as an m × |T | matrix, where νc,t denotes the number of type t students allocated to school c. The distributional constraints of this market can be expressed as F whereF = {ν ∈ Zm×|T |≥0|(cid:13)c∈C,t∈Tνc,t = n,(cid:13)t∈Tνc,t ≤ qcand pc,t ≤ νc,t ≤ qc,t ∀c ∈ C, ∀t ∈ T },and it can be verified that F is M-convex. Note that F is a 2-dimensional matrix, which is an extension of the standard definition. More specifically, each element νc,t represents the number of type t students assigned to school c. We can assume each school c is divided into |T | sub-schools, and distributional constraints are imposed on these m × |T | sub-schools. Then this model becomes equivalent to the standard model where distributional constraints are defined on a one-dimensional vector.Distance constraints [1]. When allocating n students among m schools, suppose that an ideal distribution vector exists from the viewpoint of the mechanism designer who considers any distribution vector feasible if it is close enough to the ideal vector. More specifically, distance constraints are defined by an ideal vector ν∗and a distance k describing the maximum tolerable deviation from the ideal distribution. The set of feasible vectors for such distributional constraints is expressed as F , such thatF = {ν ∈ Zm≥0|(cid:13)c∈Cνc = n and δ(ν, ν∗) ≤ k},where for any pair of m-dimensional vectors ν, ν(cid:10) ∈ Zm(or the L1 distance), which is defined as δ(ν, ν(cid:10)) =is defined as δ(ν, ν(cid:10)) = maxc∈C |νc − ν(cid:10)|νc − ν(cid:10)|. It can also be verified that F is M-convex.≥0, the distance function δ can be either (i) the Manhattan distance distance), which |, or (ii) the Chebyshev distance (or the Lc∈C(cid:2)∞cIn the next theorem, we show that feasibility, PE, and SP can be incompatible when the set of feasible vectors is not an cM-convex set.Theorem 1. A market exists where the set of feasible vectors is not M-convex, such that no mechanism simultaneously satisfies feasi-bility, PE, and SP.Proof. The theorem can be proved even with a simple market with two students, three schools, and the set of feasible vectors becomes an M-convex set by just adding one vector. Consider the following market:• S = {s1, s2},• C = {c1, c2, c3},• ω(s1) = ω(s2) = c1,• student preferences: s1 : c3 (cid:4)s1 c2 (cid:4)s1 c1 and s2 : c3 (cid:4)s2 c2 (cid:4)s2 c1, and• F = {(2, 0, 0), (1, 1, 0), (0, 1, 1)}.8 R has a laminar structure if for any r, r(cid:10) ∈ R (where r (cid:5)= r(cid:10)), one of the following conditions holds: r ⊂ r(cid:10), r(cid:10) ⊂ r or r ∩ r(cid:10) = ∅.8T. Suzuki, A. Tamura, K. Yahiro et al.Artificial Intelligence 315 (2023) 103825This market can be interpreted as follows. Within a school district, there are three schools, c1, c2, and c3, where c1 has a larger capacity than the others. Due to the constraints on the district’s logistic resources, at most two schools can be simultaneously operated only if they are close to each other (i.e., c1 and c2, or c2 and c3), otherwise only c1 is open. Note that F is not an M-convex set by the following argument. For ν = (2, 0, 0) and ν(cid:10) = (0, 1, 1), consider ν3 < ν(cid:10)3, and then ν j > ν(cid:10)j holds only for j = 1, but ν + χ3 − χ1 = (1, 0, 1) is not in F . However, F ∪ {(1, 0, 1)} is an M-convex set.In this market, there are two feasible and PE matchings, {(s1, c3), (s2, c2)} and {(s1, c2), (s2, c3)}. Assume that PE mech-anism ϕ chooses ϕ((cid:4)S ) = {(s1, c3), (s2, c2)}. Then s2 can misreport (cid:4)(cid:10)c2. With this misreport, the only s2feasible and PE matching is ϕ((cid:4)s1 , (cid:4)(cid:10)) (cid:4)s2 ϕs2 ((cid:4)s1 , (cid:4)s2 ). Similarly, s1 has an incen-s2tive to misreport if ϕ((cid:4)S ) = {(s1, c2), (s2, c3)}. In both cases, since a student can benefit by misreporting, ϕ cannot satisfy SP. (cid:2): c3 (cid:4)(cid:10)s2) = {(s1, c2), (s2, c3)} and ϕs2 ((cid:4)s1 , (cid:4)(cid:10)s2c1 (cid:4)(cid:10)s2This theorem implies that the violation of M-convexity easily leads to the nonexistence of any feasible, SP, and PE mechanism. In Section 5, we show that if the distributional constraints of a market can be represented as an M-convex set, a mechanism exists that satisfies SP and PE. We conjecture that M-convexity would be the most general classes of distributional constraints under which we can still have a mechanism with such desirable properties.4. Properties of M-convex setIn this section, we present several properties related to M-convexity that are used in later sections. These properties are either already known in the literature or proving them is rather straightforward. To be self-contained, however, we provide proofs.(cid:14)Lemma 1 (Murota [27, Lemma 9.23], Fujishige [52, Lemma 4.5]). Let F be an M-convex set. For some ν ∈ F , there exist i1, j1, . . . , ir, jr , all of which are in [m] and distinct, such that− χ jk∈ F− χ jk /∈ F(cid:2)ν + χihν + χihif h = kif h > k(h, k ∈ [r]).(1)Then it holds that ν +k∈[r](χik− χ jk ) ∈ F .Proof. The proof is conducted by induction on r. When r = 1, it obviously holds. Assume the supposition is true up to r = (cid:8) and consider a case where r = (cid:8) + 1. Take two vectors, a = ν + (χi1− χ jk ). It holds that a ∈ F by assumption. It also holds that b ∈ F from induction, because i2, j2, . . . , ir, jr are 2(cid:8) (which equals 2(r − 1)) distinct elements in [m], which satisfy Equation (1). Since i1, j1, . . . , ir, jr are distinct, it holds that ai1 > bi1 . It also holds that {k ∈ [m] | ak < bk} = { j1, i2, i3, . . . , ir}. From the M-convexity of F , j ∈ { j1, i2, i3, . . . , ir} must exist such that a + (χ j − χi1 ) =ν + (χ j − χ j1 ) ∈ F . It follows that j1 is the only candidate, since ν + χih− χ j1 /∈ F for any ih, h > 1. It then follows that b − (χ j1− χ j1 ) and b = ν +− χi1 ) = b + (χi1(cid:2)rk=2(χik− χ j1 ) = ν +− χ jk ) ∈ F . (cid:2)k∈[r](χik(cid:2)In other words, Lemma 1 means that we can unilaterally apply feasible moves (i.e., to reduce an element by one and simultaneously increase another by one) simultaneously if they are sorted properly in some sense.Lemma 2. Let F be an M-convex set and assume vector ν ∈ F . Let J = [r], and for a fixed q ∈ J , if elements i1, j1, . . . , ir, jr ∈ [m] are given such that {i1, . . . , ir} ∩ { j1, . . . , jr} = ∅ and− χ jk∈ F− χ jk /∈ F− χ jk /∈ Fif h = k (cid:5)= qif h = k = qif h > k(h, k ∈ J )⎧⎨ν + χihν + χihν + χihhold, then we have⎩ν +(cid:13)(χi(cid:8)(cid:8)∈ J− χ j(cid:8) ) /∈ F .− χ j(cid:8) ) is in F . If r > q, by the exchange property for ν(cid:10)(cid:2)(cid:8)∈ J (χi(cid:8)ν(cid:10) − χirProof. Assume to the contrary that ν(cid:10) = ν +with ν(cid:10)ir> νir , by {i1, . . . , ir} ∩ { j1, . . . , jr} = ∅, k exists such that ν(cid:10)jk∈ F .− χ jkFurthermore, from Equation (2), k must equal r. Then we have ν +we can assume that q = r. Since ν(cid:10)iq− χ jk(cid:8)∈ J \{r}(χi(cid:8)> νiq holds, by the exchange property for ν(cid:10)∈ F .+ χ jk , ν + χiq+ χ jk , ν + χirν(cid:10) − χiq< ν jk and(cid:2)However, all of the elements of J are less than or equal to q, which contradicts Equation (2). (cid:2)9− χ j(cid:8) ) ∈ F . By repeating the same argument, , ν and iq, k exists such that ν(cid:10)< ν jk andjk(2), ν and irT. Suzuki, A. Tamura, K. Yahiro et al.Artificial Intelligence 315 (2023) 103825In other words, Lemma 2 states that if a move is infeasible, it remains infeasible even after applying a sequence of feasible moves.Lemma 3. Assume that for ν ∈ F , I, J ⊂ [m] exist, I ∩ J = ∅ such that ∀i ∈ I , ∀ j ∈ J , the following condition holds:ν + χi − χ j /∈ F .Then no ν(cid:10) ∈ F exists such that the following condition holds:∀i ∈ [m] \ J , ν(cid:10)i≥ νi and ∃ j ∈ I, ν(cid:10)j > ν j.(3)(4)Proof. Assume to the contrary that ν(cid:10)i > νi , j exists such that ν(cid:10)with ν(cid:10)ν(cid:10) − χi + χ j, ν + χi − χ j ∈ F .j < ν j andexists and satisfies Equation (4). Since F is an M-convex set, for ν(cid:10), ν ∈ F and i ∈ IBy Equation (4), j must belong to J , which contradicts Equation (3). (cid:2)In other words, Lemma 3 means that if we cannot move one student from J to I , then we cannot increase the number of students in I without decreasing the number of students in [m] \ J .5. Top Trading Cycles under M-convex constraintsIn this section, we introduce an SP mechanism, Top Trading Cycles under M-convex constraints (TTC-M), which achieves a feasible and PE outcome in our settings. Then we show a characterization of TTC-M for a special market called a compatible market.5.1. Mechanism descriptionFirst we outline TTC-M. It repeats several rounds. At the beginning of round k, let μk−1 denote the matching of students who have already left the market, and let ˜μk−1 denote the initial endowment matching of the remaining students. Then (cid:15)μk−1 = μk−1 ∪ ˜μk−1 denotes the provisional matching at the beginning of round k.The mechanism uses a school preference profile (cid:4)∗Let Sk denote {s | (s, c) ∈ ˜μk−1}, i.e., the set of remaining students at round k. We say student s ∈ Sk, whose initial endowment school is c j , is admissible to school ci at round k if ν((cid:15)μk−1) + χi − χ j ∈ F holds, i.e., we can move s to ci from her initial endowment school c j without violating the distributional constraints. If there is no student admissible to school cin Sk, the school leaves the market at the beginning of round k. Let C k denote the set of remaining schools at the beginning of round k. Note that by this definition, if ω(s) = c, s is always admissible to c at any round k as long as ν((cid:15)μk−1) ∈ F holds.C , which is artificially constructed based on a common serial order over students (cid:4).9 We assume (cid:4) is complete and strict over S. Based on (cid:4), the (artificially constructed) preference of each school c ∈ C , (cid:4)∗c , is constructed, which is basically identical to (cid:4), but all initial endowment students of c are prioritized. More specifically, s (cid:4)∗c s(cid:10)) = c and s (cid:4) s(i) ω(s) = ω(s(ii) ω(s) (cid:5)= c, ω(s(iii) ω(s) = c and ω(sWithout loss of generality, we assume s1 (cid:4) s2 (cid:4) · · · (cid:4) sn holds.holds if and only if one of the following conditions holds:(cid:10)) (cid:5)= c, and s (cid:4) s(cid:10)) (cid:5)= c., orNow we are ready to introduce TTC-M, which is described as in Mechanism 1. Intuitively, we can assume that in TTC-M at each round k, each school selects one student and gives her the right to obtain its seat. Then students with such rights can trade seats among themselves by constructing trading cycles in Gk by the standard TTC mechanism. Therefore, a student can only participate in a trade when she is selected by some school. By definition of (cid:4)∗c , the priority right of school c is first given to its initial endowment students, where ties are broken by the common serial order (cid:4). When all of its initial endowment students have left the market, school c gives the right to a remaining student who is admissible (i.e., unilaterally moving her to c from her initial endowment school does not violate the distributional constraints), where ties are broken by (cid:4).,(cid:10)(cid:10)(cid:10)Since a student considers her initial endowment school acceptable, and the school deems her admissible at any round as long as she remains in the market, she is guaranteed a seat in her initial endowment school. Thus, every student is included in a cycle at some round before TTC-M terminates.9 In some applications, schools (as well as students) can agree on such an order, e.g., GPA. If no agreeable order exists, we can rely on a lottery to randomly decide an order. Such an order is also used in a serial dictatorship mechanism [12,16], which is school-feasible, SP, and PE, but not IR. If no student has an initial endowment school, TTC-M becomes identical to a serial dictatorship mechanism.10T. Suzuki, A. Tamura, K. Yahiro et al.Artificial Intelligence 315 (2023) 103825Mechanism 1 Top Trading Cycles for M-convex constraints (TTC-M).Initialize ˜μ0 ← ˜μ, μ0 ← ∅, k ← 1.Round k:Step 1: Construct directed graph Gk as follows.• Each school c leaves the market if it has no admissible student in Sk .Otherwise, c points to an admissible student who is ranked the highestaccording to (cid:4)∗c in Sk .• Each student in Sk points to her favorite school in C k .• This creates directed graph Gk = (V k, Ek), where V k = Sk ∪ C k ,(s, c) ∈ Ek (resp. (c, s) ∈ Ek ) represents the fact that student s (resp.school c) points to school c (resp. student s).Step 2: Let C k be the set of all directed edges that form cycles in Gk .Since V k is finite, at least one cycle exists in Gk and thus C k is nonempty.Step 3: ˜μk ← ˜μk−1 \ {(s, ω(s)) | (s, c) ∈ C k} andμk ← μk−1 ∪ {(s, c) | (s, c) ∈ C k}.Each student s such that (s, c) ∈ C k leaves the market.Step 4: If ˜μk = ∅, then return μk . Otherwise, k ← k + 1 and go to the next round.s1s2s5(cid:16)(cid:16)c4s4(cid:14)(cid:4)(cid:4)(cid:5)(cid:14)(cid:14)(cid:2)(cid:3)(cid:10)(cid:10)(cid:2)c1(cid:10)(cid:16)(cid:16)(cid:14)(cid:14)(cid:15)(cid:16)(cid:16)(cid:17)(cid:10)(cid:10)(cid:11)(cid:8)(cid:8)(cid:8)(cid:8)(cid:8)(cid:8)(cid:8)(cid:9)(cid:12)(cid:12)(cid:12)(cid:12)(cid:12)(cid:12)(cid:12)(cid:13)(cid:4)c2c3(cid:2)(cid:4)(cid:6)(cid:2)(cid:7)s3Fig. 1. G 1 obtained in Round 1 by TTC-M in Example 3.One particular feature of TTC-M is how it deals with the underlying distributional constraints. At round k of TTC-M, the priority right of a school is given to a student based on (cid:4)∗C , ν((cid:15)μk−1), and F . For instance, if the distributional constraints are individual maximum quotas, a school gives its priority right to a student if the number of allocated students is fewer than the quota. Under more complex distributional constraints, such as minimum quotas and/or regional quotas, just looking at the current status and its quota is insufficient for a school to determine which student it should prioritize. For example, , who was initially endowed a seat in another school c, decreases the number of students allocating a student to school callocated to c, i.e., νc((cid:15)μk−1). This decision might violate distributional constraints, even though ccan accept one more student. The next example describes how TTC-M works with regional quotas.(cid:10)(cid:10)Example 3. Consider the following market. In the example, for each student s ∈ S, we only list in (cid:4)s her acceptable schools.• S = {s1, s2, s3, s4, s5}• C = {c1, c2, c3, c4}• (cid:4): s1 (cid:4) s2 (cid:4) s3 (cid:4) s4 (cid:4) s5• c2 (cid:4)s1 c1 = ω(s1), c3 (cid:4)s2 c2 = ω(s2), c2 (cid:4)s3 c3 = ω(s3), c3 (cid:4)s4 c4 = ω(s4), c2 (cid:4)s5 c4 = ω(s5)⎧⎪⎨• F =ν ∈ Z4≥0⎪⎩(cid:6)(cid:6)(cid:6)(cid:6)(cid:6)(cid:6)(cid:6)(cid:2)i∈[4] νi = 5,0 ≤ νi ≤ 2 ∀i ∈ [4],2 ≤ ν3 + ν4 ≤ 3.⎫⎪⎬⎪⎭Set F represents the situation where the schools in the same region (c3 and c4) are jointly subjected to the regional minimum and maximum quotas in addition to the individual maximum quota of 2.First, ˜μ0 is determined: ˜μ0 = ˜μ = {(s1, c1), (s2, c2), (s3, c3), (s4, c4), (s5, c4)}. Note that ν( ˜μ0) = (1, 1, 1, 2) ∈ F .At Step 1 of Round 1, since every school still has its initial endowment student in the market, all the schools re-main in the market. Each school c points to a student based on (cid:4)∗c , ν((cid:15)μ0), and F . In this round, each school points to its initial endowment student who is ranked highest according to (cid:4). Each student points to her favorite school that remains in the market. This results in G 1, as shown in Figure 1. There is one cycle: (c2, s2, c3, s3, c2). At Step 2, C 1 is {(c2, s2), (s2, c3), (c3, s3), (s3, c2)}. At Step 3, (s2, c2) and (s3, c3) are removed from ˜μ0, and (s2, c3) and (s3, c2) are added to μ0. ˜μ1 and μ1 are determined:˜μ1 = {(s1, c1), (s4, c4), (s5, c4)},μ1 = {(s2, c3), (s3, c2)}.11T. Suzuki, A. Tamura, K. Yahiro et al.Artificial Intelligence 315 (2023) 103825s5(cid:16)(cid:16)c4(cid:16)(cid:16)s1(cid:10)(cid:10)(cid:18)(cid:2)(cid:3)(cid:10)(cid:10)(cid:10)(cid:10)(cid:2)c1(cid:10)(cid:16)(cid:16)(cid:17)(cid:10)(cid:10)(cid:11)(cid:10)c2s4(cid:14)(cid:14)(cid:19)(cid:14)(cid:4)(cid:5)(cid:14)(cid:14)(cid:14)(cid:14)(cid:4)(cid:14)(cid:14)(cid:15)(cid:14)c3Fig. 2. G 2 obtained in Round 2 by TTC-M in Example 3.s5(cid:4)(cid:5)(cid:4)c1(cid:2)(cid:2)(cid:3)(cid:2)(cid:7)(cid:2)c4Fig. 3. G 3 obtained in Round 3 by TTC-M in Example 3.Note that ν((cid:15)μ1) = ν((cid:15)μ0) = (1, 1, 1, 2), since at this round s2 and s3 exchange the seats of their initial endowment schools and thus the distributional vector does not change. At Step 4, TTC-M goes to Round 2 because ˜μ1 (cid:5)= ∅.At Step 1 of Round 2, schools c2 and c3 do not have their initial endowment students. School c2 points to s1 because based on (cid:4)∗, she is the highest among the remaining students and allocating her to c2 from her initial endowment school c2= (0, 2, 1, 2) ∈ F ); that is, she is admissible to c2 at c1 does not violate distributional constraints ((1, 1, 1, 2) + χc2Round 2. To school c3, however, s1 is not admissible because (1, 1, 1, 2) + χc3= (0, 1, 2, 2) /∈ F due to the maximum quota of the region containing c3 and c4. On the other hand, moving a student from c4 to c3 is feasible. Thus, c3 points to s4 according to (cid:4)∗. Therefore, G 2 is determined (Figure 2). There are two cycles: (c2, s1, c2) and (c3, s4, c3). At Step 2, C 2c3is {(c2, s1), (s1, c2), (c3, s4), (s4, c3)}. ˜μ2 and μ2 are determined:− χc1− χc1˜μ2 = {(s5, c4)},μ2 = {(s2, c3), (s3, c2), (s1, c2), (s4, c3)}.Observe that ν((cid:15)μ2) = (0, 2, 2, 1) ∈ F . Note also that c2’s decision to give its right to student s1 is based on the fact that moving s1 from c1 to c2 is feasible, i.e., (0, 2, 1, 2) is in F . Similarly, c3’s decision to give its right to student s4 is based on the fact that it is feasible to move s4 from c4 to c3, i.e., (1, 1, 2, 1) is in F . The fact that implementing both moves still gives a feasible vector is guaranteed by M-convexity, as shown in the proof of Theorem 2. At Step 4, TTC-M goes to Round 3 because ˜μ2 (cid:5)= ∅.At Step 1 of Round 3, G 3 is determined (Figure 3). Since no student is admissible to c2 or c3, these schools leave the market. There is one cycle: (c4, s5, c4). At Step 2, C 3 is {(c4, s5), (s5, c4)}. Therefore, ˜μ3 and μ3 are determined:˜μ3 = ∅,μ3 = {(s2, c3), (s3, c2), (s1, c2), (s4, c3), (s5, c4)}.At Step 4, TTC-M returns μ3 because ˜μ3 = ∅.5.2. TTC-M propertiesFirst we introduce a property, which guarantees that TTC-M is feasible even though each school independently makes its decision. Before we show the property, we prove the following lemma.Lemma 4. In TTC-M, for k (≥ 1), if ν((cid:15)μk) (cid:5)= ν((cid:15)μk−1), r (≥ 1) exists and {˜c1, ω(˜s1), . . . , ˜cr, ω(˜sr)} ⊆ C k such thatν((cid:15)μk) = ν((cid:15)μk−1) +(cid:13)(cid:8)∈[r](χ˜c(cid:8)− χω(˜s(cid:8))),(5)where ˜s1, . . . , ˜sr are ordered such that ˜s1 (cid:4) · · · (cid:4) ˜sr and ˜c1, . . . , ˜cr are ordered such that (˜c(cid:8), ˜s(cid:8)) ∈ Ek for all (cid:8) ∈ [r]. Furthermore, the schools in {˜c1, ω(˜s1), . . . , ˜cr, ω(˜sr)} are distinct, no school in {˜c1, . . . , ˜cr} has any initial endowment student in Sk, and(cid:10)ν((cid:15)μk−1) + χ˜chν((cid:15)μk−1) + χ˜ch− χω(˜s(cid:8)) ∈ F− χω(˜s(cid:8)) /∈ Fif h = (cid:8)if h > (cid:8)(h, (cid:8) ∈ [r]).12(6)T. Suzuki, A. Tamura, K. Yahiro et al.Artificial Intelligence 315 (2023) 103825Proof. In TTC-M, the fact that (c, s) ∈ C k means that “school c accepts a student (who is pointing to c), while student smoves from her initial endowment school ω(s) to a school (to which s is pointing).” Therefore, ν((cid:15)μk) can be expressed:ν((cid:15)μk) = ν((cid:15)μk−1) +(cid:13)(c,s)∈C k(χc − χω(s)).From this expression, it is clear that moving s from ω(s) to (cid:15)μk(s) does not affect the resulting distributional vector if (c, s) ∈ C k and ω(s) = c. When ν((cid:15)μk) (cid:5)= ν((cid:15)μk−1), r ≥ 1 exists and {˜c1, ω(˜s1), . . . , ˜cr, ω(˜sr)} ⊆ C k such thatν((cid:15)μk) =ν((cid:15)μk−1) +=ν((cid:15)μk−1) +=ν((cid:15)μk−1) +(cid:13)(χc − χω(s))(c,s)∈C k(cid:13)(χc − χω(s))(c,s)∈C k, ω(s)(cid:5)=c(cid:13)(χ˜c(cid:8)(cid:8)∈[r]− χω(˜s(cid:8))),where ˜s1, . . . , ˜sr are ordered such that ˜s1 (cid:4) · · · (cid:4) ˜sr and ˜c1, . . . , ˜cr are ordered such that (˜c(cid:8), ˜s(cid:8)) ∈ C k for all (cid:8) ∈ [r].Next we show that the elements in {˜c1, ω(˜s1), . . . , ˜cr, ω(˜sr)} are distinct. Since each school can receive at most one student in a round, the elements in {˜c1, . . . , ˜cr} are clearly distinct. The elements in {ω(˜s1), . . . , ω(˜sr)} are also clearly distinct since if ω(˜si) = ω(˜sh) holds (i < h), ˜ch should have pointed to ˜si (not ˜sh) according to (cid:4)∗. Furthermore, in Gk, ˜cheach school in {˜c1, . . . , ˜cr} points to a student who is not among its initial endowment students, while each school in set {ω(˜s1), . . . , ω(˜sr)} points to its initial endowment student. Therefore, all the schools in set {˜c1, ω(˜s1), . . . , ˜cr, ω(˜sr)} are distinct. Besides, each school in set {˜c1, . . . , ˜cr} points to its top-ranked admissible student based on the common order (cid:4). Thus Equation (6) holds. (cid:2)Now we are ready to prove that TTC-M is feasible.Theorem 2. TTC-M is feasible.Proof. We show that TTC-M always obtains a school-feasible and IR outcome. First, we show by induction on k that (cid:15)μkis school-feasible. For k = 0, it is clear by assumption that (cid:15)μ0 = ˜μ is school-feasible. Then by assuming that ν((cid:15)μk−1) ∈ Fis true for any k ≥ 1, the induction is completed by showing ν((cid:15)μk) ∈ F . Since ν((cid:15)μk) is represented as Equation (5), by Equation (6) and Lemma 1, ν((cid:15)μk) = ν((cid:15)μk−1) +− χω(˜s(cid:8))) must be in F .We then show that the outcome of TTC-M is IR by the following two claims: (i) each student is contained in a cycle exactly once and assigned to the school she points to in this formed cycle, (ii) a student never points to a school that is worse than her initial endowment school based on her preference. Claim (i) is clear from the definition of TTC-M. Claim (ii) is true because ν((cid:15)μk) + χi − χ j ∈ F is satisfied for any k if j = i; that is, as long as a student is in the market, her initial endowment school remains in the market and deems her admissible. (cid:2)(cid:8)∈[r](χ˜c(cid:8)(cid:2)To show SP and PE, we prove the following lemma, which illustrates that if student s is inadmissible to school c at round k, then s remains inadmissible to c at any round after k. This is a key property for proving SP and PE.Lemma 5. Let sto remain in the market at round k), if ν((cid:15)μk−1) + χc − χω(s) /∈ F for all students s ∈ Sk with s (cid:11) sbe a student in Sk+1 and c(cid:10)). For school c ∈ C , which has no initial endowment student in Sk (c is not required , then ν((cid:15)μk) + χc − χc(cid:10) /∈ F .(cid:10) = ω(s(cid:10)(cid:10)Proof. If ν((cid:15)μk) = ν((cid:15)μk−1), then the lemma obviously holds.We assume that ν((cid:15)μk) (cid:5)= ν((cid:15)μk−1). By Lemma 4, an r ≥ 1 and {˜c1, ω(˜s1), . . . , ˜cr, ω(˜sr)} ⊆ C k exist, which satisfy Equations (cid:10) ∈ Sk+1, and no student in {˜s1, . . . , ˜sr} is included in Sk+1. We assume that, based on (cid:4), the strict (cid:10) (cid:4) ˜sp+1 (cid:4) · · · (cid:4) ˜sr . By this order, we consider the order on {˜c1, . . . , ˜cr, c} and (cid:10)} is ˜s1 (cid:4) · · · (cid:4) ˜sp (cid:4) s(cid:10))} as: ˜c1, . . . , ˜c p, c, ˜c p+1, . . . , ˜cr , and ω(˜s1), . . . , ω(˜sp), ω(s(5) and (6). Note that sorder on {˜s1, . . . , ˜sr, s{ω(˜s1), . . . , ω(˜sr), ω(s(cid:10)), ω(˜sp+1), . . . , ω(˜sr).We apply Lemma 2 to the above schools and have the following facts:• ν((cid:15)μk−1) ∈ F by Theorem 2,• {˜c1, . . . , ˜cr, c} ∩ {ω(˜s1), . . . , ω(˜sr), ω(s• {˜c1, ω(˜s1), . . . , ˜cr, ω(˜sr)} satisfies Equation (6) by Lemma 4,• ν((cid:15)μk−1) + χc − χω(s(cid:10)) /∈ F by the assumption,• ν((cid:15)μk−1) + χc − χω(˜s(cid:8)) /∈ F for (cid:8) ∈ [p] by the assumption, and• ν((cid:15)μk−1) + χ˜ch(cid:10))} = ∅ by Lemma 4,− χω(s(cid:10)) /∈ F for h ∈ {p + 1, . . . , r}; otherwise, ˜ch should have pointed to s(cid:10)(not ˜sh).13T. Suzuki, A. Tamura, K. Yahiro et al.Artificial Intelligence 315 (2023) 103825From Lemma 2 and the above facts, ν((cid:15)μk) + χc − χc(cid:10) = ν((cid:15)μk−1) +F . (cid:2)(cid:2)(cid:8)∈[r](χ˜c(cid:8)− χω(˜s(cid:8))) + (χc − χω(s(cid:10))) is not contained in Next we show that TTC-M satisfies SP and PE. To show SP, we use the following lemma.Lemma 6. For any directed path (cin Gk+1.∗, . . . , s∗), if (c∗, . . . , s∗) is in Gk and s∗ ∈ V k+1 in the execution of TTC-M, then (c∗, . . . , s∗) is also Proof. We first show the following:(i) For any c ∈ C and s ∈ S, if (s, c) ∈ Ek and s, c ∈ V k+1, then (s, c) ∈ Ek+1 holds.(ii) For any c ∈ C and s ∈ S, if (c, s) ∈ Ek and s ∈ V k+1, then c ∈ V k+1 and (c, s) ∈ Ek+1 hold.(cid:10) ∈ V k+1, then s ∈ V k+1 holds.(iii) For any s, s(cid:10) ∈ S and c ∈ C , if (s, c) ∈ Ek, (c, s(cid:10)) ∈ Ek, and s(i) means that, if (s, c) ∈ Ek holds, i.e., c is the best remaining school for s at round k, and s and c remain in the market at round k + 1, then c is still the best choice for s at round k + 1. This is true because the schools that left the market will never return in a later round in TTC-M.(ii) means that if s is the highest-ranked admissible student for c at round k, then c still ranks s as the highest-ranked admissible student in the next round, given that s still remains in the market. To prove the claim, it is sufficient to show that at round k + 1, s is still admissible to c, and s is still c’s top-ranked admissible student. Let us first prove that s is admissible to c at round k + 1, i.e., ν((cid:15)μk) + χc − χω(s) ∈ F holds. If ω(s) = c, it obviously holds. If ω(s) (cid:5)= c, then consider a hypothetical case, where c is the favorite school of s at round k. This case could have happened, since the preference of each student is arbitrary. Note that in this case, since F and ω do not change, s is still admissible to c at round k. Therefore, in this hypothetical case, in addition to the cycles formed at round k in the original market, exactly one cycle, (c, s, c), is formed at round k. From Theorem 2, the resulting vector at the end of k in this hypothetical setting should be feasible: ν((cid:15)μk) + χc − χω(s) ∈ F . This fact implies that s is admissible to c at round k + 1 in the original market (where c is not the favorite school of s at round k and s remains in the market at round k + 1). Since c has an admissible student, c remains in the market, i.e., c ∈ V k+1. Next we show that s remains the highest-ranked admissible student for c at k + 1. If ω(s) = c, (cid:10)) /∈ Ek implies that then it clearly holds. Assume ω(s) (cid:5)= c, and let sν((cid:15)μk−1) + χc − χω(s(cid:10)) /∈ F . Then from Lemma 5 and ν((cid:15)μk−1) + χc − χω(s) ∈ F , it holds that ν((cid:15)μk) + χc − χω(s(cid:10)) /∈ F , and thus (cid:10)sis inadmissible to c at round k + 1. Therefore, we have (c, s) ∈ Ek+1.(iii) is an elementary property, inherited from the standard TTC mechanism. Assume (s, c) ∈ Ek, (c, s(cid:10)) ∈ Ek, and student s leaves the market at round k. She leaves the market only when (s, c) is included in a cycle. If (s, c) is included in a cycle, then (c, sremains in the market implies that s also remains in it.(cid:10)) must also be included in the same cycle. Then smust leave the market at round k. Thus, the fact that sbe a student in V k+1 and s(cid:10) (cid:4) s. The fact that (c, sFrom (i), (ii), and (iii), for any directed path (c, . . . , s), if (c, . . . , s) is in Gk and s ∈ V k+1, then (c, . . . , s) is also in (cid:10)(cid:10)(cid:10)Gk+1. (cid:2)Theorem 3. TTC-M is SP.Proof. From Lemma 6, for any directed path (c, . . . , s), if (c, . . . , s) is in Gk and s ∈ V k+1, then (c, . . . , s) is also in Gk+1. By repeatedly applying this lemma, once there is a directed path to a student in a round, it remains in any later round as long as the student also remains in the market. By the construction of TTC-M, a student can only obtain a school seat if there is a directed path from the school to her. Fix s and (cid:4)−s. We call a school obtainable at k if s can obtain its seat by pointing to it at k. Observe that any school on any directed path to s in Gk is obtainable for s. It is now clear that the set of obtainable schools for s is increasing on k, and the set’s growth depends only on (cid:4)−s. Since s can only obtain a school seat from her obtainable schools at any round, her best strategy is to choose her most preferred school among all the obtainable schools at the round. Choosing based on her true preference (cid:4)s gives her the best assignment, and therefore TTC-M is SP. (cid:2)Theorem 4. TTC-M is PE.Proof. Suppose we run TTC-M and obtain feasible matching μ. Consider a student who is matched at round r in TTC-M. We show that if in another matching μ(cid:10), the student is assigned to a more preferred school than her allocation in μ, another student must exist who is (assigned before r) worse off in μ(cid:10). The proof is done by induction on r.When r = 1, the statement is trivially true because any student being assigned at round 1 is allocated to her top choice.Assume the supposition is true up to r = k − 1 with k ≥ 2. We consider r = k and define the following notations:Ik = C \ C k: schools that are not in the market at round k.J k = {c | ˜μk−1(c) (cid:5)= ∅}: a set of schools, each of which has at least one remaining initial endowment student in the market at round k. Note that J k ⊆ C k holds.14T. Suzuki, A. Tamura, K. Yahiro et al.Artificial Intelligence 315 (2023) 103825Each ci ∈ C \ J k is filled with νi((cid:15)μk−1) = νi(μk−1) students at the beginning of round k. Without loss of generality, assume Ik (cid:5)= ∅ (if Ik = ∅, every student allocated at k goes to her top choice). Consider student s, who is allocated to school c at round k, and assume c is not her top choice. Then all the schools that she prefers over c are in Ik. From Lemma 5 and the definitions of Ik and J k, ∀ci ∈ Ik and ∀c j ∈ J k, ν((cid:15)μk−1) + χi − χ j /∈ F holds. Lemma 3 then implies that there is no feasible matching μ(cid:10)such that∀ci ∈ C \ J k, νi(μ(cid:10)) ≥ νi(μk−1) and ∃ci ∈ Ik, νi(μ(cid:10)) > νi(μk−1).Put differently, for any feasible matching μ(cid:10)s is better than c), at least∃ci ∈ C \ J k, νi(μ(cid:10)) < νi(μk−1) or νμ(cid:10)(s)(μ(cid:10)) ≤ νμ(cid:10)(s)(μk−1)with μ(cid:10)(s) ∈ Ik (which covers all the feasible matchings where the allocation of holds. Whichever is the case, a student exists who is matched before k in μ and has a different allocation in μ(cid:10)induction argument, however, such a change necessarily makes someone who is matched before k worse off. (cid:2). From the Next we prove that the TTC-M is GSP. We first introduce a concept called non-bossiness [39].Definition 12 (Non-bossiness). Mechanism ϕ is non-bossy if for any s ∈ S, (cid:4)−s, (cid:4)s, and (cid:4)(cid:10), (cid:4)−s) holds, ϕ((cid:4)(cid:10)s, (cid:4)−s) = ϕ((cid:4)s, (cid:4)−s) holds.s, as long as ϕs((cid:4)(cid:10)s, (cid:4)−s) = ϕs((cid:4)sIn other words, a mechanism is non-bossy if a student can only change the assignments of other students when her assignment changes.Theorem 5. TTC-M is non-bossy.Proof. Consider two markets, which are basically identical except for the preference of student s: denoted as (cid:4)s in the first market and (cid:4)(cid:10)denote matchings obtained by TTC-M in the first and second markets, respectively. Towards a contradiction, assume μ(s) = μ(cid:10)(s) holds, but μ and μ(cid:10)s in the second. Let μ and μ(cid:10)are different.Assume that s is contained in a cycle formed at round k in the first market and at round k, and (ii) k (cid:5)= kexamine the following two cases: (i) k = k. For case (ii), without loss of generality, we assume k < kin the second market. We holds.(cid:10)(cid:10)(cid:10)(cid:10)(cid:10).Case (i): k = kSince s is not contained in any cycle at any round before k, the cycles formed at each round before k are identical in both markets. Then at round k, since μ(s) = μ(cid:10)(s), in both markets, s points to μ(s). Furthermore, for all s(cid:10) ∈ S \ {s} and all c ∈ C , the preferences are identical in both markets. Thus, the cycles formed at round k are identical in both markets, and so are the cycles at rounds after k. This implies that μ = μ(cid:10).(cid:10).Case (ii): k < kIt is clear that all the cycles formed before round k must be identical in both markets. Let us first examine why any cycle formed at round k in the first market is also formed in the second market. Let C denote the cycle containing s at round k in the first market. We show that C is also formed at round kin the second market. At round k, since s is assigned to μ(s), s points to μ(s), and there is a directed path from μ(s) to s in the first market. This path also exists in the second in the second market. Since μ(cid:10)(s) = μ(s), s points to μ(s)market at round k. By Lemma 6, this path remains until round kin the second market, which implies that C is formed. Besides C , the other cycles at round k in the first market at round kare also formed at round k in the second market since the preferences of the other students are identical in both markets.(cid:10)(cid:10)(cid:10)(cid:10) ∈ S, (s. Let C (cid:10)(cid:10)into two groups (1 and 2). Each group 1 student points to a school in CNext we show that all the cycles formed after round k in the first market are also formed in the second market. We first show that all the cycles formed at round k + 1 in the first market are also formed in the second market. Let Cdenote the (cid:10) = {c ∈ C | ∃s(cid:10), c) ∈ C }. For a cycle formed at round k + 1 in the first market, if set of schools contained in C , i.e., C(cid:10), it is also formed at round k + 1 in the second market, since it is not influenced by C . it does not include any school in Cdenote such a cycle. We divide the students Thus, we concentrate on a cycle that includes at least one school in Cin C (cid:10)at round k in the first market, but she points to a different school at round k + 1 according to C (cid:10)(to which she pointed) leaves the market after round k. Group 2 students are the complement of group 1 students. At round k + 1 in the second market, a since C is not formed. On the other hand, each group 2 student group 1 student continues to point to the same school in Cpoints to a school according to C (cid:10)at round k + 1 in the second market. Using a similar argument to the proof of Lemma 6, we can show that all of the group 1 and group 2 students continue to point to the same school until C is formed, i.e., until (cid:10) + 1 in the second market, group 1 students point to schools according to C (cid:10)round k, (cid:10) + 1 in the second and group 2 students continue to point to schools according to C (cid:10)market., since C is formed and the school in Cin the second market. At round kis formed at round k. Therefore, C (cid:10)(cid:10)(cid:10)(cid:10)(cid:10)(cid:10)We can construct a similar argument for the rounds after k + 1 to complete the proof. (cid:2)15T. Suzuki, A. Tamura, K. Yahiro et al.Artificial Intelligence 315 (2023) 103825With Theorem 5, we can immediately show that TTC-M is GSP.Theorem 6. TTC-M is GSP.Proof. Pápai [39] showed that a mechanism is GSP if and only if it is SP and non-bossy. Since TTC-M is SP (Theorem 3) and non-bossy (Theorem 5), TTC-M is GSP. (cid:2)Recall that the strong core can be empty in our setting (Example 2). We show that the matching obtained by TTC-M is always in the weak core.Theorem 7. TTC-M always yields a matching in the weak core.. Moreover, condition (i) guarantees that permutation σ of S(cid:10) ⊆ S exist such that (i) for each c ∈ C , |{(s, c) ∈ μ(cid:10) | s ∈ S(cid:10), μ(cid:10)(s) (cid:4)s μ(s). Since TTC-M is IR, μ(s) (cid:11)s ˜μ(s) for each s ∈ SProof. Towards a contradiction, we assume that TTC-M returns matching μ that is not in the weak core: i.e., another matching μ(cid:10) ∈ M and a group of students S(cid:10)}|. By condition (ii), μ(cid:10)(s) (cid:5)= ˜μ(s) for and (ii) for every s ∈ S(cid:10)= ˜μσ (s) and s (cid:5)= σ (s) for each every s ∈ S= {(ˆsi, ω(ˆsi+1))} for each i ∈ [| ˆS| − 1] and (cid:10)s ∈ Sμ(cid:10). It implies that a set of students ˆS = {ˆs1, . . . , ˆs| ˆS|} ⊆ S= {(ˆs| ˆS|, ω(ˆs1))}. Let ˆC denote the set of initial endowment schools of students in ˆS .ˆs| ˆS|Consider student ˆsi ∈ ˆS who is the first assigned by TTC-M among the students in ˆS . Let ki denote the round at which ˆsiis assigned by TTC-M. Students ˆS and schools ˆC are in V ki since ˆsi is the first student assigned among ˆS . At round ki , student ˆsi points to μ(ˆsi) and is accepted, even though ω(ˆsi+1) = μ(cid:10)(ˆsi) (cid:4)ˆsi μ(ˆsi) holds (when i = | ˆS|, ω(ˆs1) = μ(cid:10)(ˆsi) (cid:4)ˆsi μ(ˆsi)holds). This is possible only when ω(ˆsi+1) (or ω(ˆs1)) has already quit the market. However, this contradicts the fact that ω(ˆsi+1) (or ω(ˆs1)) remains at round ki . (cid:2)exists such that μ(cid:10)ˆsi(cid:10)}| = |{(s, c) ∈ ˜μ | s ∈ Sexists such that μ(cid:10)s(cid:10)(cid:10)(cid:10)Finally, we examine the time complexity of TTC-M.Theorem 8. The time complexity of TTC-M is O (mn) under the assumption that we can check in O (1) time whether ν ∈ F for an M-convex set F and a vector ν on C .Proof. Since at least one cycle exists in each round, at least one student in S leaves the market with her allocation. There-fore, the number of rounds required for TTC-M is at most n. At each round, there are at most m students who can be part of the cycles since each remaining school points to exactly one student, and finding the cycles can be done in O (m). Furthermore, a school needs to check whether a student is admissible. By Lemma 5, when a student becomes inadmissible (or she is inadmissible in the initial round), she remains inadmissible in all future rounds. Thus for each school, the cost required for this check (until it leaves the market) is O (n). To be more precise, in the first round, each school goes through (cid:4)∗c from the top until it finds the first admissible student. In the next round, it checks whether the student, to whom it points in the previous round, remains in the market and is admissible. If she is no longer admissible (or left the market), it again goes through (cid:4)∗c . Thus, the total number of checks for each school is O (n). Hence, the overall time complexity is O (mn). (cid:2)5.3. TTC among representativesIn this subsection, we study a special case of TTC-M, which restricts the set of feasible vectors F to {ν( ˜μ)}, i.e., the mechanism only outputs matchings whose distribution vector is identical to that of the initial endowment. This mechanism is identical to a mechanism called the Top Trading Cycles among Representatives (TTC-R) [17]. In TTC-R, the number of students assigned to each school is fixed; if a school accepts a student from another school, one of its initial endowment students must leave. At each round, each school points to its top-ranked initial endowment student, each student points to her favorite school, and all the students caught in cycles are allocated to their favorite schools. That is, these top-ranked students (representatives) exchange seats among themselves. When the top-ranked student of school c leaves the market, the second-ranked student becomes the representative of school c, and so forth.Since TTC-R is equivalent to TTC-M, when we artificially restrict the set of feasible vectors to a set containing only the initial endowment distribution vector, TTC-R remains feasible, IR, and SP. However it fails to satisfy the efficiency require-ments. In addition, since we can show that it is non-bossy using a similar argument from the proof of Theorem 5, it is also GSP. We can also show that the matching obtained by TTC-R is in the weak core by using a similar argument from the proof of Theorem 7.Theorem 9. TTC-R is GSP and always yields a matching in the weak core.16T. Suzuki, A. Tamura, K. Yahiro et al.Artificial Intelligence 315 (2023) 103825However, since TTC-R artificially restricts the set of feasible vectors, the following example easily shows that TTC-R is not NW-R.Example 4. Consider the following market:• S = {s1, s2, s3}• C = {c1, c2, c3}• ω(s1) = c1, ω(s2) = c1, ω(s3) = c2• (cid:4)S and (cid:4)C are given as follows:s1 : c1 (cid:4)s1 c2 (cid:4)s1 c3s2 : c3 (cid:4)s2 c2 (cid:4)s2 c1s3 : c1 (cid:4)s3 c2 (cid:4)s3 c3c1 : s1 (cid:4)c1 s2 (cid:4)c1 s3c2 : s3 (cid:4)c2 s1 (cid:4)c2 s2c3 : s2 (cid:4)c3 s3 (cid:4)c3 s1• The set of feasible vectors is given as follows:(cid:6)(cid:6)(cid:6)(cid:6)i∈[3] νi = 3,0 ≤ ν1, ν2, ν3 ≤ 3.ν ∈ Z3≥0F =(cid:2)(cid:17)(cid:14)Under common serial order s1 (cid:4) s2 (cid:4) s3, artificially modified schools’ preferences (cid:4)∗C are given as follows:c1 : s1 (cid:4)∗c1c2 : s3 (cid:4)∗c2c3 : s1 (cid:4)∗c3s2 (cid:4)∗c1s1 (cid:4)∗c2s2 (cid:4)∗c3s3s2s3In TTC-R, the set of feasible vectors is artificially restricted to F = {(2, 1, 0)}. Then c3 immediately leaves the market since it has no admissible student. In the first round, each student points to her favorite remaining school: s1 to c1, s2 to c2, and s3 to c1. According to (cid:4)∗C , c1 points to s1 and c2 points to s3, forming cycle (s1, c1, s1). In the second round, cycle (s2, c2, s3, c1, s2) is formed. Therefore TTC-R outputs matching:(cid:11)(cid:12)c1{s1, s3}c2c3{s2} ∅.Student s2 claims an empty seat in c3 based on ranks since rank((s2, c3)) = 1 < rank((s2, c2)) = 2. Hence, TTC-R is not NW-R.Example 4 also implies that TTC-R is not NW or PE. Besides that TTC-R is not NW, NIE-fairness does not hold either, as shown in the following example.Example 5. Consider the following market:• S = {s1, s2, s3}• C = {c1, c2, c3}• ω(s1) = c1, ω(s2) = c3, ω(s3) = c2• (cid:4)S and (cid:4)C are given as follows:s1 : c2 (cid:4)s1 c1 (cid:4)s1 c3s2 : c2 (cid:4)s2 c3 (cid:4)s2 c1s3 : c3 (cid:4)s3 c2 (cid:4)s3 c1c1 : s1 (cid:4)c1 s2 (cid:4)c1 s3c2 : s3 (cid:4)c2 s1 (cid:4)c2 s2c3 : s2 (cid:4)c3 s3 (cid:4)c3 s1• Set of feasible vectors F is given as {(1, 1, 1)}.That is, each school, which has exactly one initial endowment student, leaves the market after it is included in a cycle. Thus, the choice of a common serial order does not affect the behavior of TTC-R. In the first round, cycle (s2, c2, s3, c3, s2)is formed. In the second round, schools c2 and c3 leave the market; cycle (s1, c1, s1) is formed. Thus the obtained matching is:(cid:11)(cid:12)c1{s1}c2{s2}c3{s3}.Observe that student s1 has justified RIE-envy towards s2 since s1 (cid:4)c2 s2 and ω(s2) (cid:5)= c2, which implies that TTC-R is not NIE-fair.17T. Suzuki, A. Tamura, K. Yahiro et al.Artificial Intelligence 315 (2023) 1038255.4. Characterization of TTC-MTTC’s characterization has been actively developed for several models [53–55]. Characterization shows that both (i) a mechanism satisfies some axioms and (ii) no other mechanism exists that satisfies those axioms, i.e., any mechanism that satisfies those axioms must obtain the same outcome. In this subsection, we present the characterization of TTC-M in compatible markets, in which school preferences satisfy a condition called compatibility.Market (S, C, ω, (cid:4)S , (cid:4)C , F ) is compatible if (cid:4)C satisfies the following property:Definition 13 (Compatibility). A profile of school preferences is compatible if a bijection η : S ←→ [n] exists such that for any school c ∈ C and any pair of students s1, s2 ∈ S, the following conditions hold:(i) if ω(s1) = c and ω(s2) (cid:5)= c, s1 (cid:4)c s2,(ii) if ω(s1) (cid:5)= c and ω(s2) = c, s2 (cid:4)c s1,(iii) otherwise, s1 (cid:4)c s2 if and only if η(s1) < η(s2).In a compatible market, each school always prefers its initial endowment students over the remaining students. Fur-thermore, since η is a bijection, for any pair of students s1, s2 ∈ S, η(s1) (cid:5)= η(s2) holds. Then assuming s1, s2 is any pair of students among the initial endowment (respectively, among non-initial endowment) students of school c, s1 (cid:4)c s2 if and only if η(s1) < η(s2). In other words, for all schools, the relative preference ranking between any pair of initial endowment students (respectively, any pair of non-initial endowment students) is consistent with η.Since the compatible markets lay in a subclass of the general markets, TTC-M satisfies SP, IR and PE when it is applied to a compatible market. We further introduce another desirable property called weak consistency (WC). As its name suggests, WC is a weaker condition of consistency, which is widely used in the existing literature, e.g., using consistency to characterize a mechanism in a house allocation market with existing tenants [56].To introduce WC, we need some additional concepts and notations. Given an arbitrary compatible market (S, C, ω, (cid:4)S, (cid:4)C , F ), student s ∈ S, whose initial endowment school is c j , is admissible to school ci if ν( ˜μ) + χi − χ j ∈ F holds. School c ∈ C is active if it has at least one admissible student in S; otherwise, it is inactive. For student s ∈ S, let c∈ C denote the ∈ S denote the top-ranked admissible student of c by (cid:4)c . For top-ranked active school of s by (cid:4)s. For active school c, let sany m-dimensional vector x ∈ Zm≥0, let F −x denote the set of remaining vectors after subtracting x from each element in F . Formally, F −x = {ν | ν + x ∈ F , ∀i ∈ [m], νi ≥ 0}. Note that if for ν(cid:10) ∈ F , ν(cid:10) − x has a negative element, and then ν(cid:10) − x is not included in F −x.∗c∗sWith these concepts and notations, we define the following concept, which is crucial in WC’s definition. First, let us introduce a concept called the Mutually Best (MB) group. In an MB group, each student is top-ranked by a school in the group, and vice versa. Formally, it is defined as follows.Definition 14 (Mutually Best (MB) group). In compatible market (S, C, ω, (cid:4)S , (cid:4)C , F ), (Smutually best group if ∀c ∈ C, such that c = c∗, ∃c ∈ C∗, ∃s ∈ S∗s , and ∀s ∈ S, such that s = s∗∗∗), where S∗c hold.∗, C∗ ⊆ S and C∗ ⊆ C , is a Note that |S∗to C∗∗| = |C∗(or from CSgroups is also an MB group. An MB group (San MB group.∗| since each student has only one top choice, as does each school. Therefore, a bijection exists from ). Notice that in a compatible market, more than one MB group can exist, and any union of MB to S(cid:10)) is also ∗) is minimal if there exists no Ssuch that (Sand C(cid:10) (cid:2) C(cid:10) (cid:2) S∗, C(cid:10), C∗∗∗∗∗For a given mutually best group (S∗, CThe MB market is defined as (S∗), we partition the original market into two compatible markets: MB and residual.∗). We assume ω∗(s) = c such that s∗= s holds. For each student c∗, ˜(cid:4)s is basically identical to (cid:4)s in the original market, but it is restricted to schools C. Similarly, for each school = ω∗(c) at ∗, ˜(cid:4)c is basically identical to (cid:4)c in the original market, but it is restricted to students in S; otherwise x j = 0, for each j ∈ [m]. x is identical to contains only one vector x such that x j = 1 if c j ∈ Cs ∈ Sc ∈ Cthe top of ˜(cid:4)c . Fthe vector of the initial endowment given by ω∗∗, C∗, ω∗, ˜(cid:4)S∗ , ˜(cid:4)C ∗ , Fand places sOn the other hand, the residual market is defined as (S, ω is the same as the original market. Her preference is identical to (cid:4)s in the original market. For each school c ∈ C , ˜(cid:4)c is basically identical to (cid:4)c in the original market, but it is restricted to the students in S. F −x is the set of vectors obtained by subtracting the only feasible vector x in the MB market from each element of F .S−∗ , ˜(cid:4)C , F −x). In this market, S−∗, C, ω, (cid:4)−∗ = S \ S−∗∗c∗∗∗.Now we are ready to define WC. Intuitively, WC means that if we partition the original market into MB and residual markets and apply the mechanism separately in these partitioned markets, each student is assigned to the same school in the original and partitioned markets.Definition 15 (Weak consistency (WC)). Let (Srespectively denote the matchings obtained by running mechanism ϕ in the original, MB, and residual markets. Mechanism ϕ satisfies weak consistency if μ = μ∗ ∪ μ−∗∗) be an MB group in a compatible market. Let μ, μ∗, and μ−∗holds.∗, CTheorem 10. TTC-M is WC in any compatible market.18T. Suzuki, A. Tamura, K. Yahiro et al.Artificial Intelligence 315 (2023) 103825Proof. To make the proof concise, we introduce a slightly modified version of TTC-M, in which we choose exactly one cycle in each round and each student in that cycle is assigned to the school to which she is pointing, and the students in the other cycles remain in the market. Since the way of choosing one cycle from multiple candidates is arbitrary, each round in the original TTC-M might be divided into several rounds in the modified TTC-M. It is clear that this modified TTC-M outputs the same matching as the original TTC-M.∗), the original TTC-M satisfies WC. First, we illustrate that the original TTC-We show that for any MB group (Sdenotes all the students) and the in both the residual market (in which SM outputs an identical matching for S∗) consists of k (k ∈ Z>0, i.e., positive integer) minimal MB groups. Observe that for original market. Assume that (Seach minimal MB group, a cycle exists that is formed in the first round of the original TTC-M. Then we can find one instance of the modified TTC-M, in which the cycles formed in the first k cycles exactly correspond to these k minimal MB groups. Based on how we construct the residual market and the procedure of the modified TTC-M, the matching obtained in the residual market and the matching for Sin the original market (by the modified TTC-M) must be identical. Since both the modified and the original TTC-M obtain an identical matching, the original TTC-M also outputs an identical matching for Sin both the residual and original markets.∗, C−∗∗, C−∗−∗−∗Next we show that TTC-M outputs an identical matching for Sin both the MB and original markets. In the MB market, the top-ranked active school (resp. admissible student) of each student (resp. each school) is consistent to that in the original ∗market. Therefore, in both the MB and original markets, Sand Csin both markets.form identical cycles, and each s ∈ Sis matched to c∗∗∗∗Thus, TTC-M satisfies WC. (cid:2)Theorem 11. In compatible markets, if a mechanism satisfies SP, PE, and WC, it obtains identical matching as TTC-M.Proof. The proof is developed based on a modified TTC-M (simply called TTC-M below) used in the proof of Theorem 10. We assume that mechanism ϕ satisfies SP, PE, and WC. First we prove that in the MB market, which is constructed by the students and the schools in the first cycle (round) of TTC-M, ϕ outputs identical matching as TTC-M. Then we can apply similar arguments to the residual market, i.e., proving the above claim in the MB market, which consists of the students and the schools in the first cycle of TTC-M in the above residual market. By repeating this process, the proof can be completed.∗) denote the (minimal) MB group, such that it forms the cycle in the first round of TTC-M in the original ∗, μ(s) =∗, (s, c) ∈market. Additionally, let μ denote the matching obtained by TTC-M in the original market. Note that for any s ∈ Ss , i.e., each student in the MB group is assigned to her top-ranked active school. Let μ(cid:10) ⊆ μ denote {(s, c) | s ∈ S∗cμ}.Let (S∗, CSince in the MB market, the only feasible vector is x, where x j = 1, if c j ∈ C, otherwise x j = 0, for each j ∈ [m]. Since is school-feasible. Furthermore, by the assumption that ϕ is PE, in the MB market, ϕ must output μ(cid:10)∗ν(μ(cid:10)) = x holds, μ(cid:10)since it is the unique PE matching in the MB market.Next we consider the residual market, which is constructed after removing the above MB market of (Sbe a (minimal) MB group of the residual market, such that (Sresidual market. Then we can apply a similar argument to the MB market, which consists of (Soutputs {(s, c) | s ∈ S∗1, (s, c) ∈ μ}.∗1, C∗1)∗1) forms the cycle in the first round of TTC-M in the ∗1), and show that ϕ∗). Let (S∗1, C∗1, C∗, CWe repeat the process and conclude that in each MB group, ϕ outputs consistent matching as μ. By WC, in the original market, ϕ outputs μ, which is identical to the matching obtained by TTC-M. (cid:2)Note that we do not require that ϕ satisfies IR since it is automatically satisfied if WC is satisfied in a compatible market. Also, note that we do not explicitly use SP. Due to the well-known revelation principle [57], even if mechanism ϕ is not SP, as long as PE and WC are satisfied in a dominant strategy equilibrium, we can still show the equivalence with TTC-M.6. Deferred Acceptance based mechanismsIn this section, we study DA-based mechanisms. First we describe a simple extension of DA called the Artificial Cap Deferred Acceptance (ACDA) mechanism. Then we introduce our second main mechanism called DA based on Ranks (DA-R).6.1. Artificial Cap Deferred AcceptanceIn this subsection, we introduce Artificial Cap Deferred Acceptance (ACDA). Its idea is used in the Japan Residency Match-ing Program (JRMP) [6]. ACDA fixes the maximum quotas of each school/hospital such that the distributional constraints are automatically satisfied.For each school c, we set artificial maximum quota qc to | ˜μ(c)|, i.e., the number of its initial endowment students. Therefore, the distribution vector of output matching by ACDA is ν( ˜μ), which must be school-feasible. The preference of each school, (cid:4)c , is modified as ˜(cid:4)c such that each of its initial endowment students is preferred over any students in S \ ˜μ(c). holds if one of the following conditions holds:More specifically, for each school c, for each pair of students s and s(cid:10)(cid:10), s ˜(cid:4)c s1. ω(s) = c and ω(s(cid:10)) (cid:5)= c,19T. Suzuki, A. Tamura, K. Yahiro et al.Artificial Intelligence 315 (2023) 103825Mechanism 2 Deferred Acceptance (DA).Step 1:Step 2:Step 3:Each student s applies to her favorite school according to (cid:4)s from which she has not yet been rejected.Each school c provisionally accepts students applying to it up to its maximum quota based on ˜(cid:4)c ; the rest of the students are rejected.If no student is rejected, then return the current assignment as a final matching. Otherwise, go to Step 1.2. s (cid:4)c s3. s (cid:4)c s(cid:10)(cid:10)and ω(sand ω(s(cid:10)) (cid:5)= c, ω(s(cid:10)) = ω(s(cid:10)) = c.(cid:10)) (cid:5)= c, orThe mechanism performs the standard DA procedure (Mechanism 2) using ( ˜(cid:4)c)c∈C and (qc)c∈C . We show an example to illustrate how ACDA works.Example 6. Consider the following market:• S = {s1, s2, s3, s4}• C = {c1, c2, c3}• ω(s1) = c1, ω(s2) = ω(s3) = c2, ω(s4) = c3• (cid:4)S and ˜(cid:4)C are given as follows:s1 : c2 (cid:4)s1 c3 (cid:4)s1 c1s2, s3, s4 : c1 (cid:4)s c2 (cid:4)s c3c1 : s1 ˜(cid:4)c1 s2 ˜(cid:4)c1 s4 ˜(cid:4)c1 s3c2 : s2 ˜(cid:4)c2 s3 ˜(cid:4)c2 s4 ˜(cid:4)c2 s1c3 : s4 ˜(cid:4)c3 s1 ˜(cid:4)c3 s2 ˜(cid:4)c3 s3• The set of feasible vectors F is given as follows:(cid:6)(cid:6)(cid:6)(cid:6)(cid:6)(cid:6)⎧⎨⎩ν ∈ Z3≥0i∈[3] νi = 4,0 ≤ ν1, ν2 ≤ 3,1 ≤ ν3 ≤ 4.F =⎫⎬(cid:2)⎭Set F represents a situation where at least one student must be assigned to c3. Since ACDA sets artificial maximum quotas according to the initial endowment ω, quotas q1, q2, and q3 are set to 1, 2, and 1, respectively.Each student applies to her favorite school, specifically, s2, s3, and s4 apply to c1, and s1 applies to c2. Since three = 1, c1 accepts s2, who is more preferred according to ˜(cid:4)c1 , students are applying to c1, which exceeds maximum quota qc1and rejects s3 and s4. Similarly, c2 accepts s1. Students who were rejected in the previous step, s3 and s4, apply to c2. Then = 2. Hence, c2 accepts s3 and s4 and rejects three students, s1, s3, and s4, apply to c2, which exceeds maximum quota qc2s1. Finally, s1 applies to c3 and is accepted. All students are accepted, and the mechanism terminates.The following is the obtained matching:(cid:11)(cid:12)c1{s2}c2{s3, s4}c3{s1}.We show ACDA satisfies several fundamental desiderata although it can be excessively inefficient.Theorem 12. ACDA is feasible, IR, NIE-fair, and SP, but is not NW-R.Proof. Since qc = | ˜μ| and ˜(cid:4)c is constructed such that each initial endowment student is preferred more than any non-(cid:10) ⊆ S, student s, who is an initial endowment student of c, is within top qc students initial endowment student, for any Saccording to ˜(cid:4)c . This means that s is never rejected from c in ACDA if she applies to it. Thus ACDA satisfies IR.school, then each student sω(sFurthermore, DA satisfies fairness according to the given schools’ preferences ˜(cid:4)C [7]; if s prefers c over her assigned (cid:10) (cid:4)c s or assigned to c is more preferred than s according to ˜(cid:4)c . This means that either s(cid:10)) = c holds. Thus, ACDA satisfies NIE-fairness.Since DA is SP [58,59], and the artificial maximum quotas are determined independently from the students’ preferences, (cid:10)ACDA is also SP. Furthermore, since DA is feasible for given maximum quotas [7], ACDA is feasible.We show that ACDA fails to satisfy NW-R by Example 4. It is clear that ˜(cid:4)C is consistent with (cid:4)C in this example. Since ν( ˜μ) = (2, 1, 0), the artificial cap of ACDA is (2, 1, 0). Then each student applies to her favorite school, that is, s1 and s3apply to c1, and s2 applies to c3. However, since (2, 0, 1) violates the artificial cap, s2 is rejected by c3 and then applies to c2. The following matching is obtained:(cid:11)(cid:12)c1{s1, s3}c2c3{s2} ∅.In the matching, student s2 claims an empty seat in c3 based on ranks since rank((s2, c3)) = 1 < rank((s2, c2)) = 2. Thus, ACDA fails to satisfy NW-R. (cid:2)20T. Suzuki, A. Tamura, K. Yahiro et al.Artificial Intelligence 315 (2023) 103825Mechanism 3 Deferred Acceptance based on Ranks (DA-R).Initialize μ ← ∅, μ(cid:10) ← ∅, Re ← ∅.Step 1:Step 2:μ ← Ch S (M \ Re), μ(cid:10) ← ChC (μ).If μ = μ(cid:10), then return μ. Otherwise, Re ← Re ∪ (μ \ μ(cid:10)), and go to Step 1.6.2. Deferred Acceptance mechanism based on RanksIn this subsection, we introduce the Deferred Acceptance mechanism based on Ranks (DA-R) and describe its properties. Kojima et al. [1] presented a very general, abstract class of mechanisms, which works for any M-convex constraints, called Generalized DA (GDA). That class of mechanisms exploits choice functions for students (Ch S ) and schools (ChC ). Any GDA instance is guaranteed to satisfy SP. DA-R is one particular, concrete instance that belongs to this class. We construct DA-R such that it also satisfies IR.Definition 16 (Choice function for students). For each student s, let Chs denote her choice function, which is defined as follows. Given μ ⊆ M, let ˆμs denote {(s, c) ∈ μs | c (cid:11)s ω(s)}. Then Chs(μ) returns {x} such that x ∈ ˆμs and x is the most preferred contract in ˆμs for s. The choice function of all students Ch S is defined as: Ch S (μ) =(cid:18)s∈S Chs(μ).Definition 17 (Choice function for schools). Given μ ⊆ M, the choice function of the schools returns set of contracts ChC (μ), which is defined as:ChC (μ) = arg maxμ(cid:10)⊆μf (μ(cid:10)).Here f : 2We assume fM → R ∪ {−∞} is an evaluation function that aggregates the school preferences and distributional constraints. is unique-selecting; i.e., for all μ ⊆ M, a unique subset μ(cid:10) ⊆ μ exists that maximizes f (μ(cid:10)).Based on these choice functions, DA-R is defined by Mechanism 3. Here Re represents a set of contracts proposed by the students and rejected by the schools in previous steps. Students are not allowed to propose a contract in Re, which is initially empty. Each student chooses her most preferred contract in M \ Re. Here μ represents the set of contracts proposed by students. Then schools choose subset μ(cid:10)from μ by ChC . If no contract is rejected, the mechanism terminates. Otherwise, the rejected contracts are added to Re, and the mechanism repeats the same procedure.Kojima et al. [1] concluded that if f satisfies a property called M(cid:2)-concavity, then GDA satisfies several desirable prop-erties. Furthermore, they showed several methods for constructing f that satisfies M(cid:2)-concavity. In this paper, we follow is expressed as f = (cid:15)f + (cid:19)f . (cid:15)f represents hard distributional one of them: divide fconstraints, and (cid:19)fis concerned with soft constraints that reflect the schools’ preferences.into two parts, (cid:15)f and (cid:19)f , such that fKojima et al. [1] also showed the following result.Lemma 7 (Condition 1, [1]). f satisfies M(cid:2)-concavity,10 if (i) (cid:15)f is defined based on an M(cid:2)-convex set [19], and (ii) each contract x is associated with value v(x), and (cid:19)f (μ) is defined as (cid:2)x∈μ v(x).First, we show how (cid:15)fis defined. For m-element vectors v and v(cid:10), we write v ≤ v(cid:10)if for each i ∈ [m], v i ≤ v(cid:10)i holds.Definition 18 (Hard distributional constraints). Given μ ⊆ M, (cid:15)f (μ) is defined as:(cid:14)(cid:15)f (μ) =if ν ∈ F exists such that ν(μ) ≤ ν holds,0−∞ otherwise.Intuitively, (cid:15)f (μ) = 0 holds when ν ∈ F exists such that ν(μ) is smaller than or equal to ν by element-wise comparison. The set {ν(cid:10) | ∃ν ∈ F s.t. ν(cid:10) ≤ ν} becomes an M(cid:2)-convex set when F is an M-convex set. Thus, (cid:15)f (·) satisfies requirement (i).Next we show how (cid:19)fis defined such that it satisfies condition (ii), i.e., it is represented as a sum of contract values.Definition 19 (Schools’ preference). Given μ ⊆ M, (cid:19)f (μ) is defined as:(cid:19)f (μ) =(cid:13)x∈μv(x).10 These conditions correspond to Condition 1 in Kojima et al. [1], which requires that the family of feasible matchings constitute a mathematical structure called matroid. In our setting, distributional constraints are defined on distributional vectors. This requirement is satisfied when the family of feasible distributional vectors constitutes an M(cid:2)-convex set.21T. Suzuki, A. Tamura, K. Yahiro et al.Artificial Intelligence 315 (2023) 103825Procedure 1 Procedure for calculating ChC (μ).Initialize μ(cid:10) ← ∅.Step 1:Step 2:Step 3:Remove x from μ such that v(x) is the largest.If (cid:15)f (μ(cid:10) ∪ {x}) = 0, then add x to μ(cid:10)If μ is empty, then return μ(cid:10).. Otherwise, go to Step 1.Here v : M → (0, ∞) is a function that gives the value of each contract:Definition 20 (Contract value function). For contract (si, c j), its value v((si, c j)) is defined as:v((si, c j)) = C1(n − rank((si, c j))) + C2(m − j) + (n − i).Here C1, C2 are constants that satisfy C1 (cid:20) C2 (cid:20) n, and rank((si, c j)) is the ranking of student si by school c j (Defini-tion 7). From this definition, it is easy to show that v satisfies the following properties:(cid:10), c(cid:10), c(cid:10)), such that rank((s, c)) < rank((s1. For two contracts, (s, c) and (s(cid:10), ck), such that rank((s, c j)) = rank((s2. For two contracts, (s, c j) and (s3. For two contracts, (si, c) and (sk, c), where rank((si, c)) = rank((sk, c)) and i < k, v(si, c) > v(sk, c) holds.(cid:10))), v((s, c)) > v((s(cid:10), ck)) and j < k, v((s, c j)) > v((s(cid:10))) holds.(cid:10), c(cid:10), ck)) holds.The first property denotes that a higher-ranked contract is more valuable. In particular, a contract corresponding to an initial endowment is more valuable than any non-initial endowment contracts. The second property is used for tie-breaking among contracts with the same ranking by different schools. The third property guarantees that, for any pair of contracts (cid:10)). More specifically, rank((si, c)) = rank((sk, c)) holds only if ω(si) = ω(sk) = c holds, i.e., (cid:10)x and xboth si and sk are c’s initial endowment students. Neither contract is ever rejected; their relative ordering does not affect the ChC output.When (cid:15)f and (cid:19)f are defined in this way, a greedy procedure (Procedure 1) obtains μ(cid:10) ⊆ μ that maximizes f (μ(cid:10)), i.e., ChCimplies v(x) (cid:5)= v(x(cid:10), x (cid:5)= xcan be calculated efficiently [1].We show the execution of DA-R with Example 7.Example 7. We consider the same instance as in Example 6. First, each student chooses her favorite acceptable con-tract. Thus, μ = {(s1, c2), (s2, c1), (s3, c1), (s4, c1)}. Based on Procedure 1, (s2, c1), (s4, c1), and (s1, c2) are added to μ(cid:10). Next (s3, c1) is selected, but no ν ∈ F exists such that (3, 1, 0) ≤ ν holds. Thus, (s3, c1) is not included in μ(cid:10). Then μ(cid:10) = {(s1, c2), (s2, c1), (s4, c1)}, and μ \ μ(cid:10) = {(s3, c1)} is rejected.Student s3 next chooses her second favorite contract (s3, c2), and other students choose the same schools as be-fore. Thus μ = {(s1, c2), (s2, c1), (s3, c2), (s4, c1)}. Based on Procedure 1, (s3, c2), (s2, c1), and (s4, c1) are added to μ(cid:10). Next (s1, c2) is selected,11 but no ν ∈ F exists such that (2, 2, 0) ≤ ν holds. Thus, (s1, c2) is not included in μ(cid:10). Then μ(cid:10) = {(s2, c1), (s3, c2), (s4, c1)}, and μ \ μ(cid:10) = {(s1, c2)} is rejected.Finally, s1 chooses her second favorite contract (s1, c3). Thus, μ = {(s1, c3), (s2, c2), (s3, c2), (s4, c1)}. (cid:15)f (μ) = 0 since ν(μ) = (2, 1, 1) ∈ F . No contract is rejected, and the mechanism terminates.The following is the obtained matching:(cid:11)(cid:12)c1{s2, s4}c2{s3}c3{s1}.It satisfies IR and NIE-fairness.ACDA is a special case of DA-R, if the set of feasible vectors F is artificially restricted to {ν( ˜μ)}, i.e., it contains exactly one vector that is identical to the distribution vector of the initial endowment. We can see that ACDA is much less flexible than DA-R.Next we describe the theoretical properties of DA-R.Theorem 13. DA-R is feasible, SP, and NIE-fair.Proof. Since DA-R follows conditions (i) and (ii) in Lemma 7, it is guaranteed to be school-feasible and SP. Next we show that DA-R is IR, which (with school-feasibility) leads to DA-R also being feasible. Observe that student s is never rejected by (cid:10) ∈ μ \ ˜μ, her initial endowment school ω(s) because, for any μ and initial endowment ˜μ, and two contracts x ∈ μ ∩ ˜μ and x(cid:10)) holds. Thus, all the contracts in μ ∩ ˜μ are chosen before any contract in μ \ ˜μ. Furthermore, (cid:15)f (μ ∩ ˜μ) = 0v(x) > v(xsince ν( ˜μ) ∈ F holds. Hence, DA-R satisfies IR.11 Here rank((s1, c2)) = rank((s4, c1)) = 2. v((s1, c2)) < v((s4, c1)) is derived by the second property of v.22T. Suzuki, A. Tamura, K. Yahiro et al.Artificial Intelligence 315 (2023) 103825We next show that DA-R is NIE-fair. Assume that student s prefers c over her assigned school, then for each student sassigned to c, v((s(cid:10), c)) > v((s, c)) holds. This means that either s(cid:10)is c’s initial endowment student or s(cid:10) (cid:4)c s holds. (cid:2)(cid:10)Theorem 14. DA-R is NW-R.(cid:10))}) and (s, c(cid:10)) ∈ Ch S (μ ∪ {(s, cProof. Kojima et al. [1] showed that DA-R satisfies a property called Hatfield-Milgrom (HM)-stability. This property means (cid:10)) ∈ M \ μ exists such that that for matching μ obtained by DA-R, μ = ChC (μ) = Ch S (μ) holds, and no contract (s, c(s, c(cid:10)) ∈ ChC (μ ∪ {(s, c(cid:10)Toward a contradiction, we assume for matching μ obtained by DA-R, s claims an empty seat in c(cid:10))) < rank((s, c)) holds. Furthermore, (μ \ {(s, c)}) ∪ {(s, c(cid:10))}) holds. Let us next examine ChC (μ ∪ {(s, cbased on ranks, i.e., (cid:10))} is school-feasible.(cid:10))}). In Procedure 1, since (cid:10)) is selected before (s, c). Since μ is feasible, all contracts (cid:10))} is also school-(cid:10))} is school-feasible, its subset μ(cid:10) ∪ {(s, c(cid:10))) > v((s, c)) holds. Thus, (s, c. Since (μ \ {(s, c)}) ∪ {(s, c(cid:10) (cid:4)s c, it is clear that (s, c(cid:10))) < rank((s, c)), v((s, c(s, c) ∈ μ, (s, cSince crank((s, cselected before (s, cfeasible. Thus, (s, c) ∈ ChC (μ ∪ {(s, c(cid:10))}) holds, violating the fact that DA-R is HM-stable. (cid:2)(cid:10) (cid:4)s c and rank((s, c(cid:10)) ∈ Ch S (μ ∪ {(s, c(cid:10)) are added to μ(cid:10)(cid:10)) ∈ M \ μ, c(cid:10))}) hold.Note that DA-R fails to satisfy NW (or PE), since it is NIE-fair, and NIE-fairness is incompatible with NW as Example 1shows.Next we show that DA-R does not satisfy GSP, and the obtained matching is not in the weak core by the following example.Example 8. We use the same instance as in Example 5. Notice that in this example, ˜(cid:4)C is identical to (cid:4)C . First, each student chooses her favorite acceptable contract. Thus, μ = {(s1, c2), (s2, c2), (s3, c3)}. Based on Procedure 1, (s1, c2) and (s3, c3) are added to μ(cid:10). Next (s2, c2) is selected, but no ν ∈ F exists such that (0, 2, 1) ≤ ν holds. The schools choose μ(cid:10) = {(s1, c2), (s3, c1)}, and μ \ μ(cid:10) = {(s2, c2)} is rejected.Student s2 next chooses her second favorite contract (s2, c3), and the other students choose the same schools as before. . Next (s3, c3) is selected, but no Thus, μ = {(s1, c2), (s2, c3), (s3, c3)}. By Procedure 1, (s2, c3) and (s1, c2) are added to μ(cid:10)ν ∈ F exists such that (0, 1, 2) ≤ ν holds. The schools choose μ(cid:10) = {(s1, c2), (s2, c3)}, and μ \ μ(cid:10) = {(s3, c3)} is rejected.Student s3 next chooses her second favorite contract (s3, c2), and the other students keep their previous choices. Thus, . Next (s1, c2) is selected, but no μ = {(s1, c2), (s3, c2), (s2, c3)}. Based on Procedure 1, (s3, c2) and (s2, c3) are added to μ(cid:10)ν ∈ F exists such that (0, 2, 1) ≤ ν holds. The schools choose μ(cid:10) = {(s2, c3), (s3, c2)}, and μ \ μ(cid:10) = {(s1, c2)} is rejected.Finally, s1 chooses her second favorite contract (s1, c1). Thus, μ = {(s1, c1), (s3, c2), (s2, c3)}. (cid:15)f (μ) = 0 since ν(μ) =(1, 1, 1) ∈ F . No contract is rejected, and the mechanism terminates. The obtained matching is identical to the initial en-dowment matching ˜μ described as follows:(cid:11)c1{s1}c2{s3}c3{s2}(cid:12).We assume s1 misreports her preference as c1 (cid:4)s1 c2 (cid:4)s1 c3, and s2 and s3 report their true preferences. Then DA-R obtains the following PE matching:(cid:12)(cid:11)c1{s1}c2{s2}c3{s3}.(cid:10) = {s1, s2, s3} and the above manipulation, s1’s assignment is unchanged (she is This implies that DA-R is not GSP: for Sweakly better off), and s2 and s3 are strictly better off. Furthermore, if s2 and s3 exchange their initial endowments, both students are strictly better off than ˜μ. Hence, the matching obtained by DA-R is not in the weak core. In this example, ACDA also obtains ˜μ since F = {ν( ˜μ)}. Thus, ACDA fails to satisfy GSP, and the matching obtained by ACDA is not in the weak core.Finally, we discuss DA-R’s time complexity with the following theorem.Theorem 15. The time complexity of DA-R is O (T ( f ) × |M|2), where T ( f ) denotes the time required to calculate f .Proof. According to Theorem 12 in a previous work [1], the required stages of DA-R are O (|M|2), and the time complexity of DA-R is O (T ( f ) · |M|2). (cid:2)Time complexity T ( f ) depends on the complexity of checking whether (cid:15)f (μ(cid:10) ∪ {x}) = 0 holds in Step 2 of Procedure 1. If it can be done in a constant time, then the time complexity of T ( f ) is O (n log n), since when calculating ChC (μ), μ =Ch S (M \ Re) contains n contracts, and sorting μ based on v requires O (n log n) time.23T. Suzuki, A. Tamura, K. Yahiro et al.Artificial Intelligence 315 (2023) 1038257. Experimental evaluationFig. 4. Ratio of students with justified RIE-envy.In this section, we conducted quantitative evaluations with several mechanisms, including TTC-based and DA-based mechanisms. In previous sections, we theoretically showed that TTC-M always outputs PE matchings, and DA-R and ACDA always yield NIE-fair matchings. Although efficiency and fairness are both desirable properties in matching markets, they are incompatible in general. Therefore, we conducted computer simulations to evaluate the degree of efficiency/fairness that these mechanisms can achieve in random markets.In previous sections, we compared the proposed mechanisms: TTC-M, TTC-R, ACDA, and DA-R. As a benchmark, we show the performance of another trivial mechanism called Initial, which always returns the initial endowment matching ˜μ. We evaluated the performance of these mechanisms by comparing several measurements, which can reflect the efficiency or the fairness (e.g., the ratios of students who claim empty seats and who have justified RIE-envy) of the matchings obtained by these mechanisms.In the experiments, we used instances with 800 students and 20 schools. Instances were randomly generated in two types of markets: A and B. In Market A, each school has individual minimum/maximum quotas: pc = 10 and qc = 80. In Market B, distance constraints are implemented, where matching μ is feasible if the Manhattan distance between ν(μ)and the ideal distribution ν∗ = (40, . . . , 40) is smaller than or equal to 300. As described in Section 3, both constraints can be represented as M-convex sets. For ACDA, the artificially restricted maximum quotas of each school is set to 40 in both markets.In all instances, the student preferences are generated by the Mallows model [60–63], where strict preference (cid:4)s of student s is drawn with probability Pr((cid:4)s):Pr((cid:4)s) = exp(−θ · d((cid:4)s, (cid:4)(cid:15)s))(cid:2),exp(−θ · d((cid:4)(cid:10)s, (cid:4)(cid:15)s))(cid:4)(cid:10)swhere θ ∈ R is a spread parameter, (cid:4)(cid:15)s is the central preference (randomly drawn from all possible preferences by uniform distribution), and d((cid:4)s, (cid:4)(cid:15)s) denotes the Kendall tau distance, which is the number of pairwise inversions between (cid:4)s and (cid:4)(cid:15)s. When θ = 0, the Mallows model is equivalent to a uniform distribution. As θ increases, all student preferences quickly converge to the degenerate distribution with the only preference (cid:4)(cid:15)s.In each of the following evaluations, we randomly constructed 100 instances for each parameter setting and compared the average performances of the five mechanisms (TTC-R, TTC-M, ACDA, DA-R, and Initial) over 100 instances except for Figure 8, which plots for each problem instance.7.1. Evaluation of fairnessTo evaluate the degree of fairness, we examined the ratio of students who have justified RIE-envy in the matchings obtained by the mechanisms. Since the DA-based mechanisms (i.e., ACDA and DA-R) as well as Initial are NIE-fair, it is guaranteed that the ratio of students with justified RIE-envy is zero. Thus, we only show the results of TTC-R and TTC-M. Figure 4 shows the average ratio of students with justified RIE-envy with varying spread parameter θ for the students’ preferences. Recall that when θ = 0, the students’ preferences are random, and as θ increases, they quickly become similar. Thus, as θ increases, the competition among students deepens, and fewer students can be allocated to their first (or second) choice schools. Since TTC-based mechanisms do not use schools’ preferences, more students have justified RIE-envy. In both Markets A and B, under each θ setting, the ratio of TTC-M is smaller than that of TTC-R, which implies that TTC-M outperforms TTC-R in terms of fairness. This is because TTC-M is more flexible than TTC-R, where the number of students allocated to each school is fixed.24T. Suzuki, A. Tamura, K. Yahiro et al.Artificial Intelligence 315 (2023) 103825Fig. 5. Ratios of students claiming empty seats.7.2. Evaluation of efficiencyFig. 6. Average Borda scores of students.To compare the efficiency of the mechanisms, we measured the ratio of students who claim empty seats, the Borda scores, and the Cumulative Distribution Function (CDF).Figure 5 shows the average ratios of students who claim empty seats with varying θ . Since TTC-M is PE, it is also NW, i.e., no student claims an empty seat. Thus, we compared four mechanisms: TTC-R, DA-R, ACDA, and Initial. In terms of the ratio of students who claim empty seats, these mechanisms are ranked from lowest/best to highest/worst as follows: DA-R, TTC-R, ACDA, and Initial. That is, a more flexible mechanism performs better in terms of NW. Similar to Figure 4, as θ increases, the competition among students becomes more severe, and more students claim empty seats, except for Initial.Next we evaluated the students’ welfare by the average Borda scores. More specifically, if a student is matched to her i-th choice school, her score is given as m − i + 1. Thus, if all the students are matched to their first choice of school, the average Borda score is m = 20. The higher the Borda score is, the more efficient the mechanism is.Figure 6 shows the average Borda scores of all the students in five mechanisms with varying θ . In terms of the average Borda scores, these mechanisms are ranked from largest/best to smallest/worst as follows: TTC-M, DA-R, TTC-R, ACDA, and Initial. This result implies that a more flexible mechanism performs better in terms of students’ welfare. ACDA/TTC-R is equivalent to DA-R/TTC-M when F is restricted to one feasible distribution vector ν( ˜μ), although in TTC-M and DA-R, Fis expanded to fully utilize the flexibility allowed by the given constraints. Similar to Figures 4 and 5, as θ increases, the competition among students becomes more severe, and their welfare falls, except for Initial.Another way to compare students’ welfare is to check the Cumulative Distribution Functions (CDFs) of their school rankings. Figure 7 shows the average ratios of the students, who are assigned to their i-th choice or a better school, with varying i when θ = 0.3 for the five mechanisms. If the curve of mechanism α is always above that of another mechanism, β, we can conclude that mechanism α outperforms β in terms of students’ welfare. Roughly speaking, these mechanisms are ranked in terms of CDFs from best to worst as follows: TTC-M, DA-R, TTC-R, ACDA, and Initial. Note that TTC-R is slightly better than DA-R for the first and second rankings in both markets. In addition, DA-R is only slightly better than TTC-M when i ≥ 7 in Market B. Perhaps in TTC-based mechanisms, the welfare of the students can be slightly uneven; the welfare of a student who is ranked higher in the common serial order is better, although the welfare of a student who is ranked lower can be rather degraded. Compared to TTC-based mechanisms, DA-R is more balanced.25T. Suzuki, A. Tamura, K. Yahiro et al.Artificial Intelligence 315 (2023) 103825Fig. 7. Cumulative distribution functions when θ = 0.3.7.3. Evaluation of trade-off between fairness and efficiencyFig. 8. Trade-off between fairness and efficiency when θ = 0.3.Finally, to illustrate a trade-off between efficiency and fairness, we plotted the results of the obtained matchings for each problem instance in a two-dimensional space in Figure 8, where the x-axis denotes the average student Borda score (which is a measurement of efficiency/students’ welfare), and the y-axis denotes the ratio of students without justified RIE-envy (which is positively correlated to fairness). Thus, the points located northeast are preferable. Since Initial, ACDA, and DA-R are NIE-fair mechanisms, their ratios are 1. In terms of efficiency, DA-R is clearly optimal in both markets among these three. On the other hand, TTC-R is dominated by TTC-M. Therefore, among these five mechanisms, TTC-M and DA-R are clear winners in terms of these two criteria. TTC-M is the best choice for efficiency; DA-R is the best choice when we emphasize fairness.8. ConclusionWe investigated an allocation problem of multiple types of objects to agents, where each type of object has multiple copies, each agent is endowed with an object, and some distributional constraints are imposed on the allocation. A repre-sentative application domain of this setting is the school choice problem, in which each student has the right to attend her nearby school (and transfers to another school only if she prefers it over her default school), although some distributional constraints, such as minimum/maximum quotas in regions, must be satisfied for schools to operate. We developed two mechanisms that are feasible and SP when distributional constraints are represented as an M-convex set. One mechanism, called TTC-M, satisfies PE, and the other, called DA-R, satisfies NIE-fairness. We experimentally evaluated the performance of these mechanisms in terms of the trade-off between fairness and efficiency by computer simulation.Our future works include developing mechanisms that can work for a class of constraints that is broader than M-convex sets (with weaker efficiency/fairness conditions).Declaration of competing interestThe authors declare that they have no known competing financial interests or personal relationships that could have appeared to influence the work reported in this paper.26T. Suzuki, A. Tamura, K. Yahiro et al.Artificial Intelligence 315 (2023) 103825AcknowledgementWe are grateful to Hiroshi Nakahara who helped with the experimental evaluations.This work was partially supported by JSPS KAKENHI Grant Number JP20H00609, JP21H04979 and JP22K19813.References[1] F. Kojima, A. Tamura, M. Yokoo, Designing matching mechanisms under constraints: an approach from discrete convex analysis, J. Econ. Theory 176 [2] T. Suzuki, A. Tamura, M. Yokoo, Efficient allocation mechanism with endowments and distributional constraints, in: Proceedings of the 17th Interna-tional Conference on Autonomous Agents and MultiAgent Systems (AAMAS-18), 2018, pp. 50–58.[3] A. Abdulkadiro˘glu, T. Sönmez, School choice: a mechanism design approach, Am. Econ. Rev. 93 (2003) 729–747, https://doi .org /10 .1257 /[4] T. Sönmez, M.U. Ünver, Matching, allocation, and exchange of discrete resources, in: A. Bisin, J. Benhabib, M. Jackson (Eds.), Handbook of Social Economics, North-Holland, 2011, pp. 781–852, https://ideas .repec .org /p /boc /bocoec /717.html.[5] P. Biró, T. Fleiner, R.W. Irving, D.F. Manlove, The college admission problem with lower and common quotas, Theor. Comput. Sci. 411 (2010) 3136–3153.[6] Y. Kamada, F. Kojima, Efficient matching under distributional constraints: theory and applications, Am. Econ. Rev. 105 (2015) 67–99, https://doi .org /10 .[7] D. Gale, L.S. Shapley, College admissions and the stability of marriage, Am. Math. Mon. 69 (1962) 9–15, https://doi .org /10 .2307 /2312726.[8] M. Balinski, T. Sönmez, A tale of two mechanisms: student placement, J. Econ. Theory 84 (1999) 73–94, https://doi .org /10 .1006 /jeth .1998 .2469.[9] D. Fragiadakis, A. Iwasaki, P. Troyan, S. Ueda, M. Yokoo, Strategyproof matching with minimum quotas, ACM Trans. Econ. Comput. 4 (2015) 6, https://(2018) 803–833.000282803322157061.1257 /aer.20101552.doi .org /10 .1145 /2841226.publsh /2195 .html.[10] D. Fragiadakis, P. Troyan, Improving matching under hard distributional constraints, Theor. Econ. 12 (2017) 863–908, https://ideas .repec .org /a /the /[11] M. Goto, A. Iwasaki, Y. Kawasaki, R. Kurata, Y. Yasuda, M. Yokoo, Strategyproof matching with regional minimum and maximum quotas, Artif. Intell. [12] M. Goto, F. Kojima, R. Kurata, A. Tamura, M. Yokoo, Designing matching mechanisms under general distributional constraints, Am. Econ. J. Microecon. [13] Y. Kamada, F. Kojima, Stability concepts in matching under distributional constraints, J. Econ. Theory 168 (2017) 107–142, https://doi .org /10 .1016 /j .jet .235 (2016) 40–73, https://doi .org /10 .1016 /j .artint .2016 .02 .002.9 (2017) 226–262, https://doi .org /10 .1257 /mic .20160124.2016 .12 .006.[14] R. Kurata, N. Hamada, A. Iwasaki, M. Yokoo, Controlled school choice with soft bounds and overlapping types, J. Artif. Intell. Res. 58 (2017) 153–184.[15] K. Yahiro, Y. Zhang, N. Barrot, M. Yokoo, Strategyproof and fair matching mechanism for ratio constraints, Auton. Agents Multi-Agent Syst. 34 (2020) 23, https://doi .org /10 .1007 /s10458 -020 -09448 -9.[16] K. Yahiro, M. Yokoo, Game theoretic analysis for two-sided matching with resource allocation, in: Proceedings of the 19th International Conference on Autonomous Agents and Multiagent Systems (AAMAS-20), 2020, pp. 1548–1556.[17] N. Hamada, C.-L. Hsu, R. Kurata, T. Suzuki, S. Ueda, M. Yokoo, Strategy-proof school choice mechanisms with minimum quotas and initial endowments, Artif. Intell. 249 (2017) 47–71, https://doi .org /10 .1016 /j .artint .2017.04 .006.[18] A. Gibbard, Manipulation of voting schemes: a general result, Econometrica 41 (1973) 587–601, https://doi .org /10 .2307 /1914083.[19] K. Murota, Convexity and Steinitz’s exchange property, Adv. Math. 124 (1996) 272–311.[20] K. Murota, Discrete convex analysis, Math. Program. 83 (1998) 313–371.[21] A. Abdulkadiro˘glu, College admissions with affirmative action, Int. J. Game Theory 33 (2005) 535–549, https://doi .org /10 .1007 /s00182 -005 -0215 -7.[22] L.S. Shapley, H. Scarf, On cores and indivisibility, J. Math. Econ. 1 (1974) 23–37.[23] K. Murota, Matrices and Matroids for Systems Analysis, vol. 20, Springer Science & Business Media, 2009.[24] A. Schrijver, Combinatorial Optimization – Polyhedra and Efficiency, Springer, 2003.[25] B. Korte, J. Vygen, Combinatorial Optimization, Theory and Algorithms, fifth edition, Springer, 2012.[26] V. Danilov, G.A. Koshevoy, K. Murota, Discrete convexity and equilibria in economies with indivisible goods and money, Math. Soc. Sci. 41 (2001) 251–273, https://doi .org /10 .1016 /S0165 -4896(00 )00071 -8.[27] K. Murota, Discrete Convex Analysis, SIAM Monographs on Discrete Mathematics and Applications, vol. 10, Society for Industrial and Applied Mathe-[28] K. Murota, A. Tamura, Application of M-convex submodular flow problem to mathematical economics, Jpn. J. Ind. Appl. Math. 20 (2003) 257–277, [29] N. Sun, Z. Yang, Equilibria and indivisibilities: Gross substitutes and complements, Econometrica 74 (2006) 1385–1402, https://www.jstor.org /stable /[30] W.T. Huh, G. Janakiraman, On the optimal policy structure in serial inventory systems with lost sales, Oper. Res. 58 (2010) 486–491, https://doi .org /10 .matics, Philadelphia, 2003.https://doi .org /10 .1007 /BF03167422.3805929.1287 /opre .1090 .0716.jmi :articl :jmi -v1i1a5.doi .org /10 .1016 /j .dam .2005 .10 .006.doi .org /10 .1287 /moor.2014 .0679.[31] P. Zipkin, On the structure of lost-sales inventory models, Oper. Res. 56 (2008) 937–944, https://doi .org /10 .1287 /opre .1070 .0482.[32] K. Murota, A. Shioura, Z. Yang, Computing a Walrasian equilibrium in iterative auctions with multiple differentiated items, in: Proceedings of the 24th International Symposium on Algorithms and Computation (ISAAC-13), in: Lecture Notes in Computer Science, vol. 8283, Springer, 2013, pp. 468–478.[33] K. Murota, Discrete convex analysis: a tool for economics and game theory, J. Mech. Inst. Des. 1 (2016) 151–273, https://EconPapers .repec .org /RePEc :[34] S. Fujishige, A. Tamura, A general two-sided matching market with discrete concave utility functions, Discrete Appl. Math. 154 (2006) 950–970, https://[35] S. Fujishige, A. Tamura, A two-sided discrete-concave market with possibly bounded side payments: an approach by discrete convex analysis, Math. Oper. Res. 32 (2007) 136–155, https://doi .org /10 .1287 /moor.1070 .0227.[36] K. Murota, Y. Yokoi, On the lattice structure of stable allocations in a two-sided discrete-concave market, Math. Oper. Res. 40 (2015) 460–473, https://[37] T. Fleiner, A matroid generalization of the stable matching polytope, in: Proceedings of the 8th International Conference on Integer Programming and Combinatorial Optimization (IPCO-01), Springer, 2001, pp. 105–114.[38] J.W. Hatfield, P.R. Milgrom, Matching with contracts, Am. Econ. Rev. 95 (2005) 913–935, https://doi .org /10 .1257 /0002828054825466.[39] S. Pápai, Strategyproof assignment by hierarchical exchange, Econometrica 68 (2000) 1403–1433, https://www.jstor.org /stable /3003994.[40] M. Pycia, M.U. Ünver, Trading cycles for school choice, SSRN 1899344, 2011, Working Paper.[41] M. Pycia, M.U. Ünver, Incentive compatible allocation and exchange of discrete resources, Theor. Econ. 12 (2017) 287–329, https://doi .org /10 .3982 /TE2201.27T. Suzuki, A. Tamura, K. Yahiro et al.Artificial Intelligence 315 (2023) 103825[42] A. Abdulkadiroglu, Y.-K. Che, P.A. Pathak, A.E. Roth, O. Tercieux, Minimizing Justified Envy in School Choice: the Design of New Orleans’ OneApp, Technical Report 23265, National Bureau of Economic Research, 2017, Working Paper.[43] J. Combe, O. Tercieux, C. Terrier, The design of teacher assignment: Theory and evidence, Working Paper, 2020.[44] C. Terrier, Matching practices for secondary public school teachers – France, Working Paper, 2014.[45] E. Fujita, J. Lesca, A. Sonoda, T. Todo, M. Yokoo, A complexity approach for core-selecting exchange with multiple indivisible goods under lexicographic [46] Z. Sun, H. Hata, T. Todo, M. Yokoo, Exchange of indivisible objects with asymmetry, in: Proceedings of the 24th International Conference on Artificial preferences, J. Artif. Intell. Res. 63 (2018) 515–555.Intelligence (IJCAI-15), vol. 15, 2015, pp. 97–103.(AAAI-17), 2017, pp. 684–690.https://doi .org /10 .1111 /j .1468 -2354 .2012 .00710 .x.[47] S. Sikdar, S. Adali, L. Xia, Mechanism design for multi-type housing markets, in: Proceedings of the 31st AAAI Conference on Artificial Intelligence [48] A. Abdulkadiro˘glu, T. Sönmez, House allocation with existing tenants, J. Econ. Theory 88 (1999) 233–260.[49] P. Guillen, O. Kesten, Matching markets with mixed ownership: the case for a real-life assignment mechanism, Int. Econ. Rev. 53 (2012) 1027–1046, [50] A.E. Roth, A. Postlewaite, Weak versus strong domination in a market with indivisible goods, J. Math. Econ. 4 (1977) 131–137.[51] Y. Kamada, F. Kojima, Fair matching under constraints: theory and applications, Rev. Econ. Stud. (2021), http://ykamada .com /pdf /fair _constraints .pdf, in [52] S. Fujishige, Submodular Functions and Optimizations, 2nd ed., Annals of Discrete Mathematics, vol. 58, Elsevier, Amsterdam, 2005.[53] A. Abdulkadiroglu, Y.-K. Che, The Role of Priorities in Assigning Indivisible Objects: A Characterization of Top Trading Cycles, 2010.[54] T. Morrill, An alternative characterization of top trading cycles, Econ. Theory 54 (2013) 181–197, https://doi .org /10 .1007 /s00199 -012 -0713 -3.[55] U. Dur, A characterization of the top trading cycles mechanism for the school choice problem, SSRN Electron. J. (2012), https://ideas .repec .org /p /pra /[56] T. Sönmez, M.U. Ünver, House allocation with existing tenants: a characterization, Games Econ. Behav. 69 (2010) 425–445, https://doi .org /10 .1016 /j .press.mprapa /41366 .html.geb .2009 .10 .010.[57] N. Nisan, T. Roughgarden, E. Tardos, V.V. Vazirani, Algorithmic Game Theory, Cambridge University Press, 2007.[58] L.E. Dubins, D.A. Freedman, Machiavelli and the Gale-Shapley algorithm, Am. Math. Mon. 88 (1981) 485–494.[59] A.E. Roth, The economics of matching: stability and incentives, Math. Oper. Res. 7 (1982) 617–628.[60] C.L. Mallows, Non-null ranking models. I, Biometrika 44 (1957) 114–130, https://doi .org /10 .2307 /2333244.[61] J. Tubbs, Distance based binary matching, in: Computing Science and Statistics, Springer, 1992, pp. 548–550.[62] J. Drummond, C. Boutilier, Elicitation and approximately stable matching with partial preferences, in: Proceedings of the 23rd International Joint Conference on Artificial Intelligence (IJCAI-13), 2013, pp. 97–105.[63] T. Lu, C. Boutilier, Effective sampling and learning for mallows models with pairwise-preference data, J. Mach. Learn. Res. 15 (2014) 3963–4009.28