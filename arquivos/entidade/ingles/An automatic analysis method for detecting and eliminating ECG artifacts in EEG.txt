Computers in Biology and Medicine 37 (2007) 1660 – 1671www.intl.elsevierhealth.com/journals/cobmAn automatic analysis method for detecting and eliminating ECGartifacts in EEGJoe-Air Jiang a, Chih-Feng Chao a, Ming-Jang Chiu b, Ren-Guey Lee c,∗,Chwan-Lu Tseng d, Robert Lin aaDepartment of Bio-Industrial Mechatronics Engineering, National Taiwan University, Taipei, TaiwanbDepartment of Neurology, National Taiwan University Hospital, Taipei, TaiwancDepartment of Electronic Engineering, National Taipei University of Technology, Taipei 10643, TaiwandDepartment of Electric Engineering, National Taipei University of Technology, Taipei, TaiwanReceived 21 January 2006; received in revised form 25 March 2007; accepted 29 March 2007AbstractAn automated method for detecting and eliminating electrocardiograph (ECG) artifacts from electroencephalography (EEG) without anadditional synchronous ECG channel is proposed in this paper. Considering the properties of wavelet filters and the relationship betweenwavelet basis and characteristics of ECG artifacts, the concepts for selecting a suitable wavelet basis and scales used in the process aredeveloped. The analysis via the selected basis is without suffering time shift for decomposition and detection/elimination procedures afterwavelet transformation. The detection rates, above 97.5% for MIT/BIH and NTUH recordings, show a pretty good performance in ECG artifactdetection and elimination.(cid:2) 2007 Elsevier Ltd. All rights reserved.Keywords: EEG rhythms; ECG artifacts; Wavelet basis selection criterion; Wavelet transform1. IntroductionThe electroencephalography (EEG) represents the excita-tory and inhibitory postsynaptic potentials generated by cor-tical nerve cells. EEGs enable brain functions to be investi-gated via monitoring potential waves from the scalp surface.Since EEGs were discovered by Berger in 1929, they havebeen considered an important tool for diagnosing, monitoring,and managing neurological states in clinical medicine. Nowa-days, EEG measurement is widely used as a standard procedurein research including sleep studies [1], epileptic abnormalities[2–4], and the diagnosis of other disorders [5,6]. However, in-specting large quantities of raw EEG records visually is a com-plex and time-consuming operation. Visual screening of EEGrecords requires an experienced professionals—the electroen-cephalographer (EEGer). When understanding EEGs to identify∗Corresponding author. Tel.: +886 2 2771 2171x2254.E-mail address: evans@ntut.edu.tw (R.-G. Lee).0010-4825/$ - see front matter (cid:2) 2007 Elsevier Ltd. All rights reserved.doi:10.1016/j.compbiomed.2007.03.007specific conditions such as epilepsy or sleep stages, an EEGeris guided by general definitions and subjective criteria basedon the causal relationship of extended EEG. Large quantities ofreviewing records, covering more than several hours or even aday, are normally required to diagnosis disorders or determinesleep stages. Since artifacts may cause inaccuracy or even crit-ical errors during visually screening or computer analysis, pureEEG records without artifacts will improve the accuracy of vi-sual inspection or computer-based analysis in the long term.In general, the relatively high electrical energy cardiac ac-tivity is most likely to cause EEG artifacts. Electrocardiograph(ECG) artifacts remain a major problem for EEG research.Some automatic detection methods have been proposed in paststudies [7,8]. Algorithms for eliminating artifacts have been de-veloped using the ensemble average subtraction (EAS) method[7], independent component analysis (ICA), and adaptive noisecanceling theory [8]. Nevertheless, these methods cannot beimplemented without an additional reference ECG channel, andthe ECG signal is therefore required to use these algorithms.J.-A. Jiang et al. / Computers in Biology and Medicine 37 (2007) 1660 – 16711661Recently, an energy interval histogram method based on theSmoothed Nonlinear Energy Operator (SNEO) technique andmultiple thresholding schemes was proposed by Park and Jeong[8]. The SNEO technique is known to be very sensitive to noise,and EEGs contain abundant noise such as EMG artifacts andother high frequency disturbances. As a result, several post-processing procedures are needed to complete detection andelimination of artifacts after SNEO processing. The total faileddetection rate for four subjects was 9.1% under restricted con-ditions. Detection and elimination algorithms are thus worthyof further investigation for the sake of the improvement of per-formance.The wavelet transform (WT) method has various uses inbiomedical applications [9]. Seizure detection in epilepsy pa-tients is one of the most frequent uses of WT in EEG anal-ysis [2–4,10]. WT is also used as a pre-processing or featureextraction tool prior classification and clustering during EEGanalysis. Kalayci and Ozdamar used an artificial neural net-work to discriminate between epileptic spikes and backgroundEEG activities, and chose to employ Daub-2 and Daub-10 as awavelet basis [3]. Shen and Sun also used Daub-2 as a basis,and proposed a method to extract dynamic rhythms via Multi-Resolution Analysis (MRA) such that four primary rhythmswere acquired individually and reconstructed by decompositionof the raw EEG data [11]. It is obvious that the Daub-N basishas been frequently applied [3,4,6,10,11]. However, applyingMRA with a Daub-N basis to decompose/extract ECG artifactsentails certain problems.This paper presents a novel method of detecting and elim-inating ECG artifacts based on the WT technique. In contrastto the foregoing studies, the proposed method takes advantageof the WT technique’s localization and provides more temporalaccuracy when performing long-term detection and eliminationdirectly from EEGs. In other words, our algorithm does notneed an additional synchronous ECG channel to perform detec-tion and elimination. Our ECG artifact detection and elimina-tion procedures are described in Section 2. Section 3 providesillustrations of detection and elimination schemes for both sin-gle and multi-channel cases.2. Methods2.1. Wavelet transformCWT makes it possible to localize features in both time andfrequency domains for accurate detection. In many situations,however, the discrete wavelet transform (DWT) method is suffi-cient to satisfy the requirements of analysis. The DWT methodis a dyadic WT when the scaling parameter a is a number witha power of two, i.e., a = 2j , j ∈ Z. Mallat’s fast algorithm forDWT is computed as follows [12]:Aj (n) =Dj (n) =+∞(cid:5)k=−∞+∞(cid:5)k=−∞g(k − 2n)Aj −1(k),h(k − 2n)Aj −1(k).(2)(3)Here Ajis termed the j th approximation, or approxima-tion at level j ; and Dj is termed the j th detail, or detail atlevel j . The filters h(·) and g(·) used to decompose signalsare called wavelet filters (high-pass) and scaling filters (low-pass), respectively. Transformation via these filters is knownas MRA and is used to decompose signals into sub-bandsthe time-dependentwith scale-dependent bandwidths [12];spectral features of physiological signals can then be decom-posed into individual levels. Therefore, dyadic WT can beconsidered to yield a set of equivalent filter-banks generatedby the original wavelet functions via spectral analysis. Whenthe decomposition level is set as m, the raw EEG is filteredinto each level by filter-banks H1((cid:3)), H2((cid:3)), . . . , Hm((cid:3)) andG1((cid:3)), G2((cid:3)), . . . , Gm((cid:3)), where Hj ((cid:3)) and Gj ((cid:3)) at eachdecomposition level j are defined as follows [13]:⎧⎨j −1(cid:9)⎩G(2l(cid:3)),Gj ((cid:3)) =Hj ((cid:3)) = H (2j −1(cid:3))Gj −1((cid:3)).l=0(4)The band of each filter at each decomposition level canthus be obtained. For example,the multi-band frequencyof wavelet basis, Coiflet-1, is shown in Fig. 1. The mainfrequency band of each level can be roughly defined as(fs/2j −1)(cid:2)(cid:6)Hj (cid:6)(cid:2)(fs/2j ), which implies that the bandwidthat the current level is approximately half of that at the previouslevel.The WT of signal x(t) is defined asC(a, b) =(cid:2)Rx(t)(cid:2)a,b(t) dt =(cid:2)x(t)R1√a(cid:2)(cid:4)(cid:3)t − badt.(1)Here C(a, b) are the WT coefficients of signal x(t), (cid:2)(·) is thewavelet function, a is a scale parameter, and b is a translationparameter. a ∈ R+ − {0}, b ∈ R for continuous analysis;a = 2j , b = k2j , and (j, k) ∈ Z2 for discrete analysis. j is thedecomposition level. Since the continuous wavelet transform(CWT) method is capable of performing continuous translationand is not restricted to a dyadic scale, it provides a higherresolution with a continuous scale for dilation. This property of2.2. Wavelet basis and scale selectionChoosing a suitable wavelet basis for EEG analysis relies onthree aspects: the temporal morphology (pattern) relationshipbetween the EEG and the wavelet basis, the frequency bandallocation relationship between the EEG and the wavelet basis,and the properties of the wavelet filters.As for the aspect of frequency, WT decomposes a signal intoseveral bands, of which some specific bands will contain thecritical features of an EEG. As a consequence, the overridingconsideration is to choose a suitable decomposition level/scalecorresponding to the bands containing critical features. As formorphological aspects, choosing a basis with a similar temporal1662J.-A. Jiang et al. / Computers in Biology and Medicine 37 (2007) 1660 – 1671Fig. 1. The frequency response of the filter-bank of Coiflet-1. The gray section is the main frequency distribution of ECG artifacts.pattern corresponding to the temporal features of the EEGs isthe natural option. This reflects the fact that the shape of thedetail at the j th level, Dj , has considerable similarity with thewavelet basis via MRA processing. The original signal is con-volved with wavelet filters in decomposition and reconstruction,as shown in Eqs. (2) and (3). This is to say that the wavelet co-efficients contain periodic and shifted versions of the j th levelwavelet filter. The correlation coefficients are therefore esti-mated as a measure of similarity between the ECG artifacts andwavelet bases. Here x and y are two signals with N samples:R(x,y) =(cid:10)Ni=1(xi − ¯x)(yi − ¯y)(cid:10)(cid:11)(cid:10)Ni=1(xi − ¯x)2Ni=1(yi − ¯y)2.(5)In addition, the properties of wavelet filter-banks must beexamined [13]. The phases of the Symlet-8 and Coiflet-1 filtersat each decomposition level used in this work are approximatelyzero. When the phase function of a filter reaches zero phase orapproximately zero phase, the time-shift function will be almostzero [13]. As a consequence, the result of decomposition has notime shift via MRA if the filters have zero phases. In contrast,time shift has already occurred at level 2 via the Daub-2 filters.The time-shift functions of three selected wavelet filter-banksat each decomposition level can be found in [13].The concepts of the basis and scale selection of WTs can beillustrated pictorially. Fig. 2 shows the procedures for detect-ing ECG artifacts and eliminating from an EEG. The suitablewavelet basis and decomposition scale are selected on the ba-sis of frequency features, temporal morphology, and waveletFig. 2. The procedures for detecting ECG artifacts and eliminating from an EEG.filter properties. The following sections utilize the foregoingconcepts to perform artifact detection and elimination fromEEGs.J.-A. Jiang et al. / Computers in Biology and Medicine 37 (2007) 1660 – 16711663Fig. 3. Comparison of the energy coefficients at scales 22 and 23. (a) The raw EEG with ECG artifacts (indicated by arrows); (b) at scale 22, the localmaxima (peaks of energy coefficients) correspond to the R-peaks of ECG artifacts and the detections will be achieved correctly (indicated by arrows in (a));(c) there are many false sections circled by dash line in the decomposition at 23 scale, i.e., the local maxima do not correspond to the R-peaks of ECGartifacts (indicated by arrows in (a)); (d) the reference ECG channel for verifying the detection points.2.3. Wavelet-based ECG artifact detection and eliminationThe proposed method of detecting and eliminating ECG ar-tifacts in EEGs is based on the foregoing concepts accordingto the power spectra of an ECG signal [14]. The proposed al-gorithm for the detection and elimination of ECG artifacts isdescribed as follows.Step 1: Decomposition scaleThe gray part of Fig. 1 indicates the main frequency band ofECG artifacts, and it is clear that the frequency distribution ofthe QRS complex generally covers the scales of 23 and 22. Mostartifact energy spectra are in the 23 scale. Thus, we initiallychose the scale 23 to extract the R-peak of ECG artifacts, andthis should be the general principle of decomposition. Whileinspection of the spectrum in Fig. 1 shows that the 22 scalecontains less energy than the 23 scale, the extracted signal mayavoid most variations like beta activity and sleep spindles at thisscale. We therefore selected both 23 and 22 scales so that wecould test the reliability of the algorithm via detection process-ing and simulation results. A comparison of results at differentscales is shown in Fig. 3. A further discussion is presented inthe next section.Step 2: Wavelet basis selectionBased on the basis and scale selection criterion mentionedabove, the first step of selection is to find a basis which hasa sharp and spiky waveform consistent with spike-like ECGartifacts. We chose the basis, Coiflet-1, which has the great-est similarity with ECG artifacts, as shown in Figs. 4(a) and(b). Wavelet transformation using Coiflet-1 also avoids theproblem of time shift due to the zero phase at each decom-position scale. Furthermore, Daub-2 (Fig. 4(d)) and Symlet-8Fig. 4. (a) The ECG artifact in the EEG (in the frame); (b) Coiflet-1 waveletbasis; (c) Symlet-8 wavelet basis; (d) Daub-2 wavelet basis.(Fig. 4(c))—bases often used in the literature—were also usedfor the sake of comparison.Step 3: Adaptive thresholdingThe main goal of an adaptive thresholding algorithm is toreveal artifacts and make the focal points stand out. The thresh-old values depend on the local variation of the wavelet energycoefficients. The threshold values can be used to shrink thewavelet energy coefficients over specific intervals—called win-dow length L—to ensure correct detection. The wavelet detailsof the j th decomposition level obtained via MRA are desig-nated Dj , and the energy of coefficients at this resolution levelis defined as Ej (k) = D2j (k). An adaptive threshold scheme is1664J.-A. Jiang et al. / Computers in Biology and Medicine 37 (2007) 1660 – 1671Fig. 5. Adaptive thresholding procedure. (a) The adaptive thresholds are determined via a sliding window according to the local variation of the MRA energycoefficients; (b) the detection points after adaptive thresholding.proposed as follows:(cid:12)(cid:3)T (k) = maxEjk − L2: k + L2(cid:4)(cid:13)contaminated EEGs y(n). The artifact-cleaned EEGs ˆx(n) canbe defined as follows:ˆx(n) = y(n) − K ˆs(n).(7)for k = L2,L2+ 1, . . . .(6)Here T (k) is the threshold at the kth time index and L isthe length of a moving window. In Fig. 5, the adaptive thresh-old values are determined according to the variations in eachsegment of energy coefficients, E2, by a moving window. Thisprocedure allows the determination of the local maximum ofenergy corresponding to the R-peak of ECG artifacts in a spe-cific segment.Furthermore, window length L is also an important parameteraffecting the correctness of the adaptive thresholding scheme.Detection will be achieved correctly when the window lengthis within the range of I < L < 2I , where I is the intervallength between two adjacent R-peaks (R–R intervals). In ac-cordance with experimental results, the pre-defined length ofa sliding window was set as 300 data points (1.2 s). Detectionwas achieved correctly as long as the R–R intervals were in therange of 0.6–1.2 s. Nevertheless, R–R intervals will change inlong-term recordings due variation in heart rhythm. Windowlength was therefore updated every 10 s in order to ensure thecorrectness of detection. The current window length was deter-mined on the basis of the mean value of the intervals betweendetection points during the previous 10 s.Step 4: Elimination of ECG artifactsSuppose that an artifact-contaminated EEG can be expressedas y(n) = x(n) + s(n), where x(n) represents the original EEGwithout ECG artifacts and s(n) represents the ECG artifacts.Using CWT, the extracted wavelet coefficients are taken as theestimated artifacts, ˆs(n). Since we use the single scale waveletdecomposition, the WT cannot extract the total energy of thetrue artifacts, that is, the amplitude of extracted artifacts shouldbe lower than that of the true ones. Therefore, the amplitudeof the estimated artifacts ˆs(n) must be multiplied by a constantK—called the recovering parameter—to approach the true am-plitude of artifacts. Since the analysis of WT via Coiflet-1 hasno time shift, the elimination of ECG artifacts can be achievedby directly subtracting the estimated artifacts ˆs(n) from them(cid:10)Due to the variability of cardiac activity, the energy ofECG artifacts may change in long-term recordings for onesubject or between subjects. The recovering parameter wasestimated every 10 s for each recording in order to ensurethe correctness of artifact elimination. The recovering param-eter K (i) is estimated as the ratio between the amplitudesof EEGs and the extracted wavelet coefficients at the timesof detection points (corresponding to the R-peak times ofECG artifacts) in the ith 10-s epoch. It can be expressed asj (p), where y(i)ˆs(i)K (i) =arethe respective relative amplitude of the j th R-peak in ith 10-s epoch of an ECG-contaminated EEG and of the extractedwavelet details. The index p is the time when the signal reachesthe R-peak of ECG artifacts; it can be obtained from the timeindex of detection points. To prevent estimation error causedby failed detections, K (i) is regarded as a correct value withina reasonable range of 1–2.5. K (i) is substituted as the previ-ous correct estimation, K (i−1), when the value is outside thisrange. Artifact-cleaned EEGs can be obtained by Eq. (7) usingthe estimated recovering values, K (i), in each 10-s epoch.and ˆs(i)jj =1y(i)j (p)/mj =1(cid:10)j3. Evaluation and resultsThe EEG recordings in this study were separated into twogroups. The data in Group 1 consisted of “sleep” recordingsobtained from the Polysomnographic Database established byMassachusetts Institute of Technology and Beth Israel Hospi-tal (MIT/BIH) [15]. The EEGs in this group were originallycontaminated with ECG artifacts. The performance of the pro-posed method based on CWT and DWT was derived for EEGsof different subjects and sleep stages.The data in Group 2 consisted of “wakeful” recordings ac-quired from the Department of Neurology, National TaiwanUniversity Hospital (NTUH). In order to verify the performanceof the proposed method under various conditions, i.e., perfor-mance under different level of contamination and with corre-lation of signals before and after processing, the ECG artifactsJ.-A. Jiang et al. / Computers in Biology and Medicine 37 (2007) 1660 – 16711665Fig. 6. The procedures of the automatic ECG artifact detection and elimination (sleep recordings): (a) the raw EEG contains ECG artifacts (arrows); (b)extracted ECG artifacts via CWT with a Coiflet-1 basis; (c) the wavelet energy coefficients (powers of extracted ECG artifacts); (d) the detection of ECGR-peaks after using the adaptive thresholding procedure; (e) the artifact-cleaned EEG; (f) the synchronous ECG signal was used to verify the detection results.in this group were taken from a synchronous ECG channel andincorporated into the EEG signals by linear addition at variousamplitudes.3.1. Performance indices for statistical assessmentThe rules for scoring the results of automatic detection ad-dressed the two main considerations of the identification ofdetections and the time accuracy of detections. Detection wastaken to be completed correctly when these two criteria wereboth satisfied. The first rule is to count the false positive (FP)and false negative (FN) detections, which are described as fol-lows:FN beats: the number of missed detection while ECG artifactsare present.FP beats: the number of additional unexpected detections whenthe ECG artifacts are not present.The second rule is to identify the time accuracy of detections.This rule specifies that a detection is performed only when it islocated within a range of 0.1 s around the true temporal locationof an ECG artifact. The two scoring rules were used to test therobustness and accuracy of the proposed algorithm.Spike-to-EEG energy ratio (SER): Elimination performancewas evaluated by estimating the SER [8] before and after theelimination procedures. The SER is defined as the ratio of themean energy of a spike region (QRS wave) to the mean energyof the background EEG in a recording:(cid:10)(cid:10)N (k)S.(cid:10)(8)(1/Nk)SER =n=1 SE(k)(n))k=1((1/N (k)NkS )NBn=1EE(n)(1/NB )Here SE(k)(n) represents the signal energy of the kth QRS re-gion with N (k)samples; Nk is the number of total spike seg-Sments in the recordings; EE(n) represents the signal energy ofthe EEG background in the non-spike region with NB samplesin the recordings. The estimated SER can be regarded as thedegree of ECG artifact contamination in both groups and canbe used to regulate the added ECG energy level in the cases inGroup 2.Correlation: The correlation coefficient is a normalized mea-sure of the degree of linear correlation between two signals.It is used to verify the correlation between signals before andafter processing in the NTUH cases. Correlation coefficientsare defined in Eq. (5), where x and y are signals with N sam-ples, and R(x, y) is the correlation coefficient between x andy. The correlation coefficients used in this work are describedas follows:R(rEEG,rEEG+rECG): The mean correlation between the orig-inal non-ECG-contaminated EEG (rEEG, Fig. 7(a)) and theECG-contaminated EEG (rEEG + rECG, Fig. 7(c)) in therecordings.R(rECG,eECG): The mean correlation between original addedECG spikes (rECG, Fig. 7(b)) and the ECG spikes estimatedby WT (eECG, Fig. 7(g)) in the recordings.1666J.-A. Jiang et al. / Computers in Biology and Medicine 37 (2007) 1660 – 1671R(rEEG,eEEG): The mean correlation between original non-ECG-contaminated EEG (rEEG, Fig. 7(a)) and the artifact-cleaned EEG (eEEG, Fig. 7(g)) in the recordings.3.2. Group 1: sleep recordings3.2.1. Subjects and recordingsThe selected EEG records from the MIT/BIH database wereoriginally contaminated with ECG artifacts. The three sub-jects were male, aged 33, 38, and 44, with weights of 95,145 and 89 kg, respectively, and suffering from obstructivesleep apnea syndrome. EEG data were acquired with elec-trodes placed at C4-A1, O2-A1, and C3-O1 in accordance withthe standard 10–20 electrode placement system. The samplingrate was 250 Hz and the resolution of the EEG data was 12-bit. Supplemental EMG and EOG records were also includedto determine sleep stages manually by RK rules [16]. Therecordings of the three subjects were employed to evaluatethe overall performance of the proposed algorithm for differ-ent subjects, sleep stages, and WT types (CWT and DWT).In this study, recordings containing ECG artifacts were arbi-trary acquired; each test recording was about 60–90 min inlength. A simultaneous ECG channel was used in all casesas a reference when we scored detection results. Five sleepstages and wakeful stages were also included in the selectedrecordings.3.2.2. Experimental resultsFig. 6 shows adaptive thresholding procedure for automaticECG artifact detection and elimination procedures. The rawEEG still contains ECG artifacts (arrows) in Fig. 6(a). TheECG artifacts were extracted via CWT with a Coiflet-1 basis,as shown in Fig. 6(b). The wavelet energy coefficients (powersof extracted ECG artifacts) are shown in Fig. 6(c). As shown inFig. 6(d), the detection of ECG R-peaks is achieved after usingthe adaptive thresholding procedure (as shown in Fig. 5). Theartifact-cleaned EEG is shown in Fig. 6(e). The synchronousECG signal was used to verify the detection results, as shownin Fig. 6(f).3.2.3. Statistical assessment resultsThe number of heart beats was 16,690 over a total periodof 231 min, with a mean heart rate of 72.25 beats/min. Therecordings were utilized to test performance of the proposedalgorithm via CWT and DWT, respectively. The performanceevaluation for each recording is listed in Table 1. The proposedalgorithm via DWT yielded an overall 1.61% FN detectionrate and an overall 0.61% FP detection rate. Via CWT, thealgorithm’s FN detection and FP detection rates were 1.59%and 0.53%, respectively. The original mean SER (SERr), 5.64,was reduced to 1.41 (the artifact-cleaned SER, SERe). Thedetection performance for individual sleep stages is shown inTable 2.In Table 2, the failed detection rates in stages 3 and 4 wereless than 1.06% via either CWT or DWT. The highest faileddetection rates occurred during sleep stage 1 and the wakefulstage and were roughly 3.20–5.49%. The failed detection rateduring rapid eye movement (REM) stage was a little lowerthan those during the wakeful stage and stage 1, which were3.24% via DWT and 2.50% via CWT. The failed detection ratesduring stage 2 were 1.65% and 2.03% via DWT and CWT,respectively.3.3. Group 2: wakeful recordings3.3.1. Subjects and recordingsThe recordings of 10 normal wakeful subjects from NTUHwere randomly selected from data previously recorded with anEEG 1000 system (Nihon Kohden Co., Japan) with a samplingrate of 200 Hz. Two subjects were male and eight were female,aged from 11 to 64 (mean age of 28.5). The recordings includedthe data from six EEG channels (FP2-A2, F3-A1, C4-A2, T5-A1, P4-A2, and O1-A1, according to the standard 10–20 elec-trode placement system). Each recording was about 4–5 min inlength.Since the locations of the EEG channels were chosen tocover various locations on the scalp, the wakeful EEG withmore noise could be used to test the robustness of the proposedmethod. The reference ECG channel was filtered in the rangeof 5–40 Hz to remove most non-spike waves and then addedto each EEG channel with various amplitude levels to verifythe detection and elimination performance. A general QRS de-tection algorithm [17] was used to detect QRS peaks of thereference ECG channel used to evaluate performance.3.3.2. Experimental resultsFig. 7 shows step by step automatic ECG artifact detec-tion and elimination procedures. Fig. 7(a) shows the raw EEGs(rEEGs) without ECG artifacts. In Fig. 7(c), ECG-contaminatedEEGs (rEEGs + rECGs) are constructed by adding filteredECGs to rEEGs, as shown in Fig. 7(b). In this example, theECG SER was set as 10 (SER will be described in the nextsection). The EEGs with artifacts are then transformed intolevel 2 detail, D2, via WT with a Coiflet-1 basis, as shown inFig. 7(d). The extracted detail (estimated ECGs and eECGs)reveals the hidden artifacts. In Fig. 7(e), the wavelet energycoefficients are computed and the extracted artifacts are evenmore evident than at the previous stage. Finally, as shown inFigs. 7(f) and (g), the detected temporal points and the ener-gies of ECG R-peaks are determined following the adaptivethresholding procedure, and the artifact-cleaned EEGs (eEEGs)are also obtained. To see the nature of the residual artifacts,Fig. 7(h) shows the residual signal: raw EEG compares to ECG-cleaned EEG (rEEG–eEEG).3.3.3. Statistical assessment resultsThe total number of ECG artifacts from six EEG channelsat five SER levels was 102,120. The length of recordings was42.97 min, with a mean heart rate of 79.22 beats/min. Thedetection and elimination performance for each recording atspecific SER levels is listed in Table 3. The mean failed detec-tion (FD, equal to FN + FP) rate of all recordings at all SERJ.-A. Jiang et al. / Computers in Biology and Medicine 37 (2007) 1660 – 16711667Table 1Performance evaluation with respect to subjects (MIT/BIH cases) via DWT and CWTRecording No. Total beatsdFN beatsdFP beatsFailed detection (DWT) (%)cFN beatscFP beatsFailed detection (CWT) (%)SERrSEReslp01slp02slp67SumMean57736528438916 69037881442692019631020.991.644.722.2238115112265231550881.061.993.692.125.446.614.170.631.851.745.411.41dFN/dFP beats: the number of false negative/ positive detections after DWT; cFN/cFP beats: the number of false negative/ positive detections after CWT;SERr: original SER; SERe: ECG-eliminated SER.Table 2Performance evaluation with respect to different sleep stages (MIT/BIH cases) via DWT and CWTStage 1Stage 2Stage 3Stage 4Total beatsdFP beatsdFN beatsFailed detection (DWT) (%)cFP beatscFN beatsFailed detection (CWT) (%)4551785.491775.277619101251.65127282.03940540.96641.062124840.56530.38REM311878233.2461172.50Wakeful243460384.0349293.20Fig. 7. The procedures of the automatic ECG artifact detection and elimination (wakeful recordings): (a) the raw EEG (rEEG) without ECG artifacts; (b) theoriginal ECG channel filtered in the range of 5–40 Hz (rECG); (c) the ECG-contaminated EEG (rEEG + rECG); (d) the extracted ECG (eECG) from theECG-contaminated EEG by Coiflet-1; (e) the energy of extracted ECG; (f) the detection after adaptive thresholding on (e); (g) the ECG-cleaned EEG (eEEG)after elimination procedure; (h) the residual signal: raw EEG compares to ECG-cleaned EEG (rEEG–eEEG).level was 2.09%. The mean and standard deviation of FD forall subjects at various electrode locations are summarized inTable 4.The correlations between signals before and after process-ing at distinct SER levels are listed in Table 5. As for ECGspikes extraction, the mean correlations between rECG and1668J.-A. Jiang et al. / Computers in Biology and Medicine 37 (2007) 1660 – 1671Table 3Performance evaluation with respect to subjects (NTUH cases) at distinct SER levelRecording No.SERr3FD (%)11.758.603.612.431.892.935.9212.438.3613.46SERe1.390.851.341.231.281.401.581.561.360.795FD (%)2.662.921.910.630.570.212.995.411.915.57SERe2.101.242.041.871.972.071.431.761.600.8310FD (%)0.410.430.670.090.280.101.030.390.051.14SERe3.442.013.403.113.323.292.403.112.801.3815FD (%)0.140.160.360.180.280.000.570.240.000.34SERe4.742.794.754.354.654.473.424.494.021.9520FD (%)0.000.160.260.180.280.000.570.150.000.27SERe6.033.576.095.585.975.644.455.895.252.53ntuh01ntuh02ntuh03ntuh04ntuh05ntuh06ntuh07ntuh08ntuh09ntuh10Mean FD ± SD 7.14 ± 4.171.28 ± 0.272.48 ± 1.871.69 ± 0.420.46 ± 0.382.83 ± 0.690.23 ± 0.173.96 ± 0.950.19 ± 0.175.10 ± 1.2FD: failed detection; SD: standard deviation of FD among subjects.Table 4Performance evaluation with respect to electrode location (NTUH cases)Electrode locationMean FD (%)SD (%)FP2-A2F3-A1C4-A2T5-A1P4-A2O1-A12.431.921.491.661.593.292.641.331.421.841.442.39SD: standard deviation of FD rate among subjects at the location.Table 5Correlations between signals at distinct SER levels (NTUH cases)CorrelationSERr35101520R(rEEG,rEEG+ECG) (%)R(rECG,eECG) (%)R(rEEG,eEEG) (%)85.1580.3285.0176.5782.4579.4870.2683.2475.0065.3583.6672.6961.3883.9369.43R(rEEG,rEEG+ECG): mean correlation between rEEG and rEEG + rECGin recordings; R(rECG,eECG): mean correlation between rECG and eECGin spike regions; R(rEEG,eEEG): mean correlation between rEEG and eEEG inrecordings.eECG in spike regions, R(rECG,eECG), is above 80% at all SERlevels. R(rEEG,rEEG+rECG) and R(rEEG,eEEG) reveal correlationsbetween EEGs before and after elimination procedure.4. DiscussionThis study proposes the concepts of wavelet basis/scale se-lection and wavelet-based methodology for ECG artifact de-tection and elimination. The proposed method achieves prettygood performance. The key element of the proposed methodol-ogy is the selection of suitable wavelet basis. The selected basiscan improve the overall performance of detection and elimina-tion directly from EEG without an additional ECG signal.The wavelet bases used with our algorithm avoid the prob-lem of time shift after processing. This advantage enhancestemporal accuracy when using the WT technique. A waveletbasis with pattern corresponding to EEG/ECG characteristicsallows a good projection from the characteristics via WT, andthe extracted signal can match the specific waveform even moreclosely.It should be noted that 22 was chosen as the alternative de-composition scale. Although the energy at the 22 scale is lowerthan that of the 23 scale (see Fig. 1), extraction results at the22 scale are better than that at the 23 scale, as shown in Fig.4. This is because the most beta activity and sleep spindles arealso extracted simultaneously at the 23 scale. In other words,the extracted wavelet coefficients at the 23 scale contain muchunnecessary EEG activity. It is clear that results at the 22 scaleare much better, and the relative high energy coefficients cor-respond to the R-peaks. In addition, results at the 23 scale havemuch false extraction, as shown in Fig. 4(c).Since the sampling frequency (fs) of EEG might be differentin other applications, it should be noted that the wavelet scaleused to extract artifacts will not be fixed. The selection of aproper scale is relative with respect to the sampling frequencyof the EEG signal. As mentioned above, the most proper scalefor ECG artifact detection and elimination will be 2(n−1). Thedecomposition level n can be determined by a manner that themain frequency band of the wavelet filter at 2n scale can locatein the range of 10–30 Hz approximately (main frequency bandat each level can be defined for different sampling frequency,see Section 2.1). For sampling frequency at 200 Hz in our case,the main frequency band of the wavelet filter at scale 23 is in therange of 12.5–25 Hz, so we choose 23−1 as the decompositionscale.The detections at each stage showed high adaptability andreliability in the diverse environment of the background EEG,as shown in Table 3. It is clear that a suitable basis and decom-position level make the detection algorithm much more pow-erful and avoid the effects of EEG variability, even when theartifacts are not visually obvious. Due to the transformationJ.-A. Jiang et al. / Computers in Biology and Medicine 37 (2007) 1660 – 16711669without time shift, the extracted ECG artifacts can be directlysubtracted from the contaminated EEG. It should be noted thatthe phase of ECG artifacts may be different in recordings (pos-itive or opposite). However, the types of phase do not influencethe results of elimination. The phase of extracted signals de-pends on that of the ECG artifacts. Spikes were also removedby the same elimination procedure.4.1. MIT/BIH databaseThe application of the proposed algorithm to subjects withobstructive sleep apnea syndrome showed excellent results. Themanual scoring statistics and assessment in Table 1 indicatethat detection performance significantly depends on the subject,which means that the properties of subjects’ EEG signals influ-ence the detection rate. EEG activities and artifacts are likely toremain consistent for one subject, but may differ considerablybetween subjects. For instance, the EEG of subject slp01 dis-played less contaminating high frequency noise than the otherrecordings, and detection performance for subject slp01 wastherefore superior to that for the other subjects. On the otherhand, the EEG of subject slp67 was frequently contaminatedwith much more high amplitude EMG noise. When this situa-tion occurs, the extracted ECG signal is mixed with EMG noiseand failed detections tend to occur relative to the quantity ofnoise. It should be noted that detection can also be achievedaccurately when EMG noise is not severe (relative amplitudeis not much greater than background EEG).In Table 2, the failed detection rates at stages 3 and 4 werevery low (less than 1%) regardless of whether DWT or CWTwas used. This suggests that the background frequency of theEEGs was lower than ECG artifacts during deep sleep, and alsoindicates that the detection algorithm worked well. The high-est failed detection rates occurred during the wakeful stage,sleep stage 1, and REM stage. This is explained by the fact thatthe many EMG artifacts and body movements occurring dur-ing these stages contaminated the EEGs. ECG spikes and thefrequency bands of these disturbances overlapped each other.The failed detection rate rose with an increased number of dis-turbances. It should be noted that the total beats in recordingsduring stage 1 were much less than during other stages (theoriginal recordings contained many fewer episodes of stage 1sleep). The failed detection rate during stage 1 in our experi-ments was thus higher than during the wakeful state. Manualscoring experience suggests that detection during the wakefulstage (when most EMG artifacts and body movements occur)is quite difficult. The occurrence of sleep spindles during stage2 led to a higher detection rate during stage 2 higher than dur-ing stages 3 and 4. Another reason for failed detections was theoccurrence of unexpected spikes, which had a frequency veryclose to that of ECG artifacts. The above-mentioned situationswere not disregarded in the final manual score, which meansthat all detections were counted even though the ECG artifactswere almost invisible. The only situations in which scores werenot taken into account were sleep stages that were labeled asMT (moving time), when the EEG amplitude was more than300 (cid:2)V (typical threshold of normal EEGs), and when the EEGshad no contaminating ECG artifacts.Tables 1 and 3 show comparative results for DWT and CWT.While CWT should generally yield more accurate analyticalresults than DWT due to its continuous scales and shifts, ourexperiments indicated that the performance of CWT is not en-tirely superior to that of DWT. We found that CWT producedmore false detections than DWT in some cases. The reason forthis result was that the use of DWT with the proposed algo-rithm also employed the 22 scale, and the filters shifted with afour sampling interval, i.e., (cid:3)t = 4/250 = 0.016 s. This shortshift interval was sufficient to achieve the desired accuracy fordetection of ECG artifacts in the experiments. DWT is thusmore efficient with fast algorithms and demonstrated satisfac-tory performance in the experiments.4.2. NTUH clinical recordingsThe proposed method was validated again using the record-ings with supplemental experimental indices. Data for all sub-jects were recorded while they were in a wakeful condition.As mentioned above, detections were difficult to achieve dur-ing the wakeful stage since most noise and EEG/ECG variationgenerally occurred during this stage. The wakeful stage record-ings can therefore be considered as relatively extreme cases.Looking at real ECG-contaminated cases, the setting of SERlevels should be sufficient to cover most situations in whichECG artifacts occur.In the very low ECG-contaminated cases (e.g., SER < 3),ECG artifacts were almost invisible and tended to be sub-merged in the background EEG. The failed detection rate thusincreased with the reduction of SER. The reason for this wasthat in some recordings, especially at low SER levels, ECGspikes were not sharp enough to be differentiated from highfrequency EEG activity, implying that the failed detection rateincreases when ECG artifacts are unusually submerged in theEEG signals. However, the overall detection performance didnot deteriorate severely and still remained acceptable undersuch conditions. As for the aspect of elimination performance,according to the standard deviations of SERes, the differencesbetween artifact-cleaned SERs (SERes) and other recordingswith the same SERrs were not significant. The waveforms andamplitudes of extracted ECG spikes were therefore adapted tothose of real ECG spikes. The proportion subtracted from theEEG in the spike regions was thus equivalent for each pair (ex-tracted and real) of spikes. Furthermore, ECG artifacts werealmost completely eliminated in most real ECG-contaminatedsituations (SERr (cid:3) 10) according to the satisfactory results ofSERe (SERe < 3).In terms of the detection performance for specific electrodelocations, we can see that failed detections occurred most fre-quently in the frontal (FP2-A2) and occipital (O1-A1) positions.However, according to the standard deviations in Table 4, theFD rate for identical locations was quite different in the case ofdifferent subjects. The index RCC was above 80% for all SERlevels and it could be interpreted that the correlation between1670J.-A. Jiang et al. / Computers in Biology and Medicine 37 (2007) 1660 – 1671contaminated and extracted ECGs in spike regions after trans-formation is high. Further, R(rEEG,rEEG+rECG) and R(rEEG,eEEG)described the improvement of correlations of contaminated andeliminated EEGs with the original non-contaminated EEGs.Improvements suggest that the removal of ECG artifacts causesthe waveform of eEEGs to more closely approximate those ofthe rEEGs. The background EEGs in non-spike regions alsomaintained their original waveforms and were not disturbedby the elimination procedure. At a SER level equal to 3, theR(rEEG,eEEG) was slightly lower than the R(rEEG,rEEG+rECG).Since the effects of spikes are relatively less than those of non-spike regions in extracted ECG at the low SER levels, the sub-traction of extracted ECGs from the EEGs influenced the pro-motion of R(rEEG,eEEG). It should be noted that, in practice, itwas not necessary to perform elimination procedures since theECG artifacts were almost submerged in other EEG activities.Unlike previous studies conducted under restricted limitedconditions [8], under unrestricted conditions the average FDrate of single channel cases (MIT/BIH) was 2.12% and that ofmulti-channel cases (NTUH) was 2.10%. The SER of artifact-cleaned EEGs was within the acceptable contamination limit forclinical practice. The proposed algorithm’s conceptual clarity,simple procedures, and high efficiency make it very suitablefor other applications.5. ConclusionsA reliable and feasible wavelet-based methodology for ECGartifact detection and elimination is presented in this study. Themain contribution of the proposed method is the successfulapplication of the concepts of wavelet basis and scale selec-tion to biomedical signals. The proposed algorithm provides apretty good performance in ECG artifact detection and elimi-nation. The reliability and validation of the proposed methodwere verified by various experimental indices. The experimen-tal performance of the method shows that WT is an excellentanalytical method when the optimal scale and a suitable basisare employed.The specific frequency band and temporal features of otherwaveforms, such as epilepsy spikes, sleep spindles, and K-complexes, have rhythm extraction and ECG artifact detectionaspects similar to those addressed by our algorithm. We believethat our proposed method can also be used for other applicationsinvolving these types of waveforms.6. SummaryAn automatic analysis method for detecting and eliminatingelectrocardiograph (ECG) artifacts in electroencephalography(EEG) is proposed in this paper. Considering the propertiesof wavelet filters and the relationship between wavelet basisand EEG characteristics, the criterion for selecting the suitablewavelet bases and scales used in EEG analysis is developed.Based on the selection criterion of wavelet basis, the EEG anal-ysis via the selected bases is without suffering time shift inthe process of decomposition and detection/elimination afterwavelet transformation. The effective separation of alpha, betarhythms and slow wave activity is achieved and the results con-form to the clinical concern. Based on the similar concepts ofproposed wavelet analysis, an automatic and adaptive methodwith high reliability to detect and eliminate ECG artifacts fromEEGs without an additional synchronous ECG channel is alsodeveloped. An extensive of performance evaluations with re-spect to both of MIT/BIH database and NTUH clinical subjectsis conducted. The achieved average detection rate of ECG ar-tifacts is above 97.5%. After elimination procedure, the inter-ference of ECG artifact is almost removed below an acceptablecontamination level for clinical practice. The performance eval-uations have demonstrated that the proposed wavelet-based ap-proach can be successfully implemented for biomedical signalprocessing with accurate analysis.References[1] R. Agarwal, J. Gotman, Computer-assisted sleep staging, IEEE Trans.Biomed. Eng. 48 (12) (2001) 1412–1423.[2] H.S. Liu, T. Zhang, F.S. Yang, A multistage, multimethod approach forautomatic detection and classification of epileptiform EEG, IEEE Trans.Biomed. Eng. 49 (12) (2002) 1557–1566.[3] T. Kalayci, O. Ozdamar, Wavelet preprocessing for automated neuralnetwork detection of EEG spikes, IEEE Eng. Med. Biol. Mag. 14 (2)(1995) 160–166.[4] S. Flavio, E. Mario, Automatic detection of epileptiform activity bysingle-level wavelet analysis, Clin. Neurophys. 110 (2) (1999) 239–249.[5] M. Cabrero-Canosa, E. Hernandez-Pereira, V. Moret-Bonillo, Intelligentdiagnosis of sleep apnea syndrome, IEEE Eng. Med. Biol. Mag. 23 (2)(2004) 72–81.[6] A.A. Petrosiana, D.V. Prokhorovb, W. Lajara-Nansona, R.B. Schiffera,Recurrent neural network-based approach for early recognition ofAlzheimer’s disease in EEG, Clin. Neurophys. 112 (8)(2001)1378–1387.[7] M. Nakamura, H. Shibasaki, Elimination of EKG artifacts from EEGrecords: a new method of noncephalic referential EEG recordingElectroencephalogr, Clin. Neurophys. 66 (1987) 89–92.[8] H.J. Park, D.U. Jeong, K.S. Park, Automated detection and eliminationof periodic ECG artifacts in EEG using the energy interval histogrammethod, IEEE Trans. Biomed. Eng. 49 (12) (2002) 1526–1533.[9] M. Unser, A. Aldroubi, A review of wavelets in biomedical applications,Proc. IEEE 84 (4) (1996) 626–638.[10] A. Hojjat, Z. Ziqin, D. Nahid, Analysis of EEG records in an epilepticpatient using wavelet transform, J. Neurosci. Methods 123 (1) (2003)69–87.[11] M. Shen, L. Sun, F.H.Y. Chan, Method for extracting time-varyingrhythms of electroencephalography via wavelet pocket analysis, IEEProc. Sci. Meas. Technol. 148 (1) (2001) 23–27.[12] S. Mallat, A Wavelet Tour of Signal Processing, Academic Press, SanDiego, 1999 pp. 255–258.[13] D.B. Percival, A.T. Walden, Wavelet Methods for Time Series Analysis,vol. 154, Cambridge University Press, New York, 2000 pp. 115–121.[14] N.V. Thakor, J.G. Webster, W.J. Tompkins, Estimation of QRS complexpower spectra for design of a QRS filter, IEEE Trans. Biomed. Eng. 31(1984) 702–705.[15] Y.Ichimaru, G.B. Moody, Development ofthe polysomnographic(1999)database on CD-ROM, Psychiatry Clin. Neurosci. 53 (2)175–177.[16] A. Rechtschaffen, A. Kalesstandardizedterminology, in: Techniques and Scoring System for Sleep Stage ofHuman Subjects, BIS/BRI, UCLA, Los Angeles, CA, 1968.(Eds.), A manual of[17] J. Pan, W.J. Tompkins, A real-time QRS detection algorithm, IEEETrans. Biomed. Eng. 32 (3) (1985) 230–236.Joe-Air Jiang was born in Taipei, Taiwan, in 1963. He received the M.S.and Ph.D. degrees both in electrical engineering from National Taiwan Uni-versity, Taipei, Taiwan, in 1990 and 1999, respectively. From 1990 to 2001,J.-A. Jiang et al. / Computers in Biology and Medicine 37 (2007) 1660 – 16711671he was with Kuang-Wu Institute of Technology, Taipei, Taiwan. Currently, heis an Associate Professor in the Department of Bio-Industrial MechatronicsEngineering at National Taiwan University, Taipei, Taiwan. His areas of inter-est are in computer relaying, bio-mechatronics, bio-effects of electromagneticwave, sensing network, and neuro-engineering.University (NTU), in 2000. Since 2002, he has been with the Departmentof Electronic Engineering, National Taipei University of Technology, wherehe is currently an Associate Professor. His research interests include medicalinformatics, telecare and mobile care system, and wireless sensor networkfor biomedical applications.Chih-Feng Chao received the B.S. degree in mechanical engineering fromChang Gang University, Taoyuan, Taiwan, ROC, and the M.S. degree in bio-industrial mechatronics engineering from National Taiwan University (NTU),Taipei, Taiwan, ROC, in 2003 and 2006. His research interests are in thearea of biomedical engineering, biomedical signal processing, and patternrecognition.Ming-Jang Chiu received his B. Med. degree in medicine in 1984 and Ph.D.degree in electrical engineering in 2000 both from National Taiwan Univer-sity, Taipei, Taiwan; and became a board certificated neurologist in Taiwanin 1989. He is currently an attending neurologist in National Taiwan Uni-versity Hospital specialized in the diagnosis and treatment of patients withdementia. He has been the standing board member of Taiwan Alzheimer’sDisease Association and secretary general of Taiwan society of clinical neu-rophysiology both since 2004. Dr. Chiu’s research interests include cognitiveneuroscience, sleep medicine and clinical neurophysiology.Ren-Guey Lee received the M.S. degree from Department of Electrical En-gineering, National Chen Kung University (NCKU), Taiwan, in 1989, and thePh.D. degree from Department of Electrical Engineering, National TaiwanChwan-Lu Tseng graduated from the National Taipei Institute of Technol-ogy in 1985 and received the M.S. and Ph.D. degrees from National TaiwanUniversity in 1991 and 1995, respectively, both in electrical engineering.Since 2000, he has been an Associate Professor in the Department of Elec-trical Engineering, National Taipei University of Technology. His researchinterests include signal processing, automation, robust control theory and itsapplications. He is a member of the Phi Tau Phi Scholastic Honor Societyat National Taiwan University.Robert Lin was born in Changhwa, Taiwan, ROC, in 1957. He received theM.S. degree in electronic engineering from Chung Yuan Christian Univer-sity, Taiwan, ROC, in 2001. He is currently working toward his Ph.D. degreein Bio-industrial Mechatronics Engineering Department of National TaiwanUniversity. He is currently a Senior Lecturer in Electrical Engineering De-partment of Lunghwa University of Science and Technology. At present, hisinterested research includes mix-mode IC design of VLSI, and the applicationof medical engineering.