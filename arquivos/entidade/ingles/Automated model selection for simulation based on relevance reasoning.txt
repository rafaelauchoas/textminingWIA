ELSEVI ER Artificial Intelligence 96 (1997) 351-394 Artificial Intelligence Automated model selection for simulation based on relevance reasoning Alon Y. Levy a~1, Yumi Iwasaki bp*, Richard Fikes c*2 a AT&T Bell Laboratories, 600 Mountain Ave., Room 2A-440, Murray Hill, NJ 07974, USA b Knowledge Systems Laboratory, Stanford University, Gates Bldg. 2A, Rm. 256, Stanford, CA 94305. USA ’ Knowledge Systems Laboratory, Stanford University, Gates Bldg. 2A. Rm. 246, Stanford, CA 94305, USA Received March 1996; revised August 1997 Abstract Constructing an appropriate model is a crucial step in performing the reasoning required to pieces of knowledge the behavior of a physical and Forbus successfully answer a query about modeling approach of Falkenhainer composable construction problem Model construction of dynamic behavior over a sequence of states. The latter is significantly more difficult former since one must select model fragments without knowing exactly what will happen future statles. is provided with a library of the physical world called model fragments. The model the situation. can be considered either for static analysis of a single state or for simulation than the in the selecting appropriate model In the compositional ( 1991), a system to describe fragments situation. involves about The model construction problem about relevance described by Levy reasoning about relevance of knowledge for reasoning paper, we present a model formulation procedure based on that framework fragments efficiently model must be adequate possible. We define formally in fact generates an adequate and simplest model. @ 1997 Published by Elsevier Science B.V. in general can advantageously be formulated as a problem of that is available to the system using a general framework ( 1993) and Levy and Sagiv ( 1993). In this for selecting model to be useful, the generated time, as simple as the concepts of adequacy and simplicity and show that the algorithm for the case of simulation. For such an algorithm the given query and, at the same for answering Keywords: Model formulation; Relevance reasoning; Qualitative reasoning; Simulation * Corresponding author. Email: iwasaki@ksl.stanford.edu. ’ Email: levy@research.art.com. 2 Email: filtes@ksl.stanford.edu. 0004-3702/97/$17.00 @ 1997 Published by Elsevier Science B.V. All rights reserved. PIISOOO4~-3702(97)00056-8 352 A. E Levy et al. /Artificial Intelligence 96 (1997) 351-394 1. Introduction study solving problem themselves for a problem the real world is too complex instead of studying endeavor, and constructing for various because are products of our intellectual Models are the conceptual objects humans is a challenging reasons. For example, Models priate model constructed constructed models of a device being designed are constructed of the device by experimenting with the model even before the device the real thing. an appro- task in itself. Models are simplified models of the real world are in its entirety, and the behavior is actually built. There are as many possible models of a given subject of study as there are reasons is no one “true” or “correct” model since any model and the goodness of a model depends on one’s goal, i.e., a model. the question detail. for for constructing models. There is necessarily the question one wishes For a model with sufficient precision Constructing answering and studying to answer too much unnecessary to comprehend in order to understand to by constructing information requires deciding what information and, therefore, should be included and accuracy without containing it must contain enough to find an answer could be relevant such a model an abstraction in the model. to be useful, the questions Thus, model formulation can be considered about and Genesereth problem of reasoning as Subramanian for reasoning of one of them, namely Levy’s, efficient procedure, purpose of simulation useful, same time, as simple as possible. of adequacy and simplicity and simplest model. about relevance of knowledge [ 301 and Levy relevance of knowledge. as a special case of a more general for a given goal. Researchers such [ 161 have proposed general frameworks In this paper, we present an application based on the general framework, for formulating of physical devices. For any model formulation to the problem of model formulation. We propose an for the to be the given query and, at the the concepts in fact generates an adequate In later sections, we will define formally and show that the procedure a model procedure for answering the generated model must be adequate 1.1. Motivations The ability to analyze a physical system using a model of its behavior skill required of engineers. Equally that is appropriate a model a good model is much formulated. Most computational rely on the user to construct a model. less understood for one’s purpose. However, important, if not more, is the ability is an important to formulate the problem of how to build it is to assist in analysis of model behavior than that of how to analyze a model once tools intended though simulation design, The ability to formulate systems greatly by making For example, in engineering involved If a system could quickly aspect of interest, perform in a readily understandable in formulating an appropriate model would enhance the utility of such it much easier to take advantage of their analysis capabilities. tool for evaluating design alternatives is a very useful a model, performing it is not currently used as freely as it could be because of the cost the results. and interpreting the particular for analyzing of the results and produce an interpretation form, a designer could much more easily analyze design a simulation, an appropriate model formulate the simulation, A.Z Levy et al./Art$cial Intelligence 96 (1997) 351-394 353 Fig. 1. An example circuit: SAl is a solar array and BAI is a rechargeable battery. alternatives. during the design process, quality of the final design. Such a capability would enable designers thereby improving to make better informed decisions the efficiency of the process as well as the 1.1.1. behavior modeling as modeling paradigm modeling [7] represented by an effective system of for automatically differential equations t!hat can adequately modeled a lumped-parameter sitional approach, a is provided a 3 In a physical compo- composable pieces fragment formu- model a library model fragments. or a by selecting process. The model fragments knowledge about one aspect physical world a component given physical lates model of them. composing main advantage fragments, describing compositional modeling a phenomenon, its modularity. is much easier model than composing complete model every possible and query. existing appropriate is also easier. Furthermore, context. model fragments reused fragments can in an a system systems automatically to aid given domain, in formulating in analyzing modeling model. However, must have mechanism model will order for for appropriate for promising behaviors of wide variety is approach compositional modeling such model fragments given analysis that a Also, because all the savings achieved by using an appropriate model for analysis will not be worthwhile if the cost of the selection process for the selection algorithm to have a reasonable itself is prohibitive. time complexity, to succeed, the it 11s imperative I. 1.2. Model formulation in compositional modeling is crucial when and different perspectives an appropriate model Selecting levels of abstractions various studied. #Suppose one is analyzing is rich with can be the design of an electrical power supply consisting of the problem domain at which phenomena 3 When spatial variation is not of interest, one speaks of the system as being lumped parameter [6]. 354 A.I: Levy et al. /Artijicial Intelligence 96 (1997) 351-394 into account phenomena of the battery. Furthermore, in Fig. 1. If one is interested in the voltage a model battery and a solar array as shown that takes and discharging in the a rechargeable level supplied by the battery over the course of a day, one would variation such as solar power generation construct and charging the model would describe those phenomena with mostly electrical properties such as currents, voltages and charge in the charging capacity of the battery level. If, instead, one is interested such over several months, one would have to take into consideration as aging, whose effect becomes observable cycles. in the details of the Yet another possibility is interested In this case, an appropriate model would consist chemical processes of representations the electrodes of the battery. is that one that cause aging. of individual only after many charge-discharge chemical processes other phenomena in the variation the electrolyte in aging and involving and While the library of model fragments may contain knowledge can also be represented by several different model fragments, of physical phenomena, most of them may be irrelevant phenomenon different ways representation made, desired Therefore, to describe and the problem temporal and quantitative in the context of compositional modeling, to be solved, the same thing based on different including accuracy, and precision. about a wide variety for any given problem. Each assumptions representing about the such things as approximations the model formulation problem is: l Select an appropriate subset of the model fragment library and appropriate instan- tiations of that subset, given: l A description of a problem situation, and l An analysis goal, A more formal statement of the problem will be given in Section 4.1. The set of instantiations a model of the situation. of the selected subset comprises As discussed above, this selection process requires one to make two types of decisions, namely: l What phenomena l How to model each of the chosen phenomena? If the model to model? includes the most detailed model fragment about every phenomenon the resulting model will be the most comprehensive from the library. However, in most situations, what is appropriate the most comprehensive model. For a model it must cover all the phenomena that are relevant it is desirable for the model to produce a satisfactory the model fragments relevant phenomena It must also make sure that the choice of model to be appropriate for solving that that could is much for a given the problem. At to include only enough details about each the selection process must described fragments them. For example, signal propagates underlying that an electrical that assumes that it takes time. To is that of deciding what to model and how answer. Therefore, representing the library knows about, be produced less than problem, the same time, phenomenon strive to include only with just enough details. be internally one cannot instantaneously summarize, to produce consistent select a model in terms of the assumptions that assumes to all parts of a circuit and another fragment the model formulation the simplest adequate model. problem A.E Levy et al./Arti$cial Intelligence 96 (1997) 351-394 355 1.2. Our approach to model formulation influence influence algorithm the model such simulations behavior. People perform type of task for which we target our model formulation work is simulation for a variety of reasons, as predicting how the values of a set the user’s query (and (and The primary of time-dependent but in most cases the goal can be characterized of terms of interest change over time. Thus, in our work, we represent primarily as a set of terms of interest and assume that the goal of model formulation is to explain how their values change over time. Intuitively, predicting simulation) how values change over time requires explaining) all the things that could causally driving our model formulation influences on the goal terms. We start from each goal term, look for all the things can causally other terms can influence other things or object, we decide based on the set of modeling sections of this paper give a detailed account of the representational used by our method and analyze computational mechanisms of our work can be summarized of model fragment to take into consideration the term. Thus, the core high level mechanism is backward chaining on all the possible causal that the term, including objects and physical phenomena, decide what look for those phenomena those terms, and so on recursively. For each phenomenon in the model, we determine how it should be modeled that are being maintained. The remaining assumptions inferential properties of the algorithm. as follows: libraries by introducing The contributions l We enrich constructs in a library. The knowledge tions that are implicit knowledge usable by a model formulation the representation that enable statements about the relationships additional between model fragments expressed by these statements make explicit assump- the in the mind of the library builder, and thereby make the goal term through that can influence or objects, to include algorithm. and l We analyze the problem of model formulation as a problem of relevance and show how this analysis provides insight into the model formulation reasoning problem. apparatus, we describe a novel l Based on this analysis and algorithm l We define the concepts of simplicity and adequacy the representational for simulation. model formulation that make sense in the context of problem. We present an analysis of our algorithm and show the model formulation that IIt produces a simplest adequate model. We also show that the time complexity of the algorithm model fragment l Finally, we present in limiting experimental the size of formulated models. is polynomial with respect to the size of the problem library under a reasonable results demonstrating set of assumptions. the effectiveness approach and the of our Several pieces of work have addressed the model formulation positional modeling model formulation approach [ 7,23,26]. Our work is distinctive for simulation with guarantees of adequacy and simplicity. problem for the com- in that it combines 1.3. Relevance reasoning for model formulation Our model formulation about relevance of knowledge. Formulating of relevance reasoning was instructive is based on a general for reasoning as a type in teasing out the different parts of the model the problem of model construction framework procedure 356 problem as well as providing guidance construction explaining reasoning, we briefly explain the connection between the problems of model construction reasoning problem. the relevance in treating each of the parts. Before and of relevance there are two forms of irrelevance Inference mechanisms irrelevant that have large and diverse knowledge bases en- a given query. This causes their that may arise. The facts may be shown not in systems facts in the process of answering counter many them to explore many useless paths in their search, and therefore severely degrade performance. Broadly speaking, first is irrelevance to contribute cannot detect this irrelevance, The second conceptualized. at a granularity space that needs to be explored if the inference mechanism that involve is due to the level of detail at which For example, a knowledge base may identify properties of individuals the search level that is too detailed a query. However, it may still consider solutions for a given query, and as a result, irrelevant the domain in any way to answering form of irrelevance in the knowledge is unnecessarily base. Certain facts. is of facts large. base are possibly Often, it is possible to detect efficiently and still be able to answer a set of queries correctly to give the system additional meta-level [ 16,21,30], or to detect that a knowledge that facts (or sets of facts) in the knowledge base can In other [ 17,311. control advice as to which the therefore enabling for framework in and the model selection procedure presented to a query, relevant the rest. Levy has developed a general [ 16,18,21], about relevance is based on that framework. The framework provides a space of definitions in which can be given to a system. Levy also that for some forms of irrelevance efficiently decide which parts of in of their properties and provides a language about irrelevance to a query, thereby yielding significant speedups inferences. An important that is emphasized is the need to decide which facts in the knowledge base are relevant the algorithms aspect of relevance reasoning the whole knowledge base. In particular, including a set of Horn rules and a set in [ 181 consider knowledge bases facts, but the algorithms do not consider the ground facts when determining to ignore to a query in the knowledge base are irrelevant be abstracted cases, it is possible facts inference mechanism reasoning this paper of irrelevance with a comparison additional meta-level knowledge provides algorithms the knowledge base are irrelevant performing in this framework without actually described of ground relevance of facts to a query. In this paper, we argue considering that the model construction problem can advantageously be the first aspect of the model construction reasoning. The first advantage of such a formulation formulated as a problem of relevance In is that it enables us to tease out the different parts of the model construction problem. is that we need to decide particular, can affect a given term. The second aspect is that we need to decide which phenomena of how to model each phenomenon. Note that these two decisions are not independent each other. Finally, model construction must be done without knowing exactly which states the system may encounter. reasoning the treatment of each of these aspects of also guided relevance problem Moreover, the problem: ( 1) Determining which phenomena to the goal of explaining how a given term changes over time led to the high-level mechanism of our algorithm, which influences on the term. In fact, is backward chaining on all the possible causal are relevant A.E Levy et al./Artijicial Intelligence 96 (1997) 351-394 357 the data the graph of causal structure developed by Levy to represent which facts may be part of a derivation of a query over a Horn rule knowledge base [ 181. to the query is similar influences in spirit tree, (2) Second, the ability tools for supporting the need to reason about how to model each phenomenon to bear in selecting a model. Such claims are a generalization led us to de- such reasoning. The first tool (see velop two representational Sections 3.1.1 and 3.2) provides to state relevance claims that describe when a model fragment can be used and to express additional domain knowledge that comes consider predicate described clear semantics the user to explicitly in alternative models of the same phenomenon. the appropriate model of a phenomenon selecting composed models are consistent with each other. of the framework provided tool (see Section 3.1.4) enables the modeling assumptions made in Such claims provide guidance that the for such statements. The second state the difSeererzce between in [7], but Levy’s relevance and in guaranteeing (3) Third, our algorithm must build a model without having complete information the possible about states of the system. Even given complete knowledge of the initial state, the future states are not known until we construct a model and per- for simulation, we must somehow form the simulation. Thus, determine what could be relevant the a query without performing to answering simulation. Our algorithm chooses a model for simulation based only on knowl- the system may enter, but without states edge of constraints the possible on actually generating in the graph of causal are encoded them. These constraints that we use to guide the model construction influences to build a model algorithm. 1.4. Organization of the paper and representation, The re:Pt of this paper and behavior prediction relies. Section 4 defines the basic knowl- in compositional modeling, which Section 3 describes formulation. the apparatus on which our formulation is organized as follows: Section 2 describes edge representation approach we take as the starting point of our work on model the addit:ional knowledge method procedure, Section 4 also presents fragment model the models as reasoning research formally, describes our formulated by the procedure. the results of our experiments with the procedures using several and the characteristics as well about relevance. Section 7 concludes with a discussion of some remaining related work in model formulation it generates. Section 6 discusses an example of a model being the model formulation problem libraries. Section 5 analyzes of the procedure and presents :issues. 2. Compositional modeling In this section, we describe our representation for predicting behavior, which is based on the compositional modeling positional modeling was first described by Forbus Theory and method approach. Com- in his work on Qualitative Process [ 81 and is also the basis of subsequent work on qualitative modeling of physical knowledge (QPT) 358 A.E Levy et al. /Artificial Intelligence 96 (1997) 351-394 Charge-sensitive-voltage-battery Participants: X: type Battery Quantities: voltage(X) , charge-level(X) , damaged(X) Conditions: ldamaged 6 < charge-level(X) (X) < 30 Consequences: voltage(X) = f+(charge-level(X)) Fig. 2. An example model fragment. approach, which we take as the starting point and Forbus [ 111. The purpose of this section [ 71, Crawford, Farquhar and Kuipers in general is to explain [ 51, and Iwasaki and by Falkenhainer the essence of terms Low in the work the compositional modeling presented here on model formulation. We then describe the additional knowledge and the organization we impose on the knowledge base to facilitate model formulation. Though pro- the terms used cedures differ somewhat are and the definitions given in the same in all of them. Here, we will use the nomenclature [ 21. CML was designed by the researchers CML (Compositional Modeling Language) above as a common model fragment of the compositional modeling representation formal see [ 31. The description below includes only the aspects discussion of model fragments, relevant to describe parts of a model in different systems to enable sharing of knowledge bases, For a complete and the actual simulation fragment [ 5,7,8,11], the underlying principles systems mentioned to our discussion. language 2.1. Model fragments together (composing) is a self-contained pieces of descriptions idea in compositional modeling is to formulate a model of a given situa- in aspect of some physical such as one aspect of a component behavior or a physical process. Each is decided the model of an entire situation. These pieces are called model the dependence of the voltage the process of fluid flow through a The basic tion by putting the domain. Each piece describes a conceptually phenomenon, piece separately fragments. For example, a model fragment may describe of a battery on its charge pipe connecting describing two containers. Fig. 2 shows an example of such a model the charge-level of a battery and its voltage. assertion whose applicability of physical phenomena level or may describe the relation between to a given situation to generate independent fragment A model fragment names a set of participants in the phenomenon being described and a set of conditions which the participants need to satisfy in order for the phenomenon to take place. We say that an instance of a model fragment exists in a state when entities in the model fragment exist in the state for which for being participants the conditions A. E Levy et al. /ArtQicial Intelligence 96 (1997) 351-394 359 are satidiecL4 We also assume entities in the domain. A model specifies there fragment the behavior of the participant objects while the phenomenon types of a set of consequences which is taking place. is a set of unary predicates denoting also includes We deiscribe each part of the model fragment in detail below: Participants. A name and type for each of the objects participating instance. A participant can be viewed as a unary function to an object class battery. In Fig. 2, the participant in the domain. is required from a model fragment in a model fragment instance to be an instance of Quantitiles. Atomic expressions denoting participants expressions such as color(X) operution!aZ( X) or dumaged( X). The time argument of all quantities in a model fragment such as volfuge( X) and current(X) locution(X), instance. Quantities can be continuous-valued functional or boolean-valued , discrete-valued time dependent relational and functional expressions expressions such as is left implicit. attributes associated with the the phenomenon that indicate when represented by the model takes place by specifying constraints on the participants of the model fragment include both structural constraints on the participants Conditions. Statements fragment and on its, quantities. The conditions as well as constraints on the ranges of quantity values. We will sometimes use the term operating from modeling in Section 3.1.1. 5 assumptions, which are meta-level that the battery not be damaged In our example, the model fragment’s conditions and 30 ampere-hours. and that the charge level of the battery be between 6 ampere-hours to distinguish that will be introduced to these conditions conditions conditions to refer require them the phenomenon that are true whenever Statements is taking place. Some of the consequences Consequences. model fragment ena (e.g., a fluid flow) by a set of equations model fragment. 6 The equations may be quantitative (e.g., equations) water in the cup). Consequences a state in which an instance of the model fragment exists. Disjunctions in the consequences. that the voltage and the charge partial derivative of one with respect of the model level of a battery are qualitatively to the other is positive). the rate of evaporation negatively The consequences can also be any other logical assertions the continuous or qualitative involving fragment represented by the describe continuous phenom- quantities of the (algebraic and ordinary differential affects the amount of that are true in are not allowed in our example asserts (i.e. the proportional One of the key assumptions regarding model fragments approach than one phenomenon is that they be composuble. at the same time. For example, in the compositional modeling In general, a quantity may be affected by more the amount of water in a container 4 In other words, a modelfrngment instance is a binding of each of the participants the conditions state such that the objects satisfy in that state. to an object in a particular 5 The term “operating “To simphfy discussion, we assume conditions” is also consistent with its usage in [ 7 1. do not contain that the consequences inequalities on quantities. This since an inequality can be rewritten as a qualitative equation does not impose a limitation on the representation involving the difference. 360 A.E Levy et al. /Artificial Intelligence 96 (1997) 351-394 fragments, are independent such phenomena effect of the two phenomena. fragments. Their consequences is the combined as model process. The way the In can be affected by an evaporation process and by a condensation amount actually changes over time terms of representing As these two phenomena model amount of water in the container, which is that they tend to increase instances quantity. At simulation a quantity have been their effects are combined complete the effects consequences the following: of each other, they are represented by separate the the effect each has on the quantity, (or decrease) the that directly affect into one time, when all the model fragment in a given state, assumption. The procedure language the closed-world the semantics for combining for expressing under is based on of the mathematical in model fragments. this means identified equation specify The semantics of model fragments can be summarized as follows. Let fr , . . . , fn be the participants of a model fragment M. Let o( X1, . . . , X, ) be the conditions of M and b(Xt,... the conditions, there exists an instance of the model fragment. Formally: of M. First, whenever a set of objects satisfies ,X,) be the consequences t/Xl 9 . . ..x. 0(X1,. ..,Xn) W (3 m)M(m) AAfj(m)=Xj] j=l The existence of the model fragment instance also implies in it are defined. Furthermore, the existence of the instance tioned consequences hold. Formally: that the quantities men- the implies that 2.2. Composing simulation models Given a description of the physical configuration of a system and a particular that represents state the physical in the state. In compositional modeling, a model is composed of a in that state. Fig. 3 shows are satisfied instances whose conditions approach. the simulation model for in the simulation model give rise in the compositional modeling in a state comprise fragment instances that hold as a consequence of the phenomena task is to formulate a model framework the basic modeling it is in, the model formulation phenomena occurring set of model fragment schematically The set of all model that state. The consequences to a set of equations and logical formulas taking place. Those equations, state must be changing. The simulation model generates there may be a set of possible next states. Otherwise, In either case, the conditions fragments next states to formulate a new simulation model. of the model fragments the next state using the equations. of the model if they include differential is given to the prediction If prediction equations, determine how the engine, which is performed qualitatively, there will be a unique next state. in each of the are re-examined In the basic modeling is searched presents in every state two problems: First, framework described to identify model thus far, the entire model fragment fragments that can be instantiated. library This the resulting model will be very complex, containing A. Z Levy et al. /Artificial Intelligence 96 (1997) 351-394 361 Simulation Model (a set of model fragment I --- ---__-- Fig. 3. Basic modeling framework in compositional modeling. everythin,g process expensive, the resulting model may be inconsistent the library describing assumptions. Therefore, considered for answering Selecting for instantiation it is necessary know exactly what will happen To simulate, one needs one needs to know what can happen the system knows about the situation. This can not only make the simulation complex. Secondly, in but also the resulting prediction unnecessarily since there can be multiple model fragments the same phenomenon based on different incompatible modeling to limit the set of model fragments to a subset of the model fragment library that will be that is sufficient the query and makes a logically consistent set of modeling assumptions. such a subset is difficult since, without performing simulation, one does not in the future states. The situation presents a quandary: to formulate a model. But, to formulate an appropriate model, One extreme strategy for dealing with this problem in the future, which requires simulation. is to perform relevance reasoning that strategy can become in every state. That strategy only requires determining what is relevant current state, thereby eliminating However, one must take the entire to perfonm model fragment during may produce a model to a query in the the need to worry about what may happen in the future. library grows, since is reasoning only once at the beginning. That strategy will require selection only once, but since all legal states that the system may enter the simulation must be considered, model selection will be more difficult and complex. Any number of strategies between in every state. The other extreme inefficient as the model fragment that is unnecessarily into consideration relevance library 362 A.Y L.evy et al. /Art@cial Intelligence 96 (1997) 351-394 these two extremes can be devised, each with its run-time versus pre-processing versus effectiveness tradeoffs. time The model formulation procedure that we will present the two extremes one to pick a strategy between The procedure provides a mechanism be relevant varying assumptions scope of the phenomena that is appropriate to infer what might happen in hand. It also provides a means in the situation relevant. about what will not change that must be considered to the given goal in the following section enables for a given situation. in the future that can for the user to make the to broadly delimit consistent procedure is adequate for answering the evaluation and also sufficient in the context of simulation? For a model criteria the model produced for such methods. A model for solving to describe our formulation method, we must Evaluation criteria. Before we proceed formulation is discuss the given problem. What worthless unless it must to be adequate, does adequacy mean the given query. In addition, be internally we would like the model to be as simple as possible. Our model formulation procedure was devised with these goals in mind. We will provide a formal definition of the model in Section 4.1, where we will also formally define adequacy and formulation simplicity. to prove that the procedure will in that is also a simplest model. We say a fact produce a consistent simplest there can be more than one simplest models for to our definition of simplicity. Furthermore, we will prove a given scenario according about the structure of the model fragment that under reasonable the time complexity is polynomial. For now, we turn to the description of the organization assumptions of the procedure of our model fragment In Section 5, we will use those definitions that facilitates model formulation. instead of the simplest because and sufficient model problem library, library 3. Knowledge representation for model fragment selection the additional the difficulty of actually The previous section described model fragments and the idea of composing them to formu- It also discussed for the purpose of simulation. In this section, we tools we use in order to facilitate model formu- in generate a model for a given situation. lating an appropriate model, especially describe representational lation, such as composite model fragments, assumption [ 71)) and explicit modeling organization dependent knowledge more structure this structure we enable and thereby enable classes constraints. The first two are used for imposing additional library, and the third is used for expressing domain- these tools introduce in the library, we argue that the designers of model fragments must have library. Here, this structure, underlying to benefit from the structure. about relevance of model fragments. Though the process of constructing on the model fragment the model construction a model fragment to make explicit the assumptions in mind during such designers introduced (originally algorithm 3.1. Model fragment library In the basic compositional modeling framework described fragment library is simply a set of model fragments without any additional in Section 2.2, the model structure. A.Y Levy et al./Artifcial Intelligence 96 (1997) 351-394 363 Charge-sensitive-voltage-battery Modeling Conditions: Rel(rechargeableBattery(X)) Rel (charge-level(X) Rel (voltage (X) > > A A Fig. 4. Modeling conditions for a model fragment. if the content of the model fragments is examined, of the same phenomena, and some sets of model some sets of model fragments in different operating regions. into our model fragments. Model fragments are grouped and CMFs are further grouped into assumption among model th’e same phenomena related. For example, However, seen to be closely different descriptions scribe formulation, we introduce more organization relations frugmews describe causal orientation ments assumptions Causal orientation relations of model into groups according implied by a model fragment. (CMFs), these concepts, we must first introduce modeling fragments. Both are important to their contents. Modeling library some model fragments are simply provide fragments de- In order to facilitate model that reflects such into composite model classes. Before we and the notion of frag- the in classifying model conditions make explicit conditions that underlie a particular description of a phenomenon in a model fragment makes explicit as a model fragment. the knowledge of possible causal In addition 3.1. I. Modeling conditions to operating called modeling conditions tinguish alternative ways of modeling different (i.e., meta-level We identify as opposed two classes of modeling from operating conditions) conditions conditions, we attach conditions. Modeling to model conditions the same phenomenon. Modeling fragments another are used in order type of to dis- are conditions the representation in that they are conditions about to conditions on the domain and state. conditions. The first class consists of relevance in Section 1.3, relevance the as- claims can be used to express an abstraction. For example, a description of a battery that ignores claims. As explained sumptions underlying its thermal aspects may be based on the relevance claim that the predicate is irrelevant the predicate Rel. to the query. In modeling conditions, we state such relevance claims using temperature task. These include assumptions consists of assumptions The second class of modeling constraints about of the model. For example, a model solving the temporal granularity behavior of a battery over a few seconds would look quite different from one describing over several days. The former would treat the voltage and the charge level as essentially constant of each other. The functional the problem the desired accuracy of the answer and the it ‘quantities relation fragment describing that exists between latter would need independent to include them. about the Fig. 4 :shows the modeling conditions for the Charge-sensitive-voltage-battery fragment level, vohage, and rechargeability shown in Fig. 2. In the example, the model fragment of the battery be considered requires as relevant properties. model that the charge 364 A. I: Levy et al. /Art$icial Intelligence 96 (1997) 351-394 Formally, Rel is defined as follows. A simulator and is said to produce a simulation model for each simulated predicate Rel can be either a ground ground atomic sentence. ’ Rel(r) or in some simulation model M, produced from M. term is given a model of an initial state state. The argument of term) or a in M (i.e., a constant or functional is said to hold for a model M when r occurs from a model Note that as a consequence that is a negative occurrence of Rel of the meaning of the predicate Rel, a modeling assump- in a model, is a statement about what 8 For example, assum- the temperature because tion that is a positive occurrence of Rel is a statement about what is included whereas an assumption is excluded ing TRel( Temperuture(battery) ) simplifies attribute of the battery can be ignored, whereas assuming Rel( Temperature (battery) ) attribute of the battery be considered. We keep the same requires that are used to specify properties of the re- convention sulting model. For example, is simplified is a simplifying assumption). the representation time&ale) states that the representation for other meta-level predicates that the temperature to ignore (i.e., the literal +rge( term effects on the battery. in spirit to the Consider longer The predicate Rel is similar is that we provide clear semantics for Rel based on the relevance relevance of different elements predicate used in [ 71. The main reasoning (i.e., terms or ground difference framework, and that we distinguish atoms). In general, it is difficult to assign semantics 9,151). However, ground (such as whether Rel( p V up) terms and ground atomic sentences. Hence, we avoid controversial implies ReZ( p) ) . in this paper we have limited situations for relevance predicates the relevance claims (see e.g., to apply only [4, to 3.1.2. Causal orientation of model fragments When building a model of a system and analyzing are determined, in the model. For example, the quantities the values of quantities how among may say that the voltage orientation of the equations causally determined by that model. is determined in a model determines i.e., what it, we often want to know exactly are the causal dependencies in a model containing Ohm’s law, we by the current and the resistance. The causal that can be the set of quantities involved Equations the equation the functional relations among in model fragments describe in the modeled phenomenon without specifying the continuous causal for Ohm’s law, V = iR, only states the relationship the voltage and the resistance, without specifying which values is quantities direction. For example, between cause which other values. The direction of causality only emerges when the equation embedded and the quantities dering that are externally determined [ 121 provides an operational definition of causality in a system of equations each of which represents an independent mechanism are specified. The theory of causal or- in such a system of equations. the current, a particular ’ In order not to deal with second order sentences, we use KIF’s quoting mechanism [ lo] when the argument is a ground atomic sentence. 8 Though any finite model fragment all the terms not appearing (regarding to make explicit are those about detailed model fragment describing implicitly makes a potentially in the model fragment), intinite number of irrelevance assumptions that are useful in an alternative, more the only irrelevance assumptions in itself but do appear the terms that do not appear the same phenomenon. A.Z L.evy et al. /Artificial hrelligence 96 (1997) 351-394 365 relations the causal dependency the causal ordering procedure to a self-contained among By applying can determine The result of the causal ordering essentially from each equation, represents equation other quantities tity. Since @ is one-to-one, model determined establishes a one-to-one mapping, Q(e) = q, in the equation. The and all in the same equation are the causal predecessors of the quan- in a that are not associated with any equation are called exogenous. They are the ones to a quantity, q, that appears that determines system of equations, one in the equations. e, in the system the mechanism external to the system being modeled. by some unspecified mechanisms # @(e2). 9 The quantities the value of the quantity, if el + e2, then @(el) the quantities appearing Given a causal ordering @, we say that a quantity q1 causally affects a quantity q2 if: in the equation e, and @(e) = q2. in which case we say l The quantity q1 appears q1 c;!irectZy causally affects q2, or l There exists some quantity q3, such that q1 causally affects q3 and q3 causally affects q2. In compositional modeling, set of quantities for each model a priori specify and equations are assembled the causal orientation of equations can only be determined into a simulation to the theory of causal ordering, the quantities whose values are is In gen- of the model after the model fragments are instantiated model. Since an equation by itself is acausal, according one cannot fragment caused by the model fragment. What one can say a priori about each model fragment the possible eral, this set can contain all the quantities mentioned fragment, but it could be a subset represent’ed by the model allows one to limit tions of lthe equations. We will call the set of quantities model fragment determined by the model fragment simulation model Furthermore, if some knowledge about the particular phenomenon interpreta- turns out to be causally in any that could be determined by the model fragment. is always a member of that set. lo its output quantities. The quantity that can be determined in the model fragment) (actually an equation the possible causal in the consequences that actually fragment by a one can determine a priori for each member of the set of output quantities the set of other quantities on which the quantity causally depends the model fragment. These quantities must be determined by other model fragment that to the model. Given a model the set of all quantities q, we can determine in the model or must be exogenous of a model fragment, upon through fragments m and one of its output quantities, directly causally affects q through m as follows: l The set includes all the quantities mentioned l If q is a continuous the s’ame equations as q in the consequences quantity, the set also includes all the quantities in the operating conditions of m. appearing of m. in We call this set of quantities the input quantities of m with respect though we have couched and equations as if the consequences the discussion thus far in this section fragments of model to q. Even in terms of quantities consisted only of numerical y We consider two equations to be equivalent if they contain the same quantities and are true for the same vectors of values of those quantities. lo We allow specification mation algorithm in the empirical evaluation of the algorithm presented for our formulation of output variables is not necessary in a model fragment definition. However, such additional infor- to work correctly. Also, no such information was used in Section 4.5. 366 A.E Levy et al./Arti$cial Intelligence 96 (1997) 351-394 and equations, quantities numerical quantities any time-dependent and equations. attributes. the concepts apply equally well to both numerical and non- ‘I Thus, the input and output quantities can include Given a set M of model fragments, one can draw a directed graph of causal influences as follows, where a node represents a quantity and an arrow represents a potential causal influence of the quantity at the tail on the quantity at the head: ( 1) Draw an arrow from each qi to q such that qi is an input quantity of any member of M with respect to q. (2) Repeat the procedure recursively Each path in this graph leading in M on q. quantity for each qi until no new arrows can be drawn. influence of a to q represents a path of potential causal 3.1.3. Composite model fragments Some model fragments describe the same phenomenon, i.e., the value ranges assumed but differ only in their oper- in the model the behavior relation the voltage of a battery and its charge level changes depending on the value of ating regions, quantities fragment. This happens often when a group of model fragments describe of the same device between the charge level: When and 30 ampere-hours, tends to increase the charge level is in a given range, say between 6 ampere-hours is constant. On both sides of the range, the voltage the voltage (or decreases). as the charge level increases regions. For example, in different operating for the continuous the functional (or decrease) We group such model fragments into a single composite model fragment (CMF) . A in the phenomenon. Consequently, CMF is a set of model fragments describing participating the same set of participants conditions of the model fragments fragment a singleton instead of individual model fragments. is included the CMF from the entire operating range of the quantities all the members of a CMF must have conditions. The operating that at most one model in any simulation model. Clearly, a CMF can be selects CMFs procedure in each CMF must guarantee set. As we will show later, our model formulation and the same set of modeling l2 3.1.4. Assumption classes Composite model sumption class is a set of CMFs that describe and contradictory modeling are further grouped into assumption classes. l3 An as- based on different the same phenomenon conditions. As stated in Section 3.1.1, modeling conditions fragments and discrete-valued the concept of causal ordering applies the definition of quantities continuous-valued including in Section 2.1 includes all atomic expressions denoting functional ” Recall attributes, relational expressions. Likewise, I2 CMFs are in a sense an artifact of a particular arc using. If the model fragment definition need CMFs. In that case, our model formulation procedure would work with model fragments CMFs and achieve I3 We are giving and Forbus language allowed disjunctions a slightly different meaning the term “assumption-class” to logical expressions the same effect. restriction of the model fragment definition expressions in language we in the consequences, we would not rather than with time-dependent as well as boolean-valued [ 291. from that given to it by Falkenhainer A. X Levy et al. /Artificial Intelligence 96 (1997) 351-394 367 Temperahm-sensitive CL J Fig. 5. Battery voltage assumption class. abstractions the assumptions made express underlying Fig. 5 shows an assumption of a battery. One way to model way is ta’ assume takes into consideration voltage produced. Since mutually CMF frolm a single Since CMFs instantiated in an assumption exclusive, any consistent and approximations in the representation of the system. They express that are assumed by the model class consisting of different ways of describing the fragment. the voltage it is always constant. Another it steadily degrades over time. Yet another way of modeling a battery on the actual class are set of modeling assumptions will include at most one effects of the charge the modeling level and the temperature in an assumption is to assume the voltage conditions of CMFs the same phenomenon, than a CMF ci (written they each class all represent have the !;ame set of participants. Within an assumption class, CMFs are partially ordered relation which we denote by the predicate “<“. A CMF ci is said to by a simpler-than be simpler assumptions made by cj. We will denote is <‘c*?‘. In Fig. 5, the simpler-than class has a single an arc frlom ci to cj if ci < cj. We assume most complicated CMF and a single simplest CMF. The most complicated CMF makes the fewest simplifying the most simplifying assumptions. Finally, we assume if ci makes a superset of the simplifying the transitive closure of < by the predicate is denoted by the directed arcs. There and the simplest CMF makes that every assumption that if ci < cj, then: assumptions, ci < cj) relation assumption class. ( 1) The output quantities of cj are a superset of the output quantities of ci. (2) If fi is a causal ordering of the quantities of ci, then there exists a causal ordering f, of cj such that the causal relations among quantities in ci (given by fi) are a subset of the causal relations among quantities in cj (given by fj). All of these properties follow approximation fragment relations is a causal approximation entailed by the former if we assume that whenever ci < cj, then ci is an [ 241. A model if the set of causal fragment is a subset of those entailed by the latter. Nayak has of another model of cj of the type that Nayak calls causaZ approximations A.Z Levy et al./Arti$cial Intelligence 96 (1997) 351-394 that causal approximations cover most approximation relations encountered in 368 argued practice. We assume that the modeling conditions of CMFs made by in an assumption class in the assumption this is formalized that are conjoined model fragments Then we can annotate that ci is making link ci to cj assumptions a set of literals . . . ,lpn} (7~1, . . . , pn, to in addition meaning the simplifying the simplifying assumptions made by cj, or formally, As,, = (As, - {PI,. . . , pn}> U {‘PI,. . . Coherence of the library. The library coherence assumption instances whose modeling we have a set of model fragment and whose operating are satisfied that model equations than quantities). equations conditions that state will not be over-constrained this assumption Formally, in some state, essentially assumptions that if requires are consistent then set of the resulting (i.e., will not have more is defined as follows: Definition 1. A model fragment holds. Let M be a set of instances of model state such that: library is said to be coherent if the following condition from the library and s be any fragments a(M), of the model fragment instances in M are conditions, ( 1) The modeling consistent, If a( 44) b Rel(r), of some model fragment (2) (3) The conjunction M are satisfied in s. the set of equations Then, then r appears instance in M, and in the operating conditions or consequences of the operating conditions of the model fragment instances in given by the union of the consequences of M are not over-constrained. Note that a set of equations that are not over-constrained can always be made complete by assuming that some quantities are exogenous. Completeness of the library. No library can be “complete” the knowledge of the world. There are things in the sense of covering all that any library, no matter how large and A. E Levy et al. /Art$cial Intelligence 96 (1997) 351-394 369 to define completeness with respect in the library. The library completeness to limitations of the knowledge it is possible contained detailed, cannot explain. However, known assumption causally affect any quantity is explicitly known quantity call the zset &lo&L) contained all quantities such that they appear not contain model fragments of all the phenomena quantity. of quantities states that the library contains knowledge about all the phenomena that can appearing the to be at the boundary of the library’s knowledge. We will to be at the boundary of knowledge in any model fragment in the library unless that are known in the library L the globally exogenous quantities. E&,&L) in model fragments but for which is the set of the library does that can directly causally affect the is said to be complete if the following condition conditions, M be a set of model fragment conditions, a(M), of the model fragments in 2. A model fragment Defhitbn holds. Let A be a set of consistent modeling instances, (1) and s be any state such that: of the modeling library The conjunction Af is consistent, For any assumption assumptions a(M) a(M) quences of at least one model fragment The conjunction is true in s. is consistent with A, k Rel(r) implies (2) (3) (4) (5) Then, class As that contains at least one CMF whose modeling are consistent with A, M contains an instance of a CMF from As, that r appears in the operating conditions or conse- of the operating conditions instances in M instance in M, and of model fragment l if the quantities in Eg[,,ba[( L) are assumed to be exogenous, the set Eq, of equations given by the union of the consequences of M is not under-constrained, l4 and l for (all u such that u appears each of the assumption conditions that are true in s. in EqM and u $ Eglobal( L), M contains a CMF from the that influence u under phenomena classes representing of a library, for any consistent Under this definition of completeness library L will give rise to a set of equations of the variables appearing notion of completeness a Newtonian physics where objects are moving close to the speed of light. state s, a complete to determine all the values in them except for those in Eglobal( L). We should note that this of a library. For example, in states to that of “correctness” library can be complete but will not give accurate results that are sufficient is orthogonal 3.2. Other modeling constraints In addlition to the modeling conditions attached to each model fragment, we assume a background on the possible models. The constraints constraints theory of modeling constraints, C. We use C to express additional constraints (e.g., general can either be domain claims) or domain specific constraints. The following entailed by relevance independent I4 Note that under the library coherence assumption, the set will also be self-contained. 370 A. Z Levy et al. /Art$cial Intelligence 96 (1997) 351-394 states constraint an object 0 query. * l5 For example, property Subpart relevant object as well. that if the refinement of objects along the property r is relevant that is relevant to a query, and r(0, X) holds, if Battery1 is relevant, and Chassis1 is relevant, the refinement along is a subpart of Battery 1, then Chassis1 then X is relevant of Battery1 for to the the is a RelObjectRejinement(0, k> A r( 0, X) A RelObject(0) + RelObject(X) . The following examples and Forbus covering Falkenhainer of the minimal components mentioned Falkenhainer in the model, given of constraints [ 71. Their heuristic system, defined specify a variation on a heuristic used by is to include in a model all the components ancestor of the in the query in the part-of hierarchy of the system being modeled. to assure that certain other objects be included to be the lowest common and Forbus use this heuristic the initial set of objects of interest. structuralHierarchySlot(p) A RelObject(X) A RelObjectRe$nement( X, p) A p(X, Y) =F- RelObject( Y) structuralHierarchySlot(p) A p(X, Y) A RelObject(X) A RelObject(Y) + RelObjectRejinement(X, p) The above relevance axioms state that if the objects st and s2 are both relevant query, and t is their least common ancestor in the hierarchy such an object, will be considered that is either between relevant t and st (or between to the query. in the structural hierarchy, to the then any object t and SZ), or a child of can be expressed using arbitrary Essentially, constraints reasons, we assume efficiency rules. Even constraints, Horn rules have been expressive have so far encountered. though Forbus and Falkenhainer that the constraints first order formulas. For in C are expressed using only Horn to state modeling allow arbitrary clauses enough for the modeling constraints we 4. The model formulation method In this section, we explain how the model formulation problem can be formulated and we present the actual algorithm reasoning, for formulating as a problem of relevance a scenario model. We also present a detailed example of models being the algorithm. As a basis for our discussion, we first formally define model formulation previous sections. given all the representational for simulation, apparatus formulated by the problem of in introduced I5 Note that for clarity, we use predicate names for relevance that are specialized to the kind of entity being deemed relevant. A.I! Levy et al. /Artijcial Intelligence 96 (1997) 351-394 371 4.1. The problem dejinition Infonnally, the model problem formulation that can answer a query about a system given an initial of a system may go through many states, and, as we argued is to choose a set of instantiated model state. However, a in Section 2.2, the costly selection process at every state. Therefore, we problem as selecting a small set of potentiuE instances of to repeat formulation the scenario model. The scenario model has the property that its modeling and at every state, a simulation model can be easily composed are consistent, fragments simulation we do not want pose the model CMFs, called conditions from it. Formally, we first define a potential instance of a CMF and then use that definition to define a scenario model. Definition 3. A potential plist is a list each element of which is a participant in c I6 and o is an object instance of a CMF is a pair (c,plist), where c is a CMF and is a potential binding of the form (p, o), where p that satisfies the type specification of p. Note that the objects in the bindings of a potential in the Conditions part of the model fragments instance of a CMF may or may not in the CMF. (Those are checked when the simulation model is created for a specific state.) satisfy the statements conditions Definition 4. A scenario model is a set of potential conditions are consistent. instances of CMFs whose modeling Formally, the model formulation problem theory domain system description, (i.e., model fragment and a query, defined as follows: is to choose a scenario model, given a a library and background modeling constraints), about a physical typically describe a set of individuals Scenario description: A set of statements state. These statements the system), those individuals. QLlCi-JV - A quantity q (or list of quantities) whose value we want to predict by simulating system and its initial of to structure, and the initial values of quantities (i.e., components related their physical the system. - A list Eiyut of exogenous quantities. The elements given and to be outside the scope of the simulation a scenario model. in EQ,,, are assumed to be for which we are constructing - A list Cinp,, of atomic ground sentences are used a scenario model to circumscribe These conditions creating (e.g., construct a scenario model only for states in which the battery constraints if ldaaaged(Battery1 that we want - A list Znit of modeling to enforce. that must hold in all simulated states. the set of states for which we are then we is in C+ur, is not damaged). Implicitly, Znit includes Rel (q) . I6 Recall that all model fragments in a CMF must have the same participants. 372 A.Z Levy et al./Artifcial Intelligence 96 (1997) 351-394 At each state during a simulation, the operating the system checks in the scenario model. The operating conditions instance instances of the CMF model fragment fragment scenario model by S and the simulation model created from it in state s by S,. that the resulting from each CMF will be satisfied In Section 2.2, we argued the simulation model of the state. We denote instances will comprise only conditions of at most one in the state, and those model the logical-model to refer to the standard notion of a model problem we have just defined. the meaning of adequacy and simplicity scenario model must be adequate yet in the In our discussion, we (i.e., in logic it from a model of and to distinguish simple. Now, we can formally define context of the model use the phrase an interpretation a physical device. formulation The first condition on a generated answering scenario model as follows. the query. We define adequacy that satisfies a set of formulas) scenario model for first for a simulation model and then for a is that it must be adequate that a can l7 Definition 5. Given a set of exogenous quantities E, a simulation model M in a state s is adequate for determining a CMF a quantity q when the following conditions from every assumption Cl M contains class a such are satisfied: instance influence q in s and that there is at least one path of potential causal influence from a variable in a to q that does not include a variable in E. C2 The set of equations, EqM, in M determines the value of q uniquely; i.e., C2.1 EqM contains q, and C2.2 Either: C2.2.1 Eq, contains a self-contained (i.e., not over-constrained or under constrained) subset that includes q, or C2.2.2 Eq, can be made self-contained by adding exogenous quantities that are in E. We now define a scenario model as being adequate when it is coherent and sufficient as follows: constraints C, a scenario model S is adequate a query (q, Einput, C+t, hit) Definition 6. Given a set of background for answering There Dl .l The modeling D1.2 is a logical-model Dl If Rel( ql) is satisfied CMF in S. if: L for C A hit such that: conditions of all the CMFs in S are satisfied in L; and in L for some quantity 41, then q1 occurs in some D2 For any state s of the simulation model S, for s that results quantities from Einp,, and Eglobal are exogenous. that does not contradict Cinput, the simulation from S is adequate to determine q, assuming the Condition Dl ensures that the scenario model is coherent. D1.l considers the modeling conditions, and D1.2 considers the relevance conditions. Condition D2 ensures that the I7 See Section 3.1.2. A.E: Levy et al./Arti$cial Intelligence 96 (1997) 351-394 313 scenario model q. determining is adequate, i.e., that in every state, the resulting model is adequate for In order for a scenario model to be useful, it should be as simple as possible: Definition 7. A scenario model St is simpler than LT.2 if there is a mapping 4 from the CMFs of Sr to the CMFs of S2 such that ( 1) F;or every CMF c E St, 4(c) instantiated assumption the same is from class as c. (2) EGther c = 4(c) or c <* 4(c). 18 The mapping 4 in the definition guarantees that Sr has no more CMFs than S2, and that for each CMF c in Sr, there is CMF than c. in S2 that is the same or more complicated The model selection problem is to find an adequate scenario model such that there is no simpler, adequate scenario model. 4.2. Mo,del formulation as relevance reasoning The approach on the intuition relevance to the model formulation problem advocated is based that several aspects of the problem are better viewed as problems of in this document reasoning. We explain our view and its import in this section. Intuitively, we argue that the model formulation nation oF two subproblems. The first is to determine which phenomena which quantities) to the query quantity. The second problem the level of detail at which independent greater Ilevel of detail may require modeling of reasoning done for each one of these problems problem can be viewed as a combi- (and therefore is to determine are not at a the kind the relevant phenomena. These problems additional phenomena. However, to model a certain phenomenon of each other because the decision are relevant is different. to model 4.2.1. Selecting the relevant phenomena The first part of the model formulation problem is to decide which quantities are rele- (and therefore, decide which phenomena should be modeled). is some possible (1) there vant to the query quantity Intuitivel.y, a quantity u is relevant q, i.e., either fects q, or (2) u can cause a change where some other quantity value of q). Consequently, the possible causal traces underlying query and to other work on model models through all the possible this algorithm causally finding tree described [ 25,27,33] is similar causal (e.g., ). to the query quantity q if u can causally injluence af- in a state the affects state of the system in the state of the system resulting therefore, u indirectly in which u causally affects q (and, the relevant quantities can be done by following that we describe here on the query quantity. The intuition influences influences between quantities. The algorithm in [ 211, which represents to the intuition underlying the construction of the all the possible derivations of a query, to build in order that follows causal chains formulation I8 Recall that the predicate <* is the transitive closure of the “simpler-than” predicate for CMFs. 374 A.Y Levy et al./Arti$cial Intelligence 96 (1997) 351-394 4.2.2. Selecting the level of detail The second part of the model selection problem is determining the level of detail and at which approximations that knowledge underlying understood when stated to bear in choosing l We articulate constraints, ences between one model fragment to model each phenomenon. This entails deciding which abstractions can be made in modeling [ 16,171 demonstrates such decisions can be stated as relevance claims and better in that form. In our algorithm, we bring relevance knowledge the system. Levy in the level of detail in two ways: the diflerence between CMFs in an assumption expressed partially by relevance claims. Articulating class by the modeling the precise differ- to determine when to switch from the CMFs enables our algorithm to another. l Engineers have good general heuristics for selecting physical declaratively systems. We use the modeling constraints C to express (in the form of relevance claims) and to reason with them. relevant detail when modeling these heuristics Our modeling algorithm uses both kinds of this knowledge to select a simplest scenario model. 4.2.3. Partial knowledge about the simulation states is given reasoning Our algorithm all the possible that are assumed for a set of possible selects a scenario model [8] which we do not want process. Therefore, our algorithm states that the system may reach beginning states. This knowledge to be exogenous of the system. The problem we face here is analogous Envisioning state is a very expensive operation the model formulation only on partial knowledge of the possible the set E+.,t of quantities facts in the description relevance Horn rule knowledge which ground ground that some ground might be. l9 Analogously, that is consistent with our partial knowledge. As in [20], any additional about the reachable partial knowledge relevance states of the system. from the initial to perform as part of selects a scenario model based implicitly by and by the time invariant to the in the context of the problem was to decide to a given query without actually knowing which stated that they reach any state knowledge states may enable us to select a simpler scenario model. Assuming is a key aspect in making formulas are in the knowledge base. In doing so, unless problem discussed by Levy and Sagiv are not in the knowledge base, that the system can actually (and the knowledge base) formulas are irrelevant bases and database reasoning practical. here we assume about the world systems. There, it was explicitly it was assumed formulas in [20] 4.3. Model formulation algorithm Based on the discussion lation algorithm. in order to find all the quantities Informally, in the previous sections, we now describe our model formu- influences on the query the that can affect the query. For each such quantity, follows all possible the algorithm I9 Note that the fact that a certain formula might be in the knowledge base may affect the relevance of another formula. A.L Levy et al. /Artijicial Intelligence 96 (1997) 351-394 315 To find all the quantities selects the simplest CMF that describes it such that the set of selected CMFs algorithm make consistent modeling assumptions. The details of the algorithm are shown in Fig. 6. that can affect the query q, the algorithm begins by consid- classes of which the quantity q may be an output quantity. The class is the union of all the output quantities ering all the assumption set of output quantities of an assumption of the model fragments contained in the assumption class. From each such assumption class, we select one CMF and recursively consider all to q. The recursion bottoms out when we the input quantities of the CMF with respect reach the exogenous quantities given in E+,, or EglOba[. To select a CMF from an assumption assumptions made given in Init (and in particular, the simplest CMF that does not contradict the assumptions thus far about class, we maintain the model. The list initially a list, Rel, of modeling the assumptions includes the relevance of the query q). At every step, we choose in Rel. Adding a new CMF to the scenario model may imply that we add assumptions and that we need to revise previous choices of CMFs. We perform adjustment the while.-loop In what follows, we illustrate the execution of the algorithm with an example. in select-scenario-model) to Rel, steps (via until all the choices of CMFs are consistent. 4.4. Example The example is a simple circuit containing a solar array (SAI) and a rechargeable shown battery (IBAl), the model fragments the CMF’s behavior equations operating conditions The query the quantities mentioned modeling is Voltage(BAl), constraints is empty. in Fig. 1. Fig. 7 shows the scenario description in the domain theory library. For each CMF in the domain (consequences) and the list of quantities appearing and Fig. 8 shows theory, in its classes are shown in Fig. 9. all except Damaged(BA1). The set of quantities which includes are shown. The annotated assumption with a list of exogenous in the scenario description is the only identifies Battery-voltage-ac(BA1) The query quantity Voltage(BA1) and so that can class, we start from the simplest, this choice and we select this CMF. This choice results in the addition of the following the algorithm affect it. :?O To select a CMF out of this assumption Constant-voltage-CMF. is consistent, to our modeling there are no earlier modeling assumptions, item on the queue initially, class as an assumption assumption list, Rel: Since Rel(Battery(BA1)) and Rel(Damaged(BA1)). the quantity Voltage(BA1) the CMF Constant-voltage-CMF(BA1)) Since (through tity Damaged(BAI) find the assumption class Battery-damage-due-to-overcharge-ac can be influenced by the quantity Damaged(BA1) the quan- the new current goal. We that can affect it is the only is placed on the queue and becomes out of which Battery-damage-CMF which is not exogenous, is selected since Damaged(BAl), member. This selection causes the literals: 2o In our implementation of the algorithm, we make use of a data StrucUCture that enables us to efficiently find the assumption that affect a given quantity without searching the whole model fragment library. classes 376 A.Z Levy et al./Art@cial Intelligence 96 (1997) 351-394 the list of conditions that must hold in all simulation states given in the query. */ procedure select-scenario-modeI( q, Einpu,, Cinpu,, Init. C) I* q: the query quantity. *I /* Einput: the list of exogenous quantities given in the query. */ /* Citpr: /* hit: the list of modeling constraints given in the query. */ /* C: the background theory of modeling constraints. */ /* Q: a queue of quantities and terms. */ /* Rel: the current list of modeling constraints. */ /* Model: the scenario model being constructed. It is a list of pairs (c, n), */ /* where c is a potential instance of a CMF */ /* /* As,: the modeling assumptions of CMF c. */ begin and x is a quantity or a term that c could causally affect. */ Q = (41. Rel = Init. Model = nil. repeat q1 = dequeue(Q). As = assumption classes in which q1 cm be an output quantity and whose operating conditions do not contradict CinPU,. for each a E As do: select-from-assumption-class while there is a pair (c, q’) E Model and p E Rel such that up E As< (a, 41) . remove (c, q’) from Model. select-from-assumption-class( I* A, is the assumption class from which c was chosen */ A,, q') until Q is empty. return the set {c 1 (c, q’) E Model). end select-scenario-model. procedure select-from-assumption-class( /* A is a potential instance of an assumption class that can determine q. */ begin A, q) c = A simplest CMF in A such that there does not exist p such that up E Asc A p E Rel. Model=ModelU{(c,q)}. inputs = the union of: The quantities that appear in equations with q and The quantities in the operating conditions of c. for every X E inputs do if X has not been in Q and X @ Einpu, then enqueue X onto Q. Rel = DeductiveClosure(C U Rel U Pos(As,)). /* DeductiveClosure returns the set of ground atomic formulas derivable from its argument. */ Pos(As,) is the list of positive literals in As,. if Rel(ql) E ReZ and q1 $! Einpu, and q1 has not been in Q then enqueue q1 onto Q. end select-from-assumption-class. Fig. 6. Model selection algorithm. A.Z Levy et al. /Artificial Intelligence 96 (1997) 3.51-394 377 Scenario description Legend CL: Charge-level(X) V: Voltage-produced(X) TEMP: Temperature-of(X) I: Current(Plus-terminal(X)) DOD: Average-depth-of-discharge(X) TSLC: Tie-since-last-conditioning(X) Solar-array(SA1) Battery(BA1) Rechargeable( BAl ) Plus-terminal( BAl )=t4 Minus_terminal(BAl)=t3 Plus-terminal( SAl )=t2 Minus-terminal(SAl)=tl Electrically-connected(t2,t4) Electrically-connected(tl,t3) lDamaged(BA1) Fig. 7. T’he initial state of the system. CMF Behavior Quantities in operating cond. Batterv-voltage assumution class: Constant-voltage-CMF v = co Battery(X), -Damaged(X) Binary-voltage-CMF Normal-degrading-CMF Charge-sensitive-CMF v= 0 ifCL<co ~1 if CL > co 1 v = f(zime) v = f( CL) Temperature-sensitive-CMF V = f( TEMP, CL) Battery-chsuge-level assumption class: Constant-charge-level-CMF Normal-accumulation-CMF CL=q CL=sIdt Battery(X) , lDamaged( X) Battery(X), Battery(X), Rechargeable(X) Battery(X), Rechargeable(X) -Damaged(X) TDamaged(X), -Damaged(X), Battery(X), -Damaged(X) Battery(X), -Damaged(X), Rechargeable(X) Accumulatlkon-with-aging-CMF CL = j- I dt - f (DOD, TSLC) Battery(X), -Damaged(X), Battery-damaged-due-to-overcharge assumption class: Battery-damage-CMF Damaged(X) Rechargeable(X) Battery(X), Rechargeable(X) -Damaged(X), CL(X) Fig. 8. Model fragments for the battery example. Rel(Rechargeable(BA1)) and Rel(Charge-level(BA1)) to Rel. The tree of quantities to be added current content of Rel at this point one currently any further. is shown selected. The node marked X is in Einput and, therefore, and assumption classes in Fig. 10. The CMF together with the in bold face is the is not expanded The addition of the above literals to Rel makes the assumption both TRel (Rechargeable(BA1) Constant-voltage-CMF. > and lRel(Charge-level list inconsistent since (BAI) ) were assumed by 378 A.I: Levy et al./Artifcial Intelligence 96 (1997) 351-394 Bat e -ch aree-level-ac Battenr 01~ -” - Cop&ant-charge-level-CMF ormal-accumulation-CMF -Rel(DOD), -Rel(TSLC) Accumulation-with-aging-CMF -Rel(Rechqeable(?b)) Temperahue-sensitive-CMF Fig. 9. Assumption classes. Rel(Battery(BAl), Rel(Damaged(BAl)), -Rel(Charge-level(BAl)), -Rel(Rechargeable(BAl)), -Small(Granularity), -Rel(Temperature(BAl) -Large(TPoG) Fig. 10. An intermediate goal tree in Example 1 Rel(Battery(BAl), Rel(Damaged(BAl)), Large(TPCJG) RWbarge-level(BAl)), ReKRecbargeabl4BAl)), -Rel(Temperature(BAl)), -Rel(DOD), -Rel(TSLC) Small(Granularity), Fig. 11. The final goal tree of the example. A.I: L.evy et al. /Art$icial Intelligence 96 (1997) 351-394 379 Table 1 Reduction in the size of models Example name Max. formulated model size Max. possible model size SC EPS RCS BMS 7 28 252 18 31 41 418 212 To resolve the inconsistency, we adjust we now select Charge-sensitive-CMF, contradict the current modeling assumptions. the choice of Constant-voltage-CMF, which is the simplest CMF and that does not The current goal quantity now becomes Charge-level (BAl) . The assumption class and we select from it the the current modeling is Battery-charge-level-ac, that can iaffect this quantity CMF Normal-accumulation-CMF(BA1) , which is the simplest CMF that is consistent (BAI) > can influence with it is an exogenous quantity, Charge-level(BA1) terminates. it is not placed on the queue. The queue The final tree of quantities in Fig. 11. The resulting scenario is now empty and the procedure this CME However, since assumptions. Current -model contains: and assumption (Plus-terminal is shown through classes Charge-sensitive-CMF(BAl), Battery-damage-due-to-overcharge-CMF(BAl), Normal-accumulation-CMF(BA1). and makes the following modeling assumptions: Rel (Battery(BAl)), Rel(Damaged(BAl)), Rel’(Rechargeable(BAl)), Rel(Charge-level(BAl)), Large(TPOG),Small(Granularity), TRel(Temperature(BAl)), TRel(DOD), lRel(TSLC) Note that the procedure (Plus-terminal Current been specified exogenous, including those representing the quantity terminates at this point in the query. Had it not (BAI) > was specified as exogenous the procedure would have added more CMFk to the model, in the example because other components and processes affecting the current. 4.5. Experimental results We have conducted experiments with the model formulation domain algorithm and to verify theories. The purposes of the experiments are to test our implementation its effectiveness with actual model fragment libraries. The results of the experiments the effectiveness of the formulation algorithm the model sizes varied widely depending on queries. Table 1 shows the size of the largest model formulated along with the model size. For each example, generally confirm in limiting algorithm on several of the 380 A. I! Levy et al. /Artificial Intelligence 96 (1997) 351-394 through tl sl through kl, k2 : Relays t14 : Electrical s4: Signal terminals terminals - Signal connection .- - - - Sensor data connection - Electrical connection Fig. 12. Electrical Power System. theories assumptions the size of the maximum model of the four domain adding a priori exogeneity obtained without any such assumptions. Even used were fairly narrowly that a significant reduction table shows that reduction 91% (BMS). We expect for more general-purpose model fragment that reduction that would be created without the algorithm tried. Since model sizes can be made arbitrarily for each small by the model sizes shown are those libraries the results show for most queries. The to fragment focused on certain aspects of one device, in the size of the model was achieved in the size of formulated models ranged from 32% (EPS) to the query, though all the model in model sizes would be even more significant libraries with a broader scope. We briefly describe the four example domain theories used to test the algorithm: Simple circuit (SC). The circuit shown Section 4.4. The model fragment in Fig. 1 used as the illustrative example in library contains 32 model fragment definitions. Electrical power system shown load, a rechargeable the satellite is in the sun, the solar arrays supply power to the load while recharging battery. The battery supplies power in eclipse. The charge current controller monitors charge level of the battery and opens and closes the relays in order to prevent from damage due to over-charging. The model fragment system of a satellite (EPS). The Electrical Power Supply in Fig. 12. The system consists of a series of solar arrays, relays, an electrical and their connections. While the the the battery library contains 66 definitions. battery, a charge current controller, in Fig. 13. The system consists of two structurally (RCS). The Reaction Control System of the Space Shuttle Reaction control system for shown supplying oxygen and fuel. Oxygen and fuel, separately propelled by pressurized helium, meet in the thrusters and ignite, generating library containing 95 definitions is mainly concerned with the fluid dynamic behavior of the system. thrust. The model fragment subsystems identical A.E Levy et al./Artifcial Intelligence 96 (1997) 351-394 381 eaure-terminal-0 raulic-terminal-2 Isolation valves l/2 @i-V 31415 +I hydraulic-terminal-4 Manifolds lkolaticn valves Manifdds Thrusters Fig. 13. Reaction Control System. temperature gauge (BMS). The temperature gauges shown in Fig. 14. in [ 221. The device is intended Bimetallic-strip It is described by Macaulay of liquid. The resistance of the thermistor changes according liquid, which results the heat generated by the coil, which changes As the bimetallic fragment mal conduction, library contains 80 definitions. library contains knowledge about kinematics, strip is heated by the coil, it bends, in the current in change through to measure the temperature to the temperature of the the temperature of the bimetallic the wire. The current determines strip. the pointer. The model ther- thermodynamics, strip. The rotating electricity, as well as the behaviors of the thermistor and the bimetallic 382 A.Y Levy et al./Art@cial Intelligence 96 (1997) 3.51-394 Coil Container of water Fig. 14. Bimetallic strip temperature gauge. Table 2 Size of the examples Example Library size Scenario size Max. scenario model size SC EPS RCS BMS 32 66 95 80 11 54 289 33 31 41 418 212 Except for the simple circuit example, which was constructed explicitly the algorithm, the domain theories had been originally of demonstrating to model independently bimetallic strip temperature Nayak to test his approach bimetallic library in CML for the experiment. the behavior of respective devices. The gauge knowledge base had been originally last example of the by constructed in his thesis, which extensively uses the [23]. We rewrote his model fragment to model formulation strip temperature gauge as an example for the purpose constructed in terms of the size of the model fragment size for a scenario model. fragment is the total number of components is measured by the number of model the size of the scenario, and the maximum possible in the library. The size of the scenario Table 2 shows the size of each example, library library, The size of the model fragment definitions in the scenario.21 The maximum possible CMF instances formulate a model. given the library and the scenario. Tables 3-6 show quantitative that would be created is the number of in the library were used to In other words, it is the upper limit on the size of a scenario model size for a scenario model if all the knowledge the tables show the goal term, the formulated model size (in terms of the number of CMF the number of goals explored by the formulation procedure, and instances In Table 5, the numbers of facts and components determined data from each example. For each domain relevant by the procedure. in the model), theory, 21 In these domain modeled as one entity. theories, a terminal or a junction, which represents a connection among terminals, is A. 1: Levy et al. /Artijicial Intelligence 96 (I 997) 351-394 383 Table 3 Sample results from the SC example Goal term Model size Goals Relevant facts Components stored-chaq;:e( BAl ) drained-p(l3Al) expected-charge-level( BAl ) electromotive-force(BA1) damaged-p(BA1) voltage-at-terminal( t4) current-thru-terminal( t4) voltage-at-terminal(u) 3 4 8 7 7 7 7 1 6 7 18 16 15 16 16 4 13 14 29 26 26 26 26 7 4 4 8 8 8 8 8 3 Table 4 Sample results from the EPS example Goal term Model size Goals Relevant facts Components orbit-time( sun) sun-shining-p( sun) signal-on-at-terminal-p( sl) relay-closed-p( kl) voltage-at-terminal( tl ) current-thru-terminal(t1) voltage-at-terminal(t7) current-thrwterminal(t7) voltage-at-lerminal(tl0) current-thru-terminal(tl0) voltage-at-lerminal( t13) voltage-at-terminal(t14) 2 2 28 28 28 28 28 28 28 28 1 28 Table 5 Sample results from the RCS example 2 2 98 98 98 98 98 98 98 98 10 98 5 5 143 143 143 143 143 143 143 143 18 143 2 2 43 43 43 43 43 43 43 43 7 43 Goal Model size Goals Relevant facts Components sensed-pressure-at-terminal( pressure-terminal- 1) *sensed-pn:ssure-at-terminal(pressure-terminal-l) pressure-at -terminal( hydraulic-terminal-2) pressure-at -terminal( hydraulic-terminal-4) thruster-cavitating-p (thruster- 1) *thruster-cavitating-p(thruster-1) thruster-cavitating-p (thruster-5) *thruster-cavitating-p(thmster-5) 20 20 252 252 252 136 252 136 84 84 769 758 760 432 736 420 52 52 936 936 936 508 936 508 20 20 267 267 267 141 267 141 384 A.E Levy et al. /Artificial Intelligence 96 (1997) 351-394 Table 6 Sample results Goal from the BMS example resistance(Coil-0) current-through-terminal(terminal-0) temperature-of( Bimetallic-Strip-O) temperature-of( Coil-O) heat-flow (Coil-O) input-electrical-power(Coil-0) position( terminal-3) resistance (Thermistor-O) voltage-difference( Thermistor-O) voltage-difference(Coil-0) voltage-difference( Battery-O) temperature-of( Thermistor-O) heat-flow (Bimetallic-Strip-O) self-induced-emf( Coil-O) angular-position (terminal-4) Model Size Goals Relevant Facts Components 1 15 15 15 15 15 18 12 12 15 2 12 15 15 18 1 24 26 26 26 26 39 21 23 24 6 23 26 24 39 3 38 38 38 38 38 59 34 34 38 13 34 38 38 59 2 5 5 5 5 5 10 5 5 5 4 5 5 5 10 the goals with a * indicate variable assumptions. Those assumptions were essentially scope of the model the query did not include any exogenous variable assumptions the to either the oxygen or the fuel side of the RCS. In all other cases, the cases where the given query included a set of exogenous (i.e. Einpur = 8). to broadly intended limit Our goal for constructing the BMS example was to obtain a direct comparison with the result obtained by Nayak for the same example. However, because of the different initially did not way in which goals are formulated formulate the query In his approach, to the model as a statement of the expected causal relation, which one wishes system is formulated to establish by formulating the same model as the one produced by Nayak. in Nayak’s system, our program a model. For example, formulation (causes (temperature thermistor-l ) (angular-position pointer-2) ) to the system. the term to be specified the query but not a cause (angular-position pointer-2) was given as the goal in In other words, our formulation by a model. is to explain of the problem causal behavior given as a query specifies only is an expected in our formulation explained the model in the case where query, our algorithm produced by Nayak’s system. The model produced only strip, where a perfectly valid model assumptions we provided algorithm produced a model are relevant and sufficient terms. for explaining the bimetallic that included about included strip was modeled as being in the absence of any a priori relevance of heat flow into all the components In contrast, (or terms) only allows a query to be causally the efSect term term. Thus, the in term than that produced the pointer and the bimetallic in thermal equilibrium. This is assumptions. Once strip, our that the two the bimetallic and their behaviors relevance the possible causal relation between a much smaller and simpler model A.E Levy et al. /Artificial Inrelligence 96 (1997) 351-394 385 One notable advantage of our approach over Nayak’s is the fact that our formulation rules as Nayak’s system does in order to formulate a model. rules such as Component formulation. As rules from Nayak’s does not rely on heuristic Nayak’s approach depends on manually Interaction Heuristic and Heuristic Coherence Constraints for model our apprlDach does not require any such heuristics, we ignored all the heuristic when constructing original domain heuristics additionall to guide relevance assumptions if one wishes to provide domain- or problem-specific theories. However, the model it is easy to do so in the form of library of the BMS example the CML model fragment and modeling constraints. formulated heuristic formulation process, 5. Analysis formulation that a model the evaluation In Section 2.2, we discussed criteria for model formulation techniques, procedure must produce an adequate yet simple and argued model. How does the algorithm we presented fare against these criteria? In this section, we prove that our algorithm produces a simplest adequate scenario model the assumptions under which this result holds and the for answering consequences the main properties of the algorithm: a query. We discuss of relaxing them. The following theorem establishes in this document Theorem 8. Let L be a library of model fragments describing a domain, and C be a set of modeling constraints. Let (v, Einput, Cinpur, Init) be a query about a system. Let S be the scenario model resulting from algorithm select-scenario-model. Furthermore, assume that: Tl T2 T3 T4 L satis$es the library coherence and completeness assumptions; If ci and cj are two CMFS in an assumption class in L such that ci < cj, then ci is a causal approximation of Cj; All modeling constraints in C are either ground atomic formulas or Horn rules; The most complicated scenario model, dejined to be all the possible instantiations of CMFs that are the most complicated in their assumption class, is adequate for answering the query; 22 and T5 Al! assumption classes in L are linear. Then, S is an adequate scenario model for (v, E+ut, Ci”put,Znit), and there is no scenario model S1 such that SI is simpler than S. The complete proof, given in the Appendix, It then shows that the output of the algorithm simplicity given in Definitions 6 and 7. shows first that the algorithm satisfies terminates. the conditions of adequacy and We can also show that S is built in time that is polynomial theorem: as stated in the following in the size of the problem, ** Note fragments, time invariant that the most complicated scenario model needs the objects satisfy to include only the type conditions the valid instantiations of model in the model fragment and the i.e., instantiations in which facts in the description of the system. 386 A.1 Levy et al. /Artificial Intelligence 96 (1997) 351-394 Theorem 9. Let d be the maximum number of CMFs in an assumption class, and let n be the number of instantiated assumption classes in S. Let 1 be the sum of the size of C and the number of ground atoms that appear of CMFs in S. The running in the instantiated modeling conditions in n, d and 1. S is polynomial time ofjnding are Horn, computing the modeling assumptions constraints is done in time polynomial select-from-assumption-class. is at most nd. This can be seen by observing the logical closure of the Proof. Since in 1. This is done every time we set of modeling this procedure call the procedure that every call to select-from- is called assumption-class may, at worst, replace a CMF by another one that is more complicated than it. Since assumption class, algorithm in S and at most d CMFs per time of the this can only be done nd times. Consequently, The number of times there are n instantiated in n, d and 1. 0 is polynomial the overall running classes 5.1. Relaxing the assumptions In this section, we discuss the effect of relaxing some of the assumptions made in Theorem 8. 5. I. I. The library coherence assumption is the library coherence assumption. The most significant assumption the assumption may seem too strong, that we made If there is a set of model there is a compelling Although Specifically, library. give rise to an over-constrained library coherence assumption Process Theory coherence assumption the assumption for it. if the assumption does not hold, there is a problem with the model fragment constraints but feature of the It should be noted that the library (as in Qualitative then the library and assumption in [ 71. In fact, if we assume causally oriented, are uniquely follows when we make the causal approximations scenario model is adequate. is made implicitly [ 81) that all equations the modeling that is an undesirable that calls for additional knowledge acquisition. set of equations, that satisfy fragments argument We can relax that the most complicated the library coherence assumption at the cost of doing more work at every state of the simulation. Specifically, the scenario model created by our algorithm at every state from which a complete model can be extracted equations). We can extract by Nayak in the absence of the coherence assumption, to produce a set of equations some the methods described the complete model efficiently using (perhaps by removing is guaranteed in [ 241. 5.1.2. Causal approximations and Horn restriction The only role of the causal approximations assumption and the restriction is to guarantee efficient performance assumption guarantees that the of the model that when we constraints must be Horn algorithm. The causal approximations modeling formulation select a more complicated CMF in the set of simplifying modeling are added to Rel). The Horn restriction guarantees put in Rel that it will not be retracted. Relaxing in an assumption assumptions decreases class that the number of elements literals (i.e., more positive literal has been either of these two assumptions will that once a positive AX Levy et al./ArQicial Inrelligence 96 (1997) 351-394 381 to perform arbitrary backtracking the algorithm in [24], require this will cause shown the assumption that all assumption model can be found in polynomial as described, will still work in polynomial It is possible will not run in polynomial the algorithm to modify time. the model selection problem and constraint satisfaction. As to be intractable. Finally, that a simplest scenario classes are linear guarantees time. If the assumption does not hold, the algorithm, time but may not produce a simplest model. it such that it finds a simplest model, but then 6. Related work Several researchers have considered the problem of model addresses one or both of the two aspects of the model model construction and model simplification. formulation. Their work problem, namely formulation Nayak [23] addressed both aspects. Nayak describes an algorithm for constructing a influences must be given explicitly for the single state case. His algorithm these In contrast, our work exploits model however, heuristic. these links, It should be noted, however, further focusing of the search by inserting only a subset of the links. the structure of the model fragments the user with the error prone task of putting interaction to derive them in. as in Nayak’s scheme, can enable a also follows possible causal the component thereby not burdening that user intervention, influences; using the choice to simplify if necessary. from every assumption In choosing a model fragment the model by selecting one, and then uses a procedure complicated gorithm builds only adjusts vary significantly search, since we only introduce phasized on the stack and will therefore that Nayak’s methods generated at every state from our scenario model. result for model simplification in their complexity, class, Nayak chooses In cases where the CMFs the simplest CMF possible the most the resulting model. Our al- in every class and class in the It should be em- that will be put in a much larger scenario model. Finally, we note to the simulation model in an assumption savings that the more complicated CMFs will involve more quantities our approach the complicated models can be applied to substantial if necessary. leads the rep- (specifically Falkenhainer every model to our modeling In their framework, their Consider predicate) aspects of compositional modeling and Forbus’ work on compositional modeling and addresses conditions. Our use of relevance claims enriches and provides formulation the lowest object down the partonomic hierarchy resentation problem. corresponding language In their model (by identifying objects mentioned They rely on heuristics easily lead to inclusion and it cannot guarantee more flexibility selection of the relevant properties are done in a uniform way, (by reasoning modeling [7] describes the model construction fragment has a set of relevance conditions their it with a formal basis. scope of the model that subsumes all the in the query) and then select the relevant properties of these objects. to be modeled. This approach can to select types of properties of model to the query, related that are not causally the sufficiency of the model produced. Our algorithm provides in that the selection of the physical scope of the scenario model and the about the and can therefore affect each other. Furthermore, we only select they first select the physical constraints) algorithm, fragments 388 A.Z Levy et al./Art@cial Intelligence 96 (1997) 351-394 to model that can casually they generate all possible consistent properties sets of modeling model, the simplest, where simplicity is measured based on the number of objects each model and also on the ordering among choices within each assumption to select the simplest and choose included in class. the query. Finally, assumptions influence While our model formulation the assumptions In particular, Falkenhainer algorithm may be more efficient than that of Falken- listed in Section 5, their approach and Forbus do class has a unique simplest and a unique most complex the difference class, which is likely library much easier for their in practice because one needs to in an assumption formally assumptions among alternatives task of constructing that each assumption than ours in some respects. hainer and Forbus’, especially under is more general not require CMF, which we do. They also do not require one to represent in the modeling to make the actual approach. This last point construct a large library of model fragments if the compositional modeling paradigm large model fragment experts. We have started an effort construction whether an explicit be reliably constructed is an important consideration as well as use of a model library would certainly towards providing a model fragment library require collaboration fragment representation and maintained [ 131. It remains fragment Rickel and Porter’s work on model the type of organization we proposed here for a model to be seen library with each model fragment can environment. is similar to ours since to select relevant model it makes use of graphs of interaction fragments. Their approach also provides guarantees of simplicity and adequacy. However, their graph of interactions influence graph created by our algorithm, includes variables, while we include all terms and predicates it only that could directly or indirectly of modeling assumptions underlying in such a collaborative [27,28] paths among quantities the goal terms. than the causal is less general formulation influence since among many domain for collaborative is to be a viable option. The construction of a that can be used in a variety of situations an environment is similar representing The idea of explicitly class the problem of selecting complete models exponentially can be viewed as combining The model simplification as the number of possible modeling assumptions instead of fragments, the differences between CMFs among complete models. Since the space requirement of their approach in an assumption to the graph of models by Addanki et al. [ 11. Their work addresses in their graph are increases increases. Our approach the idea of a graph of models with compositional modeling. [33] and Weld problem has been addressed by Williams a model. Both as an input. Williams in his work on innovative assume a complete model of the situation also makes use of causal influence graphs [ 321. Williams Weld and Williams also makes use of the idea of following design the models to simplify influences causal [ 341. 7. Discussion This document describes a method that is appropriate nario model general framework lem can significantly for relevance benefit for selecting model fragments to generate a sce- for answering is based on a a given query. The method reasoning, and we have argued that the modeling prob- from the perspective of relevance from being considered A.E Levy et al./Artifcial Intelligence 96 (1997) 351-394 389 influences for modeling and articulating using general considerations reasoning. Specifically, we have shown be approached chaining on causal tion classes. Moreover, we have shown how to incorporate heuristics to declaratively to inspect heuristics which efliciently of our algorithm knowing precisely what states the system can reach. that some aspects of the modeling problem can of relevance reasoning, namely, backward the differences between CMFs in assump- and reasoning. The ability fashion, using relevance express modeling heuristics has important advantages. Since it is easier experimenting with different modeling algorithm selects a simplest model for a system and a query. An important aspect of the system without is that it chooses a model and modify declarative becomes viable. Our approach offers a novel model for a simulation in a declarative formulation knowledge, engineering knowledge (DME) environment The algorithm has been implemented [ 141, which provides a computational as part of a system called the Device Modeling for designing Environment electromechanical devices. Given a topological description of a device, DME formulates a behavior model of the device using the compositional modeling approach and simulates its behavior. Prior to implementing our algorithm, to be considered select a zset of model a significant of every model each stam. The system has been document. the operating the simulation model for those used in this the system would prompt in the scenario model, bottleneck. DME checks to determine acquisition in the scenario model the user to thus creating conditions tested on many examples, knowledge fragments including fragment Research on compositional modeling by crystallizing is in its infancy. The discussion some of the main questions regarding in this document that the approach in a library, and research. The key issues that came to bear in this work are: (i.e., how to decide what phenomena fragments to write model in a single model fragment, and what assumptions can be to make regarding described the contents of a model fragment), (2) How to organize model fragments (3) What assumptions We have contributed model fragments CMFs in an assumption questions ( 1) and (3). model and by requiring in polynomial ( 1) The model-fragment library consisting of all the possible in their assumption can be made about the model fragment library. to solving problem (2) by suggesting of the differences representation class. In our discussion, we made several assumptions in order for our algorithm In particular, the concept of composite between regarding to produce a simplest explicit time, we made the following assumptions: is complete instantiations and coherent, and the scenario model of CMFs that are the most complicated class is adequate for answering the query. (2) The assumption classes are linear, and the simpler CMFs are causal approxima- tions of the more complicated CMFs. contributes require additional (1) How in the consequences clause of a model fragment. are specified using only Horn rules. (3) There are no disjunctions (4) Other modeling In general, we see a tradeoff between then constraints fragments, irrdividual model library as a whole, and vice versa. Finding about model possibilities ( 1) and (3). fewer constraints If more assumptions are made to be placed on the the optimal point in the spectrum of systems. We need requires additional research and practical experience building 390 A.Z Levy et al. /Artificial Intelligence 96 (1997) 351-394 believe beneficial that imposing some structure on the model fragment is necessary and in the long run to facilitate knowledge acquisition library and reuse. The problem of model formulation in which a system needs to reason about its own knowledge before answering setting query. In doing so, it must choose among alternative make different currently under [ 191. We believe distributed heterogeneous this work can form the basis for reasoning mechanisms tasks. can be viewed as one instance of a problem solving a that and abstractions. Other instances of this problem are also in in solving such as reasoning with contexts and query evaluation that the techniques developed assumptions investigation, in these other problem of the domain representations databases Finally. the most serious weakness of our approach, apparatus classes as graphs of CMFs and links with explicit representations task to construct actually a detailed “most faithful” one in some way, the practical point of in in this article, from introduced classes. Since alternative model fragments about a phenomenon It is unarguably a very arduous or abstracting assumptions. view, is that it requires all the representational particular assumption of underlying modeling such assumption result gaining a better understanding techniques to be able to semi-automate most detailed model fragment from approximating the task of constructing for each phenomenon. and abstraction is one of our current goals. With such an understanding, we hope some day class from the of the nature of different approximation a whole assumption Acknowledgement The authors would like to thank Jeff Rickel and Pandu Nayak for helpful discussions formulation the problem of model reviewers of this article for their help in shaping in general. We also thank the on this article and for detailed comments, which were very valuable anonymous in improving the quality of the final version. We would also like to thank the past and the current members of the How Things Work project at Stanford’s Knowledge Systems Laboratory of DME. Pandu Nayak provided example. Patrice Gautier constructed system example. Diane Chi constructed used for this article. This research was sponsored Research Projects Agency NASA grants NAG 2-581 and NCC 2-537. It was also supported the National and Optimization strip the original knowledge base for the reaction control the much enhanced version of the RCS example in part by the Defense Advanced and by NASA Ames Research Center, under in part by DARPA and program, under cooperative agreement 70NANB6H0075. and Technology, Rapid Development, Exploration the ideas in this paper and in the implementation the original knowledge base for the bimetalic for Standards (DARPA) (RaDEO) Institute Appendix A. Proof of Theorem 8 Proof of termination. First, we note the algorithm (i.e., the while loop in select-scenario-model) must terminate. This is because we can always adjust a choice of a CMF to a more complicated CMF that does not contradict that because of assumption T4, A.E Levy et al./Art@cial Intelligence 96 (1997) 351-394 391 in Rel. Ultimately, we will end up with the most complicated scenario the assumptions model, which is guaranteed, by T4, to be adequate. Proof of adequacy. Let L be the logical model which satisfies Rel and the negation of positive C A Init because Init C_ Rel and Rel U C is closed under deduction. literals not appearing in the positive in Rel. L is a logical model of literals Proof of the condition Dl of adequacy: Condition D1.l (1) For every CMF c E S, Pos(As,) C Rel. is satisfied because the following holds in the algorithm: We always add to Rel Pos(As,) choice of c is later adjusted causal approximations assumption, T2). of any CMF c that is added to S (and to c’, then Pos(As,l) > Pos(As,) if the because of the (2) Whenever some simplifying assumption of a CMF c is not satisfied in Rel (i.e., -up E As, but p E Rel), we adjust the choice of c. in c are satisfied Because of ( 1 ), all the positive literals of c are satisfied negative literals in L. in L. Because of (2)) all the Condition D1.2 is satisfied by L because whenever Rel(qr ) E Rel, where q1 is a quantity, then either: a q1 c: E, or l ql was put on the queue, and some assumption quently added to S. class that can affect q1 was subse- in both cases, S will contain a CMF that includes 41. Therefore, Proof of the condition D2 of adequacy: In building q. The operating must be in S,, since otherwise, Therefore S, includes that the :set of equations conditions the scenario model, we considered all the assumption classes that can affect classes in the state. the quantity q. The library coherence assumption Tl guarantees of a CMF from at least one of these assumption there would be no model for the system in S,, which we denote by Eqs, is not over-constrained. If Eq, the library completeness is not over-constrained, Eq, can be made self-contained to be exogenous self-contained some other quantities such quantity. Therefore, x $ E+,, U EglObal and q causally depends on x. that in the set Einput U E&,bal that Eq, can only be made in Eq, to be exogenous. Let x be one it cannot. This means in Eq,. Suppose some quantities by assuming by choosing assumption guarantees However, this contradicts the fact that we included all the assumption classes fore, all the equations) library is complete. that can affect q in any situation and the assumption (there- that the In this proof, it is important that we have only partial Proof of simplicity. knowledge about the possible states that the system may reach. Specifically, all we know is that the time independent facts given in the system description must hold and that the value of binary quantities given in Einpur cannot change. to remember In the proof, we assume that S was constructed by adding tion class ai at the ith iteration of select-from-assumption-class. ci’s may have been removed subsequently the same assumption class. We prove the following by induction on i: the CMFs ci from assump- Note that some of the by choosing a more complicated CMF from 392 A.E Levy et al./Artificial Intelligence 96 (1997) 351-394 Al There must be a CMF in S from the assumption A2 The CMF ci is the simplest CMF that can be chosen from ai, with respect A3 For each quantity q1 on the queue, we must include all the phenomena affect q1 and can occur in one of the possible states of the system. class ai. to C. that can Conditions Al and A3 guarantee that all the phenomena modeled that all these phenomena are modeled to the modeling constraints, C. The simplicity in S are necessary, in the simplest way possible these of S follows from A2 guarantees with respect claims. The base case includes all the assumption classes that can affect the query quantity the simplest CMFs is satisfied because we need an assumption class that can determine q, states that were chosen were those the assumption that are consistent with the possible classes are linear and select-from-assumption- q. Clearly, Al and the ones of the system. Since class selects condition A2 is satisfied. Condition A3 is satisfied because q in the same equation, any phenomenon appears in the operating conditions of a CMF that can determine q and is not exogenous, then any phenomenon that do not contradict Rel, if a quantity q1 appears with then if q1 influence q. If q1 is not exogenous, in the model. Similarly, that can influence q1 must be included then q1 can causally in these assumption classes in the model. i + 1. The CMF ci+i could loop (i.e., adding a new in two ways. In the first, we use the outer the claims class when popping a quantity We assume have been added assumption we must include all the phenomena Therefore, adding CMF from ai+t and A3 are satisfied because select-from-assumption-class that satisfies queue. from the queue). By the inductive assumption, that can affect the quantity on the top of the queue. is satisfied. As before, A2 is necessary, and so Al selects the simplest CMF c to the the assumptions made so far and adds only the necessary quantities that can affect q1 must be included them for for i, and we prove loop (i.e., by adjusting The second possibility for adding ci+r class). the minimal that can be included those that are entailed by C and previous modeling previous choice from an assumption ai+i was justified by a previous CMF added to S. Since Rel include only are therefore ui+i the quantities the same argument as before. Moreover, any quantity not have to be removed, because approximation will be possible is by the inner a In this case, the inclusion of a CMF from in they and since ci+r is the simplest CMF from satisfied.23 Finally, is put in S are necessary using that is already on the queue does a CMF cj that is a causal through cj set of assumptions, in the scenario model, A2 is therefore that were put on the queue when ci+i of ci+r, and therefore, any causal the CMF ci+r is replacing that was possible through ci+i. the modeling assumptions, assumptions influence 0 References [l] S. Addanki, R. Cremonini and J. Penberthy, Reasoning about assumptions in graphs of models, in: Proceedings IJCAI-89, Detroit, MI (Morgan Kaufmann, Los Altos, CA, 1989) 443-446. 23 Note that if ci+l was put in S instead of Cj for j < i + 1, then Cj was removed from S. A.Z Levy et al. /Art#cial Intelligence 96 (1997) 351-394 393 121 D. Bobrow, B. Falkenhainer, A. Farquhar, R. Fikes, K. Forbus, T. Gruber, Y. Iwasaki and B. Kuipers, A in: Qualitative Reasoning, Proceedings 10th International Workshop compositional modeling (AA,41 Press, Menlo Park, CA, 1996) 12-21; also: AAAI Tech. Rept. WS-96-01. language, [3] D. Bobrow, B. Falkenhainer, A. Farquhar, R. Fikes, K. Forbus, T. Gruber, Y. Iwasaki and B. Kuipers, Systems Laboratory, language, Tech. Rept. KSL94-16, Cml: a compositional modeling Department of Computer Science, Stanford University, Stanford, CA ( 1994). Knowledge [4] R. Carnap, Logical Foundations of Probability [ 51 J. Crawford, A. Farquhar and B. Kuipers, A compiler equations, into qualitative differential in: Proceedings AAAI-90, Boston, MA (Morgan Kaufmann, Los Altos, CA, 1990) 365-372. from physical models (University of Chicago Press, Chicago, IL, 1950). [ 61 M.M. Denn, Process Modeling (Pitman, Marshfield, MA, 1986). 171 B. Falkenhainer and K.D. Forbus, Compositional modeling: finding the right model for the job, Artificial Intelligence 51 (1991) 95-143. 181 K.D. Forbus, Qualitative process [9] P. Giirdenfors, On the logic of relevance, Synrhese 37 ( 1978) 351-367. [ 101 M.R. Genesereth and R.E. Fikes, Knowledge interchange theory, Art$cial Infelligence 24 ( 1984) 178-219. format, version 3.0 reference manual, Tech. Rept., Logic-92-1, Logic Group, Stanford University, Stanford, CA ( 1992). [ 111 Y. Iwasaki and C.M. Low, Model generation and simulation of device behavior with continuous and discrete change, intelligent Systems Engineering 1 (2) ( 1993) 115-145. [ 121 Y. Iwasaki and H.A. Simon, Causality [ 131 Y. Iwasaki, A. Farquhar, R. Fikes and J. Rice, A web-based compositional modeling in device behavior, Artificial Intelligence 29 ( 1986) 3-32. system for sharing (Morgan Kaufmann, San Francisco, of phhysical knowledge, CA, 1997). in: Proceedings IJCAI-97, Nagoya, Japan [ 141 Y. Iwasaki and CM. Low, Device modeling environment: an integrated model-formulation and simulation environment Engineering for continuous (The Institution of Electrical Engineers, London, UK, 1992) 141-146. and discrete phenomena, in: Proceedings Conference on Intelligent Systems [ 151 J.M. Keynes, A Treatise on Probability (Macmillan, London, 1921). [ 16 j A.Y. Levy, Irrelevance reasoning in knowledge base systems, Ph.D. Thesis, Stanford University, Stanford, CA (1993). [ 171 A.Y. Levy, Creating abstractions using relevance reasoning, in: Proceedings AAAI-94, Seattle, WA (AA.41 Press/MIT Press, Menlo Park, CA, 1994) 588-594. [ 181 A.Y. Levy, R.E. Fikes and S. Sagiv, Speeding up inferences using relevance reasoning: a formalism and algorithms, Arti$cial Intelligence 97 ( 1997) 83-136. [ 191 A.Y. Levy, A. Rajaraman and J.J. Ordille, Query answering algorithms for information agents, in: Proceedings AAAI-96, Portland, OR (AAAI Press/MIT Press, Menlo Park, CA, 1996) 40-47. [20] A.Y. Levy and Y. Sagiv, Constraints in: Proceedings 11th ACM SIGACT- SIGMOD-SIGART Symposium on Principles of Database Systems, San Diego, CA (ACM, New York, NY, 1992) 67-80. and redundancy in datalog, [ 2 11 A.Y. Levy and Y. Sagiv, Exploiting IJCAI-93, Chambery, France irrelevance reasoning to guide problem solving, in: Proceedings (Morgan Kaufmann, San Mateo, CA, 1993) 138-144. 1221 D. Macaulay, The Way Things Work (Houghton Mifflin, Boston, MA, 1988). [ 231 PP. Nayak, Automated model selection, Ph.D. Thesis, Stanford University, Stanford, CA ( 1992). 1241 PP. Nayak, Causal approximations, Art&ial Intelligence 70 (1994) 277-334. [25] P.P. Nayak and L. Joskowicz, Efficient compositional modeling for generating causal explanations, Art@iul Intelligence 83 (1996) 193-227. [26] J. Rickel and B. Porter, Automated modeling for answering prediction questions: Exploiting interaction in: Proceedings 6th International Workshop on Qualitative Reasoning about Physical Systems, paths, Edinburgh, Scotland (1992) 82-95. [27] J. Rickel and B. Porter, Automated modeling the time scale in: Proceedings AAAI-94, Seattle, WA ( AAAI Press/MIT Press, Menlo Park, CA, for answering prediction questions: Selecting and system boundary, 1994) 1191-l 198. 1281 J. Rickel and B. Porter, Automated modeling of complex systems for answering prediction questions, Art@ial Intelligence 93 ( 1997) 201-260. [29] H.A. Simon and N. Rescher, Cause and counterfactual, Philos. Sci. 33 ( 1966) 323-340. 394 A.I: Levy et al./Art$cial Intelligence 96 (1997) 351-394 [ 301 D. Subramanian and M.R. Genesereth, The relevance of irrelevance, in: Proceedings IJCAI-87, Milan, Italy (Morgan Kaufmann, Los Altos, CA, 1987) 416-422. [ 3 1 ] D. Subramanian, A theory of justified reformulations, Ph.D. Thesis, Stanford University, Stanford, CA (1989). [32] D.S. Weld, Approximation reformulation, in: Proceedings AAAI-90, Boston, MA (AAAI Press/MIT Press, Menlo Park, CA, 1990) 407-412. [ 331 B.C. Williams, Capturing how things work: constructing critical abstractions of local interactions, in: ( 1990) 163-174. [ 341 B.C. Williams, Interaction-based invention: designing novel devices from first principles, in: Proceedings Proceedings Workshop on Automatic Generation of Approximations and Abstractions AAAI-90, Boston, MA (AAAI Press/MIT Press, Menlo Park, CA, 1990) 349-356. 