Artificial Intelligence 78 ( 1995) 45-86 Artificial Intelligence 3-D motion estimation from motion field* Naresh C. Gupta a,b, Laveen N. Kanal ayb a Department of Computer Science, University of Maryland, College Park, MD, USA b L.N.K. Corporation, Inc., Riverdale. MD, USA Received October 1993; revised January 1995 Abstract Several experiments suggest that the first stage of motion perception is the measurement of visual motion. The result of this stage is called the motionJield, which assigns a velocity vector to each point in the image plane. The second stage involves interpreting the motion field in terms of objects and motion in the three-dimensional world. Recovering 3-D motion of the object from the motion field has been difficult owing to the nonlinear system of equations involved, and the sensitivity of the system to noise. The need for the stability of the system is essential as only the optical flow field can be recovered from a sequence of images, which is at best a crude approximation to the motion field. We define two sets of “basic” parameters, which can be recovered from the motion field by solving a linear system of equations. The relationship between the basic parameters and the motion parameter being one-to-one and linear, we obtain a closed form solution for the 3- D motion parameter by solving a system of linear equations only. We prove the correctness, completeness and robustness of the approach and in that sense the problem of recovering the motion parameter from the motion field may be said to be “solved”. We present the results of extensive experimentation with real and simulated image sequences. 1. Introduction two-dimensional image provides only (3-D) world, as the 3-D information A single dimensional the image formation. However, recover the lost 3-D information is provided by the relative motion of elements the three- is lost during there are several cues in the images which enable us to to a certain extent. A valuable source of 3-D information (Z-D) (depth and motion) in the changing 2-D image. Several information about * Supported by NSF Research Grant # IRI 8802419 and in part by LNK Corporation. 0004-3702/95/$09.50 @ 1995 Elsevier Science B.V. All rights reserved SSDIOOO4-3702(95)00031-3 46 N.C. Gupu. L.N. KanaUArtificial Intelligence 78 (1995) 45-86 the remarkable have demonstrated experiments reliably extract 3-D structure and motion other cue. A particularly present observers with apparent motion sequences of a random dot surface undergoing motion to in the absence of any is to compelling method of demonstrating ability of the human visual system from an image sequence this phenomenon in space. There are several experiments which indicate is the measurement which assigns a velocity vector the motion involves dimensional world. In this paper we present a solution sequence parameter of a rigid object undergoing that the first stage of motion perception of visual motion. The result of this stage is called the motion field, in the image plane. The second stage in the three- for the second stage of the image the 3-D motion problem. We present an algorithm in terms of objects and surfaces to each point field a general motion. interpretation interpreting to recover interpretation Image sequence In Section 3, we discuss the reasons and underline has been an active area of research for the last two to recover 3-D motion from a sequence in Section 2. Though image the associated difficulties In Section 4 we define two sets of parameters which can be recovered field via solving a linear system of equations; we also show that the decades. Several algorithms have been proposed of images. We present a brief overview of the previous efforts many algorithms have been proposed, none works well for the noisy, real-world sequences. with the problem. from the motion 3-D motion parameter sections we look at the correctness, relationship. robustness of the approach and in that sense these sections represent difference between solution using nonlocal details of our extensive experimentation. of this work are presented the theorem. We then present and the relevance this work and previous efforts. In the next section we stabilize to these basic parameters via a linear and one-to-one and the most significant Some general observations and Green’s divergence In the subsequent in the concluding completeness constraints is related section. 2. Literature review Gibson hypothesized [4-61 recover a unique, physically then numerous information. These algorithms algorithms have been proposed can be grouped correct that there is sufficient interpretation information in the flow field to of 3-D motion and structure. Since field for the 3-D to interpret into six main categories. the motion 2.1. Closed form solution from flow jields Koenderink and van Doorn [ 191 proposed an algorithm properties of motion and surface shape by using the local deformations (e.g., divergence, built on their work and obtained a closed form solution flow derivatives. A serious problem with these approaches the flow field. curl, shear). Longuet-Higgins and Prazdny to measure the invariant in the flow field [ 381 [24] and Waxman for the flow field in terms of to noise in is their sensitivity N.C. Gupta, L.N. KanaUArtijicial Intelligence 78 (1995) 45-i-86 47 2.2. Least squares methods a global approach Bruss and Horn 121 proposed in the entire visual field to choose the 3-D motion and structure that fits the flow field best in the least squares sense. The cases when there is only translation or only rotation are simple and stable closed form solutions iterative techniques were used for the translational parameter. Adiv In the case of a general motion, system of equations to solve a nonlinear that combines are derived. information the same residual [ l] minimizes way. The flow field is divided for each patch under direction, each patch. Patches having similar motion are merged. an error measure the assumption is computed, into patches and motion parameters function as Horn and Bruss, but in a different are then estimated of planarity. For each patch and each translation from which a best translation is selected for Other researchers have also proposed function over a discretely residual the focus of expansion of a translating field is decomposed which the velocity rotational motion flow field. is hypothesized techniques that pick solutions by minimizing sampled solution space. Lawton camera. Prazdny into rotational and translational is estimated and the best translation [ 311 proposed an approach a [ 211 used it to obtain in components. The for the remaining Heegar and Jepson [ 121 minimize the same residual depth and the rotation parameters function of the translation. The error function for a large number of patches translation direction which is selected from which a translation for most patches are eliminated function as Horn and Bruss. The to arrive at a measure of error as a is evaluated for each candidate translation is selected is chosen for each patch. The to be the translation. 2.3. Subdividing the problem Several researchers have proposed splitting the problem of structure and motion esti- into several subproblems. The idea is to eliminate one set of motion parameters only mation and get a constraint value of that set of parameters, which proposed of smooth only. first for the rotational solving in rotation or translation. Solving is then used to estimate component of motion. Under that constraint gives the other. Prazdny the [ 3 1 ] the assumption in terms of rotation surfaces, he derived a system of nonlinear equations Helmholz image point, same expansion. Reiger and Lawton focus of expansion is the noise sensitivity the difference pointed out that if two points at different depths are projected onto the the focus of the from local flow-vector differences. The problem with this approach in the image velocities points [ 321 proposed an approximate to estimate algorithm towards in computing the flow difference. 2.4. Direct methods Negahdaripour and Horn 3-D motion parameters. They substituted to get a constraint constraint, [29] proposed several direct methods field equations in terms of 3-D parameters and image the motion the for recovering in the optical flow intensity gradients. 48 N.C. Gupta, L.N. Kanal/Artijicial Intelligence 78 (199.5) 45-M to avoid Several algorithms were proposed being Hanna directly [lo] from the image proposed an iterative algorithm intensity. the computation of the optical the motivation for special cases of object motion; has proved flow-which to be difficult. the motion of the camera that estimates 2.5. Long sequence Several algorithms have been proposed which use a sequence of flow fields to estimate [27] used a precise dynamical model for the motion parameters. Matthies and Kanade temporal changes of their approach motion may only be translation Kalman and parallel filter per pixel to recover a dense depth map. in depth to recover structure from a sequence of images. The limitation is the need to know the camera motion as well as the restriction to the image plane. Heel that [ 131 used one 2.6. Linear methods Tsai and Huang [35] proposed are recovered are determined a linear algorithm of eight “pure parameters” motion and structure parameters a sixth order polynomial. general curved object eight feature point correspondence. Motion parameters are then recovered by taking SVD of the essential parameter matrix E. The E-matrix and efficient. But they are highly sensitive coordinates. One of the reasons for this is that the linear constraint than the rigid body motion constraint. for a planar patch. First, a set by solving a set of linear equations. The from these “pure parameters” by solving for a from the are quite simple of image they utilize is weaker later [22,36] in motion. The “essential” parameters were first recovered linear algorithms were proposed to noise, especially to perturbations algorithms Several Jepson and Heegar [ 171 proposed an elegant solution to estimate the problem is obtained by eliminating ter by decomposing parameter sembles be estimated improves on their effort. Sundareswaran pute the motion linear. the current work. Once easily. We discuss from the motion into three steps. The linear constraint the rotational component the translation their approach is known, in detail re- locally and closely rotation and depth map can later and show how our work to com- [ 341 proposed an approximate method field. A constraint is obtained which is approximately the motion parame- for the translation 3. Interpreting the motion field In this section we introduce the problem of motion field interpretation. We present the set of equations which relate the motion We discuss the difficulties brief overview of our solution methodology. field to the 3-D motion and shape information. associated with interpreting the motion field and present a For an observer moving with the translational velocity velocity w = (A, B, C) with respect by [Is]: to the surface, t = (tr , t2, t3) and rotational field is given the image motion N.C. Gupta, L.N. Kanal/Art@cial Intelligence 78 (1995) 45-86 u(x,y) = C-t] +xtg)h(x,y) +Axy-B(x*+ 1) +Cy, u(X,Y) = (-t2 + ytg)h(x,y) + A(y2 + 1) _ Bxy _ Cx, where h is the inverse depth map l/Z. The problem of understanding the motion field can be stated as follows: 49 (1) Given the motion jeld tureofthescene (u( x, y ) , u( x, y ) > over the image plane R, find the struc- h(x,y),andthescaled3-Dmotion (tl,t2,tg,A,B,C). For an image represented discretely at n points in space, there are n + 5 unknowns: depth at n points and 5 motion parameters (it is easy to see why we can recover the translation up to a scalar constant only) and 2n motion field constraints. The problem is thus sufficiently constrained and can be solved easily, in theory. However, in practice, it turns out to be an extremely difficult problem due to the following two reasons: 0 nonlinearity, 0 noise sensitivity. 3.1. Nonlinearity The task of understanding the motion field for 3-D motion is difficult because the relationship between the motion field, 3-D motion and depth turns out to be nonlinear. As we mentioned earlier, the problem is sufficiently constrained, and can be solved easily given a technique to solve a system of nonlinear equations. Unfortunately, nonlinear equations of the form ( 1) and (2) are rather difficult to solve and none of the approaches guarantees a solution. A solution may be obtained for a very constrained situation of scene geometry and motion, but we have to resort to iterative techniques for the general case. These iterative techniques require enormous computations, do not converge, and are extremely difficult to analyze for stability and performance. Nonlinearity is difficult to handle; for any hope of solving the problem in a realistic sense, nonlinearity must be avoided, i.e., the nonlinear constraints must be reduced in some way to yield a linear relationship among various variables. 3.2. Noise sensitivity The second major problem with interpreting the motion field is the sensitivity of the motion parameter to the noise in the flow field. The problem is compounded by the fact that the motion field is only an abstract concept and cannot be recovered from a sequence of images. What is recoverable from a sequence of images is the normal flow; and even that is corrupted by noise due to discretization and numerical derivative computation. Optical flow, an approximation of the motion field, has to be recovered from the sequence of images by making additional assumptions about the local structure of the underlying object. What we have at best, is a very crude approximation of the motion field. It is evident from this that if we hope to obtain a system to interpret an image sequence for shape and motion, the algorithm for recovering shape and motion from the motion field should be extremely robust and must tolerate large amounts of noise. SO N.C. Guptcr. L.N. Kanal/ArtiJicid Intelligence 7X (199.5) 45-86 the abundance of information [7], We have argued elsewhere by using believe the inability of the algorithms the constraints. available that the stability of vision algorithms can be achieved in space and time in a useful way. We in computer vision is due to to stabilize spatio-temporal to invoke significant support that the reason noise has come to be such a nemesis information Several algorithms to solve such a difficult problem that in this noise corrupted world, try to recover the shape and motion by looking at the local structure there is not enough are that is try to estimate to recover in a reliable locally. The local constraints in the flow field which are almost the local constraints field interpretation, local information i.e., they try to do too much with the unreliable of the flow field. We reiterate reliable “overworked”, available. the local variations way. An important question arises: In the case of motion impossible Why do we have to .solve the problem waste? locally and let so much information go to In the next several sections we present an algorithm problems. The proposed approach solves a system of linear equations only and uses all the available the key issues again: in space so as to yield a stable system. We emphasize the above-mentioned to overcome information l We cannot handle more than linear constraints reliably. Linear constraints have to be obtained for any chance of success. l Stability of the system has to be a prime criterion and the information available in space suggests a way to achieve that. 4. Recovering motion parameters In this section we present an algorithm the motion parameter two sets of basic parameters which can be recovered motion motion and the rotation vector can be recovered field. We define field by solving a linear system of equations. We show that a unique from either set of basic parameters. to recover from the from the translation 4.1. Basic parameters Eliminating depth from the motion field equations (1) and (2) we get: u(x,y) -Axy+Bx’+B-Cy _ xt3 - t1 v(x,y) - Ay2 - A + Bxy + Cx yty - t2 ’ which after some algebra yields ( Bt2 + 0s)~’ + (At, + Ct3)y2 - (At? + Btl )xy - (At3 + Ctj)x _ tlv(x,?,) + f2U(X,?,) - (Br3 + Ct2)y + (At, + Bt2) + t3(xu(x.y) - yu(x.y)) = 0 (3) for all (x, .y) in the image plane. Note that if (tl, t2, t3) is a solution equation, then (ktl , kt2, kt3) is also a solution for any nonzero k and hence for the above the scale N.C. Gupta, L.N. KanaUArtificial Intelligence 78 (1995) 45-86 51 is, we can recover ambiguity. That note that we cannot estimate However, yield positive depth from the motion the above equation We can rewrite the direction ambiguity translation if the motion can be resolved field equations (3) as: (ti, t2, t3), such that ItI is unity. Also, is towards or away from the image plane. as only one of the directions will ( 1) and (2). ax* + by2 - cxy - dx - ey + f - tlo(x,y) + tzu(x,y) + t3w(x,y) E 0 (4) where a=Btz+Ctg, d = Atj + Ctl, b=Atl +Cts, e = Bt3 +Ct:!, c = At2 + Bt,, f =Atl +Btp, W(X,Y) = xdx,y) - YU(X,Y>. The key observation is that given t and any three of (a, 6, c, d, e, f), the motion that if parameter can be recovered by solving a system of linear equations. t and any three of (a, b, c, d, e, f), a linear constraint for recovering the motion parameter can be recovered by solving a linear system of equations only. A is thus possible, depending on which three of the coefficients family of algorithms are chosen. We describe two of them in detail. Several other combinations were also tried but failed to yield a stable system. can be obtained It transpires Note that if t is given along with four or more of the coefficients, no motion parameter the given coefficients were obtained with additional constraints. may be obtainable unless That leads us to the reason why the linear equation the coefficients parameter additional difficult the translation. The resulting unless we impose and as a solution constraints to be nonlinear turn out to solve. (4) cannot be solved by itself for solution may not have any motion three the system constraints. These in form and hence make three additional We define BI = (a,c,d,tl,h, t3), G=(b,c,e,t1,t2,t3) (5) (6) to be the two sets of basic parameters. We show below how the motion parameter can be uniquely determined from either basic parameter set. 4.2. Motion from basic parameters In this section we show that the translation recovered the translation from either Z?r or &. Translation is known, rotation can be expressed can be determined directly and the rotation vector can be uniquely from 23,. Once in terms of Bi = (a, c, d, tl , t2, tg ) (7) 52 N.C. Gupta. L.N. Kanal/Art@icial Intelligence 78 (1995) 45-86 Eq. (7) has a unique solution unless ti ( ts2 + t2*) is zero, which is zero if and only if tt is zero or both t2 and t3 are zero. In case tl is zero, Eq. (7) reduces to [; 9 i] [~]=[a] (8) two estimates If t2 and which yields lie on a line. whereas A is undetermined. Hence, unless tl is zero or both t:! and ts are zero. tq are zero then unique for A and an infinite number of solutions for B and C which for B and C are obtained the basic parameter 81 yields a unique 3-D motion solutions Similarly, translation can be recovered directly from & = (b, c, e, t1, t2, t3) and the rotation is given by [; ; i][;]=[“]. (9) that there is a unique solution It can be easily verified is zero or both rt and t3 are zero. In case of t2 being zero, we get two estimates and an infinite number of solutions for the above equation unless for A and C. t2 for B Remark. We revisit t. Suppose we are given (a, b, c, d), we have the case when four or more of the coefficients are given along with a system of four linear equations has a unique solution iff in three variables. The system is over-constrained and (r3’+t22)(b-dt,)t, =(I -r;)(at, -t2c+dt;). for the motion parameter. The above constraint solution constraint when recovering problem extremely difficult as the linear cannot be used. parameters has to be satisfied by the coefficients if we wish to obtain a It can be guaranteed only if we impose the nonlinear the basic parameters. It is easy to see that it will make the technique described below for recovering basic 4.3. Recovering basic parameters In this section we recover basic parameters between basic parameters, from the flow field. We present a linear from constraint field and its spatial derivatives which a unique basic parameter and hence a unique 3-D motion can be obtained. the motion Differentiating Eq. (4) with respect to x and y respectively, we get 2ax - cy -- d - tI u, + tzu, + tlw,, E 0, (10) N.C. Gupta, L.N. Kanal/Ar@cial Intelligence 78 (1995) 45-86 -cx + 2by - e - rlvy + t2ug + t3wy 3 0, 53 (11) where au ux=g au L&=&i au u!,=-j-j; ?'-ay; u-a0 aw WY = 5; w-a" Y- ay' imposes a linear constraint We call the above two constraints BaP constraints. Eq. (10) on 231 and Eq. ( 11) on &. The basic parameters motion v, at five points field and its first derivatives the for sufficient points. In particular, given U, v, ux and can be easily estimated, given in the image plane, Z?i is given by the null space of the matrix 2x1 2x2 2x3 2x4 -Y1 -Y2 -1 -1 -v,(~l,Yl) ~x(~l9Yl) Wx(Xl,Yl) -b(X29Y2) &(J2TY2) WX(X29Y2) -1 -Y3 -Y4 -1 -Ux(X49Y4) Ux(X4,Y4) Wx(X4rY4) WA~3~YS) UX(X39Y3) --D,(X3,Y3) . (12) 2x5 -Y5 -1 -~,(~s,Y5) &(XS7YS) wr(J3~Y5) that the above system has nonunique to show It is easy quadratic in x or the five points are collinear. Similarly, at five points on the image plane, & can be recovered by obtaining matrix. null space if the surface is if u, v, uy and vy are known the null space of a Generally, we can extract a dense flow field and thus will have available to us the flow at significantly more points. We wish to use all the available the stability of the system. The problem now reduces to: field and its derivatives to improve information m(x,y> .BI =O, WLY) E R, or MB, = 0, where m= ~2x,-Y,-l,-ux,ux,wx~, (13) and M is a XY x 6 matrix and X, Y is the image size. The above is a homogeneous system of equations in six variables and has a nontrivial iff the system has rank 5 or less. The solution space is given by the null space of solution matrix A4 which can be easily obtained by performing of M. The null space is spanned by singular vectors with zero singular values. ’ the singular value decomposition 5. Motion parameter: analysis In the previous from the motion section we presented an algorithm field. The proposed approach to compute the motion parameter recovers a unique motion parameter by ’ Matrix M has at least one zero singular value as it has rank 5 or less. s4 N.C. Guptu, L.N. Kunul/Artijiual Intelligence 78 (1995) 45-86 solving the completeness two systems of linear equations. In this section we prove the correctness and of the approach. A summary of the results is: . . . is the correct motion parameter. The motion parameter obtained A unique motion parameter 3-D interpretation. Infinite motion parameters in motion. Moreover, surfaces itself. These are the cases when the motion field yields multiple 3-D interpretations. surface the observer should be on the surface in case of a planar or a quadratic is obtained whenever field yields a unique for quadratic are obtained the motion 5.1. Correctness of the motion parameter In this section we prove the correctness of the approach. that the motion parameter obtained by solving Eqs. ( 13) and (7) motion parameter. In particular, we prove the correct is indeed Leta=(A,B,C,tl,t2,tj),and thefunction P(cu,x,y) bedefinedas: P(~y,x,y) =ax*+l~.v~~cx~ -dxmpey+,f -- rlu(x,.V) + r*n(x,y) +t3(XU(X,y) -yu(x,y)), (14) which is the left-hand motion field can now be stated as: side of Eq. (3). The problem of recovering 3-D motion from the given a motion$eld (u(x,y),o(x,y)) over R,jnd (Y such that P(cu,x,y) is zero overall. that there is at least one solution field is generated due to the motion between We assume motion (Y,, be the correct motion parameter and Q, = {a,,} U D be the set of solutions (14). i.e. the recovery problem, the sensor and a rigid object. Let for Eq. to the motion Let nl be the set of solutions for Eq. ( 1.5 ) which is obtained by differentiating P with respect to x: P,((~x,y) = 2ax - cy --d -. flL’(X.)‘) + fzLI(X,?.) + r3(xu(x,y) - YU(X,.Y)). (15) Since P(Lu,,,x,y) = 0 3 aP(a,,,X,y) ax 0, = the set of solutions have, for Eq. ( 15) is a superset of the set of solutions for Eq. (14). We The solution first obtain equations set for Eq. ( 15) is obtained by solving two linear systems of equations; the basic parameters is either consistent, then and inconsistent the motion parameter. A linear system of in a unique, none or or singular resulting N.C. Gupta. L.N. Kanal/Art@cial Intelligence 78 (1995) 45-86 55 solutions, infinite must have at least one solution. We are left with two cases: respectively. But, since Eq. (14) has at least one solution, Eq. (15) Case 1: Eq. (15) has a unique solution. This happens when matrix M in Eq. (13) the is of rank 5 and ti and t:! or tg are nonzero. Let the unique solution be (~1. From above we have, {%}Unc {a,} * ff, = (~1 and 0 = 0. To rephrase, if Eq. (15) has a unique solution is obtained, for the motion l the correct 3-D motion parameter l this is the only solution Case 2: Eq. (15) has injnite number of solutions. This happens when matrix M in is the solution In the field has multiple Eq. (13) has rank 4. We cannot say which one of these infinite solutions for Eq. ( 14), and these are the cases when a unique 3-D motion next section we show that these are exactly shape and motion the cases when the motion is not obtained. field problem. interpretation. 5.2. Completeness of motion parameters In this section we consider the completeness of the approach. field has a unique motion and shape interpretation, that if the given motion motion parameter motion In the previous is obtained. Moreover, a unique solution field renders multiple motion and shape interpretations. subsection we proved that either a unique for the motion parameter. The cases when solution or an infinite infinite In particular, we prove the correct if the is not obtained only number of solutions motion parameters is obtained are obtained are: ( 1) No unique basic parameter (2) Only a unique 231 is obtained and ti is zero or t2 and t3 are zero. (3) Only a unique 8~ is obtained and t2 is zero and ti and t3 are zero. (4) Unique ,131 and & are obtained with both tt and t2 being zero. is obtained. is obtained anyway and the ambiguity is only for one of the similarly. This leaves us with a nonunique motion the ambiguity in rotation is obtained. translation can be handled Except for case ( l), a unique in rotation. Later, we outline a way to resolve three cases-others parameter only A nonunique M in Eq. (13) that this happens only Moreover, basic parameters. Specifically, belong estimation if no unique basic parameter estimate (and similar if the object the viewer must be on the surface to the class of seven parameter for the basic parameter B1 (and &) is obtained only if matrix for f32) is of rank 4 or less. We show in Appendix A surface. for the that give rise to infinite 3-D motion type of quadratic solutions infinite is planar or is a certain the quadratic surfaces to yield itself surfaces described by six2 + s2Y2 + S3z2 + s4m + s=jxz + s&i?? - x - Y + s7z = 0, is a subset of all the possible quadratic surfaces. It has been proved [ 15,251 which that except motion and shape. We also prove for some quadratic surfaces, the motion field leads that, but in a different way; ours to an unambiguous is a constructive 56 N.C. Guptu, L.N. Kunal/Artijicial Intelligence 78 (1995) 45-86 proof whereas Horn’s proof in case of planar or quadratic interpretation. motion parameters whenever our approach field has multiple for recovering is existential. surfaces, It has been proved [ 11,15,23,26,28] the motion field has more Therefore, we do not obtain a unique motion parameter only when correct interpretations. Furthermore, we obtain the motion field yields a unique interpretation the motion parameter is complete. that than one correct the the motion and in that sense are obtained in three other situations the case when no basic parameters are obtained. (2), for one of them here; for others Remark. Above we discussed motion parameters above. We outline a solution only Bt available with tl equal obtained must be equal as there is at least one correct motion the B and C can be broken by going back to Eq. (4) and using of tl, t2 and A to obtain a linear constraint Infinite (3), and (4) discussed In case of it is similar. are for A and infinite solutions for A for the correct estimates lie on a line, see Section 4.1). The two estimates interpretation. The ambiguity to zero, two estimates for B and C (which for B and C. 6. Solving an overdetermined system In the last two sections we presented an algorithm to recover the motion parameter the motion from the matrix M for the noise completeness field. motion of the approach. field, A solution was developed free motion field. We also proved in terms of the singular vectors of and the for the noisy the correctness the solution In this section we develop Let AM be the error introduced in matrix M due to the noise in the motion field. The problem now is reduced to estimating the basic parameters such that (M+AM)B, ~0 We are interested gradually. in techniques which are robust, yield an unbiased estimate, and degrade There are several techniques to solve an overdetermined linear system. These can be grouped into three main categories: likelihood techniques, techniques, techniques. (ErrMin) l error minimizing l maximum l robust nonlinear The error minimizing to be minimized. Least squares However, ods are becoming situations. The maximum maximum probability that for several noise distributions, LS and ML techniques yield similar solutions. a quadratic error function technique. (CTLS) meth- in several improvement tries to obtain parameters with the It can be shown the data set and the a priori distribution. is the most popular and often used popular and show remarkable techniques entail formulating total least squares (TLS) total least squares (ML) estimator and constrained increasingly likelihood given (LS) One of the significant problems with the ErrMin and ML techniques to handle outliers. Even a single data element with large error can perturb significantly. to handle outliers have been proposed is their inability the estimates recently, techniques Several robust N.C. Gupta. L.N. Kanal/Artifcial Intelligence 78 (1995) 45-86 57 which can handle even up to 50% outliers. However, the computational requirements become severe. 6.1. Least squares estimator Least squares provides an easy way to solve an overdetermined system of equations. We wish to find Bt such that the norm is minimized. A trivial solution to the above problem is given by setting f3t to zero, resulting in zero minimum error. Therefore, we need to impose a constraint such that a non trivial solution is obtained. This constraint can be imposed in two ways; (1) by setting tg (or any other parameter) to unity, or (2) requiring that the length of Br is unity. The two constraints are equivalent unless tg is zero. The second constraint however is quadratic in nature and for the sake of simplicity we choose the first constraint. However, a closed form solution for the basic parameter with the second constraint can be obtained as well and is presented later. The problem is now reduced to recovering Br such that II MB1 - w II2 is minimized. Here, with a slight abuse of notation we now define M as a XY x 5 matrix consisting of only the first five columns of M in ( 13)) B1 is (a, c, d, tl , t2), and w is a vector of size XY consisting of w,. The LS solution is given by MTMB, = MTw, which in the continuous case reduces to: 41x2 -2 Jxy -2 Jx -2 Jxvx 2 Jxux -2 Jxy Jy2 Jv Jw - Jw -2 Jx Jv JI Jvx - Jux r31 = -2 Jxv1 Jw Jvz Jv: - Juxvx 2 Jxu1 - J.wx - Jux - Juxvx Ju: -2 J dxr-yu), .vu)x J .?J(xu- J (xv-vu), J v.r(xv-.vu)x - J ux(xl:-.Yu)x where the integrations are over the image plane R. We can replace several terms con- taining the motion field derivatives by the motion field by invoking Green’s theorem in a plane [ 201. We have: 58 N.C. Cuptu, L.N. Kunul/Artijiciul Intelligence 78 (1995) 4.5-86 (‘. yu, = YU dy, .I’ J /- \ 14, = u dy, .i’ J’ .I x(xu - yuJ.1 = c x( XL’ - yu) dy - *t XL’ - yu), J .i .I (XL: - ~14) r = (XL‘ - p) J’ d_v, where C is the boundary of the image plane R and all the integrals are over the image plane unless otherwise indicated 6.2. Bias in the least squares estimate Least squares offers a simple technique to estimate the basic parameters. However, it suffers from a severe problem; LS is asymptotically biased. For an overdetermined estimate only our problem, to be solved system MB, = w in n variables, if matrix M is noise free, i.e., all the measurement the measurement is least squares gives an unbiased errors are in W. For that is errors affect both M and w. That is, the problem (M,, + AM)& = W, + Aw, [M,,; IV,] is the true data, LAM; Aw] is the error in the data, and 131, is the actual [ 33, Lemma error has zero mean it is easily demonstrated where If the measurement solution. 301 that under quite general conditions ,131 = ( MTM) -‘klTw does not converge to at,, but (“plim” means probability limit): N.C. Gupra, L.N. Kanal/Ar@cial Intelligence 78 (1995) 45-86 59 where the error covariance matrix C of [M; w] is being decomposed as (C, is n X n and C& is n X 1). Assuming that the errors are uncorrelated across rows and columns of data [M; w], the bias in the solution converges to B, - al, = -u* plim,,,, -1 a,,. -LMTM m > is asymptotically that least squares This implies biased. The size of bias increases with error and the condition number of matrix M. Also note that the bias always has the effect the absolute value of the parameters. That is, the bias will move the of underestimating the optical axis. This kind of bias has been reported earlier focus of expansion towards by several authors and we observered it as well. The results of experiments with LS appear in [ 7,8]. 6.3. Total least squares estimator Least squares yields a biased estimate as it fails to recognize side matrix M. In case the errors are equally distributed matrix of equations. The basic principle of the TLS is to find [AM; Aw] such that [M; w] , the TLS [ 161 algorithm can be used to solve the overdetermined through the error in the left-hand the entire measurement system (M-AM)& =w-Aw has an exact solution and that I( AM; Aw (1 2 is minimized. Compare which entails finding Aw such that this to least squares, MB, =w-Aw has an exact solution and II Aw 112 is minimized. A closed form solution can be derived for the TLS problem and is given by: B, = (MTM - A*&)-‘MTw, (16) singular value of the matrix where A is the smallest [ 161 that under very general conditions, residual error at least as small as the LS solution. Several other results have been obtained. stability, performance in the TLS yields an unbiased estimate with the the [M; w]. It has been proved and computational requirements regarding 6.4. Constrained total least squares estimator The solution presented in the previous section yields an unbiased estimate when noise is uniformly [M; w] . However, (uncorrelated, with covariance matrix Z) distributed for the system of equations the noise ( 13), the across matrix in the first three data 60 NC. Guptu, L.N. Kunal/ArtijiciuI Intelligence 78 (1995) 45-86 (2x, -y, elements to see that the analysis noise is only obtain an unbiased the noise uncorrelated. * in the other solution - 1) is zero as the image coordinates is similar even if there is error three coefficients. for the system of equations In this section we present a technique are known perfectly (it is easy in the optical axis) and the to that and is ( 13) under the assumption is similarly distributed in the other three data elements ( -c_, , u,, w,) The system of equations ( 13) can be rewritten as: lMl;M*lBI =w, where the XY x 3 matrix Mt is noise free. The problem is to find [ AM2; Aw] such that [M,; M2 - AM2J& = w - Aw has an exact solution and /I AM2;Aw 11 2 is minimized. A detailed solution of the above system of equations known as mixed LS-TLS is given in [ 161. We give a brief description [ A41 ; Mz; w] is performed here. First, a 3 Householder to obtain: transformation Q on the matrix where RI, is a 3 x 3 upper triangular matrix. The closed form solution given by: for at is now B,=(MTM-A2[; ;])-'MTw, where 12 is a 2 x 2 identity matrix, and A is the smallest singular value of the matrix [ R22; R2b] The proof regarding the unbiased nature of the solution is given in [ 161. 6.5. Unmodeled noise structure The above solution with CTLS was developed under noise in the measurement uncorrelated even for very simple noise models. This results in biases in the estimates, that covariance matrix of the measurement (u,, ux, w,). However, vector C reduces uncorrelated in (u,, u,) is spatially the noise vector and to is zero mean Gaussian, the assumption of uniform it is not satisfied If we assume the a nondiagonal matrix. Moreover, C is a function of image coordinate substitution is different reduce (x, y) and hence to can be used if it is the same for all rows. But, rows of matrix M. A simple variable the covariance matrix to a diagonal across form * This is obviously not true and we observe some bias in the solution. N.C. Gupta. L.N. Kanal/Artijiciai Intelligence 78 (1995) 45-86 61 the nondiagonal varying covariance matrix to a diagonal form is nontrivial. the ill effect of varying nondiagonal covariance matrix are reducing Some described techniques to reduce in [ 181 and can be used. Some other noise structures which are not considered but will effect the motion parameter estimates are the following: l We assumed is given numerical differentiation. this must be taken into consideration. to us is the motion the Gaussian noise in the derivatives of the flow field. However, what field and its derivatives have to be computed using in the derivatives Therefore, while modeling the noise l The noise outliers. in the flow field is almost always spatially correlated with significant l There may be errors in the location of the optical axis. the constraint, Remark. We imposed we require /I Br I]= 1, the LS and the TLS yield identical solutions. This solution by the singular vector associated with the smallest singular value of the matrix The CTLS solution matrix if is given [M; w] . associated with the largest eigenvalue of ( [M; wlT[ M; w] ) -‘P, where P is a 6 x 6 matrix given by t3 = 1, to obtain a nontrivial is given by the eigenvector solution. Instead, p= O O [ 1 0 I3 * 7. Robustness of motion parameter for estimating the solution the correctness In the last three sections we developed field. We proved from the motion the data is noise free. The results guarantee rameters approach when field renders a unique motion and shape interpretation, obtained. We then developed investigate upper bound on the error in the motion parameter as noise is introduced field. the stability of the motion parameter. for the noisy motion the solution In particular, we want and the completeness that whenever the motion pa- of our the motion is field. In this section we to obtain an in the motion the correct motion parameter The motion parameter is recovered by first estimating the motion parameter recovering guaranteed only when both the steps involved are stable. We first consider the basic parameters which is recovered from the basic parameters-is from them. Thus, subsequently. discussed and hence the translation parameters. The stability of the rotation- the basic parameters the stability of the whole system and then is the stability of Recovering the basic parameters from the basic parameters of equations the following is easy to analyze two issues: from the motion field as well as recovering motion entails solving a linear system of equations. A linear system In particular, we need to address for noise sensitivity. l How stable is the system of equations the recovered basic parameters least an upper bound on the error in the basic parameters with respect in the input data. (13)? We need an estimate of the error in as a function of the error in the input data, or at to the error 62 N.C. Gupta, L.N. KanaUArtijicial Intelligence 78 (1995) 45-86 l How much noise do we expect field, its derivatives, the motion is then needed derivatives and the image coordinates. is an estimate of the noise in the BaP constraints? Eqs. ( 10) and (11) image coordinates relate and the basic parameters. What field, its in the motion level we expect 7.1. Stability of the basic parameters In this section we investigate the error introduced [AM; Aw] nonachievable under reasonable is introduced in the data matrix [M; w]. For upper bound on the relative error in the estimate of ai as the error a the TLS solution in the estimate 81 can be obtained (16), restrictions on the noise and is given by [ 16, pp. 200-2071: II < IWI II% II K(M) 1 - ~(M)(llA~ll/llMll) i lb’li (17) where K(M) defined as is the generalized condition number of the nonsquare matrix M and is K(M) = jIMI IIM+ll, = z, the ratio of the two extreme singular values of M. essentially The condition is infinity, whereas, is a measure of linear dependence number columns of a matrix. For a singular matrix condition number is 1. For our case, the problem higherorderterms It is easy to see that the two functions lower order terms in its power series expansion. As a matter of fact, a planar surface yields a linear h(x,.y), the and the the condition number the to estimating of (h(x,y)(x-tl)).and are highly dependent (h(x,y)(y-tx)).. if h( x, y) has only the columns are linearly dependent for an orthonormal matrix, the linear dependence (oforder2andmore) is reduced among among and the two functions are linearly dependent. ( 17) states that if the matrix in inequality is well conditioned, that The estimate is, K(M) small changes changes is not too large, then small changes in M and w produce correspondingly in the solution Br . On the other hand, if M is ill conditioned, then small in M and w may produce large changes involves computing in Br. Condition number computation Though we can obtain a closed form expression rather complicated be performed of M to be large noise (noise was added to the motion the singular values of the matrix. for the condition number of M, it is and hence not too informative. However, some empirical analysis can the condition number to rather easily. In most of our experiments, we found the system was not sensitive field and its derivatives (around hundred separately). thousand), though As we mentioned, the upper bound on the relative error given above cannot be achieved by any noise distribution. We can obtain a tighter bound on the instability of a linear system by transforming matrix has a lower condition the transformed not increase improve the original basic parameters and hence that this transformation the tighter error bounds coefficient from this step does does not the the linear system, such that the resulting the relative errors. We point out though the actual stability of the system, a matrix multiplication number. Obtaining variables involves rather imply N.C. Gupta. L.N. KanaUArtificial Intelligence 78 (1995) 45-86 63 overall stability of the system. However, since the computation precision machine, the system. is performed on a finite is gained as truncation error does not adversely effect some stability in idea then smaller transforming is to equilibrate ( 17) is obtained the system such the linear system [M; IV]. Expression The rationale behind terms of the data matrix [M; b] . If the relative error for the different data elements the errors for the maximum is the same, than that in the larger that all the elements of the by it by another matrix H and by change of variable B1 = H&. Here fi& = w, where J? = MH. The different noise in matrix the absolute error in the small elements will be relatively elements. The is to transform data matrix have almost similar absolute noise. The linear system post-multiplying one replaces the problem MBt = w by the problem matrix H is a square matrix of the order of M. If H is diagonal, may be interpreted this transformation orthonormal, use the diagonal matrix H as a column of the columns of M. It has been proved by van der Sluis of H, K( MH) does not exceed scaling by more than a factor of rr112. the problem mathematically. However, unless H is from that of M. We the Euclidean norms that with this choice by column this transformation to M. If H is nonsingular, the condition number of & will generally be different as a column does not change condition number obtainable to balance [37] scaling operation scaling matrix is transformed the minimal applied The overall relative error in 81 is dependent on K( MH) and is given by an expression to (17). The relative error from & by multiplication with a constant matrix H (note in Dt is the same as the relative error in 81 as it is that H is constant similar obtained for a given problem). the system to the motion ( 16) is stable against We found that with column scaling, I$? is in the hundreds most of the times and at most a few thousand), is not small and the surface means noise being added remarks are offered: l The condition the error bounds were small (condition number of if the image plane is not very close to being a planar. Low condition number in the input data (again, separately). The following to the is inversely proportional number of the matrix M in (13) size of the image plane. For a very small region the condition number was large. This shows that recovering 3-D motion from a small patch is unstable and we need data from a significant flow [7]) for robustness. support interesting l Another random perturbations its derivatives (to compute stable optical spatial and temporal observation field and is that the condition to the complexity proportional is inversely equations As the surface became more complicated contribution system of equations gained stability. Though surprising, difficult from each other and from x and y. The result is that the BaP constraints image points become of the higher order terms in the Taylor series expansion the reason to find. As the surface becomes complicated, and hence the stability. (by any measure, increasingly number of the system of in motion. of the surface as the the increases) for this is not for example, uX and uX become dissimilar at various l The condition number of M dissimilar is minimum when the object is at the center of the is if the object image plane. That is, the best 3-D motion parameters are estimated in the center of the visual field. 64 N.C. Guptu. L.N. Kunal/Art$cial Intelligence 78 (1995) 45-86 l Several attempts have been made in the past to show that the 3-D motion field is inherently unstable by showing recovery that the condition number is large. It is clear that is dependent on the field of view and the surface structure the general stability of the 3-D system of equations remarks can be made regarding from the motion of the Jacobian matrix of a nonlinear the condition number and no general motion estimation problem. separately. We ignored In the above analysis we considered field and its derivatives field and the derivatives have to be computed via numerical differentiation. The noise in the in the motion motion field. We address field and field derivatives will be significantly more this issue in the next section. the noise which was added to the motion the fact that what is given is the motion is related and more often than not, the noise that in the motion its derivatives than 7.2. Stability of BaP constraint The BaP constraints the motion relate the basic parameters. The stability of the constraints the image is thus field and its derivatives. What is given to us is its spatial derivatives, field, and (x, y) with coordinates dependent on the stability of the motion the motion an extremely unstable and ill-posed operation. We quote from field and the derivatives have to be computed via numerical differentiation- [ 31 It should be remembered that, as an approximation method, numerical differen- tiation is not stable, since small values of h (step) can lead to large errors. . . . , and in actual practice this operation is avoided whenever possible. amplifies large errors of the numerical differentiation in the flow field can produce by the fact that we will always have significant about the fact that the motion Instability noise compounded (recall our discussion optical flow is recoverable large errors are introduced constraints. Unreliable BaP constraints mean that though the system of equations conditioned, from a sequence of images). The result resulting in the motion the noise in the flow field; a small is in the derivatives. The problem in the flow field noise field cannot be recovered and only in unreliable BaP is well is that significantly are too unreliable field derivatives the constraints One of the ways to get around this problem system. This can solve the problem the overdetermined can be estimated with a small noise noise was much more overdetermined than the signal to yield any meaningful is to use several image points and solve for cases where the derivatives answer. (say 10%). But, in some of our experiments, the itself. The CTLS solution of the (derivative) from the image sequence, Another way to get around answer is to somehow compute system also failed to give any meaningful this problem in these cases. the spatial derivatives of the flow field directly them from the flow field numerically. We have not come across any such effort and we believe from the image sequence will that computing the flow field itself. The optical be much more difficult and unstable intensity. The flow field is related derivatives of the optical through the first order derivatives of the discrete, the second order partials. When computing to the spatial and temporal derivatives of the image the derivatives of the flow field directly flow will therefore be related to the image sequence than computing than computing rather N.C. Gupta. L.N. KanaUArtijicial Intelligence 78 (1995) 45-86 65 noisy image sequence is itself unstable, it is rather evident that obtaining second order derivatives robustly will be infeasible. In the next section we show how to get around this problem. We reformulate the solution so as to obviate the need for the flow derivatives. The central idea is to use the available information in the spatial domain in a useful way. 7.3. Stability of the rotation vector In the previous subsection we investigated the stability of the basic parameters and hence the translation vector. The rotation vector w is recovered from the basic parameters by solving a linear system of equations. In this section we discuss the stability of the rotation vector w recovered from the basic parameter &. The rotation vector o is recovered by solving The stability of the above linear system of equations is given by the condition number of the matrix. It is easy to see that the condition number of the above matrix is large only if t1 is small or both r2 and t3 are small; with ti zero or both tz and ts zero, the matrix is singular. The stability of the constraints for the rotation vector is dependent on the stability of the basic parameters. If f?i can be recovered reliably, the error in the constraints is small and bounded. Therefore, if at can be recovered reliably and tl and ti + tg are not small then the rotation parameter can be estimated robustly. 8. Stabilizing the BaP constraints Numerical derivative computation is an unstable operation and any noise in the input data is amplified. We mentioned earlier that what is available to us is optical flow-a very crude approximation to the motion field, Hence, it becomes all the more important for our purposes to avoid numerical differentiation. Below we present a way to eliminate the flow derivatives from the constraints ( 10) and ( 11). The central idea is to use non- local constraints-constraints which use information from a significant spatio-temporal domain-for stability. We first expand on the idea of nonlocal constraints and then present a way to stabilize the BaP constraints by eliminating the motion field derivatives from the formulation. 8.1. Nonlocal constraint Several vision problems have been formulated as solving a system of equations or minimizing an energy function. The energy function or the system of equations consist of the domain constraints and the regularization terms. The domain constraints capture the idea of the domain whereas the regularization terms capture the heuristic knowledge 66 N.C. Guptu, L.N. KunuUArtificiul Intelligence 78 (1995) 45-M about the physical world. Local constraints, which capture been used extensively relate various known and unknown quantities at a point Some examples of the systems based on local constraints 0 Optical $0~ computation: Optical flow constraint to solve a variety of problems the domain knowledge have in computer vision. Local constraints continuum. in the space-time are given below: intensity I,, the instantaneous fY, I, are the image optical at a point (where relates of the image along with smoothness from the local constraints only. l Shape from shading: For recovering the smoothness of the optical flow) intensity gradients flow velocity with the various partial derivatives flow constraint, and (u, U) the optical in time and space. The optical imposes constraint, which the assumption the optical about the flow field flow field, are used to estimate shape from shading [ 141, local constraints like it is the surface normal, I is lighting direction and I is the image in space and time) capture intensity at a point. Constraints the relationship between like these, along with the regularization intensity the reflectance and that the normals change slowly in a local neighborhood are the 3-D shape information from shading. reasons why systems based on local constraints became so popular. (where at a point the image terms which stipulate used to obtain There are several Some, albeit not all are: l Local constraints along with the additional heuristic knowledge about the physical world yield a highly overdetermined l Approaches based on local constraints and a well-conditioned system. lead to a neat, structured and elegant math- ematical formulation. l Most important of all is the ease with which can be implemented system-a performing only neural network-must be doing local operations was preferred. on a neural network. It was assumed the local constraints based systems that the biological visual and hence a system local processing, structure, these local constraints In spite of their neat mathematical an overload of “work”. By this we mean that these constraints In this noise corrupted world there is not enough reliable solution of the problem constraints were obtained, The problem of noise handling was not tackled at the constraint till very late and was passed on to the least squares system. Least squares handles noise only and hence and structured noise. suffer mainly due to try to do too much locally. to allow the local form. The result was that though enough themselves were extremely noise sensitive. level, but was deferred to the immunity the system in the presence of highly correlated in its most general the constraints fails to alleviate much of the problem if a random noise has corrupted to provide noise information If we hope to have any realistic chance vision we have constraints to use robust constraints. The main is that they use only local information to solve the difficult problems in computer of the and hence a way to achieve stability for the instability reason N. C. Gupta, L.N. Kanal/Art$cial Intelligence 78 (1995) 45-86 61 the information is to utilize constraints which invoke stability, so as to tolerate a realistic available level of noise. the support of a significant in time and space in an effective way. We must use to achieve spatio-temporal domain 8.2. Elimination of flow derivatives are local constraints The BaP constraints and space. They are unstable as they use the local variations of the motion are impossible available to impart stability over a region R, with boundary C, in the image plane we get in time field, which in a reliable way. The idea then is to use the large amount of (10) and (11) and use information to BaP constraints. only at a point to estimate information Integrating -2aJx+~Jy+dJl+t~Ju,-tzJv,--Jxu,+u-yu,=O, R R R R R R -2bSy+cJx+eJ1+t,Jo,-tzSu,-J~ur-u-~~,=o. R R R R R R (19) (20) If the motion R, from Green’s field (u, u) is continuous in the plane theorem and has continuous partial derivatives in region [ 201, we have ju,dxdy=j!udy, /u,dx+=-judx, ju,dxdy =y,dy, &,dxdy = --c&d,, R J R J R C R C (xu, + u - yux) dx dy = (xuy -u-yu,)dxdy=- (xu - yu) dy, # C (xu - yu) dx. f c Substituting the above in Eqs. ( 19) and (20) we get -2a Jx+c Jy+d Jl+tlfudy-tzfudy={(xu-yu)dy, R R R C C C -26 Jy+c Jx+eJl -t,~vdx+t2~LldX=-~(Xu-y~)d*. R R R C c C (21) (22) as linear constraints field. If the flow field obtained by solving a linear system of equations as in Section 4.3. is known at the boundaries for the basic parameters in terms of various of five regions, integrals of the flow the BaPs can be To recapitulate, we have been able to eliminate the instability in the local constraints ( 10) and ( 11) by using the motion field in a region. The local constraints are unstable due to the need to obtain the first order variations ( 10) and ( 11) the in the flow field. When 68 N.C. Gupiu, L.N. Kunal/Artijicial Intelligence 78 (1995) 45-86 large spatial support, with the additional field itself is noisy, the task of finding flow By seeking surface To emphasize the flow field, we quote from [3] again the advantage of substituting is smooth and differentiable, we are able to eliminate local variations becomes extremely difficult. that the underlying the need for derivatives. assumption the flow derivatives by various integrals of . . , consequently, Recall that this was not true in the case of numerical differentiation procedures the numerical procedure is stable as h + 0. (integration) that the motion to obtain condition is not necessary ( 1) The additional partial derivatives field be continuous the constraints can be obtained with a much relaxed requirement, Remarks. continuous The same constraints R must be moving with the same 3-D velocity. In the case of a static environment moving camera, is true for the entire in motion, we require (4) at points along with (21) and (22). that the region and image. In case of multiple objects that the entire region R be on a single object. Differencing Eq. and (x~,.v) we get this condition (xI,.~) axS,-cys,-d6,-rl(l!(x1,~) -~:(~2,y))+tt2(u(x1,y) -u(xz,y)) =y(u(xl*y) -u(x2,y)) - (xlutxl,y) -x2u(xz,y)), where 6, = xi - x2 and X is the mean of x1 and x2. Integrating a contour C of the region R we get the constraint be obtained without field. motion the need for imposing the continuity (19). Similarly, constraint the above equation along (20) can on the and differentiability (2) At this point [ 171, which to look at the algorithm proposed by Jepson and Heegar in several ways our work extends to our approach; their results. We derive the constraint obtained by Jepson and Heegar in a different way. For a patch of N x N, Eq. (3) can be written as it is instructive is very similar Pq + Rt = 0, where P is an N* x 6 matrix consisting of (x2, y’, -xy, and matrix R is an N2 x3 matrix consisting of ( -u, u, w). Multiplying with p(x,y), is in the null space of P yields such that p(x,y) -x, -y, 1)) q = (a, b, c, d, e, f), the above equation p(x,.v)Rt =O, or r1 .I P(.hY)U(X,Y) + t2 p(x,y)u(x,.Y) +t3 P(X,Y)W(X,Y) =o, J' J' the constraint obtained in [ 171. The kernel p( x, y) requires that /p=/xp=/yp=/x2p= Jyzp= Jxyp=o, where all the integrals are over the N x N image patch. From it seems that the authors have used a Hermite polynomial the description in [ 181 for the function p, although N.C. Gupta, L.N. Kanal/Art#cial Intelligence 78 (1995) 45-86 69 the above constraints the order of the polynomial. The lowest order Hermite polynomial is of order three. Computing the weighted they do not specify that will satisfy the flow field with this p is akin to computing flow field in a small neighborhood order difference of the flow field in a small neighborhood it is easy to see that the third order differences would be highly noise sensitive. of third order difference of the the first is extremely noisy. Therefore, (N is 3 1). We saw earlier the convolutions that computing 9. Combining motion parameters In the previous sections a CTLS solution was obtained for the basic parameter ,131. We have used only one of the BaP constraints used to reduce function function does not yield a closed form solution and iterative to solve the nonlinear (22) can be the effect of the noise even further. One way would be to define a error the error them techniques have to be used so far. The other constraint for the two constraints together. Unfortunately, and minimize system. lead Instead, we use CTLS to estimate the two solutions will be identical field may to slightly different thus estimated the basic parameters Et and f32 separately. For noiseless data (we proved but noise this earlier) in the motion solutions. The two sets of motion parameters can be combined to yield a better estimate of the motion parameter. One way would be to take the average of the two estimates, though a better the motion parameter which better fits the given motion technique would be to select field. The measure of fitness of the solution can be easily estimated by computing how well if LYI and cyz are the two satisfy Bq. (4). Specifically, solutions, we estimate (function P is defined by Eq. ( 14) ): the motion parameters EI = P2(x,y,d dR, J R P2(x, y, (~2) dR, E2 = s R and select the motion parameters based on one which yields the smaller error. A further (if the residuals El and E2 are large) which mini- post-processing may be performed mizes techniques. The solution obtained improved (Y using iterative is used as the starting state. ‘Ibis post-processing the above energy function from basic parameters for motion parameter for the real images the results slightly in a few iterations (less than 5). 10. Discrete case The algorithm and the analysis for analyzing field. Though essential so as be useful for the discrete motion field at discrete points. We use numerical integration to obtain in the preceding the behavior of the algorithm, sections was for the continuous flow it should be adapted field, since what is given to us is a sparse flow we can use a more sophisticated integration for our purposes. The errors algorithm or even the trapezoidal composite introduced by the trapezoidal the coefficients integration numerical in Bqs. (21) and (22). Though composite scheme, Simpson’s is sufficient technique rule are of the order of the integration 70 N.C. Gupta L.N. KunuUArtiJicial Intelligence 78 (1995) 45-86 Algorithm Compute-motion( Input: noisy, sparse, discrete Output: translation Step 1: Choose regions such that reliable and rotation vector. u, ~1). flow fields. image flow is available at most points on the boundary which are not parallel to the x, y axis. Step 2: Compute M and w. Step 3: Solve the CTLS problem via solving MB, = w. Step 4: Compute Step 5: Compute M and w for f32. Step 6: Solve the CTLS problem via solving rotation and translation from ,131 MB2 = w. Step 7: Compute Step 8: Compute rotation and translation the error in (4) from &. for the motion parameters esti- mated from ,t31 and L&. Step 9: Select the motion parameter which yields the smaller error. Fig. I. Algorithm for computing motion parameters. third derivative of the motion held, whereas Simpson’s the order of the fourth derivative. We use Simpson’s which involves obtaining the weighted sum along the contour. technique composite introduces integration errors of technique We would that the surface like to draw attention to the fact that by computing is locally planar. To see this, just consider assume fits a second order polynomial only for our scheme for most points on the segments of the boundary which are not parallel this way we rule three points and second order flow is generated [38]. Also note that we do not need the flow to be dense to work. We just have to define regions such that flow field is available to the x, y axis. that Simpson’s if the surface is planar integrals between A top level sketch of the algorithm is given in Fig. 1. IO. 1. Data requirements As we mentioned earlier, the motion field is an abstract concept and cannot be com- Eq. (21) is optical flow-an approximation reliable optical flow can be estimated only at few points. that the algorithm be useful even for a very sparse optical field. Moreover, it is important puted from an image sequence. What is computable of the motion In this context, flow field. In this section we analyze is a constraint should be obtained for five different for each constraint. As is evident constraint needed only at the boundaries regions. Moreover, we do not require over the entire boundary. We can select regions such that the data is required segments of the boundary only. from Eq. (21)) of the selected for the algorithm. the BaP for a unique solution, regions. The issue is: how much data is field is required the data for some in five variables. Therefore, the data requirements the motion N.C. Gupta, L.N. Kanal/Artificial Intelligence 78 (199.5) 45-86 71 YI I (xr Y) ______ ______ onepixelwidth (x2 Y) Fig. 2. Region such that data is required only for two points. The motion field in Eq. (22) the segments of C, along which the y coordinate does change, always give zero for the integral. Thus, to if the regions are chosen such that the significant portion of the boundary the x axis, the motion field will be needed only along small segments. is integrated along the y axis. Therefore, is parallel The minimum data is required if a rectangular y dimension being a single pixel. The rectangular axes and the width along region shown in Fig. 2, it is easy to see that Eq. (22) reduces to: region is selected with the width in the region is oriented along the coordinate the x axis can be suited according to the given data. For the -2~8% + cyS + da + tl (~2 - ~1) - t2 ( u2 - u1 ) = x2v2 - x1 u1 - y( 242 - Ur ) (23) the motion field at exactly two points that the algorithm which requires and i = 0.5(x1 + x2) ). This means flow field is extremely obtained, given these points (but not the same) then the motion unique solution. A unique solution can also be obtained a straight (XI, y) and (x2, y) (8 = x2 - x1 is applicable even if the optical sparse. It is easy to see that a unique motion parameter can be if five of to this line for a if they lie on at five points. Moreover, lie on a line parallel the motion lie on a straight field data at these seven points line and two other points field and its derivatives from six points, is sufficient line. Remark. Note along integrated that the above constraint the x axis from point (xi, y) to (x2, y). (23) can also be obtained if Eq. ( 10) was 11. Implementation issues The algorithm works for sparse as well as dense flow fields. In case of a dense flow reliable, a closed form solution can be obtained size and shape. In this case various field, with flow at each point equally by selecting the regions of predefined the flow field will have to be computed which can be easily done integrals of in parallel or on a 72 N.C. Gupta, L.N. Kanal/Art$cial intelligence 78 (1995) 45-86 neural network. The resulting takes less than a few seconds is extremely algorithm for a 512 x 512 image. fast even on a Spare Station and In case when the flow field is sparse or has a reliability the regions become slightly factor associated with each involved. As is evident, we need only five to obtain a unique motion parameter. Also, we need the flow field only on the point, choosing regions boundaries of these regions. We have two contrasting demands here: lead to the stability of the system. l More regions l For each region a reliable estimate of the flow field is required at the boundaries. For stability we need a small condition number which can be achieved by having a large number of regions. However, we need reliable motion for each region. is to fix a bound on the condition number and select the regions A good compromise with the most reliable in stability stability. using and even one region can be As we mentioned completely flow along a contour, we should select several the contour as part of their boundary. is achieved. This results the required inside another one. This suggests the regions can be overlapping that if we have an extremely in the flow field to achieve flow field till the required the best available regions having field estimates information reliable before, In case the flow field is sparse or has an associated reliability on the data and hence no closed function, the regions form solution can be (21) and (22) have to be obtained for each region and motion can be obtained via least squares. The resulting is significantly the one for predefined regions as we need In these cases, the constraints to slower the required stability by adding new regions than incremently. A lot of book-keeping a priori. have to be selected depending obtained separately algorithm achieve is required book-keeping, Spare Station. to avoid computing our implementation the same partial integrals over and over again. With some for a 512 x 512 image on a takes about a minute 12. Results and discussion We implemented the algorithm described in Sections 6, 8, 9, and 10 with the transla- for the ease of reporting for all the experiments, ItI = 1. Since ts is nonzero the results such tion scaling we scale simulated motion real and simulated periments with the simulated motion optical flow field. field and for optical that t3 is unity. The algorithm was tested extensively flow obtained for a from a sequence of images. Both the ex- field and then the experiments with the computed image sequences were experimented with. We first describe 12.1. Simulated motion field The motivation algorithm resolution, field allowed control precisely the simulated motion for experimenting with field was to test the tolerance and to assess the effects of varying grid sizes, spatial for the noise field of view, and the type of motion. Working with the simulated motion to for an easier control of the above parameters, which would be difficult from an image sequence. The motion field for the optical flow obtained N.C. Gupta, L.N. Kanal/Art@cial Intelligence 78 (1995) 45-86 73 Table 1 Covariance matrix 0.000559 -0.000136 -0.000461 0.091938 -0.00428 1 ( x 10e4) for Experiment 1 with last noise level -0.000136 0.0003 I7 0.000109 -0.064692 0.004835 -0.000461 0.000109 0.000777 -0.120080 0.05237 1 0.091938 -0.064692 -0.120080 47.176479 -1.651347 -0.00428 1 0.004835 0.052371 -1.651347 9.633154 was generated for spheres, ellipsoids and other regular surfaces undergoing a general motion. Various noise models and varying noise levels were tried, the motivation being to test the stability of the algorithm in the presence of different kinds of structured noise. We experimented with the following noise models: l Uniform noise in the range [ -c_r, ~1. l Gaussian noise with zero mean and specified variance. l Gaussian noise followed by global smoothing in the spatial domain. l Gaussian noise followed by fitting a model to the flow field in a small region, We experimented with the constant and the linear flow field models. The model was fitted to regions varying from 14 to 20 pixels in size. We report the results of our experiments with a rigid ellipsoid in motion. The motion field is generated analytically as the motion and the depth map are known. The noise model used is the fourth listed above and is given as u(x,y) = U(X,Y) + G(O.O,L+(LY)I), u(x,y) = u(x,y) + G(O.O~Pl~(&Y)l), is a Gaussian random number generator with a specified where G(mean, variance) mean and variance and p is the specified fractional noise level. The two columns under “Noise” in Tables 2-7 report the percent noise before and after the model fitting. From the “After Fit” column, we note that though fitting a model reduces the noise level it makes the noise correlated, which is closer to the kind of noise we expect in the computed optical flow field. In the next four columns we report the average translation and rotation found over twenty trials along with the respective standard deviation. 1. The objective of this experiment was to test the algorithm for noise Experiment tolerance. The image size is 595 x 595 pixels and the resolution is 512 pixels per unit focal length; the field of view is 60 degrees. Maximum and mean flow velocities are 5.79 pixels and 2.14 pixels, respectively. The regions are 161 x 161 pixels in size. The average motion parameters and the variance are shown in Table 2. The covariance matrix of the estimate for (A, B, C, tl, t2) is shown in Table 1 for the last noise level. Note that the algorithm is quite stable for even a large amount of noise (the noise level is more than a magnitude greater than what has been tried for other 3-D motion estimation algorithms, e.g. [ 181 introduces lo-15% noise whereas we introduce 200% noise with comparable results) and the error in the motion parameter increases gradually with the noise in the motion field. Note the small bias in the estimates of the motion parameters which can be attributed to the unmodeled correlation between uX. uX, w, and the spatial correlation of noise. 14 N.C. Gupru. L.N. Kanal/Art@cial Intelligence 78 (1995) 45-86 Table 2 Results for Experiment I Noise Translation Rotation Before After True Standard True x10-? fir fit 0.80 0.60 deviation 0.00 3.20 -5.30 as % as % Estimate x10-? Estimate x 1 O-’ Standard deviation x10-5 5.0 20.0 35.0 so.0 70.0 IOO.0 200.0 I .o 3.2 7.6 10.1 14.1 19.2 32.2 0.80 0.80 0.80 0.80 0.81 0.79 0.76 0.60 0.59 0.59 0.58 0.55 0.5 I 0.40 0.17 0.65 I .67 2.3 I 2.84 4.52 6.87 0.22 0.66 1.16 I .73 2.54 3.3.5 4.10 0.00 -0.0 I -0.02 -0.02 -0.08 -0.20 -0.73 3.20 3.20 3.20 3.21 3.18 3.20 3.25 -5.30 -5.33 -5.32 -5.40 -5.51 -5.59 -5.74 0.5 I 1.77 2.73 4.33 10.88 14.61 23.65 0.57 2.6-l 5.32 7.50 IO.24 15.66 17.80 1.16 3.31 4.38 6.46 13.31 18.27 27.87 Table 3 Results for Experiment 2 Noise Translation Rotation Before After True Standard True x10-’ fit fit 0.80 0.60 deviation 0.00 3.20 -5.30 as % as % Estimate x10-? Estimate x 10P3 5.0 20.0 35.0 so.0 70.0 100.0 I .4 4.5 1.6 10.5 16.2 21.3 0.80 0.80 0.80 0.81 0.80 0.79 0.60 0.59 058 0.54 0.51 0.45 0.38 I.19 2.31 3.17 3.82 5.58 0.32 I.31 2.12 2.67 2.91 4.57 0.00 -0.01 -0.01 -0.02 -0.07 -0.09 3.20 3.21 3.21 3.19 3.23 3.32 -5.30 -5.34 -5.39 -5.57 -5.65 -5.9 1 0.83 2.70 7.18 9.90 11.89 19.88 Standard deviation x 10-5 0.69 2.47 4.80 6.68 11.15 9.05 2.00 5.44 1 I .72 14.37 21.1 I 27.61 Experiment 2. The objective of this experiment was to assess the algorithm as we change the same as in Experiment experiment pixels and the average Compare bias in the estimates for Experiment the field of view of the camera. We have all the parameters field of view. The FOV for this is 4.02 in Table 3. the is more with larger variances. The added stability of the algorithm is 2.0 pixels. The results are shown for Experiment flow velocity the results with the results to the larger field of view. 1 can be easily attributed the noise tolerance of 1. For the same noise (425 x 425 image) and the maximum for a smaller flow velocity is 45 degree 1, except level, Experiment 3. The objective of the experiment was to study the stability of the algo- rithm as the grid size was changed. The grid size in this experiment is 81 x 81 pixels, 1 and 2. The field of view is 60 degree and is compared these results the same as in Experiment to one obtained is larger with comparable variances. in Experiment It is clear that the tolerance to 161 x 161 for Experiments 1. The bias in the estimates 1. The results are shown in Table 4. Compare to noise is reduced. N.C. Gupta, L.N. Kanal/Art@cial Intelligence 78 (1995) 45-86 75 Table 4 Results for Experiment 3 Noise Translation Rotation Before After True Standard True x10-’ fit fit 0.80 0.60 deviation 0.00 3.20 -5.30 as % as % Estimate x10-2 Estimate x lop3 5.0 20.0 35.0 50.0 70.0 100.0 1.0 3.2 7.3 10.4 14.6 21.1 0.80 0.80 0.79 0.78 0.75 0.72 0.60 0.58 0.55 0.5 1 0.46 0.40 0.17 0.62 1.10 I .39 2.78 3.56 0.15 0.5 1 1.38 1.30 2.61 2.89 -0.00 -0.04 -0.14 -0.26 -0.48 -1.02 3.20 3.22 3.28 3.32 3.43 3.53 -5.30 -5.35 -5.40 -5.50 -5.50 -5.37 0.47 2.08 5.29 8.72 10.76 19.47 Table 5 Results for Experiment 4 Noise Translation Rotation Before After True Standard True x10e3 fit fit 0.80 0.60 deviation 0.00 3.20 -5.30 as % as % Estimate x 10-2 Estimate x IO-” 5.0 20.0 35.0 50.0 70.0 100.0 1.0 3.2 7.3 10.4 14.6 20.7 0.80 0.79 0.76 0.70 0.47 0.20 0.60 0.54 0.46 0.38 0.30 0.24 0.14 0.50 0.78 2.31 3.42 3.78 0.16 0.61 0.76 1.46 I .38 1.21 -0.01 -0.12 -0.42 -0.97 -2.43 -3.89 3.20 3.27 3.40 3.59 4.18 5.07 -5.31 -5.44 -5.48 -5.31 -4.49 -4.11 0.43 2.29 4.87 10.59 22.91 39.23 Standard deviation x 10-5 0.38 1.87 3.39 6.22 8.14 11.82 Standard deviation x 10-5 0.40 1.42 2.89 7.28 9.3 1 14.68 0.73 1.76 5.77 8.32 12.62 14.54 0.74 1.91 3.99 7.81 11.85 10.13 to 161 x 161 for Experiments Experiment 4. The objective of the experiment was to study the stability of the algo- is 161 x 1 pixels, rithm as the grid size was changed. The grid size in this experiment 3. The compared (as in Eq. grid size is such flow (23) ) to obtain a constraint for the real images. The field of view is 60 field cannot be obtained over long contours 1. The results are shown in Table 5. Compare degrees and is the same as in Experiment these results 1. The bias in this case is significantly more with larger variances. for the basic parameter. This is significant as a reliable 1 and 2 and 8 1 x 8 1 for Experiment field velocity at only to those obtained in Experiment that motion two points is required in the presence of predominant the z axis at a rate of approximately of the Experiment 5. The objective of the experiment was to assess is rotating rotational motion. The ellipsoid algorithm 1 degree per frame. The rotation about the about other two axes is also significant. The translational motion is only along the x and the z axis and induces only 10 percent of the image motion. The results are shown in Table 6. the performance 76 N.C. Gupta. L.N. KanaUArtifcial Intelligence 78 (1995) 45-86 Table 6 Results for Experiment 5 Noise Translation Rotation Before After True Standard True x IO-” fit fit 0.50 0.00 deviation 5.00 -3.20 -15.30 as % as % Estimate x 10-2 Estimate x 10P3 Standard deviation x10-s 5.0 20.0 35.0 50.0 70.0 100.0 I .o 0.50 3.7 6.4 9.2 12.8 18.4 0.48 0.45 0.43 0.39 0.37 -0.00 -0.00 -0.01 -0.02 -0.07 -0.10 0.56 I .5 I 3.46 3.12 2.92 4.85 0.35 I .40 2.13 3.40 4.23 5.98 5.00 5.01 s.04 5.08 5.1 I 5.22 -3.20 -3.22 -3.27 -3.30 -3.39 -3.41 -15.30 -15.31 -15.34 -15.38 -15.48 -15.59 0.43 2.1 I 3.66 4.00 7.39 14.78 I .31 3.78 10.54 10.90 16.32 17.33 0.66 3.62 5.49 7.15 8.80 10.54 Table 7 Results for Experiment 6 Noise Translation Rotation Before After True Standard True x10-” fit fit -3.00 -3.00 deviation 0.00 3.20 -15.30 as % as % Estimate x10-2 Estimate x10-j 5.0 20.0 35.0 50.0 70.0 100.0 0.9 3.8 6.6 9.3 13.0 19.0 -3.01 -3.0 -2.82 -2.70 -2.s5 -2.2 I I -3.01 -3.04 -3.02 -3.06 -3.26 -3.73 3.33 12.10 24.13 2.5.60 31.70 30.82 2.93 12.73 25.16 20.96 31.18 57.94 I -0.0 -0.18 -0.48 -0.85 -1.54 -3.51 3.21 3.37 3.73 4.07 5.31 9.36 -15.30 -15.27 -15.08 - 14.96 - 14.50 -13.41 3.28 15.05 29.35 44.38 67.26 106.01 Standard deviation x 10-5 3.01 14.92 34.64 54.38 104.87 253.88 in the presence of significant Experiment 6. The objective of the experiment was to assess algorithm most difficult situation the z axis at a rate of approximately the x and the y axis is significant. The results are shown in Table 7. rotational motion and inplane algorithms. The ellipsoid translation-the is rotating about 1 degree per frame. The translational motion along for motion estimation the performance Based on these and many other experiments performed with a simulated motion field, our general observations are: l The algorithm l Noise introduces is stable against random perturbation in the input data. bias. The bias does not always move the focus of expansion the optical axis as reported towards moving FOE towards center The remaining columns and different bias can be attributed in [ 181. As we mentioned the bias of is due to LS and is eliminated with TLS and CTLS. to the correlated errors across the last three earlier, rows of the matrix M in Eq. (13). l The bias increases with the noise level. l A larger grid size enables l Better resolution improves l A larger field of view enables the system the noise tolerance. the system to be tolerant to larger noise. to be tolerant against larger noise. I .48 6.12 16.99 22.38 38.88 64.78 of the N.C. Gupta, L.N. Kanal/Artifcial Intelligence 78 (1995) 45-86 II Experiment I . . . . . . . . . . . . . . . . . . . . . . . . . . . Experiment 2 ---______. ---- , _ _ _ _ _ 5 ---- Experiment ____ 3 Expenment 4 _ _ Exoenment -, - Expe&iit~ - ‘- Angular Error in T L I I I I I I / : : : : I , I I I I I I I / ! i: Y 16.00 , 15.00 14.00 13.cnl 12.00 11.00 8.00 7.00 6.M) 5.00 4.M) 3.00 2.M) I.00 0.00 I 0.00 50.00 1lXUXl 150.00 I 200.00 X Fig. 3. Angular error in computation of T (in degree) for the six experiments with the simulated motion field. The x axis reports the percent noise in the motion field and the y axis reports the angular error in the computation of the translational vector. 12.2. Computed optical jlow In this section we describe our experiments with real image sequences, as input are the image sequences; the motion field, or its approximation available optical flow, has to be estimated well the algorithm performs the noise stability of the algorithm sequences the motion a dense computing and in the computed optical computed using field-was flow field with an associated flow as in [9]. the optical from the image sequences. The motivation for a wide range of image sequences, in the presence of a realistic noise-both flow field. Optical the algorithm described reliability. The same parameters flow-an for what is the is to see how and also, to assess in image to in [9], which provides are used for approximation The regions over which were 200 x 200 pixels starting every 2nd pixel. The image size varied imagery to 574 x 652 for the real image sequence. the BaF’ constraints were and in size. The regions were highly overlapped with a new region for simulated integrated were preselected from 400 x 400 pixels 78 N.C. Gupu, L.N. KunaUArtificiul lnrelligence 78 (1995) 45-86 Fig. 4. Left: One frame of the sphere sequence. A sphe ( -2.0,2.0, 1). Right: Computed optical flow field. :re with a sinusoidal pattern is translating with velocit Sphere sequence is shown is translating in an arbitrary direction. A sphere with a sinusoidal pattern ray tracing program and intensity values are quantized generated using a simple 256 levels. The first frame of the sequence 400 x 400 pixels length is 256 pixels either direction. Discretization to noise ratio for the computed was around 0.1% of the power of the flow field. Results are reported that the motion estimates with UI are more stable velocity gradient the next experiment. Images were into is in size and the average motion per frame is about 4 pixels. The focal in effects are severe due to the poor resolution. The signal flow field was around 50 dB i.e. the power of error in Table 8. Note than with &. This is due to a large in to the y direction. This effect is clearer and the field of view is 76 degree in Fig. 4. The image sequence in the x direction compared in both x and y directions Cylinder sequence The image sequence has a cylinder with random texture and is undergoing translation. length in Fig. 5. The image sequence is colored with random patterns, as in a random dot cinematogram. The cylinder sizes of the patches are such that the projection of each patch is approximately same size. We show the first frame of the sequence in both x and y directions. of size 400 x 400 pixels. The focal effects are severe due The field of view is 76 degrees to the poor resolution. The signal flow field is around 25 dB i.e. the power of error is around 4.0% of the power of the flow field. Results are reported the need for computing motion via both B1 and 232. The motion estimates using & are totally wrong. The reason is that in case of a cylinder oriented parallel the y in u in the y direction. That is, uY is zero for the entire direction, is not of full that the system of equations image plane. Because of noise, to the image plane with axis along in either direction. Discretization to noise ratio for the computed in Table 8. This experiment The of the is clearly demonstrates there is no gradient is 256 pixels the situation N.C. Gupta, L.N. KanaUArttjkial Intelligence 78 (1995) 45-86 79 Fig. 5. Left: One frame of the cylinder sequence. A cylinder with a random pattern is translating with velocity ( -0.4,0.4,0.5). Right: Computed optical flow field. resulting rank cannot be detected a wrong motion parameter has been recovered can be easily number of the system of equations satisfy Eq. (3). in a totally erroneous motion parameter. The fact that from the condition and by looking at how well the motion parameters inferred Robot arm sequences the translation The prominent motion being The robot arm sequences were made available to us by the Computer Vision Lab- of Maryland. There are six sequences with varying degree oratory at the University of motion complexities. the optical axis and hence the flow fields appear to be diverging about the focus of expansion. One is shown in Fig. 6. The image sequences are 652 x 574 frame of the first image sequence pixels and in size. The focal in either direction. 1315.6 pixels In the first sequence The camera in the case of the second the camera the camera and the third sequences is undergoing rotation between in the y direction. The field of view is 52.5 degrees and rotation. The fifth sequence has different into the optical axis. The true motion In the fourth and the sixth sequence both successive translation frames. length of the camera in these sequences. in the x direction a general motion is 1162.7 pixels is not known. is undergoing is moving along The computed flow field for one sequence flow obtained because are reported is shown in Fig. 6. We cannot comment on fields are not available. the quality of the optical of the ‘Ihe 3-D motion parameters translation is computed with small error. The rotation parameters are not very reliable. The reason for that seems (about 0.072 degree per frame) and hence the rotational component in the flow field is relatively small compared to the translational for tg is set to one. Note that the focus of expansion to be that the rotation parameters vector are reported, in Table 8. Only two components are fairly small the true motion component. 80 N.C. Gupta, L.N. Kanal/Arti@ial Intelligence 78 (1995) 45-86 Fig. 6. Left: One frame of the robot arm 1 sequent :e. A real world scene in which camera is undergoing translation. Right: Computed flow field for the first robot arm sequence. Coke sequence is zooming about A frame of the coke can sequence and the computed optical flow are shown in Fig. 7. The camera into the center of the coke can, and hence the optical flow field the center of the image frame. The quality of the computed optical is diverging flow suffers in the top left corner of the image. This is due to the lack of texture. In fact, for this region the flow parameters of the computed optical for the 3-D motion and structure flow. We ignore estimation. The average is less than a pixel. The results are reported denoting flow from these regions is very large (20000+), the optical the condition number of the system of equations for this image sequence the unreliability image motion for obtaining in Table 8. PUMA2 sequence The 30-frame frames a camera successive long PUMA2 sequence was taken by connecting to the end robot arm, and the robot arm was then rotated for a total of 120 degrees. of a PUMA The rotation between radian). The first is about 4 degrees frame of the sequence and the computed optical flow are shown in Fig. 8. The flow field seems is clearly evident. From is not about the center of the image, as the optical flow field it is clear that the rotation reported earlier little to the motion parameters were computed with the center of the image the left. However, (121,128) to be correct and the rotational motion of the camera rather the center of rotation in several other articles, as the optical center. is shifted (0.0698 In case of only rotational motion, the basic parameters will be all zero. The rotation from Eqs. (7) and (9), however, Eq. (3) yields a linear vector cannot be computed constraint for rotation in this case. The rotation vector can be computed easily. Due to the error in the optical axis, the 3-D motion of the camera about the optical If the optical axis is the axis passing through shifted by r, then the translation the new axis is o x r, where x the center of the image is not pure rotation. indicates about N.C. Gupta. L.N. Kanal/Art@ial Intelligence 78 (1995) 45-86 81 Fig. 7. Left: First frame of the coke can sequence. The camera Computed optical flow. is translating along the optical axis. Right: Fig. 8. Left: First frame of the PUMA2 sequence. Right: Computed optical flow field. vector cross product. The recovered radian which is very close to the actual rotation of 0.698 radian. rotation vector about the y axis is around 0.647 13. Conclusions In this paper we have presented an algorithm the motion field. Motion estimation from in computer vision. The reasons and the sensitivity of the motion parameters rameters, we obtained a system of linear equations for this are the nonlinearity to estimate the 3-D motion of objects has been one of the most difficult problems involved two sets of basic pa- the motion parameter to noise. Introducing for estimating of the equations 82 N.C. Gupta, L.N. Kanal/Art@cial Intelligence 78 (1995) 45-86 Table 8 Results for experiments with the computed optical Row Seq. - True T x 10-2 True Rot x10-J Sph. -200 200 0 0 Cyl. -80 80 0 0 Rob I 0 0 0 0 0 0 0 Rob 2 NA NA NA NA NA Rob 3 NA NA NA NA NA Rob 4 II -II -1.3 _ 2.5 Rob 5 0 0 variable Rob 6 6.7 6.7 1.3 I .3 Coke 0 0 0 0 0 0 0 0 Puma NA NA 0 0 698 Parm. - 6 f32 Final 131 .132 Final Bl t32 Final 81 132 Final Bl t$ Final BI t32 Final 81 132 Final 81 a2 Final El t32 Final BI U2 Final Comp T x 10-2 Error T deg Comp Rot x 10-4 -200 -195 -199 -61 -98 -80 2.8 -2.1 -2.0 19 14 16 II 2.0 II 15 15 14 I8 -4 3 22 8.8 I5 5.2 I .8 3.5 25.8 14.4 20.5 204 I81 201 57 -41 71 6.9 -3.9 1.6 6.3 II 10 2.2 -17 1.9 -13 -10 -12 -13 8.4 3 6.8 -15 5.5 0.3 -1.5 -1.0 3.54 -25.3 -9.49 0.4 5.5 0.2 8.8 48.6 3.0 4.3 2.5 1.5 NA NA NA NA NA NA 2.5 2.3 I.8 12.5 5.3 2.5 8.6 12.3 4.8 3.0 1.4 2.1 NA NA NA 0.4 -1.47 0.22 -15 362 -6.0 2.2 13.7 3.31 1.34 -13 0.33 2.40 43.5 2.60 4.46 38.1 -4.6 2.46 18.9 1.27 2.15 50 2.49 0.2 10.0 7.34 1.0 0.47 0.92 -12 -62 0.48 -11 -0.9 -0.8 -30 2.2 2.11 -17 -3.3 -1.0 -II 5.28 -6.3 -21 -1.8 -0.6 -5.4 2.78 4.41 -2.1 2.70 2.21 -1.67 -3.9 -1.9 10.4 36.4 0.51 0.81 0 -0.3 -0.3 9.8 0.59 1.60 -2.4 0.94 0.53 0.80 -0.4 -0.3 0.39 1.18 0 -1.4 3.47 I.0 -2.4 0.47 80.46 113.2 95.4 92.7 13.73 55.26 -683 -604 -647 field. The system of equations the correctness, from the motion available proach and in that sense the problem of recovering 3-D motion “solved”. in space. We proved is stabilized by utilizing completeness the information and robustness of the ap- field is from the motion No assumptions the algorithm general and widely applicable. However, since the optical be obtained the applicability lack of a more stable motion estimation are made about the nature of the surface or the motion. This makes flow field can a smooth motion, to these cases for the the stability of the in the case of smooth surfaces undergoing algorithm improves as the local structure of the object becomes complicated. of the motion estimation for computing optical reliably only is restricted flow. But, technique N.C. Gupta, L.N. Kanal/Art$cial Intelligence 78 (1995) 45-86 83 Specifically, we have been able equations terms to obtain increases the basic parameters decreases as the contribution in the description of the inverse depth map h. to show that the condition number of the system of of higher order Acknowledgement We are grateful to the anonymous their comments which have been very helpful of this paper. in improving reviewers and the editor of this special issue for the contents and the form Appendix A. Completeness of the basic parameters in this section we prove that the basic parameters if a certain itself. We prove that the system of equations type of quadratic surface is being viewed and the observer cannot be obtained uniquely only is on the surface -2ax+cy+d+t,u,-t2Ux-t3W,=0, cx-2by+e+tlu,-t2u,+t3wY=0 (A.1) (A.2) for obtaining being viewed belongs the basic parameters do not yield a unique solution only if the surface to a class of seven parameter surfaces described by SIX2 + s2Y2 + 3322 + s4XY + qxz + s&z - x - Y - s7z = 0. can be obtained The motion parameter the cases when can be recovered are the ones when both the system of equations and (A.2) have rank 4 or less. The system of equations no motion parameter (A.l) rank less than 5 if five of the coefficients of the basic parameters are linearly dependent. That is, we do not obtain basic parameters from either B, or 232, hence and (A.2) has (A.l) if UlUx + U2U, + a3x + a4y + u5 = 0, blu,+b2Ug+bjX+&+65 =o (A.31 (A.41 for all (x, y) in the image plane. (61,62, b3, b4, b5) should be zero. Our objective surface structure when the above equations are satisfied simultaneously. In the above equations not all (al, ~22, ~3, ~4, us) or the condition on the then is to obtain From the motion field equations we obtain: u,=(-tl +tgx)h,+h+Ay-2Bn, u,=(-tl+t3x)hy+Ax+C, uX=(-t2+t3y)hx-Bx-C, q, = (-t2 + tjy) h, + h + 2Ay - Bx. 84 N.C. Gupu, L.N. KunaUArtijicial Intelligence 78 (199s) 45-86 Substituting the above equations into Eqs. (A.3) and (A.4), we get nlh + (a1xts + a2yt3 - aIt1 - n2t2)h, + (~3 - 2Ba1 - Ba2)n + y(Aal + a4) + us - a2C = 0, b2h + (blxtj + bzyt3 - b,ti ~ bzt2)h,, + (63 - b2B + ADI )x + y(b4 + 2b2A) + b,C + b5 = 0. Rewriting the above differential equations we get h., + I h=a*+PY+S X-rl.v+Y x-rl.y+y ’ hJ + I y-*.X+7 h= kix+py+s y-?p+p’ the various Greek symbols (at, b2) are nonzero; where rameters cases when no basic parameters surfaces which simultaneously them being zero results are used for conciseness. We assumed that the pa- in a planar surface. That is, the can be obtained are the set of planar surfaces and the satisfy the above set of differential equations. for the above differential equations is straightforward and can be shown The solution to be 1 X-rlYfY 1 y-ijX+y h = h = ( 1 w: +pxy+Sx+c*(y) ( iu$+pxy+Eiy+F*(x) 1 ( 1 1 , where c*(y) interested This class is given by is any function of y only and c*(n) is a function of x only. We are in surfaces which belong to the above two classes of surfaces simultaneously. h= 1 x+y+y ? ? a~+pxy+Ss+ik$+8y+c* , > and this happens when q and 77 are equal to - 1, y = 7, /? = p, and 2 C’(Y) = &$ + 5.y + (‘*, E:‘(x) =cK- x2 2 +sx+c*. is the class of surfaces for which no basic parameters can be obtained. The surface represented is however (x,Y> and is not very easy to comprehend. To make it clear we obtain and hence no motion in terms of the image the in terms of the global coordinate (X, XZ). Substituting the projection This parameter coordinate surface equation equations in the above we get N.C. Gupta, L.N. Kanal/Art@cial Intelligence 78 (1995) 45-86 85 which represents a class of seven parameter quadratic surfaces and is a subset of all the term in the above expression, which quadratic means the viewer should be on the surface the origin or in other words, that the surface should pass that there is no constant surfaces. Note through itself. References [ I] G. Adiv, Determining three-dimensional motion and structure from optical flow generated by several moving objects, IEEE Trans. Patfern Anal. Mach. Intell. 7 (1985) 384-401. [2] A.R. Bruss and B.K.P. Horn, Passive navigation, Compur. Vision Graph. Image Process. 21 (1983) 3-20. 131 R.L. Burden, J.D. Faires and A.C. Reynolds, Numerical Analysis (Prindle, Weber and Schmidt, Boston, MA, 1978). [4] J.J. Gibson, The Perception of the Visual World (Riverside Press, Cambridge, 1950). [ 5 ] J.J. Gibson, The Senses Considered as Perceptual Systems (Houghton-Mifflin, Boston, MA, 1966). [6] J.J. Gibson, On the analysis of change in the optic array, Stand. J. Psych. 18 (1977) 161-163. [ 71 NC. Gupta, Recovering shape and motion from a sequence of images, Ph.D. Dissertation, Department of Computer Science, University of Maryland, College Park, MD ( 1993). [ 81 NC. Gupta and L.N. Kanal, On recovering shape from motion, in: Proceedings ACCV-95 (to appear). [ 91 N.C. Gupta and L.N. Kanal, Recovering robust image motion, Int. J. Comput. Vision (to appear). [ IO] K.J. Hanna, Direct multi-resolution estimation of ego-motion and structure from motion, in: Proceedings IEEE Workshop on Visual Motion (1991) 156-162. [ I I] J.C. Hay, Optical motions and space perception: an extension of Gibson’s analysis, Psych. Rev. 73 (1960) 550-565. [ 121 D.J. Heegar and A.D. Jepson, Subspace methods for recovering rigid motion I: algorithm and implementation, Inr. J. Cornput Vision 7 (1992) 95-l 17. [ 131 J. Heel, Dynamic motion vision, Rob. Autonom. Sysr. 6 (1990) 297-314. [ 141 B.K.P. Horn, Robot Vision (MIT Press, Cambridge, MA, 1986). [ 151 B.K.P. Horn, Motion fields are hardly ever ambiguous, Inr. J. Compur. Vision 1 (1987) 259-274. [ 161 S.V. Huffel and J. Vandewalle, The Total Least Squares Problem: Computafional Aspects and Analysis (SIAM, Philadelphia, PA, 1991) [ 171 A.D. Jepson and D.J. Heegar, A fast subspace algorithm for recovering rigid motion, in: Proceedings IEEE Workshop on Visual Motion ( 1991) 124-13 1. [ 181 A.D. Jepson and D.J. Heegar, Linear subspace methods for recovering translational direction, Tech. Rept. RBCV-TR-92-40, University of Toronto, Toronto, Ont. ( 1992). [ 191 J.J. Koenderink and A.J. van Doom, Invariant properties of the motion parallax field due to the movement of rigid bodies relative to the observer, Oprica Acra 22 (1975) 773-791. [20] E. Kreyszig, Advanced Engineering Mathematics (Wiley, New York, 1967). [21] D.T. Lawton, Processing translational motion sequences, Compur. Vision Graph. Image Process. 22 (1983) 116-144. [22] H.C. Longuet-Higgins, A computer algorithm for reconstructing a scene from two projections, Nature 293 (1981) 133-135. [23] H.C. Longuet-Higgins, The visual ambiguity of a moving plane, Proc. Roy. Sot. London Ser. B 223 (1984) 165-175. [24] H.C. Longuet-Higgins and K. Prazdny, The interpretation of a moving retinal image, Pruc. Roy. Sot. London Ser. B 208 (1980) 385-397. [ 251 S.J. Maybank, The angular velocity associated with the optical flow field arising from motion through a rigid environment, Proc. Roy. Sot. London Ser. A 401 ( 1985). [ 261 S.J. Maybank, The angular velocity associated with the optical flow field due to a single moving rigid plane, in: Proceedings ECAI-84, Pisa ( 1984) 641-644. [27] L. Matthies and T. Kanade, Kalman filter-based algorithms for estimating depth from image sequence, Int. J. Cornput Vision 3 ( 1989) 209-236. 86 N.C. Guptu, L.N. KunuUArtijicial Intelligence 78 (199.5) 4.5-86 128 1 S. Negahdaripour, Direct passive navigation, Ph.D. Dissertation, Department of Mechanical Engineering, MIT, Cambridge, MA ( 1986). [ 29 ] S. Negahdaripour and B.K.P. Horn, Direct passive navigation, IEEE Trans. Putfern Annl. Mach. Infell. 9 (1987) 168-176. and S. Lee, Motion recovery from image sequences using only first order optical flow ( 301 S. Negahdaripour information, 131 1 K. Prazdny, Determining In/. J. Cornput. Vision 9 ( 1992) 163-J 84. direction instantaneous the of motion from optical flow generated by curvilinearly moving observer, Cornput. VXon Graph. hnqe Process. 17 ( 1981) 238-248. 1321 J.H. Reiger and D.T. lawton, Determining generated by arbitrary (1983). sensor motion, the flow in: Proceedings ACM Interdisp. Workshop Motion, Toronto, Ont. axis of translation from optical instantaneous [ 33 ] P Schmid, Econometrics (Marcel Dekker, New York, 1976). [34] V. Sundareswaran, flow field data, from global Egomotion in: Proceedings IEEE Workshop on Visual Motion (1991) 140-145. 135 1 R.Y. Tsai and T.S. Huang, Estimating 3-D motion parameters of a rigid planar patch, IEEE Trans. ASSP 29 ( 1981) 1147-l 152. I36 1 R.Y. Tsai and T.S. Huang, Uniqueness and estimation of three-dimensional motion parameters of rigid objects with curved surfaces, IEEE Trans. Pattern Anal. Mach. Intell. 6 (1984) 13-27. I37 I Van der Sluis, Stability of solutions of linear algebraic I38 I A.M. Waxman and S. Ullman, Surface structure systems, Numer. Mafh. 14 ( 1970) 246-25 1. and three-dimensional motion from image flow kinematics, ht. .I. Rob. Rex 4 (1985) 95-108. 