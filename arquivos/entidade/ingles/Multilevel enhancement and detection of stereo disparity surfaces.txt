ELSEVIER Artificial Intelligence 78 (1995) 121-145 Artificial Intelligence Multilevel enhancement and detection of stereo disparity surfaces Yibing Yang *, Alan L. Yuille Division of Applied Sciences, Harvard University, Cambridge, MA 02138, USA Received September 1993; revised December 1994 Abstract images arising from viewing The problem of stereo vision has been of increasing interest over the past decade. This paper presents a new computational for matching a pair of In contrast to stereo previous work, this approach formulates the matching problem as detection of a “bright”, coherent disparity surface in a 3D image called the spatio-disparity space (SDS) image. The SDS images represents the goodness of each and every possible match. to the computer vision community framework the same object from two different positions. A nonlinear filter is proposed for enhancing the disparity surface in the SDS image and for suppressing the noise. This filter is used to construct a hyperpyramid representation of the SDS image. Then the disparity surface is detected using a coarse-to-fine control structure. The proposed method is robust to photometric and geometric distortions in the stereo images, and has a number of computational advantages. It produces good results for complex scenes. 1. Introduction 1. I. Stereo matching and feature detection When viewed from two different perspectives, the same object will give rise to a pair of different images. The 3D shape and location of the object can be recovered by fusing the stereo pair. The human ability of stereo vision was first observed by Wheatstone [ 321, and the computational standpoint important the underlying mechanism [4,14,18]. applications for machine perception. The most Stereo are cartography [ 81 and robot vision is a useful method investigated has been [ 20,211. from * Corresponding author. Current address: Polaroid Co., 750M-3J, Cambridge, MA 02139, USA. E-mail: yangy@polaroid.com. 0004-3702/95/$09.50 @ 1995 Elsevier Science B.V. All rights reserved SSDIOOO4-3702(95)00028-3 122 Y Yung. A.L. Yuillr/Artificiul intelligence 78 (1995) 121-145 In recovering 3D shape using stereo, the most difficult is to find its corresponding the problem line constraint, we may assume raster image points constraint may be introduced. line.) Stereo matching tend to have roughly that corresponding task is image matching. Given point in the right image. lie is made possible by two facts: the same disparity. Based on this in the two points points (2) Corresponding from the same point on the object, appear similar; stereo matching otherwise. Based on this fact, a photometric constraint may be a point in the left image, (Thanks to the epipolur on the same horizontal ( I ) Neighboring fact, a geometric images, originating would be impossible formulated. Many stereo algorithms have been proposed. As a common proaches attempt sumption generically, piecewise This paper presents to match a left-image point is locally constant [ 2,3,5,22,25,3 smooth a new approach that the disparity feature, existing ap- to a right-image point, based on the as- [ 9- 11,13,16,17,19,24,26,27] or more 1,331. the matching to a feature detection problem. To match a pair of 1D stereo images I’ = Z’(X) to stereo matching. We convert problem and I’ = Zr( x), we may assign a numerical value E( x, u) to measure similarity between for every possible match E = E(x, M). As such the task becomes image E = E(Y, u). the SDS images, Z= E(“(x,.Y,U). In the case of matching the “bright” disparity (x, M) we get an spatio-disparity the detection the problem is to detect surface (SDS space image the “bright” disparity curve image) in 2D stereo in the 3D SDS image two conventional the point x’ in I’ and the point (X - u) in I’. By computing E(x, M) the photometric the disparity curve and simultaneously the 1D case where the SDS image is E = 3(x, u). We want a filter which the noise. The disparity from it different filter should be that makes curves such as fingerprints. The disparity curve sensitive Consider can enhance curve has a number of photometric/geometric conventional able to take advantage of these properties. Conventional in this respect. curve detectors prove ineffective properties suppress We will present a new filter which is sensitive to the disparity surface/curve in the SDS image. The filter is quite simple, and can be synthesized filters-a morphological the filter undulations in an effective and efficient way. filter. Unlike conventional it to accommodate filter and a linear the nonlinearity is nonlinear; enables from two conventional curve detectors, surface disparity 1.2. Hierarchical methods Hierarchical methods based on pyramid data structures have been widely used in in stereo matching. Traditional hierarchical for stereo matching are based on the multiresolution representations [6] of the [ 28,291, and in particular, computer vision methods stereo images and thus can be characterized 19,27,3 1 1. Fig. 1 illustrates a pair of pyramids {I:} and {I;} 1: and 1: are respectively performed II. The belief is that by smoothing reduced-resolution the multiresolution paradigm. The first step is to construct for the input stereo images I’ and I’. At the kth level, is is to match Z: and versions of I’ and I’. Then matching in a coarse-to-fine manner. At the kth level, the problem the stereo images matching is simplified. as multiresolution methods [ 1,7,9,10,17, Z Yang, A.L. Yuille/Artijicial Intelligence 78 (1995) 121-145 123 Fig. 1. The multiresolution paradigm for disparity detection. The multiresolution is counterproductive the psychophysical instead, dense scheme, however, the input images stereo information smoothed perspective, by smoothing From to fuse; methods often have difficulty coping with sloping surfaces stereo image points have regularity intensity. But the viewed surface images of sloping Lambertian surfaces have the regularity in the smoothed is fronto-parallel. remains, unless the same is helpful in textured regions stereo pairs are not necessarily for stereo fusion. Moreover, multiresolution for some types of scenes; is also filtered out. easier in the scene. For example, that corresponding images, no photometric texture In this paper we will propose a new hierarchical method for stereo matching called the the disparity representa- in Fig. 2, the hyperpyramid is based on a hyperpyramid to detecting constructed; Bk+t multilevel method. As stated above, stereo matching amounts surface in the SDS image. The multilevel method tion {Bk} of the SDS image B = E( X, y, U) . As illustrated is recursively filter is the surface-sensitive version of z”k. We can envision integration of stereo information integrating regions. Once surfaces { uk} in a coarse-to-fine manner. is a filtered and reduced-size the hyperpyramid filter mentioned above; Bk+t this stereo information we do not assume disparity constancy compute is constructed, we recursively the construction in I’ and I’ over successively-larger of the SDS image hyperpyramid image regions. version of Bk, where the is not a reduced-resolution as the In in the image the disparity 2. The SDS image 2.1. Spatio-disparity space At an image position (x, y), the xyu-space between points a match. the spatio-disparity the disparity value u can be any real number. We call space (SDS) which consists of all possible matches (x, y, U) in the SDS represents in the left and right images. Any point I24 Y Ycmg. A.L Yuille/Arrijiciul Intelligence 78 (I 995) 121-145 Fig. 2. The multilevel paradigm for disparity detection Fig. 3. Lines of sight in the cyclopean SDS We want to investigate the disparity SDS can be defined with respect image. (x + 14/2, y) in th e e t Image, and point In the cyclopean SDS, a point 1 f surface U(x,y) in the context of the SDS. The to the left image or the right image or the cyclopean the match between point (x, y, 14) represents (x - u/2,y) in the right image. is defined by an image point and the corresponding Fig. 3 shows the lines of sight for the left and right views in the cyclopean SDS. (A line of sight In the cyclopean SDS the right lines of sight have a slope of 2 and the left lines of sight have a slope of -2. Of course, constraint the disparity A left line of sight or a right line of sight can intersect with the disparity surface at no more than one point. Fig. 3 shows a profile of a valid disparity surface lines of sight are parallel surface the cyclopean regarding is the uniqueness in the xu-plane. to the u-axis. An important focal point.) constraint: Y Yang, A.L. Yuille/Artijcial Intelligence 78 (1995) 121-145 125 The region between a and b is visible only in the left image and, on the other hand, the region between c and d is visible only in the right image. 2.2. SDS image A point in the SDS represents a match, and the goodness of the match can be evaluated similarity measure. By assigning a numerical value, or intensity, by using an appropriate to each SDS point we get an SDS image. Given a pair of stereo images I’ = I’( x, y) , I’ = F(x, y), the SDS image can be defined by using the sum-of-squared-difference measure. Let Then the intensity of an SDS point (x, y, u) is defined as B(&YTu) = -~wm?)(edb7) - eml)))27 (1) 5.7 where w is a window ruble: w = w( 5,~) = w( 5) w(v) w( ., .) is normalized: Cf,T = 1. function which has the following properties: ; (2) w( .) is symmetric and nonnegative-dejnite; ( 1) w( ., .) is sepa- (3) A more desirable similarity measure intensity the SDS image can be expressed as: is normalized correlation. Based on this measure, P(x,y,u) = C,,w(5,77)81(~,77)er(S,rl) (2) dCr~w(5,rl)(er(~.?7))* CF,ow(5,17)(er(5,71))2’ where 0 < Z(X, y, u) < E,,,,, E 1. This measure has the advantage of being to the photometric distortions position. The results reported from in this paper were obtained using robust the change of viewing this measure. in the stereo pair arising 2.2.1. Problem of ambiguity In the SDS image a point on the disparity a correct match. it represents detected by maximum-picking. left disparity surface, and the right disparity surface are the disparity Ideally The expressions surface will appear “bright”, because in the SDS image can be the for the cyclopean disparity surface, surface U(X,Y) =xgmuax~!"(x,y,u), U’(x,y) = argmU=8(x - u/2,y,u), U’(x,y) =argmUaxS(x+u/2,y,u), (3) (4) (5) respectively. Note that in the SDS image slope of -2 (or 2). the left (or right) view lines of sight have a 126 L: Yang, A.L. Yuille/Arfifcial Intelligence 78 (1995) 121-145 Fig. 4. Problem of local ambiguity. However, this scheme is impractical; along a line of sight, the image intensity B = E(U) may have multiple peaks and the true peak may be overridden by a spurious peak come mainly (see Fig. 4). In other words, from the following l Photometric introduced the existence of repetitive ambiguities. in the stereo pair and variations to image noise lack of intensity source. Ambiguities may result from is ambiguous. Ambiguities in the imaging process. images all contribute the SDS image texture patterns in the stereo two sources: In addition, l Geometric source. pletely neglected-all disparity. In computing the SDS image, geometric distortions image points in the window are assumed are com- to have the same The effect of the photometric source can be reduced by using a large window. By increasing and the effect of image noise can be suppressed. the window size, more image information can be gathered for disambiguation, of the window From the geometric point of view, however, a large window is undesirable. As the size increases, geometric distortions grow. This problem has been addressed is disparity in a small window invariance [ 15,23 1. Indeed, only in large window be used, a correct match may yield an SDS image smaller ambiguities. In short, increasing than Z,,,,,. the window size does not necessarily justified. Should a intensity value much lead to less 2.3. Computation of the SDS image One may want to compute the SDS to evaluate E( X, y. u) for each and every expensive. computationally the SDS image. computing In image directly the definition. That (x, y, u). But this brute force approach from this subsection we will present a fast algorithms is, is for The SDS image defined by (2) can be constructed using one-dimensional convolution operations. Before proceeding terms. to the construction algorithm, we first introduce a few E Yang, A.L. Yuille/ArtQicial Intelligence 78 (199.5) 121-145 127 Local auto-correlation of a two-dimensional tion @(x,y) = (I(x,y))* specified by the window Local cross-correlation of function w. two * w(x, y) , where * denotes convolution, and “local” is image I = Z(x, y) is the convolu- images Z’(x, y), Ir(x, y) is similarly defined: @1,(&Y) *w(x,y). The SDS image defined by (2) can expressed as a local cross-correlation = (Z’bbY)Z’(~~Y)) divided by two local auto-correlations: E(x,y,u) = @rr(x, Yi u) @l(x,Y;u)@r(x,Y;u)' where l @lr( x, y; u) is the local cross-correlation of the shifted left and right images: @rr(x,y;u) = (Z’(~+~/2,Y)Zr(x-u/2,y)) *w(x,y), (6) (7) l @I( x, y; u) , @,(x, y; u) are square roots of the local auto-correlations of the shifted left and right images respectively: @r(x,y;u) = (Z’b - u/zYj)* *w(x,y). (9) Thusforu=ut,u2,us B(.;;u*), well as @&.(.;;u). =“(.;;zQ) ,..., we may compute a sequence of image slices B( ., .; ut j, from @[(., .; u), @,( ., .; u) as ,.... Each image slice is computed The point is that we do not have to compute @l(.,.;u), @,(.,.;u) from (8) and (9) for every u. We observe that (8) and (9) can respectively be written as @r(x,y;u) =@t(x - t+,Y), @,(x,y;u> =@r(x + u/X.Y), where @l(X, Y> = J(Z’(x, Y,)' * W(LY> 7 @f-(&Y> = (z'(x,Y))* *w(x,y). Hence we can precompute @l( ., .) and @,( +, .j and use the computational @p~(.;;u) SDS image defined by (2). and O,.(.,.; u). Fig. 5 illustrates Procedure 1. It, I’ -+ 8. (1) Compute a~,(.,.): @l(X,Y) = (Z”(x, y))* * W(X) *w(y). (10) (11) (12) (13) the shift operation steps for constructing to get the 128 L Yang, A.L. Yiille/Artijicial Intelligence 78 (1995) 121-145 shift Fig. 5. Computing the SDS image defined using normalized correlation (2) Compute @,( ., .): @,(x,.v) = ~(l’(x,Y)* * w(x) * w(y). (3) For each u do the following: (3.1) Compute &(.;;u): @rr(x,y;u) = (Ox +u/2,y)l’(x - u/2,y)) * W(X) * w(y); (3.2) Compute E(.;,u): E(x,y,u) = @lr(& y; u) ~r(x+u/2,Y)~r(x-u/2,Y)' 3. A surface-sensitive filter 3.1. Disparity surface in the SDS image In the preceding images. By computing stereo feature detection. The feature three-dimensional slices L??(x,u) interest is the “bright” disparity curve. the computation section we have discussed of the SDS image from to in the SDS image. An SDS image can be regarded as a sequence of image the feature of the SDS, we reduce to be detected the problem of stereo matching indexed b y y. As far as an image slice is the “bright” disparity is concerned, surface As an image feature, the disparity surface in the SDS image has the following geo- metric and photometric properties: ( 1) Explicit definition. The disparity in B = I”(n, y, u) can be explicitly defined as a function u = U( X, y). In the image slice B = E( x, u) the disparity curve can be expressed as u = U(x), u = U(y). and in the image slice 6” = Z(y, u), as surface Z Yang, A.L. Yuille/Art~cial Intelligence 78 (1995) 121-145 129 the disparity in aerial Thus highways are usually related by implicit functions. curve is more restrictive than conventional curves, e.g. images. For conventional curves the two image coordinates (2) Weak continuity. The disparity surface is continuous borhood OX, of (x, y) most points have similar disparities, in the sense that in a neigh- i.e., U M const. in the physical world, V(5,r)) U(x, y) usually varies slowly with x and y. This property will enable us to distinguish in the SDS image from ambiguous ones. to the cohesive nature of objects the true bright points E OX?.. Due However, the disparity assumption cerned. the disparity surface gradient VlJ(x, y) surface is in general non-flat. Although is often close especially when a large spatial neighborhood in practice to zero, the flat surface is con- is misleading, (3) Equal brightness. The SDS image intensity is close for a point on the disparity not only “bright” but also “equally bright” conventional variations. curve detection surface. In other words, disparity (ideally the curve points usually have considerable speaking). to the upper bound Em,, surface points are in In contrast, intensity to detect As indicated in the last section the disparity otherwise we would be able this To address problem, we employ a filtering based approach. We want to design a filter which can surface. effectively The filter is supposed surfaces simply by maximum-picking. and at the same time, enhance the above properties. to take into account the SDS image is ambiguous; the ambiguity the disparity suppress 3.2. DeJinition of the filter Let &,,, be the receptive field associated with an SDS point (x, y, u). As shown in Fig. 6, O& is a flat cube centered at (x, y, u) . It can be expressed as n X.JU = G!, @ .nU, (14) where @ denotes “direct product”. The size of fiXnxyU is D, x D, x Dd. When applying the proposed from {B(x, y, u): computed the bright disparity surface, (40 8) (x, y, u) is expected filter 4 to an SDS image, (x, y, u) E OXyU}. If OX,,,, happens the response at (x, y, U) is to capture a piece of to be large; otherwise then to be small, even if (x, y, U) was bright before the filtering. If the patch is captured by (4 o 8) (x, y, U) is expected defined on &. the surface patch u = U(x,y) field fiXYU, then it can be detected by using the following formula: Consider the receptive U(5,rl) =m;7xE(5,17,~), (5,rl,~) E f&x,y,u). (15) With the search space limited that we can compute suggests to the vicinity of U, spurious peaks can be avoided. This the response at (x, y, U) in two steps: surface patch defined on a,, that is totally confined within (1) detect a candidate the receptive (2) accumulate field OX,,; neighborhood of the points on the candidate support by adding surface patch. together the SDS image intensities I30 Y Yun,q, A.L. Yuille/Artijiciul Intelligence 78 (1995) 121-145 Fig. 6. The disparity surface and a “receptive field”. The filter is formally defined as follows. Given an SDS image Z = E(x, y, u), the response is (16) where g( ‘, .) is a weighting function which is ( 1) sew-able: g(5,rl) = g(Odrl), (2) symmetric: g(c) = R( -[), ( 3) normalized. In the case of disparity curve detection, 4 is given by and Fig. 7 illustrates tively. The support for (x, u) from 5 is E(Q), by searching - in cc’. the behavior of 4. The two gray rectangles are fi,, and fix,,/ respec- rather than E( 5, u), where Q is found then fin,,,,, captures a surface patch on which the intensity If (x, y, U) lies on the is close The proposed (4 o E)(x,y,u) filter has the following properties: 4 maps one SDS image Z to another SDS image (4 o E). disparity surface, to sm,,x. Hence Lacking neighborhood less bright after filtering. q+ is a nonlinear filter; linear combination nonlinearity z Emax support, spurious bright points comes from the “max” operation. of the intensity the response values in the SDS image becomes (4 o Z) (x, y, u) cannot be expressed as a the field. Obviously, in the receptive K Yang, A.L. Yuille/Art@cial Intelligence 78 (1995) 121-145 131 b_-_---&_---v-b ~cw’) 3.3, Decomposition of the jilter Fig. 7. The nonlinear filter qr5. The proposed filter is in fact a cascade of two well-known subfilters: 4=4s04d9 where the first subfilter C$d takes effect in the disparity domain and is a morphological the second filter; Either of the subfilters focus on them one by one. filter. in computer vision and image processing. Let in the spatial domain and is a linear is widely used subfilter 4s takes effect (1) Disparity domain 8,,(u) dilation subjilter 4d. For each fixed (x, y) we have a 1D image = a(x, y, u). Applying +d amounts [30] of ZXs (u) . Let e be the following to computing structuring the morphological element: e(u) = 0, if -Dd/2 < 1.4 6 Dd/2, 1, otherwise. i Then the response to this subfilter is (4d o 2”) (x, y, u> = E,,(u) CD e(u) = ~CLE,“-D?/l~U+D&l B(X,Y,Pu), (17) (2) where x and y are dummy variables. Spatial domain subjilter &. Let F( x, y, u) = (+d o 8) (x, y, u) . For each fixed u we have a 2D image 3; (x, y) = 3(x, y, u) . Applying 4s amounts to convolving Fu,(x,y> with g(x,y>: (4, om(x,Y,u) =3u(x,y) *g(xvY) = c s(!k x,7- Y).v5,%k 1 (18) (6Jl)EfL where u is a dummy variable. 132 Y Yang, A.L. Yuille/Art@ciul Intelligence 78 (1995) 121-145 From ( 17) and ( 18), we can easily verify that 4s o 4d is indeed 4. Therefore, 4 first in the in the disparity direction and then, convolution computes morphological spatial directions. Note that 4d precedes &; dilation the order cannot be reversed. provides an efficient way of applying 4. Obviously, the definition The decomposition 4oE to the from directly in the disparity direction decomposition, we can first compute and the 2D spatial the way, the convolution convolution with ~(x, y) can be computed by using ID convolution operations, because x is assumed dilation the spatial directions. By (16) the morphological expensive. Thanks is computationally to be separable. calculating along then, 4. Multilevel surface enhancement 3.1. SDS image hyperpyramid We have proposed a nonlinear the disparity in the SDS surface filter for enhancing that needs to be addressed concerns the scale of the filter. On the one field should preferably be big so as to capture a large surface patch for disambiguation. On the other hand, In this filtering solution. The idea is to apply a sequence of image. A problem hand, the receptive so that sufficient a big receptive section we will present a recursive successively bigger filters to the SDS image, which is equivalent the same filter and shrinking of the image. The result to successively applying to that image information field would complicate the scale of the filter is related the use of the weak continuity the image, because of the SDS image. is a hyperpyrumid representation can solicited assumption. Given an SDS image E, the hyperpyramid {En*} is defined as E,;,,(-t-> .v, u) = (4 0 En,_1 )(2~,2y,2u). Vm > I, (19) Z,(x,?‘,u) =E(x.?‘,14). Conceptually, down-sampled filter, as well as the down-sampling constructing Enl from Enr- 1 involves is then by a factor of 2 in all the spatial and disparity directions. Note that the first applying 4. The result factor, is level-independent. 4.1.1. Nonlinearity of the hyperpyramid the Gaussian pyramid, Unlike m > 2, cannot be computed is for defining hyperpyramid the SDS image hyperpyramid is nonlinear. Clearly Z,,E, in closed form; they are recursively defined. The from Et ,Z,,,, rather than merely for speeding up computation. Let us interpret what Z,,, (x, y, IL) measures. We know that B(x, y, u) measures the confidence that (x, y, u) is on the disparity surface. In &, a point (x, y, u) corresponds to (X’,Y’,U’) = (X/2,Y/2,ll/2) m E;, and Ez( X, y, u) measures (x’. y’, 14’) of size the confidence that in 8, the “receptive field” of IPiY,,~ I = Ds x Ds x D~I captures a patch of the disparity surface. E Yang, A.L. Yuille/Artijkial Intelligence 78 (1995) 121-145 133 Fig. 8. Receptive fields in the m-space. Generically, a point (x, y, u) in E,,,, m > 2 corresponds to (x’, y’, u’) = (2-“‘+lX, 2-“‘fly, 2-mf’u) m E, and E,,,(x, y, u) measures (x’, y’, u’) of size the confidence that in 8, the “receptive field” of Iq!;,l,,l = 2m-2D, x 2*-=Ds x 2m-2Dd captures a patch of the disparity surface. Fig. 8 shows a disparity curve u = U(x) and a number of receptive fields represented in the figure is denoted 01 which is comprised of four by rectangles. The big rectangle subrectangles Rii, 012, L43, and L$4, where Fiji is located at the ith quadrant of 01. The subrectangle The receptive 011 again has four subrectangles fields 0111, 0113, 0131 and fit33 all capture disparity curve segments. in EZ are “bright”. Since 011 captures 0111 and f&33, to a looks “bright”. By the same integrated, E2 is Thus the corresponding “bright” point in 83. With information less ambiguous about the disparity curve being than &. than Bi and 33 is less ambiguous 0111, f& 12,Q 13, RI 14. token, 013 projects the corresponding points in Es point 4.2. Computing the hyperpyramid In the following we will present an algorithm pyramid. The algorithm and local maximum-picking. is simple and efficient; for computing the SDS image hyper- the basic operations are 1D convolution 4.2. I. Receptive In constructing field size the SDS hyperpyramid, we need to determine of 4 or the size of the receptive two parameters D, and Dd. Their ratio D,/Dd We found that the ratio is around 5.5. field I.&,] = D, x D, x D,. The receptive the size of the support field has is a constant determined by experiments. 134 Y. Yang. A.L. Yuille/Artijiciul Intelligence 78 (1995) 121-145 The receptive field is not allowed Otherwise, 4 = & 0 q&r degenerates in the disparity direction. to contain only one pixel in the disparity direction. to 4%. The minimal receptive field contains 2 pixels With the use of the minimal receptive field, Z”, (x, y, U) can be rewritten as follows: E,,,(x.v,11) =Xx(&x,7-.v) c.7 max 8,,_1(2x,2y,2u+~). /L={O.I} (20) where along The minimal the u-direction receptive the indices of pixels start from zero. field principle leads to computational results. On the one hand, in computing Zl is respected. On the other hand, recursive filtering enables us to eliminate remaining from E:I = E the weak continuity in E2. efficiency and gives good constraint the ambiguities 4.2.2. Compututiorr We know that 4 can be realized by cascading time. Then we apply E,,, from E,,,_r . we first apply at the same directions. Applying Since g(x, y) = g(x)g(y) using 1 D convolution operations. the subfilter d+ amounts is separable, the subfilter & and down-sample the subfilter & and down-sample to convolution the two subfilters & and &. To derive in the u-direction the spatial the kernel g( x, y). can be computed efficiently using the 2D convolution in Fig. 9 shows the locations of the nodes of Z,,, relative to those of Z,+r. The nodes of E,I,_r are represented by “o”, and the nodes of E,,, are represented by “0”. Computing Y Yang, A.L. Yuille/Artijkial Intelligence 78 (199.5) 121-145 135 Table 1 Sizes of the intermediate zm-_1= images I___ -_ size AxAxB -__+ c: AxAx: s--f+ Ax$xf ,-+++ = E,,, +x+x: +++9+++@+++$+$+ 000000000000000 ++++9++$+++~++$ 000000000000000 +@+~+~+~++$$+~9 000000000000000 +++++@+@+++9+$+ 000000000000000 +++++4J+@+++o+@+ 000000000000000 +~+~+~4@+~+~+$$ 000000000000000 +++@+@+++++++4+ 000000000000000 +++++++9+++@+9+ Fig. 10. Sampling the spatial domain. where A x A x B, then intermediate - denotes pre-decimation and + denotes post-decimation. the sizes of a--+, and E,,, are as shown images are explained E-++ as follows: Suppose Z,,_r is in Table 1. These 0,’ ---+(x,y,u) issimplythemaximumofZn,_t(x,y,2u) andE,,_r(x,y,2u+l). y) = E--+ (x, y, u), where u is a dummy variable, are The nodes of E--+(x, shown as “0” in Fig. 10. is the convolution l P-++ marked by “I” in Fig. 10. It is worth emphasizing and then down-sampling, we compute ,-+++ = En, locations marked by “-” is the convolution in Fig. 10. of E-++(x, . of a--+ (x, y, u) and g(y), computed at the locations that, instead of first convolving the convolution at predefined locations. y, u) and g(x), computed at the The procedure for constructing the SDS image hyperpyramid is as follows. Procedure 2. B --t {a,,,}. Initialize: m = 1; En, = 8. (1) (2) Increment: m +- m + 1. (3) Compute z”,, from - S”,-_1: z--+tx,y,u) =~~~~~n,-ltx,Y,2u+cL), g-++(X,Y,U) = p-+ (KY*U) *g(Y))wY~u)~ E”*(x, y, u) = (z-t+ (x,y,u) *gw)wyJ4. (4) If m < A4 go to Step 2; otherwise stop. Y Yang. A.L. Yuille/Artifcial Intelligence 78 (1995) 121-145 Fig. I I “Parking meters” and results. The above procedure is simple and computationally efficient. Computing tensity E,71(~, y, u), m > 1, involves only ations. Moreover, E--+ spect to (x, y, u). Similarly, a-+’ Z++ ( X, y, u) , V( x, y, u) can be computed (x,-v, u) can be computed in parallel (x, y, u), V( x, y, u) can be computed three one-dimensional in parallel. an convolution in- oper- from En,_1 with re- in parallel, and 4.2.3. Results The effectiveness of the surface-enhancing strated by experimental 1 l-1 3. The first rows ing meters” (obtained Topographic Engineering Center), positioned results. Typical filter and the multilevel is demon- in Figs. in these figures show the input stereo pairs, which are “park- at the U.S. Army by T. Kanade at CMU), respectively. The stereo images are images are shown and “Pentagon” for outdoor “Denver” (obtained scheme results side by side to facilitate human stereopsis. For each stereo pair an SDS image was computed using the normalized correlation measure. Then a three-level computed at the three levels using maximum-picking. rows of Figs. 1 I-13 as intensity these results were obtained using are reduced as we go from one level to the next, coarser hyperpyramid was constructed. The disparity maps were The results are shown in the second represented by brightness. All images, with disparity the same parameters. As we can see, the ambiguities level. Y Yang, A.L. Yuille/Art@cial Intelligence 78 (1995) 121-145 137 4.3. A degenerate case Fig. 12. “Denver” and results. Consider the degenerate case that in the u-direction the receptive one pixel. In this case, #d reduces &, and the SDS image hyperpyramid to the identity operator and 4 = 4s o & reduces field contains only to becomes a linear hyperpyramid. Suppose that the SDS image is defined from Zz by U(x, y) = arg max, E2 (x, y, u) is equivalent the disparities region matching approach detecting classical D,; and (2) detecting using a large, 2m-2 D, x 2m-2D, window. Note that implementation multiresolution method can be based on the degenerate SDS image hyperpyramid. from g,,,, m > 2, is equivalent to stereo correspondence, the disparities ( 1) to the the region size being D, x to region matching of the coarse-to-fine in terms of intensity difference. Then 5. Multilevel surface detection 5. I. Coarse-to-jne approach In the preceding section we discussed the computation of the SDS image hyperpyra- mid. In this section we address hyperpyramid. the problem of computing disparity surface from the Fig. 13. “Pentagon” and results Fig. 14. Block diagram of inter-level recursion. We address this problem using a coarse-to-tine in the SDS image at the coarsest approach. We first detect the disparity level. then in the SDS image at the next, finer the finest level is reached. In this way, a sequence in this order. When detecting U,,, in E,,,, is repeated until , lJ2, iJI are generated, surface level. This process of of surfaces UM, . nz < M, the information Computing U,,,, m < M involves provided by U,,,+l is utilized. two steps: one updating, as shown expanded version of I!./,,-,, The updating step can proceed one may employ a Bayesian in Fig. 14. The prolongation approach [ 3 11 and modify U,; is prolongation operation produces UH; which and the other is is an in many ways. For example, to minimize iteratively Y Yang, A.L. Yuille/Artificial Intelligence 78 (1995) 121-145 139 50 04 40 03 30 02 20 01 lo 00 00 0 El 0 Cl 0 0 0 cl 0 cl 0 0 0 0 0 0 cl 0 0 0 0 0 0 El 0 cl 0 ISI 0 0 0 El 0 -X 0 El 0 0 0 El 0 0 0 El 0 0 El 0 El 0 0 0 0 0 cl 0 0 El 0 Cl 0 El 0 Cl 0 ISI 0 U t Fig. 15. Spaces of (I,;; and E,-,n. some error functional. But this approach shown, non-iterative way. the hyperpyramid allows us to detect is computationally the stereo disparities inefficient. As it is to be in a recursive but 5. I. 1. Prolongation In proceeding from one level m+ 1 from the next level m, the first step is to prolongate U,,,+l to derive a rough estimate U,T of the disparity derive U,T is to use bilinear interpolation. the grid points of Em+,, Fig. 15 illustrates surface in E,,,. A simple way to represented by l , and those of Em, represented U,; (x, y) can be expressed as by o. If x and y are even, then U; (x, y) = 2U,,,+l (x/2, y/2). Generically, U,T(X,Y) = @ln,l( rx/21, IYPl) + Q?l+l(rx/21~ [Y/21> +u"I+l(l~/21~ IYPl) + Um+l( lx/219 lY/21))* (21) where 1 1 and 1 1 denote “ceil” and “floor” respectively. The right-hand side of (21) may yield a non-integer when both x and y are not even. We let U; (x, y) be the integer closest side value. In other words, integer interpolation to the right-hand is performed. The possible locations of U,T (x,y) are represented is a superset of that of U n,+l (x, y), which CJfl; (x. y) (x, y, U,;; (x, y) ) is not a grid point of Z,,, represented by o. by 0 is represented in Fig. 15. The space of that by l . Note 5.1.2. Updating Once U,T has been obtained via interpolation, the updating step that computes U,,, can by to the voxels of S,,, (represented by 0). To locate 17, (x, y) we may search Fig. 15 shows the locations of U; (represented simply be local maximum-picking. 0) the following 2k squares: relative U={U,T(x,y) - (k-l),..., U,T(X,Y) +k- l,U,-(X,Y) +k)* (22) 140 Y Yang, A.L. Yuille/Arti$cid Intelligence 78 (1995) 121-145 m=l m=2 m=3 6 Fig. 16. Tree search in the coarse-to-fine sweep C D the disparity where expressed as: indices of lJ,;; and E,,, start from zero. The local search can be U,,, ( x, y ) = arg rn:; H,,, ( x, y, p ) (23) In order to avoid ambiguous peaks, k in (22) has to be small. Possible choices k = I and k = 2. include level Obviously k = I or Z4 = {U,; (x. y) , U,; (x, y) + I } is infeasible. If k = 1, then the level. In Fig. 16, A accuracy at the finest the search of represents the binary in St, then it can never be reached by the binary search. In fact, all the nodes to the right of node C cannot be reached. We let k = 2, which the disparity of a point tree search rooted at A. If D the true disparity of the point by that at the coarsest in E3. Note that k = 1 implies is determined (x, y) implies a 4-ary (4x,4y) tree search. In Fig. 16, the four children of A is taken to be the disparity of the point are compared and the one which is the brightest (2s. 2~) the four children of B are visited and the winner Z, in E2. Suppose that B is the winner. As we proceed from level 2 to level 1, in the disparity of (4x,4y) locates In other words, U,;; specifies a local search space LI,,, = {U,;(x,y) - l.U,(X,Y),U,(X,V) + l,U,;(X,.v) i-2}, and the updating step performs maximum-picking: Now it become clear why we used integer by (21 ). Indeed, U,; (x, y) 15) among which the maximum is used to identify is to be picked. interpolation the four points in computing U,; from Un,+t (or the four OS in Fig. 5.2. Computatioti The disparity surface is computed from the SDS image pyramid in the following steps. E Yang, A.L. Yuille/Art$cial Intelligence 78 (1995) 121-145 141 ProceduN?3. {Zm}-+U. (1) Initialize: Let m = M and compute U,,(x,y) =a~mj=Z~(x,y,u). (2) (3) Recurse: Decrement m +- m - 1. (2.1) Prolongation: Compute U; (2.2) Updating: Compute U,, using Terminate: (24). from U,+i using (21) . If m > 1 go to Step 2; otherwise let U = U1 and stop. The above procedure is simple and efficient. The basic operation is maximum-picking level-recursive, with no that such a simple algorithm produces good is coarse-to-fine from a 4-element intra-level results. set, and control structure iterations. We will demonstrate 5.3. Results In this subsection we will present from SDS image hyperpyramids the simple method described by Procedure CtF2 gives good results. All the disparity values are accurate [ 351). We will demonstrate the results of computing disparities that (for details, to 1 pixel. see Figs. 17- 19 show the disparity maps for “parking meters”, “Denver”, and “Pentagon”, respectively. By comparing Fig. 17 with the second row of Fig. 11 we can see that local search is effective in resolving Fig. 17 shows that the algorithm has captured ambiguities. the three parking meters in front of the the second and the third shrubberies, parking meters, and the large depth gap between the side view of the signboard which is between the front and the building. Fig. 18 shows that the general relief of the terrain roof structure is well recovered. Moreover, is recovered. Fig. 19 shows that the road and overpass on the side of the scene is well modeled. The results for “Denver” and “Pentagon” the multiresolution to those obtained by Hsieh et al. [ 121 using favorably the complex right-hand compare method. Fig. 17. Results for “parking meters”. 142 E Yang. AL. Yuille/Artijiciul Intelligence 78 (1995) 121-145 Fig. 18. Results for “Denver” Fig. 1’9. Results for “Pentagon” The results shown in Figs. 17- 19 are represented with respect disparity maps. We can also obtain they are the cyclopean the right disparity maps the left disparity map U’ and the (negative) In other words, disparity maps and 20 shows 20 (lower-right) regions were detected by checking visible points, U/(x. y) - U’(x - U’(x, y), y) z 0. Fig. 20 (lower-left) disparity map with the left-visible regions being shown in black. the regions visible (4) and shows (cf. from the left camera only. The left-visible the consistency between U’ and U’. (For binocularly to the cyclopean view. the left (5)). The first row Fig. right disparity map -lJ’. Fig. shows the left 6. Summary and concluding remarks The notation of spatio-disparity space, or xyu-space, to the commonly used notion of matching (x’, x’, y) represents a match between It is related each point the right is very useful for stereo vision. space, or the x’x’y-space, where (XI, y) in the left image and ( xr, y) the output of the stereo image. The SDS representation is desirable because Y Yang, A.L. Yuille/Art$cial Intelligence 78 (1995) 121-145 143 Fig. 20. Results of occlusion detection for “Pentagon”. in the left and right images. of stereo information the SDS image, we reduce algorithm gives the disparity as a function of the spatial position. The SDS image useful representation By computing to feature detection, where the feature is the disparity surface in the SDS image 3 = Z(x, y, u), or the disparity curve as feature detection. For example, be formulated Z(x, y, u) where of image and (x, y) - u/2 image matching can be formulated flow U = U(x, y) can of optical in the spatio-velocity space image B = in the first frame in B = I”( x, y) . In fact, generic the computation as the detection of u = U(x, y) the problem of stereo matching in the second frame. the match between (x, y, u) denotes (x, y) + u/2 is a We have proposed a filter q3 for detecting the disparity surface in the SDS image. By is enhanced and the noise is suppressed. The design of and geometric attributes of the disparity surface. Unlike the photometric feature detectors, 4 is nonlinear by nature. The nonlinearity surface applying q5, the disparity 4 has exploited many common neat way for accommodating a novel morphological simple and efficient computation filter and the disparity filter per se, 4 can decomposed surface undulations into provides a or nonlinearities. Being two subfilters, one of which being a to filter. This decomposition leads the other being a linear of disparity surface enhancement. The multilevel paradigm for stereo matching can be described as a fine-to-coarse pro- cess followed by a coarse-to-fine process. In the fine-to-coarse sweep stereo information 144 Y Yang, A.L. Yuille/Artificiul Intelligence 78 (1995) 121-145 in an attempt is accumulated surface-enhanced a sequence of successively to-fine sweep, surface finer level. This line-to-coarse-to-fine intra-level the disparity iterations. to remove ambiguities. The SDS hyperpyramid provides versions of the SDS image. In the coarse- is detected at each level and is refined at the next, involving no is computationally efficient, process To conclude, the multilevel method proposed here provides for computing stereo disparities. In addition to applications a novel hierarchical in cartography the multilevel biological mechanism algorithm may shed light on the understanding of human stereo vision. of the paradigm and robot vision, underlying Acknowledgment We are grateful Brockett, Petros Maragos, Song De Ma, and Jie Lu for invaluable also thank anonymous presentation to David Mumford and Jim Clark for their insights. We thank Roger discussions. We the comments which greatly enhanced for constructive of this paper. reviewers This work was supported in part by the Brown/Harvard/MIT Center for Intelligent Control Systems with U.S. Army Research Office grant number DAAL03-86-K-0171. References stereo, framework and an algorithm in: Proceedings IJCAI-RI, for the measurement of visual motion, Int. J. stereo matching over scale, fn/. J. Compuf. Vision 2 ( 1989) 17-32. P. Anandan, A computational Conz/~t. Vision 2 (1989) 283-310. H.H. Baker and T.O. Binford, Depth from edge- and intensity-based Vancouver, BC (1981) 631-636. ST. Barnard, Stochastic ST. Barnard and M.A. Fischler, Stereo vision, in: SC. Shapiro, ed., Encyclopedia ofArfr@cial Infelligence (1987) 1083-1090. P.N. Belhumeur half-occluded (1992). P.J. Burt, Fast filter transformations (1981) 20-51. SD. Cochran and G. Medioni. 3-D surface description Mach. Intell. 14 ( 1992) 981-994. problem using in: Proceedings IEEE Conference on Computer Vision and Pattern Recognition for image processing, Comput. Vision Graph. Image Pmcess. 16 treatment of the stereo correspondence stereo, fEEE Truns. Patfern Awl. and D. Mumford, A Bayesian from binocular regions, j 8 1 W. Forstner and A. Pettl, Photogrammetric Stundard Methods and Digital Image Matching Techniques .fiir High Precision Surface Measurements (Elsevier Science Publishers B.V., Amsterdam, 1986). I 9 I W.E.L. Grimson, Front IntaRes to Surfaces (MIT Press, Cambridge, MA, 1981). 1 IO 1 M.J. Hannah, A system Sensing 55 (12) (1989) 176.5-1770. for digital stereo image matching, Photogrammetric Engineering and Remote III I W. Hoff and N. Ahuja, Surface from stereo: integrating feature matching, disparity estimation, and contour detection, IEEE Trans. Pattern Anal. Mach. Intell. 11 (2) (1989) 121-136. 1 I2 I Y.C. Hsieh, D.M. McKeown Jr and EP Perlant, Performance evaluation of scene registration fEEE Trans. Pattern Anal. Mach. Intell. 14 (2) and stereo ( 1992) matching 214-238. for cartographic feature extraction, I I3 I D.G. Jones and J. Malik, Determining three-dimensional shape from orientation and spatial frequency disparities, in: Proceedings Second European Conference on Computer Vision, Geneva, Italy ( 1992). I14 I B. Julesz, Foundations of Cyclopean Perception (The University of Chicago Press, Chicago, IL, 197 1) Y Yang, A.L. Yuille/Artifcial Intelligence 78 (1995) 121-145 145 [ 151 T. Kanade experiment, (1991) 1088-1095. theory and and M. Okutomi, A stereo matching in: Proceedings International Conference on Robotics and Automation, Sacramento, CA algorithm with an adaptive window: [ 161 T. Kanade, M. Okutomi and T. Nakahara, A multiple-baseline stereo method, in: Proceedings DARPA Image Understanding Workshop ( 1992) 409-426. [ 171 B.D. Lucas, Generalized image matching by the method of differences, Ph.D dissertation, Carnegie- Mellon University, Pittsburgh, PA ( 1984). [ 18 1 D. Marr, Vision (Freeman, San Francisco, CA, 1982). I 191 D. Marr and T. Poggio, A theory for human stereo vision, Proc. Roy. Sot. Lond. B 204 (1979) 301-328. 1201 L. Matthies, Stereo vision for planetary I2 1 J HP Moravec, Obstacle rovers, Int. J. Comput. Vision 8 (1) in the real world by a seeing and navigation (1992) 71-91. rover, Ph.D. avoidance robot dissertation, Stanford University, Stanford, CA (1980). 1221 Y. Ohta and T. Kanade, Stereo by intra- and inter-scanline Trans. Pattern Anal. Mach. Intell. 7 (1985) 139-154. search using dynamic programming, IEEE [23] M. Okutomi and T. Kanade, A locally adaptive window for signal matching, Int. J. Comput. Vision 7 (2) (1992) 143-162. 1241 M. Okutomi and T. Kanade, A multi-baseline stereo, IEEE Trans. Pattern Anal. Mach. Intell. 15 (4) (1993) 353-363. 1251 T. Poggio, V. Tone and C. Koch, Computational vision and regularization theory, Nature 317 ( 1985) 314-319. [ 261 S.B. Pollard, J.E.W. Mayhew and J.P. Frisby, PMF: a stereo correspondence algorithm using a disparity gradient limit, Perception 14 (1985) 449-470. [ 271 L.H. Quam, Hierarchical warp stereo, in: Proceedings DARPA Image Understanding Workshop ( 1984) 149-156. [ 281 A. Rosenfeld, ed., Multiresolution Image Processing and Analysis (Springer-Verlag, New York, 1984). Inform. Sci. 50 ( 1) (1990) 1291 A. Rosenfeld, 23-34. ed., Pyramid in images, for global algorithms structures [ 301 J. Serra, Image Analysis and Mathematical Morphology (Academic Press, London, 1982). 1311 J. Weng, N. Ahuja and T.S. Huang, Matching two perspective views, IEEE Trans. Pattern Anal. Much. Intell. 14 (8) ( 1992) 806-825. 1321 C. Wheatstone, On some remarkable, and hitherto unobserved, phenomena of binocular vision, Philos. Trans. Roy. Sot. 128 ( 1836) 371-394. [ 331 A. Witkin, D. Terzopoulos and M. Kass, Signal matching through scale space, Int. J. Comput. Vision 1 (1987) 133-144. ]34] Y. Yang, A.L. Yuille and J. Lu, Local, global, and multilevel stereo matching, in: Proceedings IEEE Conference on Computer Vision and Pattern Recognition (1993) 274-279. [ 351 Y. Yang, Multilevel computation of stereo correspondence, Ph.D. Thesis, Harvard University, Cambridge, MA ( 1994). 