ELSEVIER Artificial Intelligence 78 (1995) 213-238 Artificial Intelligence Understanding positioning from multiple images Roger Mohr ‘, Boubakeur Boufama2, Pascal Brand 3 Lifa-lnria, 46 avenue F&.x Kallel, 38031 Grenoble Cedex, France Received October 1993; revised December 1994 Abstract structure of a scene using only correspondences It is possible images to recover taken with uncalibrated the three-dimensional cameras transformation (faugeras 1992). The reconstruction obtained between of the 3D space. However, this kind this way is only defined up to a projective of structure allows some spatial reasoning such as finding a path. In order to perform more specific reasoning, or to perform work with a robot moving in Euclidean space, Euclidean or affine constraints have to be added to the camera observations. Such constraints arise from constraints on lines, etc. First, this the knowledge of the scene: it discusses how the framework of paper presents a reconstruction method projective geometry allows symbolic or numerical to be derived, and how knowledge Implementation about the scene can be used for computing issues and experimental results are discussed. location of points, geometrical then information about positions symbolic or numerical for the scene, relationships. 1. Introduction I. 1. Motivation In the late seventies, Artificial interpretation. image of image relations between for instance Expressing izontally. More complex hard to define, as an image [4] ) reduce such a relation the labelling implicitly relationships Intelligence techniques were introduced Symbolic features. For instance, knowledge was introduced constraints during possibilities into the field by means of geometric (see process. forward hor- they are like above(sky, the interpretation is looking tree) assumes like inside may also be used, however that the camera is only a 2D projection of the 3D scene. 1 E-mail: mohr@imag.fr. * Current address: mpartement d’Informatique, Universite de Moncton, Moncton, New Brunswick, Canada ElA 3E9. E-mail: boufama@clement.info.unmoncton.ca. 3 E-mail: brand@imag.fr. 0004-3702/95/$09.50 SSDIOOO4-3702(95)00035-6 0 1995 Elsevier Science B.V. All rights reserved 214 R. Mohr et trl. /Artificial Intelligence 78 (1995) 213-238 The goal of this paper is to show how geometry provides a set of basic tools for computing numerically what is often implicit geometric knowledge and inside. symbolic relationships, and to make explicit and computable in such relationships. The framework will point out the kind of like above that is needed and how to explicitly compute relations From a single it is very hard to derive 3D relationships image is to use high level alternative framework allows high level reasoning, but on the other hand for this reasoning plementary outputs are mainly numerical 3D information in the scene. An in [7,29]. This required to the domain considered. Such approaches are com- and the to the one presented here: we use very little a priori information and some simple symbolic of the scene as is done is very specific the knowledge relationships. interpretation This paper presents a general way for expressing geometrical such as 3D relationships information to compute how observed in the images. Such numerical computations by at least two cameras and the points are matched we allow the burden of calibration. change, the field of active vision. the camera position and orientation the uncalibrated framework constraints between geometrical assume in the different and shows features that the scene is observed images. However, to be unknown. This allows us to avoid the focus and aperture in be placed Since camera parameters vary when that we outline here can conveniently It was shown in [6, lo] (i.e. non-metric is possible. The reconstruction of the 3D projective eras a collineation struction past few years. Projective However, space can be seen as a constrained provided. Euclidean information based comparison tries). and relationships relationships information that reconstruction of the scene with uncalibrated has no metric space. However, cam- is defined up to the use of this kind of recon- in the cross ratio, etc. like parallelJo, midpoint&f are affine properties. Since affine space, additional knowledge needs to be information), space allows us to talk about collinearity, has received more and more attention projective and space can be seen as a constrained is needed yet more knowledge must be provided between projective, affine space, so if Euclidean (see [ 141 for an invariant geome- affine and Euclidean 1.2. Outline Projective, affine and Euclidean geometries in Section 2. Firstly we introduce They are introduced are needed, and then, show how projective least squares approach. An outline of this approach was presented new results on real images are discussed, aspects of the method. reconstructions illustrating form the basic framework of this paper. tools that the in [ 201. Here, some can be obtained using the basic geometrical both qualitative and quantitative Next, we consider different relationships between geometric entities. We will show that than just projective space contains more in projective done in fact the reconstruction information. possible affine information relation needs additional to compute In fact, so called quasi-affine information some qualitative affine relationships is not enough information for some precise relationships. about the vertical direction. is available, from which it is and convex hulls. However, For instance, above R. Mohr et al. /Ar#cial Intelligence 78 (1995) 213-238 215 This leads to a hierarchy of geometrical knowledge which allows us to define sets of symbolic relationships. knowledge affine geometry, geometry of similarities can be considered Classical 19th century geometry describes a hierarchy of embedded geometries: pro- geometry. the con- a jective geometry, However, other non-standard servation of convexity particular direction From a practical point of view, this hierarchy of geometries corresponds of constraints provided reconstruction geometry. to a hierarchy can be the general geometry, while preserving sub-tine on the perceived from a priori knowledge, scene. Section 3 shows how these constraints and Euclidean too. For instance leads to the notion of quasi-alone and how they can be integrated like the vertical direction leads to a particular framework. into Section 4 presents reconstruction mediate spaces. Finally, we discuss results and examples of computations issues raised by the present work. in the inter- 2. The geometrical framework 2.1. Introduction to projective geometry the reader with the geometrical background to under- This section aims at providing stand the remainder of the paper. the image formation We model system as a pure perspective projection, systems. Sometimes model we adopt is the pinhole model. This is a good approximation acquisition [ 3 11, and if a very high accuracy necessary in order to simulate this model has to be corrected is needed more sophisticated [ 171. It has to be mentioned the pure pinhole model. that these last models mainly correct of existing i.e. the camera image for radial distortion correction methods are the image and therefore provides clear understanding We will present a short introduction Projective geometry deals elegantly with the general case of perspective projection of the geometric aspects of image formation. and vocabulary of projective geometry. The reader is referred to [ 251 for a gentle introduction or to [ 151 for advanced vision oriented considerations on projective geometry. to the definitions Projective space Consider the (n + 1 )-dimensional space Wn+’ - { (0, . . . , 0) } with the equivalence relation: (XI,...,x,+I) N (x’, ,... ,x;+~> iff 3A # 0 such that (x’,, . . .,x;+,) = A(xl,. . . ,xn+l). (1) The quotient space obtained Thus the (n + 1) -tuples of coordinates in the projective same point from this equivalence (xl,. . . , .x,+1 ) and (xi,. relation is the projective space P”. . . , XL,, ) represent the coordinates. space and are called affine space A” is mapped the homogeneous into P” through the correspon- The usual n-dimensional dence ?‘: 216 R. Mohr et al./ArtiJicial Inielligence 78 (1995) 213-238 P: (x I,..., x,) --f (x ,,..., x,,l). (2) and Note that p that only is a one-to-one mapping . . ,A-,,, 0) are not reached. the points ly provides us with an understanding by of the points it space; if we con- (yt , . . , y,,, 0) as the limit of (yt , . . . , y,,, A) while h -+ 0, i.e. the limit of in the direc- . , y,,, 0) as the “point at infinity” (xl,. (XI >. . . ,x,, 1) which can be viewed as the usual point also provides us with an intuitive understanding sider ( yt /A, . . tion (yt,... (or ideal point) , y,/A, 1). This is the limit of a point in W” going to the infinity , yn ). Therefore, we can consider (yt , . of the remaining in this direction. the Euclidean represented points: in A hyperplane H in P” is defined by a homogeneous (n + I)-tuple of coefficients, H = (a,,. . , anfl ) . This defines the set of points whose coordinates satisfy ,,+ I c U;Xi = HXr = 0. A particular points at infinity. case is the ideal hyperplane x,+1 = 0: this is the hyperplane with all its A collineation or projective transformation (n + 1) x (n + 1) matrix W such that the image of (XI,. . . ,xn+l) from P” into P” is the mapping defined is by a full rank defined in the usual way by: Since the column Therefore, a collineation vectors are defined up to a scaling factor, the matrix W is too. has (n + 1) x (n + 1) - 1 degrees of freedom. space P” A basis of a projective is given by n + 2 points, of which no n + 1 lie in the same hyperplane. The canonical . . ., ( 1 , 1, . . . , 1). For the regular 3D pro- (0, 0, , 0, 1) augmented with the “unit point” jective spaces, these four first points are the point at infinity on the x-axis, on the y-axis, on the z-axis and the origin, basis usually chosen respectively. is (i,O,. . . ,0), A standard affine transformation maps easily into the projective the general case an affine transformation and a linear transformation is then defined by the matrix: in A3 is defined by a translation (3 x 3 matrix) M on 3D vectors. The associated collineation transformation. In t = (a, b, c), that Notice Conversely, transformations. in this case each point at infinity is mapped onto a point at infinity. all collineations mapping points at infinity onto points at infinity are affine R. Mohr et al. /Artijicial Intelligence 78 (1995) 213-238 217 ideal point L- I A - I B Fig. 1. Two points A and B on a projective line define two segments from P” into Pk is defined by a (k + 1) x (n + 1) full the space P3 case is the perspective projection which maps A projective transformation rank matrix. A particular into the image plane P2. It has to be noted that the addition of the hyperplane the first segment can be seen as the usual segment joining topology of the space. For instance, two segments: in a standard affine space, the second one is the segment passing a closed curve two segments (see Fig. 1) . Since the ideal points are unknown linking the two points don’t define a unique segment but define the two points too but as space, the the two points line is often represented through an ideal point. For this reason a projective two points are equivalent. of ideal points changes in projective joining The basic projective invariant is the basic The cross-ratio invariant in projective geometry: all other projective invariants can be derived from it [ 51. Theorem . Let A, B, C, D be four collinear points, their cross-ratio is defined as: [A,B;C,D] = g x g; (3) this cross-ratio is invariant under any collineation. The notation AC stands was already established projective space using for the algebraic measure of the segment AC. This result to by the ancient Greek mathematicians. It can be extended the following computational rules to deal with infinity: 00 - = 1, 00 a - =o, 00 ca --CO. a This points, So, three points theorem has an immediate for locating a point on a line. Given 3 the position of the fourth is uniquely defined by the cross ratio of the four points. application form a projective basis for the projective line. 2.2. The reconstruction method scene Usually Unfortunately, if a calibration reconstruction in many applications pattern is not available or if the camera requires a prior step: it is not possible the calibration to calibrate on-line, of the camera. for example, An alternative either knowing approach their absolute is to use points coordinates is involved tasks. in the scene as a reference frame without or the camera parameters. This has been in visual 218 R. Mohr et al. /Artificial Intelligence 78 (1995) 213-238 investigated by several researchers or affine shape 1271. in the past few years using projective geometry [ 181 Under researchers similar methods methods do not deal with the perspective projection case. of parallel projection or orthography hypothesis, many other for shape recovery, but these have developed the hypothesis [ 11,12,30] Using standard tools of projective geometry, Faugeras [ 61 developed a reconstruction method from perspective views. He demonstrates dimensional only up to a collineation, i.e. a projective scenes transformation. from point matches only, but such reconstruction that it is possible to reconstruct three- can be defined Azarbayejani et al. [ l] uses a recursive method that the focal length the internal parameters from tracked points. Their method gives good results and accounts they suppose case where next. Soatto et al. [26] propose another [ 11. Their algorithm works with normalized difference is constant between are unknown from the method proposed here. image coordinates, and changing images and do not consider to estimate motion and structure for noise, however, the to the to and this is the main from one image recursive method which can be compared calibrate located beacons they simultaneously Our approach has been a camera and reconstruct inspired by the work of photogrammetrists. [ 21. Szeliski and Kang’s reconstruction method these parameters This section considers In particular, the scene, using by the way [ 281 can be accurately considered close to our approach since both are based on global minimization. However, (they Szeliski and Kang suppose estimate the knowledge of the internal parameters of the camera in a prior step). the problem of computing in the three- cameras. space given at least two perspective views taken with uncalibrated We describe a reconstruction method that uses five points of the scene as a relative 3D [6] which is based on epipolar in one that the reconstruction amount of information. Faugeras’ method could be considered of our iterative algorithm, however we find our frame. Unlike geometry, our method step using as an alternative initial values with a different method explained the linear method proposed by Faugeras the location of points for the initialization in Section 4. the minimum in the sense dimensional is obtained is direct 2.2.1. The basic equations Consider L’ (u 3 2) images of a scene composed of p points. For simplicity, assume thus providing p x u image in all the images, that all the points have been matched points. In fact, it is sufficient for a point to appear in at least 2 images. Let {PI, i = 1,. . , p} and {M,i, j = 1,. , u} be the unknown 3D points and projec- tion matrices, For each neous coordinates (JJi/ti3 Yr/ti* three homogeneous Zi/ti)T, (c/l.;. Vj)‘. image the point P;, represented respectively. j, ( x;, y, , zI, t, ) T or its usual inhomogeneous by a column vector of its homoge- (Xi, s, Zi) T = ’ IS projected as the point pij, represented by a column vector of its coordinates (U;j, Uij, Wii )T or its usual inhomogeneous coordinates coordinates In homogeneous coordinates, the perspective projection can be written as Pi,jPij = M.jpi7 i= l,... ,p, j=l...., u, (4) R. Mohr et al. /Art@cial Intelligence 78 (1995) 213-238 219 where Pij Eq. (4) is an unknown is usually written scaling factor. in the following way, hiding the scaling factor, and using the inhomogeneous coordinates of the image points: These equations express sponding projection points the collinearity (pij) with the centers of projection. of the space points (Pi), and their corre- (5) As we have p points and u images, for the i!4j (which are defined up to a scaling this leads to 2 x p x u equations. There are 11 x v factor), plus 3 x p for the If v and p are large enough the system (5) becomes overconstrained. For a general configuration, this system has a solution [6], but this solution can only be defined up to a collineation. Eq. (4) can be written as pijp;j = MjPi = (MjW-‘)(WPi), i=l,...,p, j= l,...,v. (6) AS a matter of fact, if Mj and Pi are a solution, SO are Mj W-' and WPi where W unknowns space points. is a collineation Therefore, the projective For being coplanar) space Ps, form a basis. of the 3D space, i.e. a 4 x 4 invertible matrix. a basis for any 3D collineation five algebraically can be arbitrarily independent chosen points in the 3D space. (no four of them 2.2.2. Direct nonlinear reconstruction From Eqs. (5), the problem can be formulated In the general case we have to estimate parameters coordinates of the points Pi) having noisy measurements We assume one, and with a covariance matrix C. that the measurements as a nonlinear optimization problem. the matrices Mj and the 3D (here the image coordinates). are obtained with a mean value equal to the observed (here Let us call Q the vector of all parameters, and qk an element in Q, U the vector of all the measurements Uij and xj, and let u1 be one of its elements. If the relation between likelyhood the maximum the Mahalanobis distance, the measures u[ and parameters qk is linear, i.e. U = AQ, then estimation of the parameters i.e. the least square criterion is the vector Q which minimizes ,y2 = (U - AQ)TC-’ (u-AQ). (7) In the nonlinear case, linearization may be obtained by taking the first-order of Taylor expansion of the nonlinear function linking Q with each UI. Noise is usually due to many causes. The perspective model is wrong because of the existence of optical distortions, and more important are errors in image point positions. The latter are highly uncorrelated, while the former is not. So in general, independent 220 R. Mohr et al. /Artificial Intelligence 78 (1995) 213-238 the major errors can be considered as an uncorrelated noise. Since the covariance matrix of the noise due to other sources it was not taken into account. is less important and very hard to estimate, As a consequence our covariance matrix can be taken in our case, Eq. (7) to be diagonal, with values of leads to the minimization equal to the variances CT;;. Therefore, this simple sum: (I) (I) (JJ ml’, 4 + ml2 yi + m,3 zi + ml4 Wt. 2 1 r/,i - ??l:()xi + UZ~[‘yi + FTl:‘,‘zi + &’ fi X2=x ii i ai,j 1 m:f'Xl + ??tg)yi + rn$)zi + m$)ti m3, Xi + mj.2 Yi + Mfjf Zi + T?$'ti (j) (i) glj V, - +c i.i I 2 1. Section 4 provides details of the method used to solve this system and also presents the reconstruction results. When the Euclidean structure (Euclidean basis is known, we obtain a Euclidean other hand, information if no Euclidean that can be obtained defined up to a collineation. is projective, coordinates) of the five points used as a of the scene, (Section 4). On the the only kind of 3D reconstruction reconstruction is provided, i.e. the solution has no metric information and is For many applications Euclidean information is not necessary, we will show in the next section how to derive some symbolic and geometrical the Euclidean positions. information, constraints. We will also present an alternative relations using only projective information for obtaining using knowledge about the scene instead of known 3D point technique 3. Computing symbolic relations This section discusses the symbolic relationships that can be computed kinds of geometric scene has been computed from at least two views. information. We assume that the projective reconstruction from various of the 3.1. Relations in the quasi-afine space This section is inspired by a similar work done by [24]. cheirality oriented. invariants described by Hartley [8]. Both approaches It is also related to the allow the space to be Let A and B be two distinct points space. The line (A, B) passing in the projective to be the set of points with coordinates through A and B is defined and ,U being defined up to a scaling factor as usual. However as was already explained equal to AA + pB, A in R. Mohr et al. /Artificial Intelligence 78 (1995) 213-238 221 Fig. 2. Influence of the ideal line position on the convex hull. b) Fig. 1, this does not allow the segment [A, B] to be uniquely defined as two segments are possible. remains The segment that the segment the line without passing A or B; for instance [A, B] can only be defined using affine information: if the connected part of the line limited by A and B does not contain an ideal point. From this definition it is clear identical when the ideal point moves continuously along bold segment if the ideal point ideal point would be sufficient related relationships “the point is between A and B”. is similar. Fig. 2 illustrates the bold part of Fig. 1 is still the for the and the in C or D. An approximate this kind of topological The convex hull problem is located to express information, the line at infinity. for two different affine interpretations being not pass through to the intuitive one. But in Fig. 2(b) the fact that B and C are inside the infinity passes the 3D space (see line. Notice of the plane, In the first case, as the line at infinity i.e. for two different the behavior of the convex hull lines chosen as (the ideal line) does the convex hull remains similar to this line cuts the intuitive convex hull, leading the hull for this case. No side of the convex hull cuts the ideal line in to the ideal plane that in this case, we only need to know whether the true convex hull or not; this naturally extends the intuitive convex hull (Fig. 2(a)), location through [24]). In fact, we have additional infinity. This line back-projects parallel M3 is the third row of the projection matrix M, the equation of the plane in the image as we already know its line at and the convex hull. If to the image plane. This needed plane allows us to compute the center of projection to a plane passing information through is M3. (x,y,z,tjT =o. A practical arbitrarily coordinate the plane at infinity. an Euclidean hull (see of the relation inside and outside. implementation of the convex hull for the computation is to choose an frame so that t = 0 is the equation of the plane which simulates In this coordinate the unit on the axis are considered as for convex [ 2 1 ] for having a collection of efficient algorithms). From there the definition a partition between to use all the known algorithms the convex hull introduces inside is straightforward: therefore allows basis which frame, 222 R. Mohr et ul./Ariijiiciul Intelligence 78 (1995) 213-238 3.2. Relations in the afine space The ratio of aligned segments that a point is exactly if not only an insideness quasi-affine As we have already mentioned, is the main invariant of affine geometry. Hence, saying in the middle of two others is an affine definition. More generally, then is needed, but also the location of where inside, relation space is no longer sufficient and at least affine space is required. the affine space can be deduced from the projective is known. This allows ratios of parallel space when the position of the ideal plane L7, segments and therefore relations to be computed, like l closest along a given direction: compute l center of here center might be the center of gravity, the exocenter of a triangle,. The ideal plane can be defined in the given direction . . space by at least three noncollinear the ratio of lengths in the projective to be parallel and therefore points at infinity. The most common way to get such points, known these points correspond found ideal plane. intersect at infinity in the images, to vanishing they define points. is to consider lines that are in the 3D space. In the images, lines can be to get the three vanishing points which are enough If three pencils of parallel An alternative to this collinear points A, B, C. It should be noticed of the four points A, C, B, D where D is the point a infinity on the line that this ratio is related the basic affine is to consider invariant: the ratio of three to the cross ratio [A, B], as If we know the projections of these points in the images, we are therefore able to derive from its position the value of this ratio in the projective locations of D and therefore to reconstruct the image space. information In structured worlds some numerical is often available about the position of the observed points, for instance A may be the midpoint of B and C. As the midpoint (i.e. with cross ratio equal to -1) of the ideal point, and as the cross is the conjugate is ratio of point on a line is conserved by projection, easily computed when projections of A, B and C are known. is located straightforward. that fl, linear equations which constrain each ideal point in projective should have equation the last line of the matrix W (6), one equation is defined up to a collineation W) . information three independent the ideal plane Stating the projection of the ideal point space, computing (the projective reconstruction t = 0 yields affine Once for is 3.3. Relations in other geometric spaces Some relationships information use geometric the standard hi- is an example of such a and uses several features. One is the natural vertical direction not present itself vertically onto is that the object A should project affine and Euclidean. Above that fits exactly into erarchy of geometries: projective, relationships in the affine space. A second object B, or that the projection of A overlaps B. To deal with a direction we need to know be found using one of the previously described the corresponding techniques. ideal point. This can It can also be done using R. Mohr et al. /Artijicial Intelligence 78 (1995) 213-238 223 camera orientation priori information a vertical plane: allows only lines oblique from reasoning in the image information. Notice is available: that if the camera is known the central vertical line of the image back projects two images a vertical in an area close line can then be extracted. However to this line, as vertical lines might project to have no roll, a to this to if the principal axis of the camera is not horizontal. 3.4. Similarity relationships are needed. This leads us to consider Measurements of absolute size are often not needed for spatial reasoning. For instance, to know are unnecessary. factor and no Euclidean if we want to know whether an object will pass through a hole, it is sufficient the relative size of the hole and the object. Absolute measurements In this case objects can be defined up to a uniform positions scaling of lengths. To get a reconstruction to the affine transformation A such that the a priori information Such a numerical reconstruction. Mathematically, up to a similarity, new information the group of similarities, which preserves angles and ratios has to be added an affine space. this can be done by finding is satisfied in the transformed frame A more elegant way is general but not easy to implement. to recover a suitable affine transformation is to consider the absolute conic 0. The absolute conic is located in 17, [ 16,251 and defined by the equations: x2 + y* + z* = 0, t = 0, i where the previous equations are expressed i.e., an orthogonal this conic have complex coordinates. From direct computation check that 0 is invariant by uniform frame with similar frame, length unit on each axis. All points on to it is straightforward in an “extended” Euclidean and rotation. reference reference scaling, The easiest way space. Each circle circles the reconstruction to determine this conic intersects ZIW in two points belonging known circles in the 3D to D [ 251. From three such of 0 is possible. Let its equation be: translation is to reconstruct atx* + azy* + usz* + 2a4xy + 2a5xz + 2aeyz = 0. A change done by considering Q defined by in coordinates is necessary to bring that the equation of the conic it into the form of Eq. (8). This can be form is associated with the quadratic As the matrix Q is symmetric, there exists an orthogonal matrix P such that 224 R. Mohr et al. /Artificial Intelligence 78 (1995) 213-238 So setting X’ = PX, we have: Finally, with a further resealing along each axis, we get Eq. (8). Another way to proceed is to use the basic extended Euclidean cy of the angle formed by two coplanar to compute be the intersections plane defined by these two lines with 0. Laguerre’s fi, as knowledge of it introduces the value lines L and L’. This invariant can also be used a constraint on its location. Let A and A’ of the invariant: of the two lines with U,. Let I and J be the intersections formula states that: Ly= ;log({A,A’;I,J}). We can write I = A + tA’ and J = A + t’A’. With this notation {A, A’; I, J} = t/t’ = e2jn If we express that both points lie on R we get the equations tZA’TQA’ + 2tATQA’ + ATQA = 0, e4int2A’TQA’ + 2e2iatATQA’ + ATQA = 0, (9) from which a polynomial previous equations leads to constraint on Q is easily derived: elimination of t* in the 2tATQA’/?(P - 1) + ATQA(p2 - I) = 0 with p = e2in, t can be extracted from the above (P-t 1) ATQA 2p ATQAI’ ‘= - Substituting t in (9) provides a quadratic polynomial constraint on Q (ATQA) (A’TQA’) - (ATQA’)* = 0. Therefore, the absolute conic fi can be computed given five angles, but we did not succeed to get a solution based on the above equation. Hence, this theoretical discussion seems irrelevant since for our experiments we have used different Euclidean constraints. However, and Euclidean for each kind of reconstruction. shows clearly the relationships between projective, affine Furtheremore, we have derived exactely what is needed the above discussion reconstruction. R. Mohr et al./Art$cial Intelligence 78 (1995) 213-238 225 4. Implementation and results 4.1. Implementation This section explains our reconstruction procedure on both real and simulated data, and discusses 4. I. 1. 30 reconstruction in detail, gives examples of its use results. the accuracy of the reconstruction problem The reconstruction in Section 2.2.2, the resolution of the problem problem. Since the projective coordinates of the spatial points are defined up to scaling factor, the following is specified by the set of equations turns into a nonlinear optimization (5), as mentioned constraint is added x~+y~+z.~+t~=l. (10) A similar scaling constraint has to be imposed on the projection matrices. Usually the following constraint is used: 3 c i=l rn& = 1. However, since this condition was not crucial for the convergence, rn34 = 1 was used instead (we know that rn34 is not null in our formulation). the simpler constraint Finally, Eqs. (5) were homogenized leading uij X (m:()xi + m$‘Yi + T&).Zi + ti) - (t?li{)Xi + t$‘yi + mifzi + mlfti) to the minimization of the square of (11) Kj X (M$)Xi + d$yi + t?Z$).Zi + ti) - (t?l$/)xi + m~‘yi + m&i + mg’ti) (12) together with x;+y;+2;+t;-1. (13) To fit with the Levenberg-Marquardt formulation [ 221, the problem is written as a minimization of fk(xij,Yij;Xi,yi,Zi,ti,m,, (i) ,...,m:i,‘) 2 (14) over the parameters (.Xi,Yi,Zi,ti,m~_I’) ,..., djj,)) fori=l,..., p, j=l,..., V; (+k represents where (12) or (13). the variance of the kth measure, and fk( .) the functions ( 1 1 ), For such nonlinear optimization, initialization is a crucial step. Even though method converges for most of our examples with a very “ad hoc” initialization, the this can 226 R. MO/V et rd. /Artificial Intelligence 78 (1995) 213-238 initialization [ 30,321. This not be guaranteed. Therefore, we initialize model large perspective distortion steps. First, a linear reconstruction [ 321, then, Note the orthographic restriction on the camera motion this reconstruction that unlike the 3D structure is not too far from a real reconstruction from a parallel projection even with is therefore done in two (see [ 31 for details). Reconstruction is used as an initial guess is obtained assuming a weak perspective projection algorithm. the weak perspective one has no the scene). (the camera can move forward projection model, to our nonlinear 4.1.2. Estimation of the collineation W Once we have a projective the Euclidean recover transformation W which satisfies bring the solution reconstruction structure without knowing any 3D point, the added Euclidean constraints defined up to a collineation W, we need to i.e., we need to find a to as well as possible to Euclidean The collineation W can also be constrained space. that the camera using knowledge from the camera. For internal parameters do not change and that the example by assuming plane at infinity can be estimated. However, is not satisfactory yet and a large number of of images is needed to make the computation of W remain constant, given at least stable internal parameters 3 images of the same scene provide enough constraints to get Euclidean [ 131. Unfortunately, [9]. In fact, when the camera in very high nonlinear of such algorithm the performance reconstruction equations. translate The problem here it only concerns the estimation of the 15 these constraints is much easier since unknowns of W. Again, since W is defined up to a scaling factor, we add a constraint c (WJ’= I. Similarly, the problem can be written as a minimization over: fk(WI1>...,W44) qk (15) where f ( .) are functions describing with a real application in the next subsection. the particular geometric constraints as we will see 4.2. Result5 First, the algorithm using five points in the scene as a relative evaluated with real data and the use of geometrical example. Then, a quantitative with five known points and the one obtained using geometrical constraints simulated data. Finally, an example of the symbolic given. constraints the Euclidean comparison between relationships frame reference is is illustrated with a real obtained reconstruction is made using is inside and above 4.2.1. Reconstruction results using five points Three different scenes have been used here: R. Mohr et al./Art$cial Intelligence 78 (1995) 213-238 221 image 1 image 2 image 3 Fig. 3. The house scene: the three images used for the reconstruction together with the extracted comers. The relative reference frame used for the reconstruction is defined by the five points marked with white disks in image 3. l The wooden house scene (Fig. 3). The size of this indoor scene is 40 cm x 40 cm x 25 cm, it is located at about 1 meter from the camera. Three images of this scene, covering about a 7r/6 rotation of the camera, have been used. A total of 49 points [ 171, and tracked over the images. have been extracted using our corner detector ruler) and chosen (with an ordinary Five points on the house have been measured as a basis. These are denoted by disks the between in Fig. 3. The difference and the measured point coordinates was less than reconstructed scene from several different points of view. 1.5 mm. Fig. 4 shows the reconstructed point coordinates Fig. 4. Euclidean reconstruction of an indoor scene using five known points. The reconstructed points are joined with segments to make the result more expressive. (Fig. 5). Three images of an outdoor scene have been taken l The outdoor scene with a hand-held camera. A total of 162 points were extracted and tracked auto- matically over the three images. Five points were used as a basis, they are denoted by thick crosses in this case, we assigned approximate to the five points used as a basis. Al- though in Fig. 5. Since we have no exact Euclidean it is quasi-Euclidean the reconstruction is projective, coordinates coordinates however, obtained R. Mohr et al./Art@cial Intelligence 78 (1995) 213-238 229 image 1 image 2 image 3 Fig. 5. Three motion of camera images of an outdoor scene taken with a hand-held camera. Unlike the wooden house case, the in image 3. the basis are marked with thick crosses is not regular. The five points defining since the basis coordinates the reconstruction are an approximation aspects has some Euclidean to the Euclidean ones. Therefore, (see Fig. 6). l The calibration pattern (Fig. 7). This last experiment racy of the reconstructed are known to be coplanar, points. The goal is to reconstruct then to check their 3D coplanarity. This scene consists of three planes with 160 targets 55 cm. The points by computing to be reconstructed the best affine transformation in a volume of diameter are the target centers. We extract such points target and the between a theoretical aims at measuring the accu- a set of points which 230 K. Mohr et 01. /ArtiJi+d Intelligence 78 (1995) 213-238 A lateral view Another lateral view Fig. 6. The result of the reconstruction the two walls are clearly identified. algorithm for the outdoor scene, the top view is more expressive since real one. The accuracy of the extracted images were u sed for the reconstruction to be coplanar note that points expected target centers process. The result is one tenth of a pixel. Four in Fig. 8, is shown form nearly a perfect plane. into a plane points belonging The reconstructed pattern were fitted we can select any other plane of the calibration the points quantitative struction with real images. This is due to the optimal nature of our reconstruction to the horizontal plane of the calibration is arbitrary, pattern). The mean distance of is 0.49 mm. This in the recon- to this plane was 0.12 mm and the maximum distance that we can reach a very high accuracy (the choice of the horizontal plane result shows R. Mohr et al./Ar@cial Intelligence 78 (1995) 213-238 231 image 1 image 2 image 3 image 4 Fig. 7. Calibration pattern image sequence: 4 images were used for the reconstruction process. The interest points are the target centers. algorithm tenth of a pixel in this case). and to the localization of the image points to subpixel accuracy (one 4.2.2. Using geometric constraints for a real case The Euclidean reconstruction shown reference frame. Now we consider as a relative known points we will use geometric constraints The projective frame, then geometric reconstruction constraints to obtain is first computed using five points as a projective reconstruction. reference the collineation W which brings are used to estimate the Euclidean in Fig. 4 was obtained using five known points the same scene, but instead of using five 132 R. M&r et ul. /Arii’ciul Intelligence 78 (1995) 213-238 Fig. 8. The reconstructed “general view”: they form the relative reference frame. points of the calibration pattern. Five points are marked with a dark squares on the this projective to a Euclidean one. The constraints of the real problem do not exactly fit the steps described reconstruction in Section systems. For in which points are indicated lines are provided. Thus, we the plane L7, these steps helps to avoid underconstrained 3. However, understanding instance, consider an image containing as belonging define is not defined and the solution to this plane. In addition, suppose a horizontal plane, that vertical the plane z = 0 and the point at infinity on the z-axis. Obviously, is still only defined up to a projective transformation. in Fig. 3 the three main directions Suppose that, for a scene like the one shown to vanishing points in the images are given. This provides us with three points at infinity and hence defines L7,. The points at infinity correspond is defined up to an affine transformation. the rotational part will be defined. However, least two more constraints the scaling on the three axes are provided, are the two remaining degrees of freedom then defined up to a similarity. the absolute conic are needed for fixing the conic’s five degrees of freedom. is not defined yet: at If is set, as is then the uniform for the absolute conic. The reconstruction [ 231. Given this, the reconstruction if these directions are orthogonal scaling measure Furthermore, Our example the previous wooden house scene. As an example, consider The constraints we applied were a mixture of affine and Euclidean ones. frame in the scene in which To get a unique Euclidean this is not a great restriction as in almost the constraints were expressed. frame. In most indoor and outdoor scenes all the scenes we can find such a reference there is a floor that can be used as the horizontal plane XOY. Also two vertical planes that are perpendicular to each other can be found (building walls, room walls, etc.), we can use these as the X02 and YOZ planes respectively. solution we fixed a reference In our opinion, R. Mohr et al. /Artijicial Intelligence 78 (1995) 213-238 233 In the following we must keep in mind that we have a reference frame, but no notation. A’ = (XA’, yAf are given. the following coordinates We use before adding of the point with corrected coordinates representing the projective were used: the geometrical transformation constraints, , z#, tAr)T is the vector of a point and A = WA’ = (xA, yA, ZA, 1 )T the vector coordinates). W is the 4 x 4 matrix constraints to be computed. The following (Euclidean l the reference planes were fixed, l points alignment with the axes, l distances between points. Result We used by solving Finally, the same 49 points system the nonlinear (Fig. 3). The projective (5) using reconstruction was computed frame. reference five points as a projective the collineation W was estimated using the following constraints: l The floor was used as the horizontal plane for our Euclidean to this plane reference then frame. If a ,?A = 0. This point A’ = (XA’, yA’, ZA’, tAr)T is known gives a linear equation constraining W. to belong l The two walls of the house were used as the planes belonging horizontal plan. to these planes give rise to the same kind of constraints (XOZ) and ( YOZ). Points as for the obtained parallel l Metric l Up to now, the three planes of our reference from the intersection of theses planes and if a pair of points frame have been fixed. The axes are forms a line to one of the three axes we obtain an alignment information is required to get a full solution. We used distances between constraint. pairs of points aligned with an axis. This yields a second-degree equation. Once W has been estimated, clidean one. The result is qualitatively (Fig. 4). Quantitative the projective similar reconstruction into a Eu- to the one obtained with five known points is transformed evaluations will be given in the next subsection. 4.2.3. Accuracy in reconstruction Here we use simulated data to discuss the accuracy of the reconstruction and compare the result based on five known points with the one based on constraints. We simulated images covering about a 7r/2 rotation of the camera were simulated with 60 points, and the same type of constraints were used. to our wooden house scene. Four a scene similar Table 1 shows the 3D coordinates of 10 points of the simulated the errors five known points and the errors when using constraints. Pixel uncertainty when using was generated as a uniform noise with a maximum deviation of 1 pixel. it can be seen that the errors in the 3D coordinates to conclude From these results, but not good enough order to study data (2D coordinates), displays are perfect without noise, up to tiny numerical the stability of the method, different then 3D coordinates the mean e rrors on 3D positions when perturbing round-off In to our levels of noise were added are computed with the two methods. Fig. 9 the images. Of course both to Fig. 9, errors. According are reasonable is present. is robust when noise that the method scene, 234 R. Mohr et al. /Art#cial Intelligence 78 (1995) 213-238 Table I Example of reconstructed 3D coordinates 3D coordinates, and the errors X Y 12.000 0.000 6.000 12.000 13.500 - I..500 ~ I.500 13.500 0.000 0.000 0.000 18.000 0.000 0.000 - I.500 - I.500 I9500 - 1.500 6.000 12.000 z 0.500 14.500 22500 I4500 0.500 o.soo 0.500 0.000 0.500 0.500 Errors (using five points) Errors (using constraints) AX AY AZ AX AY AZ 0.047 0.178 0.088 0.249 0.068 0.010 0.048 0.062 0.062 0.00 I 0.073 0.013 0.061 0.065 0.085 0.107 0.072 0.083 0.023 0.016 0.178 0.018 0.149 0.020 0.004 0.068 0.042 0.036 0.045 0.020 0.04 I 0.000 0.054 0.000 0.011 0.011 0.038 0.002 0.000 0.026 0.059 0.025 0.018 0.025 0.026 0.026 0.001 0.032 0.007 0.014 0.004 0.042 0.069 0.042 0.023 0.023 0.005 0.000 0.054 0.007 redundant Euclidean constraints provide a better accuracy it has to be noted that the two methods for obtaining use the same Euclidean to the location of these five points sensitive in the scene while to the number and kind of the used constraints. results degrade quickly With larger noise amplitudes, the Euclidean in the reconstruction. However, do not reconstruction is sensitive is the method using constraints information. The method using five known points in 3D posi- are essential, even with redundant geometrical [ 191. If accuracy is needed, subpixel measurements tions constraints. 4.2.4. Example of symbolic relationships l Inside. With an approximation projection, of the ideal plane by assuming the affine (quasi-affine) an affine transfor- of the convex hull was computed using a subset of points. Fig. IO shows the projection of the convex hull on the inside the convex hull reconstruction then, the points of the scene split into two subsets: points for the scene-image mation the scene was performed, these reconstructed image, and points outside. l Above. This relation needs the knowledge of the vertical direction which case is computed by finding vanishing points corresponding in the 3D projective and an object B consists simply of testing whether object B, where C is our ideal point. in our the the ideal point space is computed, and the relation above between a point A the images (Fig. 11) . Therefore, in the different this direction the 3D line AC intersects (in at least two images) 5. Conclusion This paper shows how a scene can be reconstructed using a parameter estimation nates are computed relatively approach. The reconstruction is relative, to five points in the space. Since an absolute from multiple uncalibrated images i.e. point coordi- reference R. Mohr et al. /Artificial Intelligence 78 (1995) 213-238 235 z mean error on 3D coordinates(cm) with five known pointy 0.0 I I 0.5 random noise on 2D coordinates(pixels) I 1.5 I I I 1.0 2.0 Fig. 9. Since the noise is important the method using constraints is more. suitable. is not needed frame to be known. for the method, the exact positions of the five points do not need the images, the position This an approach allows us to work with a camera with automatic ture, without knowing the internal camera parameters. However, the reconstruction between formation of the 3D space. Therefore, geometric constraints have to be added. The parameter estimation in this paper allows a wide variety of geometric constraints reconstruction projective ones if enough constraints focus and aper- from where each view is taken and without knowing is the point matches trans- is needed, framework presented into the from information can only be computed up to a projective if more In particular, Euclidean to be incorporated can be obtained than projective reconstructions are available. if the only information algorithm. The resolution an approximation then, this solution It was shown of the nonlinear to the solution is used to initialize that our projective is obtained assuming the nonlinear reconstructions reconstruction algorithm algorithm. contain more is done in two steps, first, an affine model for the camera, information information. With complementary of the plane at infinity, some spatial reasoning this point If more containing ment information richer is partially known, information about the environment can be derived. Since the framework presented inside a set of points?” can be then answered. such as an estimate of the relative is possible. Qualitative questions than just projective location like “is is available, further symbolic in many applications is likely in this paper relations the environ- to prove very 236 R. Mohr et al. /Artificial Intelligence 78 (I995) 213-238 convex hull 011 the image, the relation is defined relative his Fig. 10. TI hull. r I ’ I Fig. I I The vertical direction in two images computed by finding the vanishing points in that direction. R. Bohr et al./Artificial Intelligence 78 (1995) 213-238 promising constraints we can extract from realistic environments, combined with image measurement in the near future. Therefore, our future work will focus on further and how these constraints to get useful information. 237 types of can be References I 1 J A. Azarbayejani, B. Horowitz relative orientation constraints, New York ( 1993) 294-299. and A. Pentland, Recursive estimation of structure and motion using in: Proceedings Conference on Computer Vision and Pattern Recognition, [ 2 1 H.A. Beyer, Accurate calibration of CCD cameras, in: Proceedings Conference on Computer Vision and Pattern Recognition, Urbana-Champaign, IL (1992) 96-101. 13 1 B. Boufama, D. Weinshall of scaled orthography and perspective, Computer Vision, Stockholm, Sweden and M. Werman, Shape from motion algorithms: a comparative analysis in: J. Eklundh, ed., Proceedings 3rd European Conference on (Springer-Verlag, Berlin, 1994) 199-204. strategies, in: Proceedings 3rd International 141 B.A. Draper and E.M. Riseman, Learning 3D object Conference on Computer Vision, Osaka, Japan ( 1990) 320-324. 15 I N. Efimov, Advanced Geometry 161 O.D. Faugeras, What can be seen in three dimensions with an uncalibrated (Mir, Moscow, 1978). stereo rig?, in: G. Sandini, ed., Proceedings 2nd European Conference on Computer Vision, Santa Margherita Ligure, Verlag, Berlin, 1992). Italy (Springer- 171 J.A. Feldman and Y. Takimovsky, Decision theory and artificial intelligence I: a semantic based region analyser, Arttf Intell. 5 (4) ( 1974) 349-371, [ 81 R.I. Hartley, Cheirality invariants, in: Proceedings DARPA Image Understanding Workshop ( 1993) 745-753. 191 R.I. Hartley, An algorithm for self calibration from several views, in: Proceedings Conference on Computer Vision and Pattern Recognition, Seattle, WA ( 1994) 908-912. cameras, IL ( 1992) 761-764. [ 101 R.I. Hartley, R. Gupta and T. Chang, Stereo from uncalibrated Computer Vision and Pattern Recognition, Urbana-Champaign, in: Proceedings Conference on [ 111 J.J. Koenderink and A.J. van Doom, Affine structure from motion, Tech. Rept., Utrecht University Utrecht, Netherlands ( 1989). [ 121 C.H. Lee and T. Huang, Finding point correspondences and determining motion of a rigid object from two weak perspective views, Comput. Vision Graph. Image Processing 52 ( 1990) 309-327. [ 131 Q.T. Luong and O.D. Faugeras, Self-calibration of a camera using multiple International Conference on Pattern Recognition, The Hague, Netherlands in: Proceedings images, ( 1992) 9-12. I Ith I 141 Q.T. Luong and T. Vieville, Canonic representations for the geometries of multiple projective views, in: Proceedings 3rd European Conference on Computer Ksion, Stockholm, Sweden ( 1994) 589-599. [ 151 S.J. Maybank, The projective geometry of ambigious surfaces, Tech. Rept. 1623, Long Range Laboratory, GEC Wembley, Middlessex, England ( 1990). [ 161 S.J. Maybank Vision 8 (2) and O.D. Faugeras, A theory of self calibration of a moving camera, Int. .I. Comput. (1992) 123-151. 1 17 1 R. Mohr, B. Boufama and P Brand, Accurate projective reconstruction, Workshop on Applications of Invariants in Computer Vision, Azores, Portugal I 181 R. Mohr, L. Morin and E. Grosso, Relative positioning with uncalibrated in: Proceedings DARPA-ESPRIT ( 1993) 203-227. in: J.L. Mundy and in Computer Vision (MIT Press, Cambridge, MA, 1992) cameras, A. Zisserman, 440-460. eds., Geometric Invariance I 191 R. Mohr, L. Quan, E Veillon and B. Boufama, Relative 3D reconstruction using multiple uncalibrated images, Tech. Rept. RT 84-I-IMAG LIFIA 12, LIFIA-IRIMAG 1201 R. Mohr, F. Veillon and L. Quan, Relative 3D reconstruction images, Proceedings Conference on Computer Vision and Pattern Recognition, New York ( 1993) 543-548. ( 1992). using multiple uncalibrated in: [ 2 1 ] E Preparata and M.I. Shamos, Computational Geometry, an Introduction [22] W.H. Press, B.P. Flannery, S.A. Teukolsky and W.T. Vetterling, Numerical Recipes ( Springer-Verlag, Berlin, 1985). in C (Cambridge University Press, New York, 1988). 238 R. Mohr et ~11. /Artificial Intelligence 7R (I 995) 213-238 123 I L. Quan and R. Mohr, Determining perspective structures using hierarchial Hough transform, Pattern Recognition f&t. 9 (4) (1989) 279-286. [ 24 1 L. Robert and O.D. Faugeras, Relative 3D positionning calibrated ( 1993) s40-544. stereo pair, in: Proceedings 4th International and 3D convex hull computation from a weakly Conference on Computer Vision, Berlin, Germany I25 I J.G. Semple and G.T. Kneebone, Algebruic Projectwe Geomefry 1952). I26 I S. Soatto, P Perona, R. Frezza and G. Picci, Recursive motion and structure estimation with complete Conference on Computer Vision and Pattern Recognition, New (Oxford Science Publication, in: Proceedinp error characterization, York (1993) 428-433. I27 I G. Sparr, Projective invariants for affine shapes of point configurations, in: Proceedings DARPA-ESPRIT Workshop on Applications (1991) 151-170. I 28 I R. Szeliski and S.B. Kang, Recovering 3D shape and motion from image streams using nonlinear in Computer Vision, Reykjavik, of Invariants Iceland least squares, J. Visual Commun. Image Representation 1 (5) ( 1994) 10-28. I29 I J.M. Tennenbaum 8 (1977) 241-274. and H.G. Barrow, Experimentation in interpretation-guided segmentation, Artq: Intell. 1301 C. Tomasi and T. Kanade, Factoring IEEE Workshop on Visual Motion, Princeton, NJ (IEEE Computer Society Press, Los Alamitos, CA, I99 I ) 21-28. into shape and motion, in: Proceedings sequences image [ 3 I I R.Y. Tsai, A versatile camera calibration technique for high-accuracy using off-the-shelf TV cameras and lenses, fEEE J. Robotics Automation 3D machine vision metrology 3 (4) ( 1987) 323-344. I32 I D. Weinshall, Model-based invariants for 3-D vision, fnt. J. Cornput. Vision 10 ( 1) ( 1993) 27-42. 