Artificial Intelligence 75 (1995) 3-29 Artificial Intelligence Qualitative analysis of behavior of systems of piecewise linear differential equations with two state variables Toyoaki Nishida av*, Shuji Doshita b ’ Graduate School of Information Science, Nara Institute of Science and Technology, 8916-S Takayamu, Ikom, Nara, 630-01 Japan ’ Department of Information Science, Kyoto University, Sakyo-ku, Kyoto, 606-01 Japan Abstract The set of all solution curves in the phase space for a system of ordinary differential equations (ODES) is called the phase portrait. A phase portrait provides global qualitative information about how a given system of ODES behaves under different initial conditions. We are developing a method called Topological Flow Analysis for automating analysis of the topological (VA) structure of the phase portrait of systems of ODES. In this paper, we describe the first version of TFA for systems of piecewise linear ODES with two state variables. TFA has several novel features that have not been achieved before. Firstly, TFA enables to grasp characteristics of all behaviors of a given system of ODES. Secondly, TFA represent behaviors in terms of critical geometric features in the phase allows to symbolically space. Finally, TFA integrates qualitative and quantitative analysis. The current version of TFA has been implemented as a program called PSX2PWL using Common Lisp. 1. Introduction Analysis of dynamical systems is essential to model-based reasoning as a means of from structure. One of the major concerns of qualitative dynamical reasoning systems. Unfortunately, deriving behavior has been deriving qualitative behavior of continuous most conventional scription of ambiguities. language of complex behavior and completeness qualitative reasoning techniques proposed so far lack an adequate de- of prediction due to explosion * Corresponding author. When this article was originally written, this author was with the Department of Information Science, Kyoto University. 0004-3702/95/!$09.50 @ 1995 Elsevier Science B.V. All rights reserved SSDIOOO4-3702(94)00062-X 4 71 Nishidu, S. Doshitu/Arlific.rcrI Intelligence 7.5 (1995) 3-29 To address these problems, we are developing for analyzing the topological equations (ODES). TFA is based on dynamical a sophisticated mathematical theory about qualitative a method called Topological Flow structure of the phase portrait of systems theory systems analysis of dynamical (TFA) Analysis of ordinary differential (DST), systems. In this paper, we present the first version of TFA for systems of piecewise linear ODES (PWL-ODES) with two state variables. TFA has several novel features. Firstly, TFA enables to grasp characteristics of behaviors of a given system of PWL-ODES under all possible all possible symbolically The use of symbolic the behavior, but it also helps to navigate qualitative process. Quantitative to in a phase space. does not only make sense as an explicit description of the analysis process. Finally, TFA integrates the overall analysis initial conditions. TFA does this not by directly computing or approximating solutions, but by reasoning represent behaviors at the abstract in terms of critical geometric level. Secondly, TFA allows analysis helps qualitative analysis. Qualitative analysis guides and quantitative representation features analysis resolve ambiguity. using Common Lisp, is called PSX2PWL. ’ The current version of TFA, implemented 2. Dynamical systems theory (DST theory of dynamical TFA is based on Dynamical Systems Theory qualitative the geometric and topological space. This enables, information given system of ODES, even when a precise form of the solution section, we introduce basic notions of DST. system of ODES: [ 2,3]. DST, called a for short) systems, provides a powerful method of reasoning about features of solution curves of systems of ODES in a phase of the behavior of a In this is not known. to derive qualitative the following for example, Consider $ = f(x) (1) where x is a vector of state variables in Iw as a function of t E IR. An n-dimensional variables {xi} is called space, Eq. ( 1) specifies (XI,. the phase space. For each point c = (cl,. the rate and the orientation of state change: each of which gives some value space spanned by the set of all state in the phase , c,,) . . ,x,) to initial state a = (al, In other words, Eq. ( 1) defines a vector field corresponding the point corresponding by the vector field at each point or an orbit. The collection of all orbits in a phase space is called the phase portrait. in the phase space. A specific solution is a trajectory such that it passes through to the vectors specified is called a solution curve, , u,) to a in the phase space and it is tangent (Fig. 1). Such a trajectory ’ Originally. more complex systems of ODES, as described it was called PSX (Phase Space explorer). Now, we have several other versions of PSXs for in the postscript of this paper. T. Nishida, S. Doshita/Arti$cial Intelligence 75 (1995) 3-29 5 (a) the vector field (b) solution curves Fig. 1. Geometric meaning of system of ODES. Theoretically, we can think of an orbit passing on x E U c IRn as a mapping ~,(t):W-tVwhichmapsxtoy~V~IW”asafunctionoft~R.Wecanalso think of ( 1) as specifying a “flow” @(x. r) = & (t) : U x lR -+ V. If uniqueness of solution holds for a given system of ODEs, orbits never intersect with others nor with themselves (the non-intersection construinf) . There is an obvious correspondence between the geometric properties of orbits and the aspects of dynamical behavior. For example, points in a phase space at which the right-hand side of Eq. ( 1) is zero are called JIxed points, and they correspond to equilibrium states which will not evolve for ever. Fixed points are further classified into sinks, sources and saddle nodes. Orbits near a sink and a source arbitrarily approach the sink as t 4 00 and -00, respectively, while both kinds of orbits exist around a saddle node. Closed orbits correspond to periodic behaviors. DST is particularly concerned with analyzing topological structure of asymptotic behaviors of dynamical systems as t -+ foe. In DST, it is proved that orbits in a two- dimensional planar phase space either ( 1) diverge for place at infinity, (2) approach a fixed point, or (3) approach a closed orbit (called a limit cycle), as t + foe. Roughly, orbits to which nearby orbits approach as t + 00 and -co are called artructors and respectively. Attractors and repellors play an important role in qualitative repellers, analysis of phase portrait. A set of points which an orbit passing a point x in a phase space approaches as t -+ oo is called the w-limit set of x. The a-limit set of x is defined similarly, by replacing co by --oo. Although an w-limit set becomes empty if the orbit diverges for a place at infinity as t + CO, we regard a place at infinity as a special kind of places and allow an w-limit set to contain a place at infinity. An w-limit set extended in this way is called 6 71 Nishidu. S. Doshita/Artijiciul Intelligence 75 (1995) 3-29 Fig. 2. Contracting recursive bundle of orbit intervals a generalized a generalized sink, or a g-sink source (or a g-source for short). for short. A similar extension to an a-limit set is called Unfortunately, it is not straightforward the phase space of systems of ODES based on DST. For example, DST does not provide us with a procedure Hence, we need to develop a computational continuous in a phase space, though theory of representing it gives a definition. about and reasoning for finding an attractor that can explore to implement a program flow. 3. Reasoning about phase portraits TFA is a computational theory of DST. TFA is based on several novel ideas. 2 3.1. Reasoning about bundle of orbits We focus on bundles of orbits rather than single orbits, to derive useful conclusions to regions for example, we have found I and J on the same hypersurface which cannot be made about single orbits. Suppose, a given phase portrait a pattern as shown transverse is called a contracting are also transverse is two-dimensional, boundary, Fig. 3. All orbits f ---t co. in in Fig. 2, in which a bundle of orbits 4 is I. This pattern to I transverse to J, and never leave the region occupied by 4. If the phase space I and J do not share a in I - J approach one of those limit cycles as region J is finitely bounded, then C$ contains one or more attracting and region limit cycle {a~,. . . ,Q} such that J c intervals. All orbits recursive bundle of orbit to the region transverse as shown 2 In the description below, we attempt to generalize these ideas to n-dimensional phase spaces as much as possible, because most of them are independent of the dimensionality of the phase space. Z Nishida, S. Doshita/Artifcial Intelligence 75 (1995) 3-29 7 (a) pattern (b) interpretation Fig. 3. Circumstance in which existence of an attracting limit cycle is predicted. Formally, a bundle of orbit intervals is defined as a set of intervals of orbits 4 such that (1) (2) is involved no fixed point for any point p in the internal s which is transverse and (a) all intervals of orbits in the region occupied by 4; 3 region occupied by qS, there exists a hypersurface to the region occupied by 4 at region a that contains p that belong to r$ are transverse to s once and only (b) once. for any point q in a, there exists an interval of an orbit involved is transverse in 4 which to s at q. s in the above definition The hypersurface conditions requests ( 1) and (2a) require the density and continuity the uniformity of orbit intervals is called a cross section of 4. Intuitively, in 4, and (2b) involved of orbit intervals in 4, as shown in Fig. 4. 3.2. Representing a bundle of orbits as $0~ mappings between hyperplanes (n - 1 )-dimensional hyperplanes, phase space to “sample” data about bundles of orbit called sampling hyperplunes, in intervals. We locally defined each bundle of orbits as a sequence of mappings between We use several an n-dimensional abstract (n - 1 )-dimensional hyperplanes. When n = 2, sampling hyperplanes lines, which we call sampling lines. are straight Consider a bundle of orbit intervals #J that intersects with sampling hyperplanes p1 and in Fig. 5. An interval &J of 4 delimited by r-1 p2 at r-1 and r2, respectively, and r2 continuously maps points on rl to 12. We represent as shown this as and call it a flow mapping. 3 Fixed points may be on the boundary of the region. Fig. 4. Bundle of orbit intervals and its cross section. Fig. S. Representing bundle of orbits as mapping between hyperplanes it is hard Although n-dimensional concern which can be completely to find an effective phase space, we currently representation for YI and r2 in a general step aside from this problem by limiting our phase spaces, where YI and r2 are line segments to flows in two-dimensional specified by the location of the two endpoints. lY Nishida. S. Doshita/Art$icial Intelligence 75 (1995) 3-29 9 3.3. Deriving global behavior by analyzing the structure of $0~ mappings We can derive global behavior by analyzing a couple of bundles of flow mappings composition 42 o ~$1 of 41 and 42 as follows: 41 the structure of flow mappings. Given : J + K, let us define .I and 42 : I + &o&(x) =42(41(x)) =Y iff 32 [41(x) =z, 42(z) =yl. We call a composite range is a subset of the domain, namely, flow mapping 4m 0. . . o 41 a contracting recursive mapping, if the 4m 0 * . .o 4, (I) c I. Similarly, we call 4m 0 . . . o 41 an extending recursive mapping, if 4nr 0 . . . 041(I) 3 1. Existence of a contracting existence of an extending recursive mapping entails existence of an attractor. Similarly, recursive mapping entails existence of a repellor. 3.4. Taking advantage of strong constraints of a two-dimensional piecewise linear flow for finding that produces for abstracting sampling hyperplanes for grasping global behaviors, and In order to make the above ideas computational, we need to develop l a procedure mappings l a procedure These requirements We take advantage of strong constraints on two-dimensional have studied in two-dimensional phase spaces and have found that the local flow in a cell can be computed by analyzing a few orbits generating flow as mapping between sampling hyperplanes. to achieve in general, even for two-dimensional that pass on particular points on the boundary of the cell. Our method of the properties of linear flow in convex regions piecewise-linear (cells) flows. flows. We a useful set of flow flow mappings are not trivial is to l partition the phase space into convex regions called cells by invariant manifolds and boundaries between linear regions, and l examine the property of the flow on the boundary of each cell. This algorithm produces a sufficient resulting phase space. flow mappings makes set of sampling hyperplanes in the sense it possible to capture all attractors and repellors that the in the 4. Properties of systems of PWL-ODES with two state variables In this section, we exploit properties of systems of PWL-ODES with two state variables to more detail. Consider a system of PWL-ODES of the form: {Ri: (pi(X)i$=fi(X))} (1<i<m,xEW2). (2) IO 7: Nishidu. S. Doshitu/Artijiciul Intelligence 75 (1995) 3-29 delimited by a pair of angular brackets Each constituent linear region may be given a unique of linear that gives a condition effective. The local flow in a linear region Ri is defined as a linear formula x E lR2. for the linear approximation Ri to be of label Ri and is specified as a logical combination is called a linear region. Each inequalities pi(x) fi(x) If the collection of linear regions covers Iw’ without overlap, 4 and the vector flows of linear regions are identical at both sides of the boundary, the solution adjacent determined, its derivative itself and whenever an orbit leaves (enters) uniquely determined the phase space is Euclidean are continuous). (i.e., R2), and the flow is C’ (i.e., In other words, if the two conditions an linear region, the next (previous) linear region and transition at the boundary of linear regions is continuous. is uniquely the curve hold, is Otherwise, the behavior may not be well-defined. The state transition may run into an undefined specify status, cause several variables to change discontinuously, or fail to uniquely the next state. Our algorithm presented in this paper can handle both cases. A system of linear ODES with two state variables dominating each linear region is written as: dx -=Ax+b dt where As is obvious when det(A) the above formula can be rewritten as from the above, # OS By translating linear systems have only one fixed point at -A-lb E Iw2 the coordinate to the fixed point by v + x + A-lb, do - dt = Au. into several categories by computing The properties of linear flows in a two-dimensional phase space are simple. They can be classified of the coefficient matrix A. In particular, we can grasp the asymptotic behavior of orbits are real, the flow is usually from the eigenvalues divided spanned by the (i.e., a -f i . 6, where b # 0)) the flow can eigenvectors. When eigenvalues be categorized on the sign of a. The flow is called a spiral sink if a is negative, a center if a is zero, and a spiral source if a is positive. and eigenvectors. When eigenvalues by two invariant manifolds7 into subclasses depending into four independent and eigenvectors the eigenvalues are complex subflows 4 Boundaries of linear regions are allowed 5 Since this is almost always h As long as the two eigenvalues ’ One-dimensional (i.e., straight the case, we assume are different region to overlap. from each other. line) spanned by eigenvectors this throughout this paper. on an invariant manifold are isolated manifold and orbits elsewhere never come in the manifold. at the fixed point. Orbits from orbits elsewhere; orbits on an invariant manifold never leave the originated I: Nishida, S. Doshita/Artifcial Intelligence 75 (1995) 3-29 11 Orbits of a linear than a fixed point a given orbit flow do not have any point of inflection. Hence, each orbit other the way or straight. Furthermore, is either right-turning, left-turning, turns can be determined by examining the sign of at some point on it. Thus, the orbit is right-turning sign is zero; and left-turning if the sign is positive. if the sign is negative; straight if the 5. Properties of local flow In this section, we study properties of local flow that two-dimensional linear in convex regions of the phase space. Let us first introduce a few concepts flows to make characterize local flow. Definition 1. A convex polygon or a polyline, is dominated by a single linear flow. region of a phase space is called a cell, if it is bounded by a the cell, and it it has no fixed point or invariant manifold inside Geometrically, segment comprising boundary edges or an unbounded mappings. a cell is divided the boundary into the internal is called a boundary is delimited open region. Flow mappings by a vertex. A cell may be a finitely bounded as inter-boundary are represented region and the boundary. Each line edge. Each couple of adjacent region edge In order to represent the location of a point on the cell boundary, we introduce sampling lines defined as follows: Definition 2. Sampling the base, called line I& is represented as a pair (b, o), where b = (bi ,62) E R2, is a point on lk, and o = (ot,o2) E W2, 101 = 1 is the orientation of lk. By this convention, line /k, and we use a denotation “lot(p) the location x of a point p on lk can be represented b + u . 0”. We call this system of locating points sampling “the location of p is u with reSpXt to ck” an open interval p4 bounded by two points p and q, such that lot(p) respect lot(q) = CJ with respect smaller as “x = local coordinate ck associated with to ck” which reads = u with respect to ck”. Likewise we mean by “(u, U) with respect = u with to ck, to ck and u < u for two points p and q on lk, we say that p is = u with respect = u with respect to ck, and denote to ck. If lot(p) it as p -&k q. to ck and lot(q) lk = (b, o) partitions regions: one < 0) and the other to the left of it, {x 1 DI,( X) > 0}, the phase space into two disjoint than q with respect line A sampling to the right of it, {X 1 01,(x) where Q,(x) = 10 x (x - b)lz In general, points on a sampling line that delimits interval are called landmarks. It should be noted that the exact address of landmarks the structure of the flow. Instead, only a total ordering of landmarks on a sampling is needed. In two-dimensional words, the order of landmarks phase spaces. mapping 40 is order preserving. is preserved is not necessary from rI to r2. in the mapping for understanding line In other 5.1. Flow on the boundury of cells Let c bc a cell with local flow specified by a linear differential equation dx/ dt = Ax+ c, p bc a point on the boundary of c that is not a vertex, lk : (b, 0) = (( bl, b2), (01~02)) associated with lk. We can be a sampling see how the flow in c intersects with 1~. by evaluating of the cross product o x dx/dt: line passing p, and ck be a local coordinate the z-component dx [ 1 OXdr ~ =pr4 + y where p=of.a21 + (a22-all)o,o: ,1,20;, y= (a21.h + ad2 +~2)01 (alID + a12bz + c1)02. (transverse-left) to the sampling line or if the internal (positive). The flow is inward is to the ;ight of the sampling if the internal line and the flow is transverse-right line 1 if the region to the is in the left side of the sampling line. Such a point on the boundary region of the cell to the sampling to the cell. A source on the boundary We say that the flow is transverse-right sign of [o x dx/dt] _ IS negative of the cell sampling line and the flow is transverse-left is called an entrance entrance. Maximally enter boundary more boundary edge. Likewise we define an exit and an exit segment for outgoing Exit segments located on the boundary segment mappings play a useful role as intermediate mappings at the inter-boundary is a point on the it is an open polyline segment consisting of one or flow. as a special case. Inter-boundary representation segments of a boundary segments. An entrance at which orbits segment the cell are called entrance if it is a source; otherwise, is also regarded as an for generating include sinks transversely edge level. continuous flow A point on the boundary of a cell is called a singular node if the flow is tangent boundary at that point. A maximal aggregation of contiguous singular segment. Singular nodes and segments play a crucial role in understanding structure of the flow in a cell. From the definition point at -q/p with respect point, a closed Fig. 6. In general, a singular an invariant manifold; otherwise segment consists of a single point, we call it a singular node. to the is called a the (Eq. (3) ) there is only one singular segments are either an isolated in if the boundary edge is on isolated point. When a singular intervals is a polyline it consists of a single sharing a saddle node, as shown to lk if p f 0. Singular interval, or two closed singular nodes segment segment The orbit passing through a singular node lies at the same side of the boundary immediately before and after passing the singular segment, for orbits of linear flow 7: Nishida, S. Doshita/Artificial Intelligence 75 (1995) 3-29 13 (1) convex node segments (a) a point (b) a closed interval (c) two closed intervals connectedby a saddle node (2)aconcavenode Fig. 6. Geometric configuration of singular segments. Table 1 Rules for determining the type of a singular node-when the flow at the singular node is oriented in the same direction as that of the sampling line associated with the edge The curvature of the orbit right-turning left-turning The relative position of the cell with respect to the boundary to the right to the left concavenode convexnode convexnode concave node lies outside If the orbit the singular the boundary segment other immediately segment a COWC.X flows, a singular segment, we call the singular do not have any point of inflection. before and after passing node segment, or a convex node if it consists of a single point. Due to the properties of than a convex node segment consist of a single linear point, which we call a concave node. By definition, an orbit passing on a concave node lies inside of the cell immediately it. is determined by the curvature of orbit at the singular before and after the visit, and segment, the orientation of the flow at the tangent point and that of the the relationship the sampling type of a singular node when the orientation of the flow conforms to that of the edge at the tangent point. A similar set of rules are defined for the other case, where the flow at a singular node is the opposite line associated with the edge. Table 1 shows a set of rules for determining to the orientation of the edge. In what follows, entrance before and after passing The type of singular the side in which lies immediately the orbit segment between segments, segments. Since I3 7: Nishrdu, S. Doshitu/Artificial Intelligence 75 (1995) 3-29 exit segments and singular segments are generally referred to as boundary linear the flow of a cell, by a relatively flows have strong constraints on the geometry of orbits, we can obtain In particular, identify than one concave node on the analysis enables us to useful clues about if a given cell has at most one concave node on the boundary, we can uniquely the flow pattern boundary generate a numerical is not possible, qualitative plan for resolving ambiguities. simple computation. if there is more the cell. Even interpretation computation and unique inside In the rest of this section, we first describe the analysis the properties of local tlow in closed cells, in closed cells are simpler to open cells, for flow patterns and then extend than those in open cells. 5.2. Properties qf local$ow in closed cells Orbits in closed cells come from entrance a smooth closed curve C in a given cell such segments and tend towards exit segments. Let us consider the boundary of the cell but C does not pass on any fixed point. Let us also consider a point from some designated point po on C. Then, p walking around on C counterclockwise from some value 00 to 130 + 2rk the orientation of the flow B changes continuously to the given flow). (k E Z), where the integer k is called the index of C (with respect that C runs near The following fact is known about the index. Proposition 3. ( [ 2, p. 501). The index of C is zero if C does not contain any fixed point. Proposition 4. Let the number of convex node segments and concave nodes be n,. and n<, respectively. Then, n,. = n, + 2. (4) the location of point p on C by the length x (0 < x < ICI) Proof. Let us represent of the counterclockwise for the pass from PO, and think about 4(x), where 4 stands orientation of the flow at p with respect to the orientation of the tangent vector of C at 3 and the fact that the tangent vector of C at p. Then, by putting p will eventually is a from (0, 40) to (ICI, r$o - 27r) in the x-$ space, as shown continuous in Fig. 7. increase by 27~ as p walks around on C, we can say that 4(x) together Proposition function varying In the x-4 plane, convex and concave nodes appear as points where Cp(x) cuts across there is exactly intersect with 4(x) (n t Z) as shown in Fig. 8, and normally lines $ = kr and 4 = (k + 1)~ line $ = nr each horizontal one integer k such that horizontal in 0 < x < ICI. q Proposition 5. The maximal difference in the orientation ofJlow in a cell is at most rr. Z Nishida, S. Doshita/Artificial Intelligence 75 (1995) 3-29 Fig. 7. An x-q5 curve. C R convex node (2k- I)n __, Fig. 8. Appearance of concave and convex nodes in the x-4 plane. 16 7: Nishidu. S. Do.dkt/Art~cd intelligence 75 (1995) 3-29 Proof. The proposition is convex and all eigenspaces follows from our phase space partitioning policy are used for partitioning the phase space. that each cell 0 Definition 6. A boundary segment boundary, collected counterclockwise list for a cell is a sequence of singular nodes on the from some point on the boundary. Note that there could be more than one boundary segment list for a cell, depending on where to start. s Proposition 7. No bounduv nodes. segment List cti u cell contains two consecutive concave that concave nodes tic1 and Q are consecutive a closed convex to the boundary. Then, loop C which it follows from the assumption Proof. Assume list. Consider enough k and a pair x,, and Xh such that x,, < xl,, 4(x,) increasing at a neighborhood such that XI < x0, xh < XZ, 44x1) < #4x,), (0,,@2 ) be pairs of the orientations and x2, respectively. As $1 = 8, ~ +I and 42 = 02 - J+%z, we have segment in a given cell and is close that there exists an integer is [x,,, x,,] and let (6$,1,+1) and of the flow and the boundary edge at points at xl of X, and xh. Let XI and x2 be two values outside = kr, +(xh) = k + 1, and 4(x) in a boundary is included < &x2), 4(xb) We also have since C is convex. From the above, we have 02 = vh + 42 > *I + $6 + 77 = 0, + ?r This contradicts Proposition 5. (cid:228) 1 Proposition 8. No boundary segment list for u cell contains a sequence C.V.V.C. where C Lmd V stand for (I comuve node and convex node segment, respectively. Proof. The 4 values of two consecutive nodes of the same type with respect to convexity in the statement differ by r. Hence, that above, both right-turning in a contradiction with the way cells are built. for the two concave nodes should differ by r, which means in a single cell, resulting if there existed a pair of concave nodes as mentioned orbits are contained fl and left-turning the 4 values ’ We could avoid this problem by defining it as a circular list. However, we will fix the problem by introducing a notion of “normal” boundary segment list, as given in Definition 10. T. Nishida, S. Doshita/Artificial Intelligence 75 (1995) 3-29 17 It is noted that two consecutive convex nodes do not cause a contradiction, nodes may be located on comers of the boundary and we cannot the how there. for convex tell the orientation of Theorem 9. For any cell, form V.V. (v.(z)*, there exists a boundary segment list representation of the where V and C stand for a convex node segment and a concave node, respectively. Proof. From Propositions and concave nodes on the boundary of this theorem. 0 4, 7, and 8, it is clear that the only way of allocating convex in the statement list is exactly as described segment In particular, when a concave node is involved in a boundary a sequence of three consecutive between. The center of such convex node segments no concave nodes are involved, either one of the two convex node segments the center segment. convex node segments segment list, there exists that have no concave node in- is called the center segment. When is taken as Definition 10. A sequence of all boundary segment is called a counterclockwise boundary segment list. segments ordered clockwise from the center A boundary is said to pass through a cell from segment s of a cell is said to be to the right (left) of boundary segment p segment segment through that pass through a cell from right to left are of the same cell if s appears after (before) p in the counterclockwise list. An orbit through which the orbit leaves which the orbit enters similarly defined. The internal l all orbits pass through l all orbits pass through It is easy boundary left to right if the boundary segment the cell from left to right (left-right the cell from right to left (right-left the cell is to the right of the boundary flow of a cell is either: flow); or flow). the cell. Orbits to see whether a local flow is left-right of the flow at the boundary or vice versa. For example, one to the right segment immediately might see the orientation of the center segment. If a concave node c is involved in the boundary, with each of the two sequences of the boundary segment. then the orbit passing on c intersects segments between c and the center By taking into account the above propositions and the non-intersection constraint of orbits, we have the following proposition: Proposition 11. All orbits inside a cell are nested around the center segment. Now let us give a couple of examples. Suppose boundary of a cell, as shown in Fig. 9. Since no concave node segments are involved the boundary, the local flow inside this cell is uniquely as inter-boundary characterized that we are given a flow pattern on the in Fig. 9. Example of local flow in a closed cell ( I ) b i 0 : concave node : convex node segment . l : the center segment Fig. IO. Example of local Row in a closed cell (2) : invariant manifold \ segment mapping: cd a --f a b c. In order to characterize mappings, - three possibilities arise: q/r’(b) d 4 4(d) b, c&‘(b) ---f bc; (1) da + a~$(d), - (2) da--tab, -- cd+bc; the flow as inter-boundary edge (3) @‘(b)a+ab, d&‘(b) is an image of d by 4, and 4-l -_b, where 4(d) mapped this kind of ambiguities. For instance, we can track orbits passing on vertices and see which boundary element they intersect. is a point on the boundary to resolve to b by 4. We use numerical (b) computation that is cd++(d)c. segment level, as shown in Fig. 10. This case contains three concave nodes on the boundary, Suppose now that we are given a flow pattern on the boundary of a closed cell, as and we different patterns of local flow at the arise if we shown can think of eleven possible ways of qualitatively inter-boundary consider in Fig. Il. Much more possibilities edge level. Let us determine how many qualitatively different patterns of flow we have at the inter- different the case in which boundary patterns of flow in a cell with II concave nodes. First, let us consider no single orbit passes more than one concave node and let the number of possibilities in that case be P:(n). level. Let PC(~) be the number of qualitatively is recursively defined as follows: the case at the inter-boundary segment mapping P:(n) P;(o) = I; P,N(I)=l; 7: Nislzidu. S. Doslzita/Artijiciul Intelligence 75 (1995) 3-29 la (‘) bQi 'hi h ‘xh __ b (5) (7) (9) Fig. Il. Eleven possible ways of qualitatively different patterns of local flow for the cell shown in Fig. 10. 20 LC Nishida, S. DoshiiaIArtificial Intelligence 75 (1995) 3-29 p,N.(n,=~P;(i- l)P!(n-i) i=l (n>2). The values of P!(n) for small n are as follows: P;(2) = 2, P;(3) = 5, P!(4) = 14, P;(5) = 42, P!(6) = 132, P!(7) = 429,. . . Using P:(n) as defined above, P,-(n) is defined as follows: Pc(O)=l, Pc(l)=l, n-l &Cn,=C c p=l I<ii<iz<...<r,<n-I Pc(k)Pc(i, -k- 1) il -1 c !&I p-l X n /=I ( xPc(n PC(ij+l - ij - 1) - i,, - 1) n-l +xP&i)P&n-i-1) wheren32. i=O The values of PC (n) for small iz are: PC@) = 3, Pc(3) = 11, Pc(4) =45, PC(S) = 197, Pc(6) = 903, Pc(7) =4279,... 5.3. Properties of local flow in open cells Local flow in open cells are slightly harder to capture. problem of analyzing extend a boundary infinity or an edge at infinity and to give them appropriate attributes so that the following condition may be satisfied: the is to list with additional virtual boundary entities such as point at to that of closed cells. The idea local flow in open cells In this paper, we reduce segment ( 1) the number of convex segment nodes is that of concave nodes plus two, (2) in the extended boundary (3) list, and there is at least one entrance segment and exit segment segment flow at both sides of every singular segment is inward at one side, flow should be outward at the other side. rules, general decision Before describing let us study several examples. First, consider an open cell shown at the left side of Fig. 12. This cell consists of three real boundary is an exit edges. Two of them are part of invariant manifolds. The remaining one is in the opposite direction; if flow T Nishida. S. Doshita/Artijicial Intelligence 75 (I 995) 3-29 21 point at infinity . edge at infinity : point ?t infinity convex \ Fig. 12. Example of local flow in an open cell ( 1). point at infinity ‘.. _. I@) d ==a : of 1’ ocal flow in an open cell (2). virtual boundary two points at infinity and an edge segment. Three additional at infinity, are introduced. The constraint on the number of concave nodes and convex node segments the edge at infinity as an entrance to the fact that all the real exit segment diverge to the direction delimited by the two of the orbits crossing invariant manifolds is already satisfied. But as there is no entrance segment. This interpretation segment, we regard as t -+ -oc. conforms entities, Consider the local flow in an open cell shown in Fig. 13, which has a concave node exist on the is one less than what is required. We the local flow in a on the boundary. Although both entrance boundary, regard this cell as the following a convex node segment, and characterize the number of convex node segments segments and exit segments the edge at infinity set of mappings: ~I,-, a -+ 12,~03 +(a>, c+TZ, C + 4(a) d, at the inter-boundary segment level. Consider the flow in an open cell shown at the left side of Fig. 14. Both of the two edges comprising the boundary of the cell are portions of invariant manifolds boundary entities are viewed as one convex connected by a saddle node. All of these boundary node segment. There is no entrance segment nor an exit segment on the boundary. Three additional virtual boundary the constraints on into three segments: an entrance segment, boundary entities, we divide the edge at infinity entities are introduced. In order to satisfy 22 7: Nishidu. S. Doshitu/Artifcial Intelligence 75 (1995) 3-29 point at rnrmily * \\ enlrance segment: edge ar infiniry - I ,’ ,’ b : : : : AL_.__.-- segment one convex~ncde ccmex no&: yet another point at intinily -0.- .- enlrance segment edge at mfinity - 2 __..-- _.’ poiniat infinity Fig. 14. Example of local flow in open cell (3). an exit segment, and a convex node between the two. Fig. I.5 shows general rules for assigning attributes to the edge at infinity coo and two points of infinity pm,1 and poo,z. resulting Attribute assignments l When the edge of infinity from these rules have the following properties: is regarded as an entrance segment, there are orbits which diverge l When to the corresponding the edge of infinity direction as t + --co. is regarded as an exit segment, there are orbits which diverge to the corresponding direction as t -+ co. l When the edge of infinity is regarded as a singular segment, no orbit diverges to the corresponding direction as t + &tco. 6. The algorithm We have implemented takes a specification PSX2PWL and produces features, and (b) a set of transitions a program PSX2PWL of a system of piecewise based on the ideas presented above. linear ODES of the form (2) together with the type and geometric (a) a list of g-sources and g-sinks from g-sources to g-sinks. In top linear The PSX2PWL tween ues. The ysis. fies g-sinks as a collection sults obtained flow mappings pings. local of PSX2PWL is shown in Fig. 16. In the beginning, into a collection of cells, by boundaries level algorithm partitions regions the phase space and rest of the processing invariant manifolds is divided analyzes PSX2PWL of fixed points with local analysis local flow into the in each cell, in each cell, and characterizes the flow analysis, and g-sources of flow mappings. from local analysis as a whole, In global analysis, PSX2PWL of each cell, and examines possible compositions by computing and global be- real eigenval- anal- identi- in each cell re- together puts of the properties flow map- of ‘) The result does not depend on which one of the two points of infinity is chosen I: Nishida, S. Doshita/Art@cial Intelligence 7.5 (1995) 3-29 23 ( 1) If IL, = nc + 2, then: (a) If the open cell has no entrance segment, then e, (b) if the open cell has no exit segment, then e, (c) otherwise, e, is a convex node segment or its portion. is an exit segment; is an entrance segment; (2) If n, = nC + 1, then: (4 (b) (cl (d) If the cell has both an entrance segment and an exit segment, then coo is a convex node segment. If the cell has an entrance segment but no exit segment, then e, Similarly, if the cell has an exit segment but no entrance segment, then e, entrance segment. Otherwise (i.e., the cell has no entrance segment nor exit segment), then divide coo into two by introducing a new virtual vertex and regard the two subsegments resulting from subdivision as an entrance segment and an exit segment, respectively. The sign of eigenvalue associated with the adjacent invariant manifold is examined to determine the type of the two boundary segments: the boundary segment adjacent to an unstable manifold (an invariant manifold associated with a positive eigenvalue) is regarded as an exit segment, and the one adjacent to the stable manifold (an invariant manifold associate with a negative eigenvalue) is regarded as an entrance segment. is an exit segment. is an (3) If n, = n,, then: (a) If the cell has an entrance segment but no exit segment, then e, (b) Similarly, if the cell has an exit segment but no entrance segment, then e, is an exit segment. is an entrance segment. (c) Otherwise, regard pm,1 and p,,,,~ as convex nodes, and regard e, as an entrance segment (exit) if the boundary segment on the other side of a point at infinity is an exit (entrance) segment. 9 The type of points of infinity p,, of adjacent boundary segments, as follows: if not determined in the above, is determined based on the type ( 1) If the type of the two adjacent boundary segments of pm are the same, so is the type of (2) pf”,ne of the adjacent boundary segments of pm is a singular segment, so is pm. (3) Otherwise, pm is a convex node segment or its portion. where n, and nu are the numbers of “real” concave nodes and convex node segments on the boundary, respectively. Fig. 15. General rules for assigning attributes to virtual boundary segment list items. 7. Complete example use an example the algorithm, We have implemented In this section, we to illustrate how PSX2PWL works. For a more detailed description of the idea as a program called PSX2PwL. the reader is referred Consider an unstable multivibrator to [4]. shown in Fig. 17. By modeling the two transistors as ideal switching elements, we obtain a set of circuit equations: 24 7: Nishidu, S. Doshita/Art~jiciul Intelligence 75 (1995) 3-29 procedure PSX2PWL(s: system of PWL-ODES): begin partition the phase space into cells (C = {c;}); ; local analysis for each c, t C begin instantiate boundary segments; generate inter-boundary segment mappings; generate inter-boundary edge mappings; generate local flow mappings ITli for ci; end ; global analysis let M=(Jc,e(. mi; examine the properties of M by computing possible compositions m;, O...omi, of flow mappings mi, E M; end Fig. 16. The top level algorithm of PSX2PWL. R4 - Fig. 17. Unstable multivibrator. x < u,, 1 -$ dx uc(‘ -.x = ___ CI R2 dv -_.L = ’ dt -cc‘c + 0, - y C2R4 >3 -uc(‘ + c,, - .x- dy WC - Y CI RI ‘dt = C2R3 > ’ (5) where variables x and y denote voltage across capacitors Cl and C2, respectively. As for other parameters, L’,, = 0.7, L’CC = 5, {CI 3 C2, RI, R2, R3, R4) > 0. let us assume For simplicity, two linear regions: Rl.0 and Ro,J. The former stands for a state in which TR] is ON and TR:! is OFF, while the latter stands for the opposite the state in which the activation pattern of the two transistors are exactly that we have only T. Nishida, S. DoshitaIArtificial Intelligence 75 (1995) 3-29 25 : I , I :c I -’ “” ‘Ai : l : : :: : : : : : :a ______,___._.____________:-.___----------- * x 0: ~ 12 .k... _______ ____ c4 c5 c6 11 ‘4 Fig. 18. Partitioning the space for (5) into cells. Fig. 19. Local analysis that PSX2PWL has produced for (5). of that in Rl,o. Note that these two linear regions overlap with each other and hence the uniqueness of the solution does not hold at boundaries. PSX2PWL first partitions linear regions Rl.0 and ROJ into cells, as shown in Fig. 18. Local analysis identifies local flow in each cell, as shown in Fig. 19. By global analysis, PSX2PWL finds the following contracting recursive mapping: - ~ ~ &,2 0 42 : l2,-m a -+ 45(b) a c l2,-oo a. This convinces PSX2PWL of the existence of transverse to &(b) a, where an attractor (in weaker sense) that is 26 Fig. 20. Global analysis that PSX2PWL has produced for (S) from sources St and Furthermore, PSX tinds out that all orbits except those originated & that are located in place at infinity will eventually be absorbed into the attractor found above. Fig. 20 illustrates global analysis by PSX2PWL. The analysis correctly captures the qualitative behavior of the unstable multivibrator. 8. Related work In general, there are two extremes in the spectrum of approaches rely on numerical to qualitative phase a running computation: the result general knowledge about dynamical is to heavily and interpreting space analysis. One extreme numerical simulator search by incorporating techniques partly drawn by a numerical systems. Sacks provided a global picture of activities at MIT. from computer vision and computational simulator. Yip [7] [ 61 presented a method for analyzing in an intelligent way. One can constrain systems. One can also use to interpret phase portraits to analyze discrete [ 11 took this approach continuous systems. Abelson geometry is to rely more on qualitative methods. By intensive use of knowl- systems, we can strongly guide the search process and the result The other extreme edge about dynamical is less likely explosion, by invoking a numerical as soon as ambiguity approach we have taken in this paper is closer to the second extreme. to be affected by numerical to avoid combinatorial errors. It is possible is detected. The computation Sacks [ 51 took a similar approach, POINCARE. First, PSX2PWL partitions general way than POINCARE. Although POINCARE partitions that are parallel polyline, to the x- or y- axis, PSX2PWL partitions the phase space by eigenspaces. too. Our approach has two advantages over Sacks’ in a more lines the phase space by any the phase space into linear regions it only by straight to partition allowing The second and more essential difference sis. Sacks used transition graphs as internal is the internal used for analy- representation. With transition graphs alone, representation Z Nishida, S. Doshita/Arrificial Intelligence 75 (1995) 3-29 27 (a) spiral sink (b) center (c) spiral source transition graph representation: 0 S3 Fig. 21. Transition graph representation of spiral sink, spiral source, and center. (a) (b) (c) f such that f( 0 a) c ?%z. f such that f( 0 a) = z. f such that f(z) > ?%. Fig. 22. Flow map representation of spiral sink, spiral source, and center. it is impossible and centers, as shown the mapping representation to make the important distinction in Fig. 21. In contrast, between it is possible spiral sinks, spiral sources, the three by to distinguish through in Fig. 22 (a) employed in this paper, as shown (c). Unfortunately, what has been done is severely limited ality of phase spaces. The bottleneck open question n-dimensional is the algorithm is how to develop a general algorithm flow. to in the number of the dimension- for local analysis. An interesting for generating flow mappings for 9. Concluding remark In this paper, we have presented a program PSX2PWL systems of PWL-ODES with two state variables. The program ideas: about a bundle of orbits, mapping between hyperplanes, representing deriving global behavior by analyzing reasoning that explores phase portraits of is based on four simple a bundle of orbits as a flow the structure of lo The first author has developed an algorithm for three-dimensional piecewise linear flow. It is still limited, but a big progress because the current version can analyze a system of ODES that manifest chaotic behavior. 28 II Nishida, S. Doshira/Arrificial Intelligence 75 (I 995) 3-29 and taking advantage of strong constraints of two-dimensional piecewise flow mappings, linear flow. We have given a detailed analysis of local flow in a cell, which brings about insights the ideas as a program called PSX2PWL and tested it against several examples. the algorithm. We have implemented in designing Acknowledgment We would like to thank the late Mr. Yoichi Shimada Mr. Kenji Satoh for writing a program which counts on the formula given in this paper. References for discussion. We also thank based the number of ambiguities 1 I 1 H. Abelson, M. Eisenberg, M. Halfant, J. Katzenelson, E. Sacks, G.J. Sussman, J. Wisdom and K. Yip. Intelligence 12 1 J. Guckenheimer in scientific computing, &mm. ACM 32 ( 1989) 546-562. and P. Holmes, Nonlinear Oscilkztinns, Dynamical Systems, trnd Bijiircations of Vector Fields Berlin, 1983). 13 1 M.W. Hirsch and S. Smale, Diferenrial (Springer-Veriag, Equarions, Dynamical Systems, and Linear Algebra (Academic Press, New York. 1974). 14 I T. Nishida and S. Doshita, PSX: a program that explores phase portraits of two-dimensional equations, Memoirs of the Faculty of Engineering, Kyoto University 52 (4) piecewise ( 1990) linear differential 3I1-3.55. I.51 E. Sacks, Automatic qualitative analysis of ordinary equations using piecewise linear approximations, Tech. Report 1031, MIT Artificial differential Intelligence Laboratory ( 1988). 16 I E. Sacks, Qualitative analysis of continuous dynamic systems by intelligent numeric experimentation, in: Third Infernational Workshop on Qualitative Physics, Stanford, CA ( 1989) 17 I K. M.-k. Yip, Generating global behaviors using deep knowledge of local dynamics, in: Proceedings AAAI-Ri3, St. Paul, MN (1988) 280-285 Postscript This translation represents work automated introduced 1991a) describes (Nishida, 1991b) several versions of PSXs have been constructed (Nishida, state variables. topology of phase portraits. These 1993a) gives a general the number of dimensionality behaviors as reported called PSX3. Extension though. into n-dimensional in (Nishida, ideas were framework of the approach. that was accomplished analysis of general nonlinear ODES with by June 1990. After that, and much progress has been made. two to reason about (Nishida, into PSX2NL. incorporated a notion of flow grammar (Nishida, 1993b) from two to three, which enables 1994). The ideas were incorporated is an extension in to reason about chaotic into a program to us, phase space still is a big challenge References (Nishida, 1991a) T. Nishida, K. Mizutani, A. Kubota and S. Doshita, Automated phase portrait analysis by in: Proceedings AAAI-91, Anaheim, CA ( 199 1) 8 I 1-8 16. and quantitative analysis, integrating qualitative T. Nishida. S. Doshita/Artifcial Intelligence 75 (1995) 3-29 29 (Nishida, 1991b) T. Nishida and S. Doshita, A geometric approach to total envisioning, in: Proceedings IJCAI-91, Sydney, NSW (1991) 1150-1155. (Nishida, 1993a) T. Nishida, Generating quasi-symbolic Proceedings AAAI-93, Washington, DC (1993) 554-559. representation of three-dimensional flow, in: (Nishida, 1993b) T. Nishida, K. Mizutani and Shuji Doshita, Automated analysis of qualitative behaviors of piecewise linear ordinary differential equations, New Gen. Comput. 11 (2) ( 1993) 159-177. (Nishida, 1994) T. Nishida, Qualitative reasoning for automated exploration for chaos, in: Proceedings AAAI- 94, Seattle, WA (1994) 1211-1216. 