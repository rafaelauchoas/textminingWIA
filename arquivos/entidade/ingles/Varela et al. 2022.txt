Available online at www.sciencedirect.comAvailable online at www.sciencedirect.comAvailable online at www.sciencedirect.comProcedia Computer Science 00 (2022) 000–000Procedia Computer Science 00 (2022) 000–000Procedia Computer Science 00 (2022) 000–000Procedia Computer Science 207 (2022) 726–735www.elsevier.com/locate/procediawww.elsevier.com/locate/procediawww.elsevier.com/locate/procedia26th International Conference on Knowledge-Based and Intelligent Information & Engineering26th International Conference on Knowledge-Based and Intelligent Information & Engineering26th International Conference on Knowledge-Based and Intelligent Information & EngineeringSystems (KES 2022)Systems (KES 2022)Systems (KES 2022)Fully automatic segmentation of the choroid in non-EDI OCTFully automatic segmentation of the choroid in non-EDI OCTFully automatic segmentation of the choroid in non-EDI OCTimages of patients with multiple sclerosisimages of patients with multiple sclerosisimages of patients with multiple sclerosisEmilio L´opez-Varelaa,b,Emilio L´opez-Varelaa,b,Emilio L´opez-Varelaa,b,∗, Noelia Barreiraa,b, Nuria Olivier Pascualc, Emma Garcia Benc,∗, Noelia Barreiraa,b, Nuria Olivier Pascualc, Emma Garcia Benc,∗, Noelia Barreiraa,b, Nuria Olivier Pascualc, Emma Garcia Benc,Sara Rubio Cidc, Manuel G. Penedoa,bSara Rubio Cidc, Manuel G. Penedoa,bSara Rubio Cidc, Manuel G. Penedoa,baVARPA Group, Biomedical Research Institute of A Coru˜na (INIBIC), University of A Coru˜na, Xubias de Arriba 84, A Coru˜na 15006, SpainaVARPA Group, Biomedical Research Institute of A Coru˜na (INIBIC), University of A Coru˜na, Xubias de Arriba 84, A Coru˜na 15006, SpainaVARPA Group, Biomedical Research Institute of A Coru˜na (INIBIC), University of A Coru˜na, Xubias de Arriba 84, A Coru˜na 15006, SpainbCITIC-Research Center of Information and Communication Technologies, University of A Coru˜na, Campus de Elvi˜na s/n, A Coru˜na 15071, SpainbCITIC-Research Center of Information and Communication Technologies, University of A Coru˜na, Campus de Elvi˜na s/n, A Coru˜na 15071, SpainbCITIC-Research Center of Information and Communication Technologies, University of A Coru˜na, Campus de Elvi˜na s/n, A Coru˜na 15071, SpaincServizo de Oftalmolox´ıa, Complejo Hospitalario Universitario de Ferrol (CHUF), Av. da Residencia S/N, Ferrol 15405, SpaincServizo de Oftalmolox´ıa, Complejo Hospitalario Universitario de Ferrol (CHUF), Av. da Residencia S/N, Ferrol 15405, SpaincServizo de Oftalmolox´ıa, Complejo Hospitalario Universitario de Ferrol (CHUF), Av. da Residencia S/N, Ferrol 15405, SpainAbstractAbstractAbstractMultiple Sclerosis (MS) is a chronic neurological disease, in which immune-mediated mechanisms lead to pathological processesMultiple Sclerosis (MS) is a chronic neurological disease, in which immune-mediated mechanisms lead to pathological processesMultiple Sclerosis (MS) is a chronic neurological disease, in which immune-mediated mechanisms lead to pathological processesof neurodegeneration. Optical coherence tomography (OCT) has recently begun to be used to diagnose and monitor patients withof neurodegeneration. Optical coherence tomography (OCT) has recently begun to be used to diagnose and monitor patients withof neurodegeneration. Optical coherence tomography (OCT) has recently begun to be used to diagnose and monitor patients withMS. Morphological changes in the choroid have been linked to the onset of MS, so an accurate segmentation of this layer isMS. Morphological changes in the choroid have been linked to the onset of MS, so an accurate segmentation of this layer isMS. Morphological changes in the choroid have been linked to the onset of MS, so an accurate segmentation of this layer iscritical. Conventional OCT has several limitations in obtaining accurate images of the choroid, which has been improved throughcritical. Conventional OCT has several limitations in obtaining accurate images of the choroid, which has been improved throughcritical. Conventional OCT has several limitations in obtaining accurate images of the choroid, which has been improved throughthe use of systems such as Enhanced Depth Imaging (EDI) OCT. Unfortunately, many longitudinal studies that have collectedthe use of systems such as Enhanced Depth Imaging (EDI) OCT. Unfortunately, many longitudinal studies that have collectedthe use of systems such as Enhanced Depth Imaging (EDI) OCT. Unfortunately, many longitudinal studies that have collectedsamples over the years in the past have been performed using highly variable settings and without the use of the EDI protocol (orsamples over the years in the past have been performed using highly variable settings and without the use of the EDI protocol (orsamples over the years in the past have been performed using highly variable settings and without the use of the EDI protocol (orsimilar variants). For these reasons, in this work we propose a series of fully automatic approaches, based on convolutional neuralsimilar variants). For these reasons, in this work we propose a series of fully automatic approaches, based on convolutional neuralsimilar variants). For these reasons, in this work we propose a series of fully automatic approaches, based on convolutional neuralnetworks, capable of robustly segmenting the choroid in OCT images without using the EDI protocol. To test the robustness andnetworks, capable of robustly segmenting the choroid in OCT images without using the EDI protocol. To test the robustness andnetworks, capable of robustly segmenting the choroid in OCT images without using the EDI protocol. To test the robustness andefficiency of our method, we performed experiments on a public dataset and a collected one. The Dice score obtained by the bestefficiency of our method, we performed experiments on a public dataset and a collected one. The Dice score obtained by the bestefficiency of our method, we performed experiments on a public dataset and a collected one. The Dice score obtained by the bestproposed architecture is 89.7 for the public dataset, and 93.7 for the collected dataset.proposed architecture is 89.7 for the public dataset, and 93.7 for the collected dataset.proposed architecture is 89.7 for the public dataset, and 93.7 for the collected dataset.© 2022 The Authors. Published by Elsevier B.V.© 2022 The Authors. Published by Elsevier B.V.© 2022 The Authors. Published by Elsevier B.V.© 2022 The Authors. Published by Elsevier B.V.This is an open access article under the CC BY-NC-ND license (http://creativecommons.org/licenses/by-nc-nd/4.0/)This is an open access article under the CC BY-NC-ND license (https://creativecommons.org/licenses/by-nc-nd/4.0)This is an open access article under the CC BY-NC-ND license (http://creativecommons.org/licenses/by-nc-nd/4.0/)This is an open access article under the CC BY-NC-ND license (http://creativecommons.org/licenses/by-nc-nd/4.0/)Peer-review under responsibility of the scientific committee of the 26th International Conference on Knowledge-Based and Peer-review under responsibility of the scientific committee of the KES International.Peer-review under responsibility of the scientific committee of the KES International.Peer-review under responsibility of the scientific committee of the KES International.Intelligent Information & Engineering Systems (KES 2022)Keywords: Optical Coherence Tomography; Multiple Sclerosis; Choroid segmentation; Convolutional Neural NetworksKeywords: Optical Coherence Tomography; Multiple Sclerosis; Choroid segmentation; Convolutional Neural NetworksKeywords: Optical Coherence Tomography; Multiple Sclerosis; Choroid segmentation; Convolutional Neural Networks1. Introduction1. Introduction1. IntroductionMultiple Sclerosis (MS) is a chronic neurological disease of the central nervous system, in which immune-mediatedMultiple Sclerosis (MS) is a chronic neurological disease of the central nervous system, in which immune-mediatedMultiple Sclerosis (MS) is a chronic neurological disease of the central nervous system, in which immune-mediatedmechanisms lead to pathological processes of inflammation and neurodegeneration [18]. MS mainly affects youngmechanisms lead to pathological processes of inflammation and neurodegeneration [18]. MS mainly affects youngmechanisms lead to pathological processes of inflammation and neurodegeneration [18]. MS mainly affects youngadults, and is currently the leading cause of non-traumatic neurological disability in this population group. Approx-adults, and is currently the leading cause of non-traumatic neurological disability in this population group. Approx-adults, and is currently the leading cause of non-traumatic neurological disability in this population group. Approx-imately 50% of affected patients will require walking assistance within 15 years of disease onset, and 2/3 of themimately 50% of affected patients will require walking assistance within 15 years of disease onset, and 2/3 of themimately 50% of affected patients will require walking assistance within 15 years of disease onset, and 2/3 of them∗ Corresponding author. Tel.: +34-881011330; fax: +34-981167160.∗ Corresponding author. Tel.: +34-881011330; fax: +34-981167160.∗ Corresponding author. Tel.: +34-881011330; fax: +34-981167160.E-mail address: e.lopezv@udc.esE-mail address: e.lopezv@udc.esE-mail address: e.lopezv@udc.es1877-0509 © 2022 The Authors. Published by Elsevier B.V.1877-0509 © 2022 The Authors. Published by Elsevier B.V.1877-0509 © 2022 The Authors. Published by Elsevier B.V.1877-0509 © 2022 The Authors. Published by Elsevier B.V.This is an open access article under the CC BY-NC-ND license (http://creativecommons.org/licenses/by-nc-nd/4.0/)This is an open access article under the CC BY-NC-ND license (https://creativecommons.org/licenses/by-nc-nd/4.0)This is an open access article under the CC BY-NC-ND license (http://creativecommons.org/licenses/by-nc-nd/4.0/)This is an open access article under the CC BY-NC-ND license (http://creativecommons.org/licenses/by-nc-nd/4.0/)Peer-review under responsibility of the scientific committee of the KES International.Peer-review under responsibility of the scientific committee of the 26th International Conference on Knowledge-Based and Intelligent Peer-review under responsibility of the scientific committee of the KES International.Peer-review under responsibility of the scientific committee of the KES International.Information & Engineering Systems (KES 2022)10.1016/j.procs.2022.09.12810.1016/j.procs.2022.09.1281877-0509ScienceDirectAvailable online at www.sciencedirect.comAvailable online at www.sciencedirect.comAvailable online at www.sciencedirect.comAvailable online at www.sciencedirect.comProcedia Computer Science 00 (2022) 000–000Procedia Computer Science 00 (2022) 000–000Procedia Computer Science 00 (2022) 000–000www.elsevier.com/locate/procediawww.elsevier.com/locate/procediawww.elsevier.com/locate/procedia26th International Conference on Knowledge-Based and Intelligent Information & Engineering26th International Conference on Knowledge-Based and Intelligent Information & Engineering26th International Conference on Knowledge-Based and Intelligent Information & EngineeringSystems (KES 2022)Systems (KES 2022)Systems (KES 2022)Fully automatic segmentation of the choroid in non-EDI OCTFully automatic segmentation of the choroid in non-EDI OCTFully automatic segmentation of the choroid in non-EDI OCTimages of patients with multiple sclerosisimages of patients with multiple sclerosisimages of patients with multiple sclerosisEmilio L´opez-Varelaa,b,Emilio L´opez-Varelaa,b,Emilio L´opez-Varelaa,b,∗, Noelia Barreiraa,b, Nuria Olivier Pascualc, Emma Garcia Benc,∗, Noelia Barreiraa,b, Nuria Olivier Pascualc, Emma Garcia Benc,∗, Noelia Barreiraa,b, Nuria Olivier Pascualc, Emma Garcia Benc,Sara Rubio Cidc, Manuel G. Penedoa,bSara Rubio Cidc, Manuel G. Penedoa,bSara Rubio Cidc, Manuel G. Penedoa,baVARPA Group, Biomedical Research Institute of A Coru˜na (INIBIC), University of A Coru˜na, Xubias de Arriba 84, A Coru˜na 15006, SpainaVARPA Group, Biomedical Research Institute of A Coru˜na (INIBIC), University of A Coru˜na, Xubias de Arriba 84, A Coru˜na 15006, SpainbCITIC-Research Center of Information and Communication Technologies, University of A Coru˜na, Campus de Elvi˜na s/n, A Coru˜na 15071, SpainaVARPA Group, Biomedical Research Institute of A Coru˜na (INIBIC), University of A Coru˜na, Xubias de Arriba 84, A Coru˜na 15006, SpainbCITIC-Research Center of Information and Communication Technologies, University of A Coru˜na, Campus de Elvi˜na s/n, A Coru˜na 15071, SpainbCITIC-Research Center of Information and Communication Technologies, University of A Coru˜na, Campus de Elvi˜na s/n, A Coru˜na 15071, SpaincServizo de Oftalmolox´ıa, Complejo Hospitalario Universitario de Ferrol (CHUF), Av. da Residencia S/N, Ferrol 15405, SpaincServizo de Oftalmolox´ıa, Complejo Hospitalario Universitario de Ferrol (CHUF), Av. da Residencia S/N, Ferrol 15405, SpaincServizo de Oftalmolox´ıa, Complejo Hospitalario Universitario de Ferrol (CHUF), Av. da Residencia S/N, Ferrol 15405, SpainAbstractAbstractAbstractMultiple Sclerosis (MS) is a chronic neurological disease, in which immune-mediated mechanisms lead to pathological processesMultiple Sclerosis (MS) is a chronic neurological disease, in which immune-mediated mechanisms lead to pathological processesMultiple Sclerosis (MS) is a chronic neurological disease, in which immune-mediated mechanisms lead to pathological processesof neurodegeneration. Optical coherence tomography (OCT) has recently begun to be used to diagnose and monitor patients withof neurodegeneration. Optical coherence tomography (OCT) has recently begun to be used to diagnose and monitor patients withof neurodegeneration. Optical coherence tomography (OCT) has recently begun to be used to diagnose and monitor patients withMS. Morphological changes in the choroid have been linked to the onset of MS, so an accurate segmentation of this layer isMS. Morphological changes in the choroid have been linked to the onset of MS, so an accurate segmentation of this layer isMS. Morphological changes in the choroid have been linked to the onset of MS, so an accurate segmentation of this layer iscritical. Conventional OCT has several limitations in obtaining accurate images of the choroid, which has been improved throughcritical. Conventional OCT has several limitations in obtaining accurate images of the choroid, which has been improved throughcritical. Conventional OCT has several limitations in obtaining accurate images of the choroid, which has been improved throughthe use of systems such as Enhanced Depth Imaging (EDI) OCT. Unfortunately, many longitudinal studies that have collectedthe use of systems such as Enhanced Depth Imaging (EDI) OCT. Unfortunately, many longitudinal studies that have collectedthe use of systems such as Enhanced Depth Imaging (EDI) OCT. Unfortunately, many longitudinal studies that have collectedsamples over the years in the past have been performed using highly variable settings and without the use of the EDI protocol (orsamples over the years in the past have been performed using highly variable settings and without the use of the EDI protocol (orsamples over the years in the past have been performed using highly variable settings and without the use of the EDI protocol (orsimilar variants). For these reasons, in this work we propose a series of fully automatic approaches, based on convolutional neuralsimilar variants). For these reasons, in this work we propose a series of fully automatic approaches, based on convolutional neuralsimilar variants). For these reasons, in this work we propose a series of fully automatic approaches, based on convolutional neuralnetworks, capable of robustly segmenting the choroid in OCT images without using the EDI protocol. To test the robustness andnetworks, capable of robustly segmenting the choroid in OCT images without using the EDI protocol. To test the robustness andnetworks, capable of robustly segmenting the choroid in OCT images without using the EDI protocol. To test the robustness andefficiency of our method, we performed experiments on a public dataset and a collected one. The Dice score obtained by the bestefficiency of our method, we performed experiments on a public dataset and a collected one. The Dice score obtained by the bestefficiency of our method, we performed experiments on a public dataset and a collected one. The Dice score obtained by the bestproposed architecture is 89.7 for the public dataset, and 93.7 for the collected dataset.proposed architecture is 89.7 for the public dataset, and 93.7 for the collected dataset.proposed architecture is 89.7 for the public dataset, and 93.7 for the collected dataset.© 2022 The Authors. Published by Elsevier B.V.© 2022 The Authors. Published by Elsevier B.V.© 2022 The Authors. Published by Elsevier B.V.This is an open access article under the CC BY-NC-ND license (http://creativecommons.org/licenses/by-nc-nd/4.0/)This is an open access article under the CC BY-NC-ND license (http://creativecommons.org/licenses/by-nc-nd/4.0/)This is an open access article under the CC BY-NC-ND license (http://creativecommons.org/licenses/by-nc-nd/4.0/)Peer-review under responsibility of the scientific committee of the KES International.Peer-review under responsibility of the scientific committee of the KES International.Peer-review under responsibility of the scientific committee of the KES International.Keywords: Optical Coherence Tomography; Multiple Sclerosis; Choroid segmentation; Convolutional Neural NetworksKeywords: Optical Coherence Tomography; Multiple Sclerosis; Choroid segmentation; Convolutional Neural NetworksKeywords: Optical Coherence Tomography; Multiple Sclerosis; Choroid segmentation; Convolutional Neural Networks1. Introduction1. Introduction1. IntroductionMultiple Sclerosis (MS) is a chronic neurological disease of the central nervous system, in which immune-mediatedMultiple Sclerosis (MS) is a chronic neurological disease of the central nervous system, in which immune-mediatedMultiple Sclerosis (MS) is a chronic neurological disease of the central nervous system, in which immune-mediatedmechanisms lead to pathological processes of inflammation and neurodegeneration [18]. MS mainly affects youngmechanisms lead to pathological processes of inflammation and neurodegeneration [18]. MS mainly affects youngmechanisms lead to pathological processes of inflammation and neurodegeneration [18]. MS mainly affects youngadults, and is currently the leading cause of non-traumatic neurological disability in this population group. Approx-adults, and is currently the leading cause of non-traumatic neurological disability in this population group. Approx-adults, and is currently the leading cause of non-traumatic neurological disability in this population group. Approx-imately 50% of affected patients will require walking assistance within 15 years of disease onset, and 2/3 of themimately 50% of affected patients will require walking assistance within 15 years of disease onset, and 2/3 of themimately 50% of affected patients will require walking assistance within 15 years of disease onset, and 2/3 of them∗ Corresponding author. Tel.: +34-881011330; fax: +34-981167160.∗ Corresponding author. Tel.: +34-881011330; fax: +34-981167160.∗ Corresponding author. Tel.: +34-881011330; fax: +34-981167160.E-mail address: e.lopezv@udc.esE-mail address: e.lopezv@udc.esE-mail address: e.lopezv@udc.es1877-0509 © 2022 The Authors. Published by Elsevier B.V.1877-0509 © 2022 The Authors. Published by Elsevier B.V.1877-0509 © 2022 The Authors. Published by Elsevier B.V.This is an open access article under the CC BY-NC-ND license (http://creativecommons.org/licenses/by-nc-nd/4.0/)This is an open access article under the CC BY-NC-ND license (http://creativecommons.org/licenses/by-nc-nd/4.0/)This is an open access article under the CC BY-NC-ND license (http://creativecommons.org/licenses/by-nc-nd/4.0/)Peer-review under responsibility of the scientific committee of the KES International.Peer-review under responsibility of the scientific committee of the KES International.Peer-review under responsibility of the scientific committee of the KES International.2Emilio López-Varela et al. / Procedia Computer Science 207 (2022) 726–735 Emilio L´opez-Varela et al / Procedia Computer Science 00 (2022) 000–000727will be unable to carry out their usual work activities. This has a serious impact on the economic burden of patients,impairing their quality of life and limiting their personal relationships [23]. According to the results of the GlobalBurden Disease Study 2016 [26], the average prevalence of MS is increasing since the 1990s, being currently about30 cases per 100,000 population. This increase in prevalence, coupled with the deterioration in the quality of life ofpatients suffering from this disease, motivate the creation of new treatments and techniques for early detection andmonitoring of the disease.One of the main techniques used for the detection and follow-up of MS is magnetic resonance imaging (MRI).However, like any diagnostic test, MRI has limitations. An abnormal MRI does not necessarily imply the existence ofMS, as there are other diseases that cause very similar brain damage. On the other hand, an MRI with a normal resultdoes not completely rule out MS, as there may be spinal cord damage or lesions not visible on the MRI. Finally, the useof MRI is limited by other factors such as its cost and the long time needed to obtain the images [10]. These reasonsled to the use of alternative imaging techniques to characterize and detect MS, such as Optical Coherence Tomography(OCT). OCT is a non-invasive in vivo technique based on the different reflectance of the layers present in the ocularstructure that allows the acquisition of cross-sectional images of the retina with semi-histological resolution. The OCTvolumes can be obtained in different regions of the eye (macular, peripapillary, etc.) using different configurationparameters. This results in volumes with different resolutions, number of slices and characteristics depending on theregion and way of capture [17, 16].Several clinical studies have linked changes in different retinal layers to the development of MS [2, 6, 5, 8, 7] soOCT has recently started to be used to detect and characterize MS. One of the relevant biomarkers for the analysisof MS on OCT images is the characterization of changes in the choroid, a vascular tissue that provides oxygen andnutrition to the outer retinal layers. Different morphological changes in the choroid have been related to the onset andprogression of MS, so accurate segmentation of this layer is essential to diagnose and follow the progression of MSusing OCT imaging. In contrast to the other retinal layers, the choroid is usually segmented manually in the clinicalsetting which is time consuming and laborious. So a fully automated system is significantly useful, helping cliniciansto make a decision about diagnosis and treatments more robustly, reducing the subjectivity of the process. However,conventional OCT has several limitations in obtaining accurate images of the choroid. The choroid is located posteriorto the retinal pigment epithelium (RPE), a layer that absorbs large amounts of light. This, together with the lightscattering caused by the dense vascular structure of the choroid, results in a poorly defined choroid in conventionalOCT images, limiting and hindering its characterization and segmentation due to its diffuse structure and boundaries[28]. To solve these problems and improve the visualization of the choroid, in 2008, Spaide et al. proposed the EDI-OCT (Enhanced Depth Imaging OCT) system. [24]. Essentially, in this system the spectral domain OCT objectivelens is placed closer to the eye. This causes the backscattered light from the choroid to be closer to the zero-delayline producing an image where the choroid is much more sharply defined. In Figure 1 an image obtained using theEDI protocol and three images obtained using a conventional OCT are shown. The difference between the two typescan be seen at the lower limit of the choroid. Unfortunately, many longitudinal studies that have collected samplesover the years in the past as well as current clinical analyses have been performed without the use of the EDI protocol(or similar variants). Moreover, these studies have been performed in different regions of the eye, using OCT capturedevices with different configurations, resulting in studies with quite diverse OCT images. For all these reasons, there isa need for a fully automatic system capable of robustly segmenting the choroid in images obtained in different regionsof the eye without using the EDI protocol.Due to the great relevance of general layer segmentation for different pathologies, several works have been pro-posed aiming at choroid segmentation [12, 29, 22]. Salafian et al. [22] presented an automatic choroidal segmentationmethod based on transforming each EDI-OCT image to a neutrosophic space. On the other hand, in Kajic et al. [12], atwo-stage texture-based statistical model for choroidal segmentation of normal and pathological eyes was presented.Recently, convolutional neural networks have been applied to segment images obtained from various imaging modal-ities vastly improving the results obtained with classical methods [27, 1, 19]. Regarding the segmentation of differentretinal layers, the most commonly used models are encoder-decoder variants of fully convolutional network architec-tures [15] such as the UNet [21]. In George et al. [9], a Chan Vese model for segmenting EDI-OCT images of corneaand choroid in the macula region was presented. In Chen et al. [3], the choroid is segmented in macular EDI-OCTimages using a convolutional neural network that detects the lower and upper edges of the choroid. Finally, in Li etal. [13], all retinal layers are segmented in peripapillary images of glaucoma patients using a two-stage multiscale 728 Emilio López-Varela et al. / Procedia Computer Science 207 (2022) 726–735EmilioL´opez-Varelaetal/ProcediaComputerScience00(2022)000–0003Fig.1.ImageobtainedusingtheEDIprotocol(left)andthreeimagesobtainedusingconventionalOCT(right).convolutionalneuralnetwork.Insummary,allofthestateoftheartworkspresentedhereproposemethodstoseg-mentthechoroid,oralternativelyfindtheupperandlowerboundaries,inanaccuratemannerindifferentpathologiccontexts.Allofthesepapersuseimagesofasingleregion(eithermacularorperipapillary)oruseEDIorsimilarenhancedimagescapturedwithasingleconfiguration.Aspreviouslydiscussed,theproblemisthatmanyroutineclinicalstudiesaswellaslongitudinalstudiescollectedinthepasthavebeencreatedwithoutusingtheEDIprotocol.Inaddition,theuseofOCTimagesobtainedinasingleregionoftheeye(eithermacularorperipapillary)withaspecificparametersettingislimitedintheirpotentialclinicalutility.AllthesefactorsmakeitimportanttodevelopasegmentationmethodcapableofrobustlysegmentingthechoroidinOCTimagesobtainedindifferentregionsoftheeyeusingdifferentsettingsandwithoutusingEDI.Inthiswork,weproposearobustapproach,basedonconvolutionalneuralnetworks,fortheautomaticsegmentationofthechoroidinOCTnon-EDIimageswithvariousconfigurations.Inaseriesofexperiments,wecomparedifferentneuralarchitectureswithvariouscombinationsofencoderstodeterminethebestsegmentationapproach.Totestboththerobustnessandtheefficiencyofourmethod,weperformedexperimentsintwodifferentdatasets.Thus,weuseapublicdatasettocompareourapproacheswiththestateoftheartandacollecteddatasetofnon-EDIimagescapturedwithseveralsettingsindifferenteyeregionsfromhealthyandMSpatients.Tothebestofourknowledge,thisworkisthefirstapproachtoattempttosegmentthechoroidinalargesetofnon-EDIOCTimageswithvaryingconfigurations.2.MaterialsandMethods2.1.DatasetsTwodifferentdatasetswereusedtocarryouttheexperiments.WeusedthepublicdatasetcollectedbyLietalforcomparisonwiththestateoftheart[13].ThisdatasetconsistsofperipapillaryOCTimagesobtainedfrom61subjectsusingtheDRIOCT-1Atlantis(TopconCorporation,Tokyo,Japan).Eachimageislabeledwithseveralretinallayersincludingthechoroid.Inourcaseweusedonlythechoroidlabeltoperformourexperiments.Moredetailsaboutthisdatasetcanbefoundat[13].Additionally,wecollectadatasetthatconsistsofatotalof224imageswithdifferentconfigurations,randomlyextractedfrom50OCTcubesfromapreviousstudy.Thesecubesbelongto37differentsubjectswhere22ofthe37subjectsand,respectively,103ofthe224imagescorrespondtohealthysubjectswhile15subjectsand121imagescorrespondtopatientssufferingfromMS.AllcubeswerecreatedusingtwoequivalentSpectralisROCTcapturedevicesfromHeidelbergEngineering.Withinthesecubestherearefourdifferenttypesofcubesinwhichboththeeyeregionandtheresolutionoftheimagesvary.ThefirsttypecorrespondstoradialOCTcubeswith27slicescenteredintheperipapillaryregion,whereastheremainingthreetypescorrespondtocubescenteredinthemacularregion.Thesecondtypecorrespondstocubeswith61slicesoftheposteriorpoleandanimageresolutionof768x496.Thethirdtypecorrespondstocubeswith25slicescenteredonthemaculaandanimageresolutionof512x496.Finally,thefourthtypecorrespondsto512-slicecubesthatareobtainedasanintermediateby-productofanophthalmologicaltestfrequentlyperformedintheclinicalsettingandhavearesolutionof512x496.Emilio López-Varela et al. / Procedia Computer Science 207 (2022) 726–735 729EmilioL´opez-Varelaetal/ProcediaComputerScience00(2022)000–0003Fig.1.ImageobtainedusingtheEDIprotocol(left)andthreeimagesobtainedusingconventionalOCT(right).convolutionalneuralnetwork.Insummary,allofthestateoftheartworkspresentedhereproposemethodstoseg-mentthechoroid,oralternativelyfindtheupperandlowerboundaries,inanaccuratemannerindifferentpathologiccontexts.Allofthesepapersuseimagesofasingleregion(eithermacularorperipapillary)oruseEDIorsimilarenhancedimagescapturedwithasingleconfiguration.Aspreviouslydiscussed,theproblemisthatmanyroutineclinicalstudiesaswellaslongitudinalstudiescollectedinthepasthavebeencreatedwithoutusingtheEDIprotocol.Inaddition,theuseofOCTimagesobtainedinasingleregionoftheeye(eithermacularorperipapillary)withaspecificparametersettingislimitedintheirpotentialclinicalutility.AllthesefactorsmakeitimportanttodevelopasegmentationmethodcapableofrobustlysegmentingthechoroidinOCTimagesobtainedindifferentregionsoftheeyeusingdifferentsettingsandwithoutusingEDI.Inthiswork,weproposearobustapproach,basedonconvolutionalneuralnetworks,fortheautomaticsegmentationofthechoroidinOCTnon-EDIimageswithvariousconfigurations.Inaseriesofexperiments,wecomparedifferentneuralarchitectureswithvariouscombinationsofencoderstodeterminethebestsegmentationapproach.Totestboththerobustnessandtheefficiencyofourmethod,weperformedexperimentsintwodifferentdatasets.Thus,weuseapublicdatasettocompareourapproacheswiththestateoftheartandacollecteddatasetofnon-EDIimagescapturedwithseveralsettingsindifferenteyeregionsfromhealthyandMSpatients.Tothebestofourknowledge,thisworkisthefirstapproachtoattempttosegmentthechoroidinalargesetofnon-EDIOCTimageswithvaryingconfigurations.2.MaterialsandMethods2.1.DatasetsTwodifferentdatasetswereusedtocarryouttheexperiments.WeusedthepublicdatasetcollectedbyLietalforcomparisonwiththestateoftheart[13].ThisdatasetconsistsofperipapillaryOCTimagesobtainedfrom61subjectsusingtheDRIOCT-1Atlantis(TopconCorporation,Tokyo,Japan).Eachimageislabeledwithseveralretinallayersincludingthechoroid.Inourcaseweusedonlythechoroidlabeltoperformourexperiments.Moredetailsaboutthisdatasetcanbefoundat[13].Additionally,wecollectadatasetthatconsistsofatotalof224imageswithdifferentconfigurations,randomlyextractedfrom50OCTcubesfromapreviousstudy.Thesecubesbelongto37differentsubjectswhere22ofthe37subjectsand,respectively,103ofthe224imagescorrespondtohealthysubjectswhile15subjectsand121imagescorrespondtopatientssufferingfromMS.AllcubeswerecreatedusingtwoequivalentSpectralisROCTcapturedevicesfromHeidelbergEngineering.Withinthesecubestherearefourdifferenttypesofcubesinwhichboththeeyeregionandtheresolutionoftheimagesvary.ThefirsttypecorrespondstoradialOCTcubeswith27slicescenteredintheperipapillaryregion,whereastheremainingthreetypescorrespondtocubescenteredinthemacularregion.Thesecondtypecorrespondstocubeswith61slicesoftheposteriorpoleandanimageresolutionof768x496.Thethirdtypecorrespondstocubeswith25slicescenteredonthemaculaandanimageresolutionof512x496.Finally,thefourthtypecorrespondsto512-slicecubesthatareobtainedasanintermediateby-productofanophthalmologicaltestfrequentlyperformedintheclinicalsettingandhavearesolutionof512x496.4EmilioL´opez-Varelaetal/ProcediaComputerScience00(2022)000–000Thissetwasdividedintotwogroups.Ontheonehand,agroupconsistingof196imageswasusedtotrainandtestthemodels.Theimagesinthisgroupwerelabeledbyanexpert,sothateachimagehasanassociatedsegmentationmask,whereallpixelswerelabeledasbackgroundorchoroid.Ontheotherhand,theremaining28imageswerelabeledbythreedifferentmedicalexperts.Eachexpertlabeledthelowercontourofthechoroidineachimagetwice(onceusingtherawimageandonceusinganimagewithimprovedlocalcontrast)givingatotalofsixedgelabelsperimage.Thissetof28imagesservestovalidatewhethertherearedifferencesbetweenthesegmentationperformedbyourapproachesandthatperformedbydifferentmedicalexperts.ExamplesofbothlabelingscanbeseeninFigure2.Fig.2.Ontheleft,anexampleofOCTimageanditsassociatedsegmentationmask.Ontheright,anexampleofthecontourlinelabeledbyoneoftheexpertsinanexampleimage.2.2.SoftwareandHardwareresourcesThisworkwasdevelopedinPython(version3.9.5)andusingPyTorch(version1.9.1withcuda11.2)[20]tocreate,trainandvalidatethemodels.TheencodersofthemodelswereobtainedfromthePyTorchsegmentationmodellibrary[30].OpenCV(4.5.3)andNumpy(1.20.3)wereusedtoperformimageprocessingoperations.RegardingHardware,trainingandvalidationwerecarriedoutusinganIntel(R)Core(TM)i9-9900KCPU@3.60GHzandanNVIDIAGeForceRTX2080Ti.2.3.NetworkarchitecturesInthiswork,westudytheapplicationofseveralbasearchitecturesofconvolutionalneuralnetworkstosegmentthechoroid.Asbasearchitecturesweuse,ontheonehand,theUNet[21],anarchitecturethatextractsfeaturemapsatdifferentscalesinaprogressivemanner.Inthisarchitecture,thelossofinformationisavoidedthroughtheuseofskipconnections,withwhichthefeaturemapsarereconstructedattheoriginalimagesize.Ontheotherhand,weuseaFeaturePyramidNetwork(FPN)[14]adaptedtoasemanticsegmentationtask.Thistypeofarchitectureallowsextractingfeaturemapsatdifferentscales,whichareusedtogethertoperformthefinalmodelprediction.Thefeaturemapsobtainedatdifferentscalesallowtomakeamoreaccuratesegmentationofthedifferentobjectsandtheirboundaries.Figure3showsthegeneralstructureoftheUNetarchitecture(left)andthegeneralstructureoftheFPNarchitecture(right).Eachconvolutionallayerisfollowedbyabatchnormalizationlayerandanonlinearlayer.ALogSoftmaxisappliedafterthefinalconvolutionallayerinthechannelaxis.Thisway,theclassofeachpixel(backgroundorchoroid)issetbysimplyselectingthechannelwiththemaximumvalue.Thepartsofeacharchitecturethatcorrespondtothenetworkencoder,inchargeofextractingandencodingthefeaturemapsthatwillleadtotheprediction,arerepresentedinblue.Itisessentialtohaveasuitableencoder,whichhastheabilitytoextractfeaturemapscontainingallthenecessaryinformationtosegmentthetargetintoimageswithmanyvariationswithdifferenttexturesandnoises.Forthisreason,foreachofthearchitectures,wetestedthreedifferentencoderconfigurationswithdifferentcharacteristicsandnumberofparameters,resultinginsixconfigurations.Theseencodersarepartofneuralarchitecturescommonlyusedinsimilarapplicationdomains: 730 Emilio López-Varela et al. / Procedia Computer Science 207 (2022) 726–7356Emilio L´opez-Varela et al / Procedia Computer Science 00 (2022) 000–000Table 1. Transformations applied to images in each batch. From each group only one transformation can be applied at a time.Group 1Group 2Group 3Group 4Group 5Group 6Group 7AppliedTransformationsCoarseDropoutElastic Transform,Piecewise AffineShift ScaleHorizontalRotateFlipGaussian Blur,Brightness Contrast,Multiplicative Noise,BlurCLAHEGauss NoiseRegarding model evaluation, all models were evaluated in two ways. On the one hand, for the test set of images,the Dice score (DSC) and pixel accuracy (PA) (Eq. 2) were obtained, where X represents the prediction region andY is the ground truth region. On the other hand, for the 28 independent images where the lower contour was labeled,the Euclidean distance (EUC) (Eq. 2) was calculated. The values obtained by the network were compared with thoseobtained by the three medical experts using a student’s t-test.DS C =Y|2X· |X∩+Y||||PA = |XY|∩Y||EUC =(x1 −x2)2 + (y1 −y2)2(cid:31)(2)3. Results and Discussion3.1. Public dataset resultsFirst, we show the results obtained by evaluating our models on the public dataset along with the state of the art.Table 2 shows the DSC and PA obtained for the different architectures tested along with the baseline of the dataset.Figure 4 shows an example of an OCT image with the overlay mask predicted by each network. These images showqualitatively the differences between the segmentations performed by the different networks as well as their errors.As can be seen, several models outperform the state of the art in choroid detection. Specifically, the FPN architectureusing a Densenet201 as an encoder is particularly effective in this task.Table 2. DSC and PA obtained for the segmentation of the public dataset for all the models tested. The best values are marked in bold.MetricDSCPALiet al[13]89.289.2Densenet20189.589.0UNetEfficientb088.886.8EfficientDensenetb789.389.820189.790.0FPNEfficientb088.989.0Efficientb789.489.43.2. Collected dataset resultsWe compared the lower choroidal boundary detected by the networks with the average of the six labelings of thelower choroidal contour performed by the experts. The distances obtained for the three models using the UNet basearchitecture are 704 for Densenet201, 930 for Efficientnet-b0 and 695 for Efficientnet-b7. The distances obtainedfor the three models using the FPN base architecture are 657 for Densenet201, 881 for Efficientnet-b0 and 701 forEfficientnet-b7. For reference, the expert who performed the closest labeling to the mean of experts obtained a distanceof 662. These results show that there are significant differences in the contours predicted by the different networks.Specifically UNet and FPN using Efficientnet-b0 as encoder give worse results than the other models. The resultsobtained by the best performing network (FPN Densenet) versus the six labelings performed by the experts are shownand compared in Figure 5. Table 3 shows an expert vs. expert confusion matrix (the network is also included), wherethe mean EUC obtained by comparing the contours labeled by one expert with each of the others is shown.Table 4 shows the DSC and PA obtained for the different architectures tested. As can be seen, as in the case ofthe public dataset, the FPN using the Densenet201 is the network with the best segmentation results. Figure 6 showsseveral examples of segmentation masks obtained by this model. It can be seen how the network is able to segmentEmilioL´opez-Varelaetal/ProcediaComputerScience00(2022)000–0005•DenselyConnectedConvolutionalNetwork[11]:DenseNetnetworksarebasedontheprogressiveconcatena-tionoffeaturesfrompreviouslayersinordertostrengthenfeaturepropagation.InthisworktheDenseNet201wasusedasanencoder.•Efficientnet[25]:Efficientnetcorrespondstoafamilyofmodelscreatedbybalancingnetworkdepth,widthandresolutioninanefficientandeffectiveway.Inthiswork,Efficientnet-boandEfficientnet-b7wereusedasencoders.Fig.3.GeneralstructureoftheUNetarchitecture(left)andgeneralstructureoftheFPNarchitecture(right).Thepartsofeacharchitecturethatcorrespondtothenetworkencoderarerepresentedinblue.2.4.TrainingdetailsRegardingthepublicdataset,theparametersandthedivisionofthedatasetspecifiedintheoriginalwork[13]wereused.Specifically,thesplitratiobetweenthetraining,validationandtestsetswas6:2:2.Thelearningratewassetto0.001anddecreasedbyanorderofmagnitudeevery20epochs.Moreover,theAdamoptimizerwasused.Wealsodividedthe196imagesofthecollecteddatasetintothreeparts,100imagesfortraining,48imagesforvalidationand48imagesfortest.IneachsettheratioofhealthyandMSimageswas54:46andtherewasthesameproportionofeachOCTimagetype.Regardingthetrainingprocess,knowingthesmallsizeofourdatasetandtoavoidoverfitting,theencodersofthemodelswerefirstinitializedusingapre-trainingontheImageNetdataset[4].Themodelswerethenpre-trainedontheoriginalpublicdataset.Thisgreatlyhelpstoadapttooursegmentationtaskbyavoidingoverfitting.Eachofthemodelswastrainedonourdatasetfor80epochs,usinganinitiallearningrateof0.001thatwasreducedbyhalfanorderofmagnitudeevery10epochs.Momentumandweightdecaycoefficientsweresetto0.9and0.0001respectively.WeusedAdamasanoptimizertotrainthemodelwithabatchsizeof1.Tomakethemodelmorerobustandavoidoverfitting,anexhaustivedataaugmentationprocesshasalsobeenapplied.Sometransformationsweregroupedsothatonlyonefromthegroupcouldbeappliedatatime.Table1showsallthetransformationsappliedtotheimages.Aslossfunctionweusethesumoftwolossfunctions.WeusetheDicelossandtheCrossEntropyloss(Eq.1)wheregiandpiindicatesthegroundtruthandtheprobabilityinpredictionofpixelxbelongingtoofclassi,andMisthenumberofclassesinthesegmentationnetwork.Dice=1−1MM(cid:31)i=1(cid:30)2(cid:29)x∈Ωpi(x)·gi(x)(cid:29)x∈Ωpi(x)+(cid:29)x∈Ωgi(x)(cid:28)CrossEntropy=−1MM(cid:31)i=1gilog(pi)(1)6Emilio López-Varela et al. / Procedia Computer Science 207 (2022) 726–735 Emilio L´opez-Varela et al / Procedia Computer Science 00 (2022) 000–000731Table 1. Transformations applied to images in each batch. From each group only one transformation can be applied at a time.Group 1Group 2Group 3Group 4Group 5Group 6Group 7AppliedTransformationsCoarseDropoutElastic Transform,Piecewise AffineShift ScaleRotateHorizontalFlipGaussian Blur,BlurBrightness Contrast,CLAHEMultiplicative Noise,Gauss NoiseRegarding model evaluation, all models were evaluated in two ways. On the one hand, for the test set of images,the Dice score (DSC) and pixel accuracy (PA) (Eq. 2) were obtained, where X represents the prediction region andY is the ground truth region. On the other hand, for the 28 independent images where the lower contour was labeled,the Euclidean distance (EUC) (Eq. 2) was calculated. The values obtained by the network were compared with thoseobtained by the three medical experts using a student’s t-test.DS C =2|X+Y∩Y|||PA = |XY|∩Y||EUC =(cid:31)(x1 −x2)2 + (y1 −y2)2(2)· |X|3. Results and Discussion3.1. Public dataset resultsFirst, we show the results obtained by evaluating our models on the public dataset along with the state of the art.Table 2 shows the DSC and PA obtained for the different architectures tested along with the baseline of the dataset.Figure 4 shows an example of an OCT image with the overlay mask predicted by each network. These images showqualitatively the differences between the segmentations performed by the different networks as well as their errors.As can be seen, several models outperform the state of the art in choroid detection. Specifically, the FPN architectureusing a Densenet201 as an encoder is particularly effective in this task.Table 2. DSC and PA obtained for the segmentation of the public dataset for all the models tested. The best values are marked in bold.MetricDSCPALiet al[13]89.289.2Densenet20189.589.0UNetEfficientb088.886.8Efficientb789.389.8Densenet20189.790.0FPNEfficientb088.989.0Efficientb789.489.43.2. Collected dataset resultsWe compared the lower choroidal boundary detected by the networks with the average of the six labelings of thelower choroidal contour performed by the experts. The distances obtained for the three models using the UNet basearchitecture are 704 for Densenet201, 930 for Efficientnet-b0 and 695 for Efficientnet-b7. The distances obtainedfor the three models using the FPN base architecture are 657 for Densenet201, 881 for Efficientnet-b0 and 701 forEfficientnet-b7. For reference, the expert who performed the closest labeling to the mean of experts obtained a distanceof 662. These results show that there are significant differences in the contours predicted by the different networks.Specifically UNet and FPN using Efficientnet-b0 as encoder give worse results than the other models. The resultsobtained by the best performing network (FPN Densenet) versus the six labelings performed by the experts are shownand compared in Figure 5. Table 3 shows an expert vs. expert confusion matrix (the network is also included), wherethe mean EUC obtained by comparing the contours labeled by one expert with each of the others is shown.Table 4 shows the DSC and PA obtained for the different architectures tested. As can be seen, as in the case ofthe public dataset, the FPN using the Densenet201 is the network with the best segmentation results. Figure 6 showsseveral examples of segmentation masks obtained by this model. It can be seen how the network is able to segmentEmilioL´opez-Varelaetal/ProcediaComputerScience00(2022)000–0005•DenselyConnectedConvolutionalNetwork[11]:DenseNetnetworksarebasedontheprogressiveconcatena-tionoffeaturesfrompreviouslayersinordertostrengthenfeaturepropagation.InthisworktheDenseNet201wasusedasanencoder.•Efficientnet[25]:Efficientnetcorrespondstoafamilyofmodelscreatedbybalancingnetworkdepth,widthandresolutioninanefficientandeffectiveway.Inthiswork,Efficientnet-boandEfficientnet-b7wereusedasencoders.Fig.3.GeneralstructureoftheUNetarchitecture(left)andgeneralstructureoftheFPNarchitecture(right).Thepartsofeacharchitecturethatcorrespondtothenetworkencoderarerepresentedinblue.2.4.TrainingdetailsRegardingthepublicdataset,theparametersandthedivisionofthedatasetspecifiedintheoriginalwork[13]wereused.Specifically,thesplitratiobetweenthetraining,validationandtestsetswas6:2:2.Thelearningratewassetto0.001anddecreasedbyanorderofmagnitudeevery20epochs.Moreover,theAdamoptimizerwasused.Wealsodividedthe196imagesofthecollecteddatasetintothreeparts,100imagesfortraining,48imagesforvalidationand48imagesfortest.IneachsettheratioofhealthyandMSimageswas54:46andtherewasthesameproportionofeachOCTimagetype.Regardingthetrainingprocess,knowingthesmallsizeofourdatasetandtoavoidoverfitting,theencodersofthemodelswerefirstinitializedusingapre-trainingontheImageNetdataset[4].Themodelswerethenpre-trainedontheoriginalpublicdataset.Thisgreatlyhelpstoadapttooursegmentationtaskbyavoidingoverfitting.Eachofthemodelswastrainedonourdatasetfor80epochs,usinganinitiallearningrateof0.001thatwasreducedbyhalfanorderofmagnitudeevery10epochs.Momentumandweightdecaycoefficientsweresetto0.9and0.0001respectively.WeusedAdamasanoptimizertotrainthemodelwithabatchsizeof1.Tomakethemodelmorerobustandavoidoverfitting,anexhaustivedataaugmentationprocesshasalsobeenapplied.Sometransformationsweregroupedsothatonlyonefromthegroupcouldbeappliedatatime.Table1showsallthetransformationsappliedtotheimages.Aslossfunctionweusethesumoftwolossfunctions.WeusetheDicelossandtheCrossEntropyloss(Eq.1)wheregiandpiindicatesthegroundtruthandtheprobabilityinpredictionofpixelxbelongingtoofclassi,andMisthenumberofclassesinthesegmentationnetwork.Dice=1−1MM(cid:31)i=1(cid:30)2(cid:29)x∈Ωpi(x)·gi(x)(cid:29)x∈Ωpi(x)+(cid:29)x∈Ωgi(x)(cid:28)CrossEntropy=−1MM(cid:31)i=1gilog(pi)(1) 732 Emilio López-Varela et al. / Procedia Computer Science 207 (2022) 726–735Emilio L´opez-Varela et al / Procedia Computer Science 00 (2022) 000–0008others.Expert 11Expert 12Expert 21Expert 22Expert 31Expert 32NetworkMetricDSCPATable 3. Expert vs. expert confusion matrix, showing the mean EUC obtained by comparing the contours labeled by one expert with each of theExpert 11Expert 21Expert 22Expert 31Expert 32Network0------Densenet20192.590.5Expert 123910-----UNetEfficientb089.088.88118230----8237898550---85883311309850--8347309769518670-6295748327838077110EfficientDensenetb793.091.120193.792.3FPNEfficientb091.688.2Efficientb793.190.1Table 4. DSC and PA obtained for the segmentation of the collected dataset by all the models tested. The best values are marked in bold.experts when it comes to delimiting the lower contour of the choroid. This is due to the fact that this contour is oftendiffuse, which makes its exact delimitation complicated. We can see how the proposed network delimits this contourin a similar way to the experts, without significant differences. In Figure 6 it can be seen how this network obtainsaccurate segmentation results in images obtained from both peripapillary and macula regions. This network is able toadapt to different types of images, where the texture and shape of the choroid changes very abruptly, producing robustsegmentation of this layer under highly variable conditions. This approach is followed by UNet using Efficientnet-b7as the encoder. From the results, it can be seen how, in general, FPN seems to perform better using a Densenet typeencoder, while UNet seems to perform better using an Efficientnet type encoder. The Densenet type encoder, throughits dense connections, seems to contribute in a better way to make the set of final FPN multiscale feature maps morecoherent with each other. For the UNet case, the Efficientnet encoder seems to better extract the features of eachscale individually improving the reconstruction of the final feature maps. Models using Efficientnet-b0 as the encoderobtain the worst segmentation results. As can be seen in Figure 4, these models produce false positives in regions thatdo not belong to the choroid. This encoder is much smaller so it has a smaller number of parameters (4M) than theDensenet201 (18M) or the Efficientnet-b7 (63M). A smaller encoder can, a priori, help to generalize better and reducepossible overfitting in small datasets like ours. However, in this problem, it does not work since the size of the modellimits its ability to accommodate the intense variety of textures and shapes presented by the choroid in the image set.4. ConclusionsMany routine clinical studies as well as longitudinal studies collected in the past have been created without usingthe EDI protocol or similar variants. In addition, the use of OCT images obtained in a single region of the eye (eithermacular or peripapillary) and with a specific parameter setting is limited in their potential clinical utility. In this paper,we present several approaches to accurately segment the choroid in OCT non-EDI images with varying configurations.We demonstrate how several architectures, most notably the FPN with a Densenet201 encoder, is capable of robustlyaccomplishing this task. This network outperforms the state of the art and is able to segment the choroid in imageswith different texture and shape characteristics. We showed its effectiveness on several datasets and prove that thelower boundary of the choroid predicted by the network does not differ significantly from those labeled manually bydifferent clinical experts. This segmentation is performed accurately and automatically in both healthy subjects andMS patients which facilitates the use of choroid appearance as a biomarker. This helps the clinical expert in the task ofdiagnosis and follow-up of this disease, lightening his work and reducing the subjectivity of the process. In the future,this method can be integrated into a larger system that uses the complete 3D OCT cubes to make a comprehensiveanalysis of the patient.EmilioL´opez-Varelaetal/ProcediaComputerScience00(2022)000–0007Fig.4.Exampleofthesegmentationmaskspredictedbythedifferentmodels.Blueareasshowthepredictionthatmatchthelabeling,whileredandyellowareasshowthefalsepositivesandfalsenegatives,respectively.Fig.5.Fromlefttoright:Theoriginalimage,thecontoursdelimitedbytheexpertsaswellasthedifferencesbetweenthecontoursdelimitedbythenetworkandtheexperts.Inthislastimage,thecontourdelimitedbythenetworkisshowninyellow,theaveragecontourisrepresentedinredwhereastheareaofthedispersionofthecontourisshowninblue.thechoroidinimageswithverydifferentcharacteristics,eveninimageswherethelowerboundaryofthechoroidissubtle.3.3.DiscussionTheresultspresentedshowhowseveraloftheproposedapproachessurpassthestateoftheartinsegmentingthechoroid,evenwithoutusingtheEDIprotocol.Amongtheproposedapproaches,theFPNusingtheDensenet201encoderobtainsthebestsegmentationresults.AscanbeseeninFigure5,thereissomevariabilityamongmedical8Emilio López-Varela et al. / Procedia Computer Science 207 (2022) 726–735 Emilio L´opez-Varela et al / Procedia Computer Science 00 (2022) 000–000733Table 3. Expert vs. expert confusion matrix, showing the mean EUC obtained by comparing the contours labeled by one expert with each of theothers.Expert 11Expert 12Expert 21Expert 22Expert 31Expert 32NetworkExpert 110------Expert 123910-----Expert 218118230----Expert 228237898550---Expert 3185883311309850--Expert 328347309769518670-Network6295748327838077110Table 4. DSC and PA obtained for the segmentation of the collected dataset by all the models tested. The best values are marked in bold.MetricDSCPADensenet20192.590.5UNetEfficientb089.088.8Efficientb793.091.1Densenet20193.792.3FPNEfficientb091.688.2Efficientb793.190.1experts when it comes to delimiting the lower contour of the choroid. This is due to the fact that this contour is oftendiffuse, which makes its exact delimitation complicated. We can see how the proposed network delimits this contourin a similar way to the experts, without significant differences. In Figure 6 it can be seen how this network obtainsaccurate segmentation results in images obtained from both peripapillary and macula regions. This network is able toadapt to different types of images, where the texture and shape of the choroid changes very abruptly, producing robustsegmentation of this layer under highly variable conditions. This approach is followed by UNet using Efficientnet-b7as the encoder. From the results, it can be seen how, in general, FPN seems to perform better using a Densenet typeencoder, while UNet seems to perform better using an Efficientnet type encoder. The Densenet type encoder, throughits dense connections, seems to contribute in a better way to make the set of final FPN multiscale feature maps morecoherent with each other. For the UNet case, the Efficientnet encoder seems to better extract the features of eachscale individually improving the reconstruction of the final feature maps. Models using Efficientnet-b0 as the encoderobtain the worst segmentation results. As can be seen in Figure 4, these models produce false positives in regions thatdo not belong to the choroid. This encoder is much smaller so it has a smaller number of parameters (4M) than theDensenet201 (18M) or the Efficientnet-b7 (63M). A smaller encoder can, a priori, help to generalize better and reducepossible overfitting in small datasets like ours. However, in this problem, it does not work since the size of the modellimits its ability to accommodate the intense variety of textures and shapes presented by the choroid in the image set.4. ConclusionsMany routine clinical studies as well as longitudinal studies collected in the past have been created without usingthe EDI protocol or similar variants. In addition, the use of OCT images obtained in a single region of the eye (eithermacular or peripapillary) and with a specific parameter setting is limited in their potential clinical utility. In this paper,we present several approaches to accurately segment the choroid in OCT non-EDI images with varying configurations.We demonstrate how several architectures, most notably the FPN with a Densenet201 encoder, is capable of robustlyaccomplishing this task. This network outperforms the state of the art and is able to segment the choroid in imageswith different texture and shape characteristics. We showed its effectiveness on several datasets and prove that thelower boundary of the choroid predicted by the network does not differ significantly from those labeled manually bydifferent clinical experts. This segmentation is performed accurately and automatically in both healthy subjects andMS patients which facilitates the use of choroid appearance as a biomarker. This helps the clinical expert in the task ofdiagnosis and follow-up of this disease, lightening his work and reducing the subjectivity of the process. In the future,this method can be integrated into a larger system that uses the complete 3D OCT cubes to make a comprehensiveanalysis of the patient.EmilioL´opez-Varelaetal/ProcediaComputerScience00(2022)000–0007Fig.4.Exampleofthesegmentationmaskspredictedbythedifferentmodels.Blueareasshowthepredictionthatmatchthelabeling,whileredandyellowareasshowthefalsepositivesandfalsenegatives,respectively.Fig.5.Fromlefttoright:Theoriginalimage,thecontoursdelimitedbytheexpertsaswellasthedifferencesbetweenthecontoursdelimitedbythenetworkandtheexperts.Inthislastimage,thecontourdelimitedbythenetworkisshowninyellow,theaveragecontourisrepresentedinredwhereastheareaofthedispersionofthecontourisshowninblue.thechoroidinimageswithverydifferentcharacteristics,eveninimageswherethelowerboundaryofthechoroidissubtle.3.3.DiscussionTheresultspresentedshowhowseveraloftheproposedapproachessurpassthestateoftheartinsegmentingthechoroid,evenwithoutusingtheEDIprotocol.Amongtheproposedapproaches,theFPNusingtheDensenet201encoderobtainsthebestsegmentationresults.AscanbeseeninFigure5,thereissomevariabilityamongmedical 734 Emilio López-Varela et al. / Procedia Computer Science 207 (2022) 726–735EmilioL´opez-Varelaetal/ProcediaComputerScience00(2022)000–0009Fig.6.MultipleexamplesofthesegmentationmaskspredictedbytheFPNmodelwithDensenet201encoder.Thepredictedareasthatmatchthelabelingareshowninbluewhilethefalsepositivesandfalsenegativesareshowninredandyellow,respectively.AcknowledgementsThisresearchwasfundedbyInstitutodeSaludCarlosIII,GovernmentofSpain,DTS18/00136researchproject;MinisteriodeCienciaeInnovaci´onyUniversidades,GovernmentofSpain,RTI2018-095894-B-I00researchproject;MinisteriodeCienciaeInnovaci´on,GovernmentofSpainthroughtheresearchprojectwithreferencePID2019-108435RB-I00;Conseller´ıadeCultura,Educaci´oneUniversidade,XuntadeGalicia,GruposdeReferenciaCom-petitiva,grantref.ED431C2020/24;AxenciaGalegadeInnovaci´on(GAIN),XuntadeGalicia,grantref.IN845D2020/38;CITIC,CentrodeInvestigaci´ondeGaliciaref.ED431G2019/01,receivesfinancialsupportfromCon-seller´ıadeEducaci´on,UniversidadeeFormaci´onProfesional,XuntadeGalicia,throughtheERDF(80%)andSecre-tar´ıaXeraldeUniversidades(20%).EmilioL´opezVarelaacknowledgesitssupportunderFPIGrantProgramthroughPID2019-108435RB-I00project.10ReferencesEmilio López-Varela et al. / Procedia Computer Science 207 (2022) 726–735 Emilio L´opez-Varela et al / Procedia Computer Science 00 (2022) 000–000735[1] Borkovkina, S., Camino, A., Janpongsri, W., Sarunic, M.V., Jian, Y., 2020. Real-time retinal layer segmentation of oct volumes with gpuaccelerated inferencing using a compressed, low-latency neural network. Biomedical optics express 11, 3968–3984.[2] Britze, J., Frederiksen, J.L., 2018. Optical coherence tomography in multiple sclerosis. Eye 32, 884–888.[3] Chen, M., Wang, J., Oguz, I., VanderBeek, B.L., Gee, J.C., 2017. Automated segmentation of the choroid in edi-oct images with retinalpathology using convolution neural networks, in: Fetal, Infant and Ophthalmic Medical Image Analysis. Springer, pp. 177–184.[4] Deng, J., Dong, W., Socher, R., Li, L.J., Li, K., Fei-Fei, L., 2009.Imagenet: A large-scale hierarchical image database, in: 2009 IEEEconference on computer vision and pattern recognition, Ieee. pp. 248–255.[5] Di Staso, F., Ciancaglini, M., Abdolrahimzadeh, S., D’APOLITO, F., Scuderi, G., 2019. Optical coherence tomography of choroid in commonneurological diseases. in vivo 33, 1403–1409.[6] Do˘gan, ¨U., Ulas¸, F., T¨urko˘glu, S¸ .A., ¨Og¨un, M.N., A˘gca, S., 2019. Eyes are mirror of the brain: comparison of multiple sclerosis patients andhealthy controls using oct. International Journal of Neuroscience 129, 848–855.[7] Esen, E., Sizmaz, S., Demir, T., Demirkiran, M., Unal, I., Demircan, N., 2016. Evaluation of choroidal vascular changes in patients withmultiple sclerosis using enhanced depth imaging optical coherence tomography. Ophthalmologica 235, 65–71.[8] Garcia-Martin, E., Jarauta, L., Vilades, E., Ara, J.R., Martin, J., Polo, V., Larrosa, J.M., Pablo, L.E., Satue, M., 2018. Ability of swept-sourceoptical coherence tomography to detect retinal and choroidal changes in patients with multiple sclerosis. Journal of ophthalmology 2018.[9] George, N., Jiji, C., 2019. Two stage contour evolution for automatic segmentation of choroid and cornea in oct images. Biocybernetics andbiomedical Engineering 39, 686–696.[10] Hagens, M.H., Burggraaff, J., Kilsdonk, I.D., de Vos, M.L., Cawley, N., Sbardella, E., Andelova, M., Amann, M., Lieb, J.M., Pantano, P., et al.,2018. Three-tesla mri does not improve the diagnosis of multiple sclerosis: a multicenter study. Neurology 91, e249–e257.[11] Huang, G., Liu, Z., Van Der Maaten, L., Weinberger, K.Q., 2017. Densely connected convolutional networks, in: Proceedings of the IEEEconference on computer vision and pattern recognition, pp. 4700–4708.[12] Kaji´c, V., Esmaeelpour, M., Povaˇzay, B., Marshall, D., Rosin, P.L., Drexler, W., 2012. Automated choroidal segmentation of 1060 nm oct inhealthy and pathologic eyes using a statistical model. Biomedical optics express 3, 86–103.[13] Li, J., Jin, P., Zhu, J., Zou, H., Xu, X., Tang, M., Zhou, M., Gan, Y., He, J., Ling, Y., et al., 2021. Multi-scale gcn-assisted two-stage networkfor joint segmentation of retinal layers and discs in peripapillary oct images. Biomedical Optics Express 12, 2204–2220.[14] Lin, T.Y., Doll´ar, P., Girshick, R., He, K., Hariharan, B., Belongie, S., 2017. Feature pyramid networks for object detection, in: Proceedings ofthe IEEE conference on computer vision and pattern recognition, pp. 2117–2125.[15] Long, J., Shelhamer, E., Darrell, T., 2015. Fully convolutional networks for semantic segmentation, in: Proceedings of the IEEE conferenceon computer vision and pattern recognition, pp. 3431–3440.[16] L´opez-Varela, E., Vidal, P.L., Pascual, N.O., Novo, J., Ortega, M., 2022. Fully-automatic 3d intuitive visualization of age-related maculardegeneration fluid accumulations in oct cubes. Journal of Digital Imaging , 1–12.[17] Medeiros, F.A., Zangwill, L.M., Bowd, C., Vessani, R.M., Susanna Jr, R., Weinreb, R.N., 2005. Evaluation of retinal nerve fiber layer,optic nerve head, and macular thickness measurements for glaucoma detection using optical coherence tomography. American journal ofophthalmology 139, 44–55.[18] Merino, A.G., Callizo, J.A., Fern´andez, O.F., Pascual, L.L., Torres, E.M., Zarrantz, A.R.A., 2017. Consenso para el tratamiento de la esclerosism´ultiple 2016. sociedad espa˜nola de neurolog´ıa. Neurolog´ıa 32, 113–119.[19] Moeskops, P., Viergever, M.A., Mendrik, A.M., De Vries, L.S., Benders, M.J., Iˇsgum, I., 2016. Automatic segmentation of mr brain imageswith a convolutional neural network. IEEE transactions on medical imaging 35, 1252–1261.[20] Paszke, A., Gross, S., Massa, F., Lerer, A., Bradbury, J., Chanan, G., Killeen, T., Lin, Z., Gimelshein, N., Antiga, L., et al., 2019. Pytorch: Animperative style, high-performance deep learning library. Advances in neural information processing systems 32.[21] Ronneberger, O., Fischer, P., Brox, T., 2015. U-net: Convolutional networks for biomedical image segmentation, in: International Conferenceon Medical image computing and computer-assisted intervention, Springer. pp. 234–241.[22] Salafian, B., Kafieh, R., Rashno, A., Pourazizi, M., Sadri, S., 2018. Automatic segmentation of choroid layer in edi oct images using graphtheory in neutrosophic space. arXiv preprint arXiv:1812.01989 .[23] Sicras-Mainar, A., Ru´ız-Beato, E., Navarro-Artieda, R., Maurino, J., 2017. Impact on healthcare resource utilization of multiple sclerosis inspain. BMC Health Services Research 17, 1–7.[24] Spaide, R.F., Koizumi, H., Pozonni, M.C., 2008. Enhanced depth imaging spectral-domain optical coherence tomography. American journalof ophthalmology 146, 496–500.[25] Tan, M., Le, Q., 2019. Efficientnet: Rethinking model scaling for convolutional neural networks, in: International conference on machinelearning, PMLR. pp. 6105–6114.[26] Wallin, M.T., Culpepper, W.J., Campbell, J.D., Nelson, L.M., Langer-Gould, A., Marrie, R.A., Cutter, G.R., Kaye, W.E., Wagner, L., Tremlett,H., et al., 2019. The prevalence of ms in the united states: a population-based estimate using health claims data. Neurology 92, e1029–e1040.[27] Wang, J., Zhang, M., Pechauer, A.D., Liu, L., Hwang, T.S., Wilson, D.J., Li, D., Jia, Y., 2016. Automated volumetric segmentation of retinalfluid on optical coherence tomography. Biomedical optics express 7, 1577–1589.[28] Wang, R.K., 2002. Signal degradation by multiple scattering in optical coherence tomography of dense tissue: a monte carlo study towardsoptical clearing of biotissues. Physics in Medicine & Biology 47, 2281.[29] Xie, H., Pan, Z., Zhou, L., Zaman, F.A., Chen, D.Z., Jonas, J.B., Xu, W., Wang, Y.X., Wu, X., 2022. Globally optimal oct surface segmentationusing a constrained ipm optimization. Optics Express 30, 2453–2471.[30] Yakubovskiy, P., 2020. Segmentation models pytorch. https://github.com/qubvel/segmentation_models.pytorch.EmilioL´opez-Varelaetal/ProcediaComputerScience00(2022)000–0009Fig.6.MultipleexamplesofthesegmentationmaskspredictedbytheFPNmodelwithDensenet201encoder.Thepredictedareasthatmatchthelabelingareshowninbluewhilethefalsepositivesandfalsenegativesareshowninredandyellow,respectively.AcknowledgementsThisresearchwasfundedbyInstitutodeSaludCarlosIII,GovernmentofSpain,DTS18/00136researchproject;MinisteriodeCienciaeInnovaci´onyUniversidades,GovernmentofSpain,RTI2018-095894-B-I00researchproject;MinisteriodeCienciaeInnovaci´on,GovernmentofSpainthroughtheresearchprojectwithreferencePID2019-108435RB-I00;Conseller´ıadeCultura,Educaci´oneUniversidade,XuntadeGalicia,GruposdeReferenciaCom-petitiva,grantref.ED431C2020/24;AxenciaGalegadeInnovaci´on(GAIN),XuntadeGalicia,grantref.IN845D2020/38;CITIC,CentrodeInvestigaci´ondeGaliciaref.ED431G2019/01,receivesfinancialsupportfromCon-seller´ıadeEducaci´on,UniversidadeeFormaci´onProfesional,XuntadeGalicia,throughtheERDF(80%)andSecre-tar´ıaXeraldeUniversidades(20%).EmilioL´opezVarelaacknowledgesitssupportunderFPIGrantProgramthroughPID2019-108435RB-I00project. 