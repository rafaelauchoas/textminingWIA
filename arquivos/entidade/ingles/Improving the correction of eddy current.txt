I-NHPAAuthorManuscriptI-NHPAAuthorManuscriptI-NHPAAuthorManuscriptNIH Public AccessAuthor ManuscriptComput Med Imaging Graph. Author manuscript; available in PMC 2013 October 01.Published in final edited form as:Comput Med Imaging Graph. 2012 October ; 36(7): 542–551. doi:10.1016/j.compmedimag.2012.06.004.Improving the Correction of Eddy Current-Induced Distortion inDiffusion-Weighted Images by Excluding Signals from theCerebral Spinal FluidWei Liua,b, Xiaozheng Liua,b, Guang Yanga, Zhenyu Zhoub, Yongdi Zhouc, Gengying Lia,Marc Dubind, Ravi Bansalb, Bradley. S. Petersonb, and Dongrong Xub,*aKey Laboratory of Brain Functional Genomics, Ministry of Education & Shanghai Key Laboratoryof Brain Functional Genomics, Shanghai Key Laboratory of Magnetic Resonance, East ChinaNormal University, Shanghai, China 200062bMRI Unit, Columbia University Dept of Psychiatry, New York State Psychiatric Institute, NYSPIUnit 74, 1051 Riverside Drive, New York, NY 10032, U.S.AcDepartment of Neurosurgery, Johns Hopkins University, Baltimore, MD 21287, U.S.AdWeill Cornell Medical College, Cornell University, New York, NY 10065, U.S.AAbstractIterative Cross-Correlation (ICC) is the most popularly used schema for correcting eddy current(EC)-induced distortion in diffusion-weighted imaging data, however, it cannot process dataacquired at high b-values. We analyzed the error sources and affecting factors in parameterestimation, and propose an efficient algorithm by expanding the ICC framework with a number oftechniques: (1) Pattern recognition for excluding brain ventricles; (2) ICC with the extractedventricle for parameter initialization; (3) Gradient-based Entropy Correlation Coefficient (GECC)for optimal and finer registration. Experiments demonstrated that our method is robust with highaccuracy and error tolerance, and outperforms other ICC-family algorithms and popularapproaches currently in use.Keywordsdiffusion weighted imaging; diffusion tensor imaging; eddy current; distortion correction; iterativecross-correlation; mutual information1. IntroductionDiffusion Tensor Imaging (DTI) is a powerful imaging technique for the non-invasivecharacterization of the microstructure of normal and pathological tissues. DTI data,however, are vulnerable to geometric distortion caused by eddy current (EC). DTI datatypically are acquired using echo-planar imaging (EPI) pulse sequences. Consequently,rapid switches between the strong gradients of diffusion-sensitizing magnetic fields© 2012 Elsevier Ltd. All rights reserved.*Corresponding author: Dongrong Xu Ph.D., 1051 Riverside Drive, NYSPI Unit 74, New York, NY 10032, Tel. (212)543-5495 Fax.(212)543-0522, dx2103@columbia.edu.Publisher's Disclaimer: This is a PDF file of an unedited manuscript that has been accepted for publication. As a service to ourcustomers we are providing this early version of the manuscript. The manuscript will undergo copyediting, typesetting, and review ofthe resulting proof before it is published in its final citable form. Please note that during the production process errors may bediscovered which could affect the content, and all legal disclaimers that apply to the journal pertain.   I-NHPAAuthorManuscriptI-NHPAAuthorManuscriptI-NHPAAuthorManuscriptLiu et al.Page 2inevitably create residual gradients that produce EC-induced distortion. Often the bandwidthof the phase-encoding direction is routinely much narrower than the other two (readout-encoding and frequency-encoding) directions, making the phase-encoding direction of thediffusion-weighted (DW) image more sensitive to contamination of EC-induced distortionscaused by the DW gradient. Furthermore, because the amplitude and direction of thediffusion gradients determine the magnitude of the EC-induced distortion, DW imaging(DWI) data acquired along different directions of gradient contain different distortion.Misregistration among DWI data along differing gradient directions will produce errors inthe reconstruction of the diffusion tensors in virtually every voxel of an image, andsubsequently in the derived measurements. These include the apparent diffusion coefficient(ADC)[1], fractional anisotropy (FA)[2] or ellipsoidal area ratio (EAR)[3], and theprocedure of fiber tracking. Therefore, EC-induced distortions must be corrected in all DWimages before a diffusion tensor is reconstructed. Many algorithms have been developed forcorrecting EC-induced distortions, and can be classified into three categories. The firstcategory are those algorithms that rely on improving MRI pulse sequences, including thosecompensating ECs by changing the shape of the gradient amplitude envelope [4] and thosedesigning special pulse sequences [5–7]. For example, the bipolar gradient imaging schema[6] minimized EC-induced distortion by using pairs of bipolar gradients, which requires aprolonged diffusion-weighted time and thus results in an obvious signal attenuation due totransverse relaxation. Most investigators, however, do not have easy access to theproprietary computer codes required to program pulse sequences.The second category of algorithms for correcting EC-induced distortions generally operateson DWI data in k-space [8–10]. The processing and computations involved in the k-spacecorrection algorithms, however, are often complex. For example, one representative work[10] proposed first measuring the phase evolution caused by EC fields along a set ofreference DW gradient directions that are parallel to the coordinate axes, using thesemeasurements to estimate the true phase evolution along particular spatial directions otherthan those that are parallel to the coordinate axes, and then using those estimates to removeEC-induced distortions from the k-space data. The third category refers to post-processingmethods that usually coregister the DW images to a reference image. In most cases, thereference image is one set of the baseline images that is in theory acquired without theapplication of a DW gradient and is therefore considered to be free of EC-induceddistortions by DW gradients. The methods in this third category are appealing because theyare generally flexible in permitting the correction of imaging data off-line.Among these various post-processing methods, the Iterative Cross-Correlation (ICC)algorithm [11], is one of the most popularly adopted. It estimates EC-induced distortion inDW images by cross-correlating the DWI data with the reference images along the phase-encoding direction. Unfortunately, ICC is known to correct accurately only DWI data thatare acquired at b-values lower than 300s/mm2 [12]. This is because DW signals derivingfrom the regions of cerebrospinal fluid (CSF) within the images, when measured at higher b-values, are much weaker than those measured in the reference images, thereby underminingthe accuracy of the cross-correlation of those DW images with the reference [11]. A numberof remedies have been proposed to address this limitation of the ICC algorithm [12–15],such as using a fluid attenuated inversion recovery (FLAIR) sequence to suppress signalsfrom CSF [13] or acquiring an additional set of images using gradients of opposite polarityto estimate the EC-induced distortion present in the original dataset [15]. These remedies,however, generally require either the acquisition of additional imaging data or themanipulation of specific pulse sequences, thereby significantly increasing the alreadylengthy scan time. Moreover, the need to acquire additional imaging data means that theserevised ICC methods no longer involve only post-processing procedures that can be at theconvenience of the investigator off-line.Comput Med Imaging Graph. Author manuscript; available in PMC 2013 October 01.   I-NHPAAuthorManuscriptI-NHPAAuthorManuscriptI-NHPAAuthorManuscriptLiu et al.Page 3Because the primary determinant of the errors in estimating distortion using the ICCalgorithm derives from the difference in image contrast between the reference and DWimages in the regions containing CSF, excluding the signal of the CSF when estimatingdistortion should immediately and dramatically improve the performance of an ICC-basedalgorithm for correcting EC-induced distortion in DWI data. Compared with the currentlyavailable methods for suppressing signals from CSF [13], this purely postprocessingapproach would not require extra pulse sequence or imaging data.We therefore propose to improve the ICC algorithm by excluding the CSF signal from thedistortion estimation. We first segment the brain and coarsely identify the regions of CSF(including both cortical and ventricular CSF) in a binary mask that excludes the CSFregions. This mask is then used within the conventional ICC algorithm to estimate the initialparameters of distortion. As the segmentation step may not have accurately outlined theregions of CSF, we then use Mutual Information (MI) instead of cross-correlation in the costfunction to refine the estimation of distortion for coregistering the reference with the DWimages. We use MI because it has been shown to be a robust and accurate measure ofsimilarity for registration of multimodal images in many studies [16–19]. With this measure,we use a 3-paramter affine transformation and an algorithm called Limited memory BroydenFletcher Goldfarb Shanno with bound constraint (L-BFGS-B) to find the optimal parametersfor correcting distortion (see the Method section)[20]. L-BFGS-B algorithm can performoptimization without computing the Hessian matrix, which is known to be difficult to obtainin numerical calculation [20].2. PreliminaryIterative Cross-CorrelationThe ICC model estimates distortion parameters by calculating the cross-correlation betweenthe DW and reference images along each corresponding column of their reconstructedimages at a higher resolution. The distortion is characterized by three parameters, M, T andS within the plane of an image slice (for convenience we use the notation that the image liesin the XY plane, with X, Y, and Z being the frequency-, phase-, and slice-encodingdirections, respectively). M represents the uniform scaling that the residual gradientproduces in the phase-encoding direction Y; T represents the uniform translation that theresidual gradient in the slice-encoding direction Z produces along Y; and S represents sheardeformation that the residual gradient in the frequency-encoding direction X producesparallel to Y. As mentioned earlier, EC-induced distortion is routinely more severe along theY direction than in the other two directions, and the distortion along the other two directionscan be neglected. We therefore just consider correcting distortion along the Y direction. Inthe process of evaluating the EC-induced distortions in a slice-wise manner, the displacedlocations Y′ of the voxels in each column X of the distorted image can thus be defined asfollows:(1)where ε is noise; and T′ (x) is the distance of translation along Y, which depends linearly onX. The MTS (i.e., magnification, translation and shear) parameters, thus can be estimated bymaximizing the cross-correlation between corresponding columns of the reference and DWimages [11].Mutual InformationMI is based on the concept of entropy, which describes dispersion in the distribution of grayscale values in an image. Maes [21] proposed the use of the entropy correlation coefficientComput Med Imaging Graph. Author manuscript; available in PMC 2013 October 01.   I-NHPAAuthorManuscriptI-NHPAAuthorManuscriptI-NHPAAuthorManuscriptLiu et al.Page 4(ECC) (Equation (2)). The ECC is less sensitive to slight changes of overlap between theimages being coregistered:(2)where H(R) and H(D) are the Shannon marginal entropies of two images R and D,respectively; I(R,D)=H(R)+H(D)−H(R,D); and H(R,D) is their Shannon joint entropy,which indicates the dispersion of the joint probability distribution calculated by all theoverlapping portions of the images R and D. The original Shannon entropy calculation diddepend on image intensity, but did not depend on the pixel location in the images thatprovides information of spatial characteristics, a feature that is always critical to the successof image registration. Having realized this important fact, other investigators then proposedto add into the MI calculation a measure that characterizes the intensity gradients atcorresponding points of the images [22]. Inspired by this approach, we propose in thepresent work to combine gradients information with ECC and thus define the (GECC), asfollows:(3)where G (R, D) is gradient information computed for each point x in R and its correspondingpoint x′ in D. ∇x(σ) and ∇x′ (σ) denote the gradient vectors of R and D at points x and x′with a Gaussian kernel of scale σ respectively. |·| denotes the calculation of magnitude. αx,x′(σ) is the angle between the two gradient vectors. w is a weighting function that emphasizesboth very small angles (around zero) and angles that are approximately equal to π[22]. Notein Equation (3) that multiplying the weighting function and minimum of the gradientmagnitudes favors the strong gradient occurred in both images, where either the twogradient vectors are parallel, or the two magnitudes are significant, or both are true.Summation of these products for all points in R and D thus provides general information onthe interaction of gradient in the two images, which will be multiplied to the original ECC.In general, MI works best when the histogram of two images shows highly clustered voxelintensities. Voxel values in the CSF regions are dramatically different in the raw dataacquired at differing b-values, thereby containing large variations. This variationconsequently significantly disperses the voxel clusters in the joint histograms used in MI.Therefore, identifying and then excluding CSF regions or assigning the CSF regions with aunified intensity value will help to optimize the coregistration of DWI data to the referencedata using MI.Because improper initialization will definitely cause excessive number of iterations in anoptimization procedure, which increases the opportunity of generating local extrema [23],properly initializing the parameters to MI in our procedure is deemed crucial for accuratelyand effectively estimating the EC-induced distortion. This is particularly important when MIregistration is applied to the low-resolution multimodal images. Moreover, such properinitialization of the registration parameters is expected to effectively narrow down thescopes for searching the true values in the registration at finer resolutions in the late stages,so that it will help to further accelerate the optimization procedure [24]. Our methodcontains such an initialization process (the next section).Comput Med Imaging Graph. Author manuscript; available in PMC 2013 October 01.   I-NHPAAuthorManuscriptI-NHPAAuthorManuscriptI-NHPAAuthorManuscriptLiu et al.Page 53. Materials and MethodsThe MethodWe first used BET (Brain Extraction Tool, FSL4.0, http://fsl.fmrib.ox.ac.uk/fsl/bet) toextract the brain from extra-cerebral tissue. We then used FAST (FMRIB’s AutomatedSegmentation Tool, FSL4.0, http://fsl.fmrib.ox.ac.uk/fsl/fast) to segment the brain. We thenuse a pattern recognition tool developed in-house using active contour [25] to identify theventricles in the brain and thus formed a brain mask that excluded the background and CSFsignals.We then applied the ICC algorithm to the masked images that excluded the CSF signals toobtain an approximate estimation of the distortion parameters MTS. (We call the procedureup to this step an ICC-mask algorithm.) Based on these masked images, we next conducted afiner estimation of the distortion parameters using MI within a small range of the initialvalues. (For future reference, we name the procedure of coregistration combining MI withthe CSF mask without taking advantage of the step of parameter initialization a MI-maskalgorithm.) The 3-paramter affine registration based on MI was thus optimal for the EC-induced distortion. We calculated GECC between two corresponding images as a costfunction to estimate suitable values of MTS within the finer range. The values yielding thehighest GECC were selected to confirm the optimal MTS corresponding to the distortedimage D. The L-BFGS-B algorithm was used to identify the highest GECC within the searchspace. For convenience, our approach, including all of the above-mentioned steps (i.e., ICC-mask for initializing the searching of parameters and then MI starting from the initializedparameters using the CSF mask), will be referred to as “our method” (in short, ICC-maskplus MI-mask).In addition, it is worth noticing that artifacts due to the interpolation of voxel intensityduring the procedure of imaging registration and warping may introduce additional bias thatmay have a non-negligible impact on the accuracy of estimating the distortion parameters.Such interpolation-induced artifacts occurring in the MI function may thus seriously impairthe accuracy of registration [26]. We therefore used an approximate Hanning-windowedSine function to correct the artifacts caused by interpolation of image intensities [27], and tomoderate the sharp changes that MI can introduce into the dispersion of the joint histogramdistribution. The joint dynamic profiles of entropies were consequently smoothed and localextrema in the procedure of iterative searching tended to disappear.In summary, our method consists of following steps (Fig. 1):1. Generation of two binary masks Mr and Md for the reference image R and thedistorted image D respectively, in which value 0 masks the CSF in the brain regionand background outside of the brain;2. Generation of the masked images R and D for the subsequent estimation;3. Application of the ICC algorithm to the masked images R and D for an initialestimation of the parameters MTS. The ICC algorithm searches the scaling factorM0 within the range of 0.85–1.15 (uniform scale, as suggested elsewhere [11]) atan incremental step of 0.005; the translation factor T0 and shear factor S0 areestimated by linear regression fitting on the cross-correlation values that the ICCalgorithm has estimated for each column [11].4. Application of the 3-parameter affine registration based on GECC to the maskedimages R and D for more accurate estimations of the parameters MTS in the finersearching space (M: M0±0.1; T:T0± 2; S0: S±0.2). Because MI is suitable forregistration of imaging data with different contrast, such as the reference baselineComput Med Imaging Graph. Author manuscript; available in PMC 2013 October 01.   Liu et al.Page 6data and the DWI data in our case, we use ICC to estimate the initializing valuesfor finer registration to be conducted using MI.Simulations and ExperimentsTo examine the effectiveness of our proposed method for distortion correction, weconducted four experiments using three types of data: simulated, real human data and hybridhuman data. The first two were simulations that used simulated data and the other two usedhuman data.In the first simulation experiment, we demonstrate the performance of our method usingsimulated datasets. We simulated a reference image A and one set of images B containingEC-induced distortions. Both images were created in Matlab 2008a (The Mathworks, Inc.,MA, USA) and were of dimension 256×256. We first generated an image A0 that mimickedthe contrast of a typical T2-weighted image containing an annulus-like structure. Forsimplicity, we used only the inner circular region to simulate, in combination, both thecortical and ventricular CSF. The intensities within the inner ring were higher than thosewithin the body of the annulus. We superimposed onto this image a small amount of Riciannoise (standard deviation σ =10) to obtain image A. We then generated an image similar toA0 that had a reversed contrast in the inner circle and in the body of the annulus. Wesuperimposed onto the image more severe Rician noise (standard deviation σ = 40) tosimulate the situation in the real world that the DW image always suffers heavier noise thando the reference ones; and we then distorted the image with parameters MTS within therange {M (0.85,1.15), T (−2, 2), S (−0.2, 0.2)}, to obtain the set of distorted images B (Fig.2) (Note: the parameters MTS denote transformations in the direction from the distorted tothe reference image space). We simulated a total of 200 sets of images A and B with MTSvalues evenly distributed within the above-mentioned scopes.We then qualitatively evaluated the performance of our algorithm by extracting theboundary of the reference image A and superimposing it onto both the uncorrected andcorrected images B. To assess functions of two components, the CSF mask and the MIcalculation, we also directly compared the performance of our method (MI-mask afterparameter initialization using ICC-mask) with those of the following methods: ICC, ICC-mask, ICC-MI (ICC algorithm for initialized parameters and MI algorithm without using theCSF mask), ICC-mask-MI (ICC-mask algorithm and MI algorithm, using parametersinitialized by ICC-mask but without using the CSF mask in the MI step). Methods werecompared by checking the estimated MTS parameters against the parameters that we used inpreparing the simulated data. We also tested both the MI and MI-mask algorithms that didnot take advantage of initial parameters, and found that the results contained large errors andare not included here. The estimation accuracy of each of the parameters was indexed by themean error ε̄ and corresponding standard variance σε as follows:(4)I-NHPAAuthorManuscriptI-NHPAAuthorManuscriptI-NHPAAuthorManuscriptwhere Pi is the estimated parameter in each simulation; P0 is the actual parameter that weused in each simulation; and N is the number of repeated simulations.In addition, we calculated the voxel-wise mean Euclidian distance (MED) of image intensitybetween the undistorted DW data (reference) and the corrected DW images to highlight theComput Med Imaging Graph. Author manuscript; available in PMC 2013 October 01.   I-NHPAAuthorManuscriptI-NHPAAuthorManuscriptI-NHPAAuthorManuscriptLiu et al.Page 7difference between each correction and the ground truth. We repeated this process for all200 simulated datasets.The second simulation assessed the robustness of our algorithm, examining how theaccuracy of segmenting the CSF affected the performance of our method. We assumed thatremoval of any portion of the CSF would improve the accuracy of the ICC algorithm. Due toinherent imperfections in segmentation algorithms, we sought to assess whether our methodcould tolerate error in excluding signal from the complete region of CSF. We thus randomlydeformed the true CSF mask of the simulated distorted image within a range that led to20%–100% overlap between the deformed masks and the true mask (mismatch percentage ≤80%). The overlap percentage is defined as:(5)where the vori and vd and are the CSF parts in the original mask and deformed mask,respectively. We then compared the corrected results using ICC-mask, ICC-mask-MI andour algorithm quantitatively by checking the MEDs of the image intensity. This experimentwas also repeated 200 times. The correlation between MED and degree of overlap generallyreflects the impact of the accuracy of CSF masks on the accuracy of estimating theparameters for distortion correction.In the third experiment, we used 10 datasets from healthy human participants to assess theeffectiveness of our method in practice. We evaluated the performance of our methodqualitatively by superimposing the extracted contour of the reference baseline data onto thecorrected DWI and FA data for visually checking the morphological agreement, andquantitatively by checking the percentage of ill-conditioned tensors in the reconstructed DTIdata. Because tensors are by definition to be positive definite and artifacts due to variousreasons including EC-induced distortion will damage the feature, this percentage is aterminal index for evaluating the quality of the DWI. These comparisons were conducted forresults generated using the conventional ICC algorithm, the FDT (FMRIB Diffusion Tool,http://www.fmrib.ox.ac.uk/fsl/fdt/), and our method for EC distortion correction. The ECdistortion correction in FDT, short for FDT algorithm, is a popular image-based multimodalregistration method that can correct both EC-induced distortion and bulk subject motion inDWI data using MI-based affine registration. Because the comparison was purely forchecking the performance of EC-induced distortion, we used data that were acquired with noor negligible motion for comparability of the results across these methods.In the fourth experiment, we further accessed the effectiveness of our algorithm usingsynthesized hybrid human datasets, which were artificially imposed more severe distortionto real-world adult human data by randomly altering M, T, and S parameters in aprespecified range {M (0.85,1.15), T (−2,2), S (−0.2, 0.2)}. We did so because the DWI dataacquired from the scanners commercially available today have already been corrected forEC-induced distortion, leaving limited space for testing our method and comparing it withother tools (also see Discussion section). That is, although we would have liked to comparethe performance of methods on real-world data we instead had to impose simulateddistortion. We compared corrected results using our method with the conventional ICC andthe FDT algorithms qualitatively. The contours of the brains extracted from the FA maps ofthe DWI images corrected by these methods were compared visually against the referencedata. In addition, a quantitative comparison based on the ill-conditioned tensors in thereconstructed DTI data was also performed for the DWI data produced by the differentcorrection algorithms.Comput Med Imaging Graph. Author manuscript; available in PMC 2013 October 01.   Liu et al.Imaging ProtocolPage 8I-NHPAAuthorManuscript4. ResultsI-NHPAAuthorManuscriptI-NHPAAuthorManuscriptThe DWI images of each of the 10 participant were acquired with their written consent on aGE 3.0 Tesla MR scanner (General Electric, Milwaukee, Wisconsin) using a single-shotspin-echo echo planar imaging (SE-EPI) pulse sequence with diffusion gradients at b=1000s/mm2 applied along 15 non-collinear spatial directions in addition to 3 baseline imagesacquired without applying a diffusion gradient. (This DTI sequence employed bipolargradients for diffusion.) Slice thickness was 2.5 mm with no gap, and about 60 axial sliceswere acquired to cover the entire brain, at an in-plane interpolated resolution of 0.9375 mm.Echo time (TE) was minimal at about 80 ms; repetition time (TR) = 15700 ms; field of view(FOV) =240mm × 240mm, matrix =132×128, number of excitation (NEX) = 2. The finalimages were machine-interpolated to an in-plane resolution of 256×256. Total DWIscanning time was 9 minutes 57 seconds. Slices were orientated parallel to the anteriorcommissure-posterior commissure (AC-PC) plane.In the first simulation experiment, our method demonstrated a significant improvement overthe ICC, the ICC-mask, ICC-MI, and ICC-mask-MI algorithms in estimating the distortionparameters (Fig. 3). The contour of the reference image perfectly matched the contour of thedistortion corrected image generated from our method whereas there were cleardisagreements with the distortion corrected image using the other methods. This was mostpronounced with the ICC method. The individual MTS values also support this impression(Table 1), which shows that the values of MTS calculated by the other algorithms(especially the ICC algorithm) deviated significantly from the known values. The MTSestimation which resulted from the ICC algorithm had a large divergence from the groundtruth and was also inconsistent with large variations. Results using the ICC-mask, ICC-MI,and ICC-mask-MI algorithms were not stable in estimating T and S, whereas our methoddemonstrated consistently small errors and deviations (Table 1). The MED values betweenthe reference and the corrected DW images generated using our method were between 0 and15. This contrasted with the MED values of 15–37 between the reference and the ICCcorrected images, 5–21 between the reference and the ICC-mask corrected images, 11–35between the reference and the ICC-MI corrected images, and 9–21 between the referenceand the ICC-mask-MI corrected images. These performance comparisons (Fig. 3, and Table1) demonstrate that removal of the CSF signal can significantly improve the accuracy of theestimation of M and that combining the use of a CSF mask and MI can make the evaluationof T and S more accurate.In the second simulation experiment, the accuracy of ICC was dramatically improved whenthe CSF mask was incorporated: the MED of the ICC-mask approach decreased from 35when no CSF was used to approximately 16 (the MED of using the ICC algorithm alone wasnot shown because it was a straight line and far from the others), indicating the great benefitthat the CSF mask offers (Fig. 4). This confirmed our hypothesis that any exclusion of CSFwould help improve the performance of ICC. The experiment also demonstrated the benefitof the combined ICC-mask and MI approach, as its MED ranged around 16 in comparison tothe MED of ICC-mask, which was 16–26 (Fig. 4). Our method performed the best (MEDranged narrowly from 13–16) using MI-mask with parameters initialized by the ICC-maskalgorithm. Moreover, in contrast to the ICC-mask algorithm, our method was much lesssensitive to the error contained in the binary CSF mask. However, increased accuracy in theCSF mask did lead to a decrease in estimation errors of the parameters. Although theperformance of ICC-mask-MI was relatively consistent when the mask mismatch varied, ourmethod overall outperformed the ICC-mask-MI method because the MED of our methodwas consistently lower (Fig. 4). This is especially true for overlap >50%.Comput Med Imaging Graph. Author manuscript; available in PMC 2013 October 01.   I-NHPAAuthorManuscriptI-NHPAAuthorManuscriptI-NHPAAuthorManuscriptLiu et al.Page 9In the third experiment, which used human data, the superimposed contour of the baselineimage again demonstrated that using our algorithm was much better than using the ICCalgorithm and also better than the FDT algorithms, especially in lower boundaries of thebrain. Comparing the FA maps generated from DWI data with and without correction (Fig.5), we can see that using our method provided much clearer details and structures, largelybecause it more accurately coregistered DWI data acquired along differing directions of theDW gradients, thereby improving the accuracy of tensor estimation. The fuzzy boundarysurrounding the brain in the FA map generated using DWI data corrected with our methodwas much thinner than the boundaries in the uncorrected data and those corrected using theICC or FDT algorithm (Fig. 5). Note the human data were acquired using bipolar gradients,and thus the major portion of EC-induced distortion was already removed in the obtainedimaging data. This indicates that distortion correction of the data using our algorithm wasmore accurate than it was using the competitors’.Quantitative evaluation of the percentage of ill-conditioned tensors (Table 2) showed that allthree methods reduced the number of non-positive definite tensors, indicating that all threeapproaches did improve the distorted DWI data to some extent. This improvement variedaccording to method: 5.56% for ICC, 13.58% for FDT, and 39.51% for our method, onceagain, showing that the performance of our method was superior to the other two methods.Finally, a comparison of the overlapped areas based on the extracted contour of thereference data that was superimposed onto the corrected images revealed that our algorithmgenerated the best morphological match between the corrected images and the referenceimage (ICC: 95.49%, FDT: 96.83%, and our algorithm: 97.72%), suggesting that ourmethod not only effectively corrected DWI data volumetrically, but also morphologicallywith high accuracy. The MED analysis, the comparisons of ill-tensor percentages andoverlap areas based on the 10 real datasets thus unanimously suggested that our methodoutperformed its competitors.The fourth experiment, using the hybrid human datasets, corroborated the first and thirdexperiments and buttressed the case that our method is superior to the ICC and FDT. Ourmethod improved on the competitors both morphometrically, with nearly perfect registration(Fig. 6), and volumetrically, with the greatest improvement in achieving the smallestpercentage of ill-conditioned tensors that was calculated based on all the brain voxels in theimage (Table 3).5. DiscussionWe have presented a novel algorithm for effectively correcting EC-induced distortions inDWI data acquired using SE-EPI sequences. This model employs a number of techniques asdetailed in the text from different fields to improve the performance of the ICC-family ofalgorithms for correcting distortions. The experiments with DWI data acquired at high b-values (1000 s/mm2 in our case) have shown that this method not only has overcome themajor limitation of the ICC-family algorithms, i.e. the inability to treat distortions in DWIdata acquired at b-values larger than 300 s/mm2 [12], but it also has vastly outperformed theICC and FDT methods that are popularly used in practice today for correcting EC-induceddistortions.Compared with other MI-based correction methods [17, 19], our MI-based registrationalgorithm for EC-induced distortions in DWI data has two distinct features: First, ouralgorithm identifies the regions of the CSF and then excludes the signals from CSF toinitialize the estimation procedure for improve the accuracy of MI registration. Second, thisalgorithm uses the CSF mask to help further improve the accuracy of MI registration. Inaddition, our MI registration algorithm also adopts L-BFGS-B for searching optimizedComput Med Imaging Graph. Author manuscript; available in PMC 2013 October 01.   I-NHPAAuthorManuscriptI-NHPAAuthorManuscriptI-NHPAAuthorManuscriptLiu et al.Page 10solution and a Hanning-windowed Sine function for correcting the artifacts caused byinterpolation of image intensities. Last but not least, our method is purely a postprocssingapproach, which is independent from manipulating pulse sequences or the k-space andtherefore is relatively easier for average users.Segmentation of the CSF is a key to the success of the accurate estimation of parameters fordistortion correction. As shown by the tests using simulations and real human data whichadopts the ICC algorithm to correct distortion, with or without the CSF mask, using themask can significantly improve the accuracy in estimating the distortion. Using the CSFmask also helps improve the accuracy of MI registration, because the CSF mask merges thesmall clusters of varying intensities in the CSF regions to the cluster of background, therebyenhancing this uniformly valued cluster which is large and consequently benefits MIregistration [24]. Moreover, we have shown that the identification of the CSF regions doesnot have to be ideal. That is, our method is robust, regardless of whether the CSF portion isrelatively under or over identified. Although the performance of ICC-mask-MI is relativelyconsistent when the mask mismatch varied, our method has demonstrated a consistentlylower MED compared with the ICC-mask-MI method (Fig. 4). Because of this high faulttolerance, our method does not require the segmentation of CSF to be performed separatelyand repeatedly for the baseline reference and the DWI data, even though they usually areoriginally mismatched slightly. Using our method therefore will not impose an overhead ofmanual work for carefully segmenting and excluding the CSF regions. Instead, it will bewidely applicable and robust when using any available segmentation technique.MI is a good approach for coregistering imaging data with differing contrast. However, goodinitialization of the parameters is necessary for accurate MI registration. In the firstsimulation experiment, we also tested estimation of the parameters for correcting distortionsby registration procedures using purely the MI methods without first initializing theparameters with good confidence (i.e. using the MI and MI-mask algorithms). The resultsdemonstrated that an appropriate initialization of the distortion parameters is criticallyimportant to the final success of correcting the EC-induced distortion. This is because DWIdata are usually noisy with low resolution but contain only mild distortion, which can bediminished only by specially crafted approaches designed with extra care. In our method, weused ICC-mask algorithm as a good method for parameter initialization before performingMI registration. This initialization method is easy to implemented and time-efficient. Wefound from our experiments that the ICC-mask algorithm is an appropriate way forinitializing the parameters from the outset.We showed that our algorithm yielded marked improvements in the correction of EC-induced distortion using simulated data. The improvement for human data directly acquiredfrom the MR scanner was less significant because commercially acquired scanners correctmost of the distortion, leaving comparatively less room for our algorithm or any otheralgorithm to improve it. For example, the DTI pulse sequence on our scanner uses bipolargradients, resulting in DWI data with only slight residual of EC-induced distortion.Nevertheless, residual distortion was detected and corrected by our algorithm better than bythe competing algorithms. Whereas the simulations were designed for the purpose ofquantitatively showing that our algorithm performs effectively for DWI data, the fourthexperiment, parallel to the simulation tests, was designed to show this for human data. Wesynthesized hybrid human datasets by artificially imposing more severe distortion on humandata with randomly adopting M, T, and S parameters in a prespecified range. Again, in thiscase, our algorithm outperformed the others (Fig. 6 & Table 3).EC-induced distortion is not simply a geometrical distortion. Instead, it is a consequence ofthe narrow bandwidths used in EPI and residues of the strong diffusion-sensitizing gradientsComput Med Imaging Graph. Author manuscript; available in PMC 2013 October 01.   Liu et al.Page 11required for DTI. It affects every voxel of the image but not merely those at the edge of thebrain. Thus commonly-used morphological methods for recovering the shape of the brainusing only its morphological boundary are not suitable for correcting EC-induceddistortions, because boundary-based techniques consider only the geometry information ofthe boundary voxels and interpolate this information across the entire imaging volume. Suchcorrection has little to do with the intrinsic physical process that generated the distortion. Inaddition, interpolation of the DWI measurements during correction also needs to becarefully considered [26]. A valid algorithm for correcting DWI distortion must consider theintensity information from every voxel in the image as part of a volumetric texture forcalculation. This requires a complicated model for voxel transformation to correct EC-induced distortion. Our method corrects in this way, and we have shown that our method isable to volumetrically and morphologically correct the data with high accuracy (Figs. 5 & 6,Table 2 & 3).Because the acquisition of a DWI dataset is usually lengthy, the data thus acquired maysometimes inevitably contain motion artifacts. Several available approaches therefore haveconsidered correcting motion together with EC-induced distortions [18, 28, 29]. However,we would prefer to separate the two issues, because the essential physics models for subjectmotion and EC-induced distortion are completely different, and the impact of subject motionon the change of DWI measurement is unknown. Arbitrarily modifying the value of voxelsto compensate for motion artifacts may introduce unpredictable bias to the correction of EC-induced distortion. Moreover, EC-induced correction is usually performed within the planeof image slices, whereas motion can occur along any spatial dimension. Even if the motionin 3D could be perfectly recovered, compensating the DWI measurements thereafter in therecovered voxels would be an independent problem, because DWI measurements areassociated with gradients that are specific to particular spatial orientations. Consideringthese difficulties, previous work [18, 28, 29] trying to combine motion correction anddistortion correction has made the simplified assumption that motion occurs only betweenthe acquisitions of consecutive DWI volumes. Unfortunately, such an assumption is toostrong and not generally true in practice. Even worse, in such models motion artifactsoccurring in limited slices could be spatially propagated and transferred to neighboringimage slices due to motion correction in 3D prior to or along with distortion correction,thereby severely compromising the dataset. In certain extreme cases of using such models,motion correction occurs when we test a dataset that contains absolutely no motion but hasrelatively significant distortions. We believe the ignorance and improper modeling of theinteraction between the motion and distortion is the main reason in such cases. We thereforechose to tackle only the issue of distortion correction in this paper.Finally, because EC-induced distortion intrinsically relates to the spatial orientation andstrength of the diffusion gradients, our future efforts will aim to characterize thisrelationship and develop a systematic correction for it to further improve the accuracy andvalidity of our correction algorithms. Also, developing a more realistic model that accountsfor the motion in EC-induced correction is crucial and this requires a strategy for properlyadjusting the associated gradient to each voxel that is to be corrected for motion and then fordistortion.I-NHPAAuthorManuscriptI-NHPAAuthorManuscriptI-NHPAAuthorManuscriptAcknowledgmentsGrant AcknowledgementThis work was supported in part by NIMH grant K02-74677, NIBIB grant 1R03EB008235-01A1, a grant from theShanghai Commission of Science and Technology #10440710200, a NASARD grant, and a grant from the EastChina Normal University School of Psychology and Cognitive Science.Comput Med Imaging Graph. Author manuscript; available in PMC 2013 October 01.   I-NHPAAuthorManuscriptI-NHPAAuthorManuscriptI-NHPAAuthorManuscriptLiu et al.AbbreviationsPage 12ADCBETCSFDTIDWDWIEARECECCMTSFAFASTFDTFLAIRGECCICCApparent Diffusion CoefficientBrain Extraction ToolCerebral Spinal FluidDiffusion Tensor ImageDiffusion WeightedDiffusion Weighted ImagingEllipsoidal Area RatioEddy CurrentEntropy Correlation CoefficientMagnification, Translation and Shear (distortion parameters)Fractional AnisotropyFMRIB’s Automated Segmentation ToolFMRIB Diffusion ToolboxFluid Attenuated Inversion RecoveryGradient-based Entropy Correlation CoefficientIterative Cross-CorrelationL-BFGS-BLimited memory Broyden Fletcher Goldfarb Shanno with bound constraintMISE-EPIMutual InformationSpin Echo Echo-Planar ImagingReferences1. Moseley ME, Cohen Y, Kucharczyk J, Mintorovitch J, Asgari HS, Wendland MF, Tsuruda J,Norman D. Diffusion-weighted MR imaging of anisotropic water diffusion in cat central nervoussystem. Radiology. 1990; 176:439–445. [PubMed: 2367658]2. Basser PJ, Pierpaoli C. Microstructural and physiological features of tissues elucidated byquantitative-diffusion-tensor MRI. J Magn Reson B. 1996; 111:209–219. [PubMed: 8661285]3. Xu D, Cui J, Bansal R, Hao X, Liu J, Chen W, Peterson BS. The ellipsoidal area ratio: an alternativeanisotropy index for diffusion tensor imaging. Magnetic resonance imaging. 2009; 27:311–323.[PubMed: 18835122]4. Papadakis NG, Martin KM, Pickard JD, Hall LD, Carpenter TA, Huang CL. Gradient preemphasiscalibration in diffusion-weighted echo-planar imaging. Magn Reson Med. 2000; 44:616–624.[PubMed: 11025518]5. Wider G, Dotsch V, Wuthrich K. Self-Compensating Pulsed Magnetic-Field Gradients for ShortRecovery Times. Journal of Magnetic Resonance Series A. 1994; 108:255–258.6. Alexander AL, Tsuruda JS, Parker DL. Elimination of eddy current artifacts in diffusion-weightedecho-planar images: the use of bipolar gradients. Magn Reson Med. 1997; 38:1016–1021. [PubMed:9402204]7. Reese TG, Heid O, Weisskoff RM, Wedeen VJ. Reduction of eddy-current-induced distortion indiffusion MRI using a twice-refocused spin echo. Magnetic Resonance in Medicine. 2003; 49:177–182. [PubMed: 12509835]8. Jezzard P, Barnett AS, Pierpaoli C. Characterization of and correction for eddy current artifacts inecho planar diffusion imaging. Magn Reson Med. 1998; 39:801–812. [PubMed: 9581612]Comput Med Imaging Graph. Author manuscript; available in PMC 2013 October 01.   I-NHPAAuthorManuscriptI-NHPAAuthorManuscriptI-NHPAAuthorManuscriptLiu et al.Page 139. Calamante F, Porter DA, Gadian DG, Connelly A. Correction for eddy current induced Bo shifts indiffusion-weighted echo-planar imaging. Magn Reson Med. 1999; 41:95–102. [PubMed: 10025616]10. Papadakis NG, Smponias T, Berwick J, Mayhew JE. k-space correction of eddy-current-induceddistortions in diffusion-weighted echo-planar imaging. Magn Reson Med. 2005; 53:1103–1111.[PubMed: 15844088]11. Haselgrove JC, Moore JR. Correction for distortion of echo-planar images used to calculate theapparent diffusion coefficient. Magn Reson Med. 1996; 36:960–964. [PubMed: 8946363]12. Bastin ME. Correction of eddy current-induced artefacts in diffusion tensor imaging using iterativecross-correlation. Magnetic resonance imaging. 1999; 17:1011–1024. [PubMed: 10463652]13. Bastin ME. On the use of the FLAIR technique to improve the correction of eddy current inducedartefacts in MR diffusion tensor imaging. Magnetic resonance imaging. 2001; 19:937–950.[PubMed: 11595365]14. Bastin ME, Armitage PA. On the use of water phantom images to calibrate and correct eddycurrent induced artefacts in MR diffusion tensor imaging. Magnetic resonance imaging. 2000;18:681–687. [PubMed: 10930777]15. Bodammer N, Kaufmann J, Kanowski M, Tempelmann C. Eddy current correction in diffusion-weighted imaging using pairs of images acquired with opposite diffusion gradient polarity. MagnReson Med. 2004; 51:188–193. [PubMed: 14705060]16. Maes F, Collignon A, Vandermeulen D, Marchal G, Suetens P. Multimodality image registrationby maximization of mutual information. IEEE transactions on medical imaging. 1997; 16:187–198. [PubMed: 9101328]17. Horsfield MA. Mapping eddy current induced fields for the correction of diffusion-weighted echoplanar images. Magnetic resonance imaging. 1999; 17:1335–1345. [PubMed: 10576719]18. Rohde GK, Barnett AS, Basser PJ, Marenco S, Pierpaoli C. Comprehensive approach forcorrection of motion and distortion in diffusion-weighted MRI. Magn Reson Med. 2004; 51:103–114. [PubMed: 14705050]19. Mistry NN, Hsu EW. Retrospective distortion correction for 3D MR diffusion tensor microscopyusing mutual information and Fourier deformations. Magn Reson Med. 2006; 56:310–316.[PubMed: 16773654]20. Zhu CY, Byrd RH, Lu PH, Nocedal J. Algorithm 778: L-BFGS-B: Fortran subroutines for large-scale bound-constrained optimization. Acm Transactions on Mathematical Software. 1997;23:550–560.21. Maes, F. Segmentation and registration of multimodal medical images: From theory,implementation and validation to a useful tool in clinical practice. Leuven, Belgium: CatholicUniversity of Leuven; 1998.22. Pluim JP, Maintz JB, Viergever MA. Image registration by maximization of combined mutualinformation and gradient information. IEEE transactions on medical imaging. 2000; 19:809–814.[PubMed: 11055805]23. Shams, R.; Kennedy, RA.; Sadeghi, P. Taipei. Efficient image registration by decoupled parameterestimation using gradient-based techniques and mutual information. 2007.24. Pluim JPW, Maintz JBA, Viergever MA. Mutual-information-based registration of medicalimages: A survey. IEEE transactions on medical imaging. 2003; 22:986–1004. [PubMed:12906253]25. Kass M, Witkin A, Terzopoulos D. Snakes: Active contour models. International Journal ofComputer Vision. 1988; 1:321–331.26. Pluim JPW, Maintz JBA, Viergever MA. Interpolation artefacts in mutual information-basedimage registration. Computer Vision and Image Understanding. 2000; 77:211–232.27. Lu XS, Zhang S, Su H, Chen YZ. Mutual information-based multimodal image registration using anovel joint histogram estimation. Computerized Medical Imaging and Graphics. 2008; 32:202–209. [PubMed: 18215504]28. Munoz Maniega S, Bastin ME, Armitage PA. A quantitative comparison of two methods to correcteddy current-induced distortions in DT-MRI. Magnetic resonance imaging. 2007; 25:341–349.[PubMed: 17371723]Comput Med Imaging Graph. Author manuscript; available in PMC 2013 October 01.   I-NHPAAuthorManuscriptI-NHPAAuthorManuscriptI-NHPAAuthorManuscriptLiu et al.Page 1429. Mohammadi S, Moller HE, Kugel H, Muller DK, Deppe M. Correcting eddy current and motioneffects by affine whole-brain registrations: evaluation of three-dimensional distortions andcomparison with slicewise correction. Magn Reson Med. 2010; 64:1047–1056. [PubMed:20574966]BiographiesWei Liu finished her bachelor study in Physics Department of East China NormalUniversity in 2005 and then continued to the doctoral study. She studied in PsychiatryDepartment of Columbia University as a visiting student, during 2008 to 2011. Her researchinterest focuses on post-processing of diffusion tensor images and related analysis.Xiaozheng Liu is a Ph.D. candidate in the Department of Physics, East China NormalUniversity. He was a visiting student in Psychiatry Department of Columbia University from2009 to 2011. His research interest includes post-processing of diffusion tensor images andmedical image processing.Guang Yang received his Ph.D. from Department of Physics, East China NormalUniversity. Now he is an associate professor in Shanghai Key Laboratory of MagneticResonance, East China Normal University. His research interest includes MRI imageprocessing and experiments simulation.Zhenyu Zhou was a postdoctoral research fellow in Psychiatry Department of ColumbiaUniversity from 2008 to 2011. His research interest focuses on the areas of image and signalprocessing of fMRI and diffusion tensor images.Gengying Li is a professor of Shanghai Key Laboratory of Magnetic Resonance of EastChina Normal University. His main research interest focuses on the MRI techniques,specially on MRI instrumentation.Yongdi Zhou obtained his Ph.D. in neuroscience from University of California, LosAngeles, now is a professor and the dean of the School of Psychology, East China NormalUniversity. His research interest focuses on the cognitive neuroscience, neurophysiology.Marc Dubin earned his Ph.D. in Neurobiology and an M.D. from the University ofRochester School of Medicine. He is currently an assistant professor at Cornell UniversityDepartment of Psychiatry. His research interest includes cognitive neuroscience,neurophysiology, and neuroimaging of depression.Ravi Bansal is an associate professor in the Department of Psychiatry, ColumbiaUniversity. He specializes in magnetic resonance image processing and analysis.Bradley. S. Peterson is a Suzanne Crosby Murphy Professor of Psychiatry and the Directorof MRI Unit in the Department of Psychiatry, Columbia University. His research interestfocuses on neuroimaging and brain disorders.Dongrong Xu obtained his Ph.D. in Computer Science from Zhejiang University, now is anassociate professor at Columbia University College of Surgeon and Surgery and a seniorresearch scientist at New York State Psychiatric Institute. His research interest includesbiomedical image processing and analysis and virtual reality technology in brain functionresearch, and scientific visualization.Comput Med Imaging Graph. Author manuscript; available in PMC 2013 October 01.   Liu et al.Page 15I-NHPAAuthorManuscriptI-NHPAAuthorManuscriptFigure 1.The flow chart of our proposed method for correction of eddy-current induced distortion.I-NHPAAuthorManuscriptComput Med Imaging Graph. Author manuscript; available in PMC 2013 October 01.   Liu et al.Page 16Figure 2.A typical example of the simulated datasets for the first Experiment. (a) Reference image A,which is the simulated baseline image; (b) A typical instance of image B, which is distortedwith noise added, simulating the conventional diffusion-weighted image that contains eddy-current induced distortion.I-NHPAAuthorManuscriptI-NHPAAuthorManuscriptI-NHPAAuthorManuscriptComput Med Imaging Graph. Author manuscript; available in PMC 2013 October 01.   Liu et al.Page 17Figure 3.A comparison of the performance of distortion correction using various methods based onthe simulated data. The boundary of the reference image was extracted and superimposedonto the corrected images. (a) The distorted image B as shown in Fig.2b; (b) The correctedresult by the standard ICC; (c) The result by ICC-mask; (d) The result by ICC-MI; (e) Theresult by ICC-mask-MI; and (f) The corrected result by our method. The result using ourmethod achieved the best agreement between the extracted contour of the reference imageand the corrected DWI data.I-NHPAAuthorManuscriptI-NHPAAuthorManuscriptI-NHPAAuthorManuscriptComput Med Imaging Graph. Author manuscript; available in PMC 2013 October 01.   Liu et al.Page 18Figure 4.Quantitative comparisons of the performance of the ICC-mask, ICC-mask-MI and ouralgorithm with varying degrees of inaccuracy in segmentation of the CSF. MED is the meanEuclidian distance of image intensity with arbitrary unit (a.u.), which is calculated based on200 images simulated with distortion parameters MTS = (1.1, 1.5, 0.15). The dark linesillustrate the linear trend of the performance of ICC-mask, ICC-mask-MI, and our methodrespectively. Obviously, the accuracy of the CSF mask has a great impact on theperformance of the ICC-mask algorithm (the dark green curve). Combining ICC-mask withMI (the light green curve) greatly improves the overall performance, whereas our method(the red curve) can further improve the performance in estimating the parameters forcorrecting the EC-induced distortion. This results in errors consistently lower than the ICC-mask-MI approach (the light green line). This experiment demonstrates that identifying andthen excluding CSF is important, both in the ICC and MI algorithms, and properlyinitializing the parameters is helpful to achieve higher accuracy in performing distortioncorrection.I-NHPAAuthorManuscriptI-NHPAAuthorManuscriptI-NHPAAuthorManuscriptComput Med Imaging Graph. Author manuscript; available in PMC 2013 October 01.   I-NHPAAuthorManuscriptI-NHPAAuthorManuscriptI-NHPAAuthorManuscriptLiu et al.Page 19Figure 5.A comparison of Fraction Anisotropy (FA) maps generated from the DW images correctedusing the ICC, FDT, and our method. (a) Uncorrected image; (b) Image corrected by ICC;(c) Image corrected by FDT; (d) Image corrected by our method. Note particularly theregions indicated by the ellipses where our method generated the clearest structures,implying that our method best corrected the distortion so that all DWI were wellcoregistered. Moreover, the fuzzy boundary around the brain is thinner in (d) than in (a), (b)and (c), indicating once again that our method more accurately coregistered the DWI data.Comput Med Imaging Graph. Author manuscript; available in PMC 2013 October 01.   I-NHPAAuthorManuscriptI-NHPAAuthorManuscriptI-NHPAAuthorManuscriptLiu et al.Page 20Figure 6.A comparison between different approaches using the hybrid human datasets based on thecorrected DWI data and their corresponding Fractional Anisotropy (FA) maps. Theboundary of the reference image was extracted and superimposed onto the corrected images.(a) The reference baseline image; (b) The original raw DW image directly downloaded fromour MR scanner; (c) An artificially distorted DW image to be corrected; (d) Image correctedusing ICC; (e) Image corrected using FDT; (f) Image corrected using our method; (g) TheFA map corresponding to the distorted data in (c); (h) The FA map corresponding to theICC-corrected data in (d); (i) The FA map corresponding to the FDT-corrected data in (e);(j) The FA map corresponding to the data corrected by our method in (f); (k) The FA mapcorresponding to the original reference (undistorted) dataset in (b). Note particularly theregions at the tip of the arrows, where mismatches between the image and the contour wereapparent in the images corrected by ICC (gaps at the tip of the white arrows) and FDT(image went beyond the contour at the tip of the black arrow). Such mismatches are notpresent in the image corrected by our method. Comparing the circled regions illustrates theclarity difference between the corrected results using different approaches. In thiscomparison, our method appears to perform the best.Comput Med Imaging Graph. Author manuscript; available in PMC 2013 October 01.   Liu et al.Page 21Table 1Quantitative comparisons of the performance of the standard ICC, the ICC-mask, the ICC-MI, the ICC-mask-MI, and our algorithm. The mean error and corresponding standard variance error of the estimated MTSparameters were calculated, respectively. The mean Euclidian distance (MED) values of image intensity basedon the 200 images simulated with varying values of MTS are also shown in the table. The standard ICCperformed the worst and the most unstable, whereas the algorithms combining with the CSF mask or MIobviously improved performance. The mean error and standard variance error of the estimated parameters inour algorithm were the smallest, indicating that our method performed the best. The errors of MTS werecalculated separately using Equation (4), with arbitrary unit (a.u.).M errorT errorS errorMEDICC0.0394±0.12241.6717±3.83610.3185±0.964131.14±4.2628ICC-mask0.0021±0.00080.1523±0.17650.0453±0.169513.97±1.9945ICC-MI0.0044±0.00220.2746±0.61530.0511±0.119715.34±1.9554ICC-mask-MI0.0026±0.00150.1520±0.33240.0377±0.115615.00±1.3831Our Method0.0016±0.00040.0843±0.11770.0115±0.022112.29±1.0716I-NHPAAuthorManuscriptI-NHPAAuthorManuscriptI-NHPAAuthorManuscriptComput Med Imaging Graph. Author manuscript; available in PMC 2013 October 01.   Liu et al.Page 22Table 2A comparison of the percentages of ill-conditioned tensors reconstructed from DWI data corrected for EC-induced distortions using the different algorithms in the third experiment. “Improvement” is the reductioncompared with the number of ill-tensors in the uncorrected DWI data. Our algorithm yielded the fewest ill-conditioned tensors and greatest improvement.Not CorrectedICCFDTOur MethodIll-conditioned1.62%1.53% 1.40%0.98%Improvement-5.56% 13.58% 39.51%I-NHPAAuthorManuscriptI-NHPAAuthorManuscriptI-NHPAAuthorManuscriptComput Med Imaging Graph. Author manuscript; available in PMC 2013 October 01.   Page 23Liu et al.IWDdirbyhdetcerrocnuehtnisrosnet-lliforebmunehthtiwderapmocnoitcuderehtsi”tnemevorpmI“.tnemirepxehtruofehtnismhtiroglatnereffid.smhtiroglarehtoehtdidnahtyltneiciffeeromdemrofrepdohtemruO.snoitrotsidlaicifitraehtgnisopmirepuserofebatadehtotsreferIWDwaR.atadehtgnisusnoitrotsiddecudni-CErofdetcerrocatadIWDdirbyhehtmorfdetcurtsnocersrosnetdenoitidnoc-llifosegatnecrepehtfonosirapmocA3elbaTIWDwaRdohteMruOTDFCCIdirbyH%73.0-%74.0%86.0%47.0%31.4denoitidnoc-llI%26.88%45.38%80.28-tnemevorpmIComput Med Imaging Graph. Author manuscript; available in PMC 2013 October 01.I-NHPAAuthorManuscriptI-NHPAAuthorManuscriptI-NHPAAuthorManuscript                                   