Artificial Intelligence 175 (2011) 2099–2127Contents lists available at ScienceDirectArtificial Intelligencewww.elsevier.com/locate/artintA condensed semantics for qualitative spatial reasoning about orientedstraight line segmentsReinhard Moratz a,∗, Dominik Lücke b, Till Mossakowski b,ca University of Maine, National Center for Geographic Information and Analysis, Department of Spatial Information Science and Engineering,348 Boardman Hall, Orono, 04469 Maine, USAb University of Bremen, Collaborative Research Center on Spatial Cognition (SFB/TR 8), Department of Mathematics and Computer Science,Bibliothekstr. 1, 28359 Bremen, Germanyc DFKI GmbH Bremen, Safe and Secure Cognitive Systems, Enrique-Schmidt-Str. 5, 28359 Bremen, Germanya r t i c l ei n f oa b s t r a c tArticle history:Received 13 March 2010Received in revised form 22 July 2011Accepted 25 July 2011Available online 10 August 2011Keywords:Qualitative spatial reasoningRelation algebraAffine geometryMore than 15 years ago, a set of qualitative spatial relations between oriented straight linesegments (dipoles) was suggested by Schlieder. However, it turned out to be difficult toestablish a sound constraint calculus based on these relations. In this paper, we presentthe results of a new investigation into dipole constraint calculi which uses algebraicmethods to derive sound results on the composition of relations of dipole calculi. Thisnew method, which we call condensed semantics, is based on an abstract symbolic modelof a specific fragment of our domain. It is based on the fact that qualitative dipole relationsare invariant under orientation preserving affine transformations.The dipole calculi allow for a straightforward representation of prototypical reasoning tasksfor spatial agents. As an example, we show how to generate survey knowledge fromlocal observations in a street network. The example illustrates the fast constraint-basedreasoning capabilities of dipole calculi. We integrate our results into two reasoning toolswhich are publicly available.© 2011 Elsevier B.V. All rights reserved.1. IntroductionQualitative reasoning about space abstracts from the physical world and enables computers to make predictions aboutspatial relations, even when precise quantitative information is not available [4]. A qualitative representation provides mech-anisms which characterize the essential properties of objects or configurations. In contrast, a quantitative representationestablishes a measure in relation to a unit of measurement which must be generally available [12]. The constant and gen-eral availability of common measures is now self-evident. In history, however, there used to be a lot of measurement systemsthat were only standardized locally. If you said that a pole was six feet long, that pole would have been 150 cm long in thegrand duchy of Hesse, but 300 cm in the duchy of Nassau. Even today several quantitative systems of measurements areused in the world, with the SI-system, the Imperial system and the United States Customary Units being the predominantones. One need only recall the history of length measurement technologies to see that the more local relative measures,which are represented qualitatively,1 can be managed by biological/epigenetic cognitive systems much more easily thanabsolute quantitative representations.* Corresponding author.E-mail addresses: moratz@spatial.maine.edu (R. Moratz), luecke@informatik.uni-bremen.de (D. Lücke), till@informatik.uni-bremen.de,Till.Mossakowski@dfki.de (T. Mossakowski).1 Compare for example the qualitative expression “one piece of material is longer than another” with the quantitative expression “this thing is twometers long.”0004-3702/$ – see front matter © 2011 Elsevier B.V. All rights reserved.doi:10.1016/j.artint.2011.07.0042100R. Moratz et al. / Artificial Intelligence 175 (2011) 2099–2127Fig. 1. Orientation between two dipoles.Qualitative spatial calculi usually deal with elementary objects (e.g., regions, points) and qualitative relations betweenthem (e.g., “included in,” “adjacent,” “to the left of”). This is the reason why qualitative descriptions are quite natural forpeople. The two main trends in qualitative spatial reasoning (QSR) are topological reasoning about regions [9,44,45,49,64]and positional (e.g., direction and distance) reasoning about point configurations.2 Positional relations can refer to absolute(e.g., cardinal) directions [10,28,48] or to relative directions [25]. Relative position calculi based on points as basic entitiesare [3,13,23,35,54,65]. Most relative position calculi use ternary relations. In contrast cardinal directions are expressed asbinary relations. Positional calculi can be related to the results of psycholinguistic research in the field of reference systems[25,37]. Human natural language spatial propositions often express relative spatial positions based on reference directionsderived from the shape (and function) of one of the objects involved [25] (e.g., “The hill is to the left of the train”). Thisleads to binary relations between objects in which at least one of the objects has the feature of orientedness. For thatreason, in our conception, orientedness is an important feature of natural objects. In a corresponding qualitative calculus itis necessary to use more complex basic entities than points. One option for building more complex basic entities is to useoriented line segments (see Fig. 1) as basic entities. In this abstraction we lose the specific shape of the object, but preservethe feature of orientedness. With this approach we can design relative position calculi in which directions are expressed asbinary relations. The corresponding calculus, Schlieder’s line segment calculus [53],3 is the main topic of this paper. Orientedstraight line segments (which were called dipoles by Moratz et al. [36]) may be specified by their start and end points.Using dipoles as basic building blocks, more complex objects can be constructed (e.g., polylines, polygons) in a straight-forward manner (see Fig. 11). Therefore, dipoles can be used as the basic units in numerous applications. To give an example,line segments are central to edge-based image segmentation and grouping in computer vision. In addition, GIS systems oftenhave line segments as basic entities [21]. Polylines are particularly interesting for representing paths in cognitive robotics[40] and can serve as the geometric basis of a mobile robot when autonomously mapping its working environment [61]. Tosum up, dipole calculi are qualitative calculi that abstract from metric information. They focus on directional relations, butcan also be used to express certain topological relations (see Section 2.7).In the previous paragraphs, we discussed the representation of spatial knowledge. The central topic of this paper isthe collection of reasoning mechanisms which are employed to make use of the represented initial knowledge to inferindirect knowledge. In qualitative spatial reasoning two main reasoning modes are used: conceptual neighborhood-basedreasoning, and constraint-based reasoning about (static) spatial configurations. Conceptual neighborhood-based reasoningdescribes whether two spatial configurations of objects can be transformed into each other by small changes [11,15]. Theconceptual neighborhood of a qualitative spatial relation is the set of relations into which a relation can be changed withminimal transformations, e.g., by continuous deformation. Such a transformation can be a movement of one object in theconfiguration in a short period of time. The movement of an agent can then be modeled qualitatively as a sequence ofneighboring spatial relations which hold for adjacent time intervals.4 Based on this qualitative representation of trajectories,neighborhood-based spatial reasoning can for example be used as a simple, abstract model of the navigation of a spatialagent.5In constraint-based reasoning about spatial configurations, typically a partial initial knowledge of a scene is representedin terms of qualitative constraints between spatial objects. Implicit knowledge about spatial relations is then derived byconstraint propagation.6 Previous research has found that the mathematical notion of a relation algebra and related notionsare well-suited for this kind of reasoning. In particular, in an arbitrary relation algebra, the well-known path consistencyalgorithm computes an algebraic closure of a given constraint network, and this approximates, and in some cases alsodecides, the consistency of the network in polynomial time. Intelligent backtracking techniques and the study of maximaltractable subclasses also allow of efficiently deciding networks involving disjunctions. Starting with Allen’s interval algebra,this approach has been successfully applied to several qualitative constraint calculi, and is now supported by freely available2 There is also some work about directions between regions [18,55].3 However, Schlieder’s first presentation of dipole relations [53] does not mention composition of dipole relations. Moreover, he focuses on DRAlr (withno more than two start or end points on the same straight line), which cannot be used for polylines, while his presentation of the finer calculi is sketchyand imprecise, leading to the wrong number, 63, of DRA f relations. See Section 2.1 for the definition of these calculi.4 This was the reasoning used in the first investigation of dipole relations by Schlieder [53].5 For an application of neighborhood based reasoning of spatial agents, we refer the reader to the simulation model SAILAWAY [7].6 For an application of constraint-based reasoning for spatial agents, we refer the reader to the example in Section 2.5.R. Moratz et al. / Artificial Intelligence 175 (2011) 2099–21272101toolboxes [16,59]. Moreover, people have started to develop benchmark problem libraries [42] and have shown that thismethod performs quite well also when compared to other constraint reasoning techniques [60].Since this approach is inherently based on composition tables, an essential prerequisite is the computation of suchtables. For the dipole calculi, composition tables are quite large, and existing composition tables contain errors.7 The mainobjective of this paper is the first computation of correct composition tables for all dipole calculi. The next sections of thispaper present a detailed and technical description of dipole calculi and prove new results about algebraic features of theseconstraint calculi. In Section 2 we introduce base relation sets of the dipole calculi. Then we revisit the theory of constraintreasoning with algebraic closure. To use constraint reasoning in applications, our newly computed correct composition tablecan directly be fed into the SparQ [58,59] and GQR [16] tools and used for reasoning in dipole calculi. Using this, a concretesample application of dipole calculi using a spatial reasoning toolbox is presented. Finally, an inconsistent but algebraicallyclosed scenario is presented, showing the limits of the algebraic closure method.Section 3 tackles the problem of obtaining a correct composition table for dipole calculi. It provides a condensed seman-tics for the dipole calculus. A condensed semantics, as we call it, provides spatial domain knowledge to the calculus in theform of an abstract symbolic model of a specific fragment of the spatial domain. In this model, possible configurations ofvery few of the basic spatial entities of a calculus are enumerated. In our case, we use orbits in the affine group GA(R2).This provides a useful abstraction for reasoning about qualitatively different configurations in the Euclidean plane, so thatthe mathematical reasoning can be rather directly transformed to a computer program checking the configurations. Thisavoids the sources of errors of previous approaches to composition table computation. We use affine geometry at a ratherelementary level and appeal to pictures instead of complete analytic arguments, whenever it is easy to fill in the details—however, at key points in the argument, careful analytic treatments are provided. Further, we calculate the compositiontables for the dipole calculi using the condensed semantics and we investigate properties of the composition. It should benoted that condensed semantics techniques can be applied to other calculi as well, for example, the OPRA calculus [34].In general, condensed semantics can be summarized as the study of geometric transformations that leave the relations ofthe calculus at hand invariant, and then work with qualitative configurations, which essentially can be identified as orbitsin the automorphism group of these transformations.Our paper ends with a summary and conclusion and discussion of future work.2. Representation of dipole relations and relation algebrasIn this section, we first present a set of spatial relations between dipoles, then variants of this set of spatial relations.The next subsection gives a formal representation of dipole relations. Then a subsection presents the standard reasoningmethod with dipole relations. The last three subsections discuss application contexts for dipole reasoning and exhibit someof the limits of dipole reasoning.2.1. Basic representation of dipole relationsThe basic entities we use are dipoles, i.e., oriented line segments formed by a pair of two points, a start point and anend point. Dipoles are denoted by A, B, C, . . . , start points by s A and end points by e A , respectively (see Fig. 1). Thesedipoles are used for representing spatial objects with an intrinsic orientation. When examining different relations, the goalis to obtain a set B of jointly exhaustive and pairwise disjoint atomic or base-relations, such that exactly one relation holdsbetween any two dipoles. The set of general relations P(B) is the powerset of the set of base relations. That is, a generalrelation is a set R ⊆ B of base relations. It is interpreted as the union of these base relations, and by abuse of notation,we will identify a general relation R ⊆ B with the unionR. General relations are used to express uncertainty about therelative position of dipoles. If these relations form an algebra which fulfills certain requirements, it is possible to applystandard constraint-based reasoning mechanisms that were originally developed for temporal reasoning [1] and that havealso proved valuable for spatial reasoning (see Section 2.4).(cid:2)So as to enable efficient reasoning, an attempt should be made to keep the number of different base relations relativelysmall. For this reason, we will restrict ourselves to using two-dimensional continuous space for now, in particular R2, anddistinguish the location and orientation of different dipoles only according to a small set of seven different dipole–pointrelations. We distinguish between whether a point lies to the left, to the right, or at one of five qualitatively differentlocations on the straight line that passes through the corresponding dipole.8 The corresponding regions are shown in Fig. 2.7 There has been an explosion of new qualitative spatial calculi in the last decade. A recent diploma thesis supervised by us has found errors in thecomposition tables of several such calculi. But the composition table is the core of the standard reasoning mechanism (i.e. algebraic closure) for a calculus.A wrong composition table can easily lead to wrong conclusions in reasoning. While algebraic closure has its limits and is incomplete, we know thatit is still sound, i.e. always gives a safe approximation of the space of possible geometric configurations. However, this soundness depends on a correctcomposition table. Developing techniques for correctly computing composition tables is therefore an important contribution. This means that the methodsfor computing composition tables should be subject of research. Moreover, the method we use also gives insight into the nature of spatial configurations,by identifying them with orbits in the affine group GA(R2).8 In his introduction of a set of qualitative spatial relations between oriented line segments, Schlieder [53] mainly focused on configurations in which nomore than two end or start points were on the same straight line (e.g., all points were in general position). However, in many domains, we may wish torepresent spatial arrangements in which more than two start or end points of dipoles are on a straight line.2102R. Moratz et al. / Artificial Intelligence 175 (2011) 2099–2127Fig. 2. Dipole–point relations (= LR relations).A corresponding set of relations between three points was proposed by Ligozat [27] under the name flip-flop calculus andlater extended to the LR calculus [54].9Then these dipole–point relations describe cases where the point is: to the left of the dipole (l); to the right of thedipole (r); straight behind the dipole (b); at the start point of the dipole (s); inside the dipole (i); at the end of thedipole (e); or straight in front of the dipole (f). For example, in Fig. 1, sB lies to the left of A, expressed as A l sB . Usingthese seven possible relations between a dipole and a point, the relations between two dipoles may be specified accordingto the following four relationships:A R1 sB ∧ A R2 eB ∧ B R3 s A ∧ B R4 e A,where Ri ∈ {l, r, b, s, i, e, f} with 1 (cid:2) i (cid:2) 4. Theoretically, this gives us 2401 relations, out of which 72 relations are geomet-rically possible. They constitute the dipole calculus DRA f (f stands for fine grained) and they are listed in Fig. 3. In thenext subsection we present several versions of sets of dipole base relations also in an informal way. Then in Section 2.3 wedefine the dipole base relations in an algebraic way.Proposition 1. Allen’s interval algebra can be embedded into DRA f by the following mapping of base relations10:= (cid:6)→ seseb (cid:6)→ ffbbm (cid:6)→ efbso (cid:6)→ ifbid (cid:6)→ bfiis (cid:6)→ sfsif (cid:6)→ beiebi (cid:6)→ bbffmi (cid:6)→ bsefoi (cid:6)→ biifdi (cid:6)→ iibfsi (cid:6)→ sisffi (cid:6)→ iebeIn cases stemming from the embedding of Allen’s interval algebra, the dipoles lie on the same straight lines and have thesame direction. DRA f and DRAfp also contain 13 additional relations which correspond to the case with dipoles lying ona line but facing opposite directions.2.2. Several versions of sets of dipole base relationsIn their paper on customizing spatial and temporal calculi, Renz and Schmid [51] investigated different methods forderiving variants of a given calculus that have a granularity better-suited for certain tasks. One of these methods uses onlya subset of the base relations as a new set of base relations. For example, Schlieder [53] introduced a set of base relationsin which no more than two start or end points were on the same straight line. As a result, only a subset of the DRA f baserelations is used. We call DRAlr a calculus based on these base relations (where lr stands for left/right). The following baserelations are part of DRAlr: rrrr, rrll, llrr, llll, rrrl, rrlr, rlrr, rllr, rlll, lrrr, lrrl, lrll, llrl, lllr.Moratz et al. [36] introduced an extension of DRAlr which adds relations for representing polygons and polylines. Inthis extension, two start or end points can share an identical location. In this calculus three points at different locations stillcannot belong to the same straight line. This subset of DRA f was named DRAc (c refers to coarse,f refers to fine). Theset of 24 base relations of DRAc extends the base relations of DRAlr with the following relations: ells, errs, lere, rele, slsr,srsl, lsel, rser, sese, eses.The method of using only a subset of base relations reduces the number of base relations. Conversely, other methodsextend the number of base relations. For example, Dylla and Moratz [8] have observed that DRA f may not be sufficientfor robot navigation tasks, because the dipole configurations that are pooled in certain base relations are too diverse. Thus,the representation has been extended with additional orientation knowledge and a more fine-grained DRAfp calculus withadditional orientation distinctions has been derived. It has slightly more base relations.The large configuration space for the rrrr relation is visualized in Fig. 4. The other analogous relations which are ex-tremely coarse are llrr, rrll and llll. In many applications, this unwanted coarseness of four relations can lead to problems.119 The LR calculus also features the relations dou and tri for both reference points or all points being equal, respectively. These cases are not possiblefor dipoles, since the start and end points cannot coincide by definition.10 Indeed, this yields a homomorphism of non-associative algebras.11 An investigation by Dylla and Moratz into the first cognitive robotics applications of dipole relations integrated in situation calculus [8] showed thatthe coarseness of DRA f compared to DRAfp would indeed lead to rather meandering paths for a spatial agent.R. Moratz et al. / Artificial Intelligence 175 (2011) 2099–21272103Fig. 3. The 72 atomic relations of the DRA f calculus. In the dipole calculus, orthogonality is not defined, although the graphical representation maysuggest this.Fig. 4. Pairs of dipoles subsumed by the same relation.Therefore, we introduce an additional qualitative feature by considering the angle spanned by the two dipoles. This gives usan important additional distinguishing feature with four distinctive values. These qualitative distinctions are parallelism (P)or anti-parallelism (A) and mathematically positive and negative angles between A and B, leading to three refining relationsfor each of the four above-mentioned relations (Fig. 5).2104R. Moratz et al. / Artificial Intelligence 175 (2011) 2099–2127Fig. 5. Refined base relations in DRAfp.We call this algebra DRAfp, as it is an extension of the fine-grained relation algebra DRA f with additional distinguish-ing features due to “parallelism.” For the relations different from rrrr, llrr rrll and llll, a ‘+’ or ‘−’, ‘P’ or ‘A’ respectively, isalready determined by the original base relation and does not have to be mentioned explicitly. These base relations thenhave the same relation symbol as in DRA f .The introduction of parallelism into dipole calculi not only has benefits in certain applications, the algebraic features alsobenefit from this extension (see Section 3.6).2.3. Formal representation of dipole relationsThe dipole relations have been introduced in an informal way in Section 2.1, but they can also be defined in an algebraicway. The following derivation of the semantics of the dipole calculi may seem a bit complicated to some readers, but wewant to remain as compatible to the work begun by Moratz et al. in [36] as possible. Every dipole D on the plane R2 is anordered pair of two points sD and eD in the Euclidean plane, each of them being represented by its Cartesian coordinates xand y, with x, y ∈ R and sD (cid:8)= eD .D = (sD , eD ),sD =(cid:3)(cid:4)(sD )x, (sD ) y,(cid:3)eD =(eD )x, (eD ) y(cid:4)The basic relations are then described by equations with the coordinates as variables. The set of solutions for a systemof equations describes all the possible coordinates for these points. A first specification based on coordinates was presentedin Moratz et al. [36]. Let us focus here on the LR relations first. Given a dipole A and a point p, we want to determinewhether p lies to the right or to the left of A, or is collinear with A. We begin the derivation by constructing vectors (cid:9)A and(cid:9)P having base point s A and pointing to e A and p respectively as(cid:5)(cid:9)A =(e A)x − (s A)x(e A) y − (s A) y(cid:6)(cid:5)(cid:6),(cid:9)P =px − (s A)xp y − (s A) yIf we construe (cid:9)A and (cid:9)P as vectors in three-dimensional Euclidean space, located in the plane determined by z = 0, thevector product (Fig. 6)(cid:9)P × (cid:9)AR. Moratz et al. / Artificial Intelligence 175 (2011) 2099–21272105Fig. 6. Constructing (cid:9)P × (cid:9)A.Fig. 7. Computing LR-relation (a) and qualitative angle (b) via vectors.points upwards (z > 0) iff p is to the right of A, and downwards (z < 0) iff p is to the left of A. The z coordinate of (cid:9)P × (cid:9)Ais given byz = −px · (sa) y + (ea)x · (sa) y + p y · (sa)x − (ea) y · (sa)x − p y · (ea)x + px · (ea) yIf the vectors (cid:9)A and (cid:9)P are collinear (z = 0), we can useη =t (cid:9)A · (cid:9)P= (sa)2y+ (sa)2x+ p y · (ea) y + px · (ea)x− p y · (sa) y − (ea) y · (sa) y − px · (sa)x − (ea)x · (sa)x— this is positive if (cid:9)A and (cid:9)P point into the same direction, and negative if they point into opposite directions. Altogether,we can define the LR relations as:⎧⎪⎪⎪⎪⎪⎪⎪⎪⎪⎪⎪⎨⎪⎪⎪⎪⎪⎪⎪⎪⎪⎪⎪⎩iefR =if z < 0if z > 0lrb if z = 0 ∧ η < 0sif p = sa(cid:11)z = 0 ∧ η > 0(cid:10)ea − sa(cid:10) > (cid:10)p − sa(cid:10)ifif p = ea(cid:11)ifz = 0 ∧ η > 0(cid:10)ea − sa(cid:10) < (cid:10)p − sa(cid:10)This description of the relations is particularly useful for reasoning tasks, e.g., Gröbner reasoning. Gröbner reasoning can beused to check the solvability of linear equalities over the complex numbers. For the SparQ toolbox [58] an extension ofGröbner reasoning has been defined and implemented that can check the solvability of nonlinear inequalities over the realnumbers. Unfortunately Gröbner reasoning has doubly exponential running time. This particular extension is still work inprogress, but preliminary results have been published in [63]. A follow-up article is to appear.The semantics of the relations can also be expressed in a more convenient and more regular way using atan2 and thefunction angle based on it:angle( (cid:9)A, (cid:9)B) := atan2( (cid:9)Ax · (cid:9)B y − (cid:9)A y · (cid:9)B x, (cid:9)Ax · (cid:9)B x + (cid:9)A y · (cid:9)B y)To determine an LR-relation (a b R c) with a (cid:8)= b, we compute the angle from the vector (cid:9)ab to the vector (cid:9)ac as depicted inFig. 7(a). Now we just need to substitute the LR-relations for their definitions by the case distinction:2106R. Moratz et al. / Artificial Intelligence 175 (2011) 2099–2127⎧⎪⎪⎪⎪⎪⎪⎪⎪⎨⎪⎪⎪⎪⎪⎪⎪⎪⎩lrbsiefR =if 0 < angle(ab, ac) < πif − π < angle(ab, ac) < 0if angle(ab, ac) = π ∨ angle(ab, ac) = −πif angle(ab, ac) = 0 ∧ (cid:10) (cid:9)ac(cid:10) = 0if angle(ab, ac) = 0 ∧ (cid:10) (cid:9)ac(cid:10) < (cid:10) (cid:9)ab(cid:10)if angle(ab, ac) = 0 ∧ (cid:10) (cid:9)ac(cid:10) = (cid:10) (cid:9)ab(cid:10)if angle(ab, ac) = 0 ∧ (cid:10) (cid:9)ac(cid:10) > (cid:10) (cid:9)ab(cid:10)The conditions for s and e can be rewritten as a = c and b = c respectively. Please note that the LR relations Dou andTri (which express that the first two points coincide) cannot occur, since dipoles always have a non-zero length. To obtaina DRA f relation, we determine all four LR-relations by this operation and concatenate them in the manner describedabove.For determining a DRAfp-relation, we additionally need to determine the angle of intersection of two dipoles dp A and(cid:9)dp A and (cid:9)dp B as shown in Fig. 7(b) and we can get the quantitative angle viadp B . Again we consider them as vectorsangle( (cid:9)dp A, (cid:9)dp B )by using the simple case-distinction:⎧⎪⎪⎨⎪⎪⎩R5 =+ if 0 < angle( (cid:9)dp A, (cid:9)dp B ) < π− if − π < angle( (cid:9)dp A, (cid:9)dp B ) < 0A if angle( (cid:9)dp A, (cid:9)dp B ) = π ∨ angle( (cid:9)dp A, (cid:9)dp B ) = −πPif angle( (cid:9)dp A, (cid:9)dp B ) = 02.4. Constraint reasoning with algebraic closureThe domain of the dipole calculi, the Euclidean plane, is infinite. Standard methods developed for finite domains generallydo not apply to constraint reasoning over infinite domains. The theory of relation algebras and non-associative algebras[24,32] allows of a purely symbolic treatment of constraint satisfaction problems involving relations over infinite domains.The corresponding constraint reasoning techniques were originally introduced for temporal reasoning [1] and later provedto be valuable for spatial reasoning [22,49]. The central data for a qualitative calculus are given by:• a set B of (symbolic names for) base relations, which are interpreted as relations over some domain, having the crucialproperties of pairwise disjointness and joint exhaustiveness (a general relation is then simply a set of base relations);• a table for the computation of the converses of relations;• a table for the computation of the compositions of relations.As described in Section 2.1, the set of general relations P(B) is the powerset of the set of base relations, and each suchgeneral relation is identified with its union. The converse and composition operations are easily extended from B to P(B).These data together generate a so-called non-associative algebra [29,32]. Then, the path consistency algorithm [33] andbacktracking techniques [57] are the tools used to tackle the problem of consistency of constraint networks (and relatedproblems). These algorithms have been implemented in two generic reasoning tools, GQR [16] and SparQ [59]. To integratea new calculus into these tools, only a list of base relations and tables for compositions and converses need to be provided.Thereby, the qualitative reasoning facilities of these tools become available for this calculus. Since the compositions andconverses of general relations can be reduced to compositions and converses of base relations, these tables only need tobe given for base relations. Based on these tables, the tools provide a means to approximate the consistency of constraintnetworks, list all their atomic refinements, and more (see Section 2.5 for an application).12If b is a base relation, the converse {(x, y) | ( y, x) ∈ b} is often itself a base relation and is denoted by b.13 In the dipolecalculus, it is obvious that the converse of a relation can easily be computed by exchanging the first two and second twoletters of the name of a relation, see Table 1. Since (R(cid:4))(cid:4) = R in the DRA f calculus, the entries in the table can be readfrom top to bottom as well as from bottom to top yielding correct converses. For the dipole calculus DRAfp with additionalorientation distinctions, converses can be obtained by adding the simple rule that ‘+’ and ‘−’ are exchanged, while ‘P’ and‘A’ remain invariant.(cid:2)Since base relations generally are not closed under composition, this operation is approximated by a weak composition:(cid:12)(cid:13)(cid:14)b1 (cid:12) b2 =b ∈ B | (b1 ◦ b2) ∩ b (cid:8)= ∅where b1 ◦ b2 is given by the usual set theoretic composition12 With more information about a calculus, both of the tools can provide functionality that goes beyond simple qualitative reasoning for constraint calculi.13 In Freksa’s double-cross calculus [12] the converses are not necessarily base relations, but for the calculi that we investigate this property holds.R. Moratz et al. / Artificial Intelligence 175 (2011) 2099–21272107Table 1The converse ((cid:4)) operation of DRA f can be reduced to a simple permuta-tion.rrrlrlrrseseseselrilillrrrblblrrfefefeferrlrlrrrellslselllrfrfllbbffffbbfifififirrllllrrerrsrserlfrrrrlfefbsbsefebisisebrllrlrrllererelefrrrrrfrifbibiiffbiiiifbrlllllrlslsrsrslrrrbrbrrsfsisisffseieifslllllllllrririlrlllblbllbfiiiibfibibibiblrlllllrrllilirlflllllflbeieiebesbsbsbsbRR(cid:4)RR(cid:4)RR(cid:4)RR(cid:4)RR(cid:4)RR(cid:4)rrrrrrrresesesesirrlrlirbrllllbrbbbbbbbbffffffffR ◦ S =(cid:13)(x, z)(cid:15)(cid:15) ∃ y . (x, y) ∈ R, ( y, z) ∈ S(cid:14)Computing composition tables is non-trivial and will be the subject of Section 3. Generally, b1 (cid:12) b2 over-approximates theset-theoretic composition (i.e., b1 (cid:12) b2 (cid:2) b1 ◦ b2), while composition is said to be strong if approximation is exact, i.e.,b1 (cid:12) b2 = b1 ◦ b2. Strong composition has attracted some interest under the name extensional composition [2,26].Note that neither DRAlr nor DRAc provide a jointly exhaustive set of base relations over the Euclidean plane. Thisleads to the lack of an identity relation in the case of DRAlr, and more severely, for both DRAlr and DRAc , weak com-position does not lead to an over-approximation (nor to an under-approximation)14 of set-theoretic composition, because,e.g., ffbb is missing from the composition of llll with itself. This also means that we do not obtain a non-associative algebrafor these calculi. By contrast, DRA f and DRAfp provide jointly exhaustive and pairwise disjoint sets of base relations, andlead to non-associative algebras.Let us now apply the relation-algebraic method to constraint reasoning. Given a qualitative calculus with set of baserelations B, a constraint network is a map ν : N × N → P(B), where N is a set of nodes (or variables) [29]. Individualconstraints ν( X, Y ) = R are written XRY , where X , and Y are variables in N and R is a relation in P(B). A constraintnetwork ν : N × N → P(B) is atomic or a scenario if each ν( X, Y ) is a base relation.Given a constraint network ν, an important reasoning problem is to decide whether ν is consistent, i.e., whether there isan assignment of all variables of ν with dipoles such that all constraints are satisfied (a solution). We call this problem DSAT.DSAT is a constraint satisfaction problem (CSP) [31]. We rely on relation-algebraic methods to check consistency, namelythe above mentioned path consistency algorithm. For non-associative algebras, the abstract composition of relations neednot coincide with the (associative) set-theoretic composition. Hence, in this case, the standard path-consistency algorithmdoes not necessarily lead to path consistent networks, but only to algebraic closure, which is defined as follows [47]:Definition 2 (Algebraic closure). A constraint network over binary relations is called algebraically closed if for all variablesX1, X2, X3 and all relations R1, R2, R3 the constraint relationsX1R1 X2,X2R2 X3,X1R3 X3implyR3 (cid:2) R1 (cid:12) R2.Algebraic closure can be enforced by iteratingR3 := R3 ∩ (R1 (cid:12) R2)for X1R1 X2, X2R2 X3, X1R3 X3 until a fixed point is reached. Note that this procedure leaves the set of solutions of theconstraint network invariant. This means that if the algebraic closure contains the empty relation, the original network isinconsistent.However, in general, algebraic closure is only a one-sided approximation of consistency: if algebraic closure detects aninconsistency, then we are sure that the constraint network is inconsistent; however, algebraic closure may fail to detectsome inconsistencies: an algebraically closed network is not necessarily consistent. For some calculi, like Allen’s interval14 Recall that generally, weak composition over-approximates composition, and exactly captures it in the case of strong composition.2108R. Moratz et al. / Artificial Intelligence 175 (2011) 2099–2127Fig. 8. A street network and two local observations.algebra, algebraic closure is known to exactly decide the consistency of scenarios, but for others it does not, see [47], whereit is also shown that this question is completely orthogonal to the question of whether the composition is strong. We willexamine these questions for the dipole calculi in Sections 2.7 and 3.4 ff. below.2.5. A sample application of algebraic closure reasoning with the dipole calculusIn this subsection, we want to demonstrate with an example why the dipole calculus is a useful qualitative model fordirectional information. Moreover, the example shows that composition-based reasoning is useful although it is incomplete.Our example uses the spatial knowledge expressed in DRAfp for deductive reasoning based on constraint propagation(algebraic closure), resulting in the generation of useful indirect knowledge from partial observations in a spatial scenario.This is a direct application of the composition table which we generated based on our new condensed semantics for thedipole calculi (see Section 3).In our sample application, a spatial agent (a simulated robot, cognitive simulation of a biological system, etc.) exploresa spatial scenario. The agent collects local observations and wants to generate survey knowledge. Fig. 8 shows our spatialenvironment. It consists of a street network in which some streets continue straight after a crossing and some streetsrun parallel. These features are typical of real-world street networks. Spatial reasoning in our example uses constraintpropagation (e.g., algebraic closure computation) to derive indirect constraints between the relative location of streets whichare further apart than are the local observations between neighboring streets. The resulting survey knowledge can be usedfor several tasks including navigation tasks.The environment is represented by streets si and crossings C j . The streets and crossings have unique names (e.g.,s1, . . . , s12, and C1, . . . , C9 in the concrete example). The local observations are modeled in the following way, based onspecific visibility rules (we want to simulate the prototypical features of visual perception): Both at each crossing and ateach straight street segment we have an observation. At each crossing the agent observes the neighboring crossings. At themiddle of each straight street segment the agent can observe the direction of the outgoing streets at the adjacent crossings(but not at their other ends). Two specific examples of observations are marked in Fig. 8. The observation “s1 errs s7” ismarked at crossing C1. The observation “s8 rrllP s9” is marked at street s4.These observations relate spatially neighboring streets to each other in a pairwise manner, using DRAfp base rela-tions. The agent has no additional knowledge about the specific environment. The spatial world knowledge of the agent isexpressed in the converse and composition tables of DRAfp.The following sequence of partial observations could be the result of a tour made by the spatial agent exploring thestreet network of our example (see Fig. 8):Observations at crossingsC1: (s7 errs s1)C2: (s1 efbs s2) (s8 errs s2) (s1 rele s8)C3: (s2 rele s9)C4: (s10 efbs s7) (s10 errs s3) (s7 srsl s3)C5: (s3 efbs s4) (s11 efbs s8) (s11 errs s4) (s3 ells s8)(s3 rele s11) (s8 srsl s4)C6: (s12 efbs s9) (s4 ells s9) (s4 rele s12)C7: (s10 srsl s5)C8: (s5 efbs s6) (s5 ells s11) (s11 srsl s6)C9: (s6 ells s12)R. Moratz et al. / Artificial Intelligence 175 (2011) 2099–21272109Fig. 9. All observation and resulting uncertainty marked with different colors.Observations at streetss1: (s7 rrllP s8)s2: (s8 rrllP s9)s3: (s10 rrllP s11)s4: (s11 rrllP s12)s8: (s3 llrr- s1)s9: (s4 llrr- s2)s10:(s3 rrll- s5)s11:(s4 rrll- s6)The result of the algebraic closure computation/constraint propagation is a refined network with the same solution set(the results are computed with the publicly available SparQ reasoning tool supplied with our newly computed DRAfpcomposition table [58]). We have listed the results in the next Section 2.6. Three different models are the only remainingconsistent interpretations (see Section 2.6 for a list of all the resulting data). The three different models agree on all butfour relations. The solution set can be explained with the help of the diagram in Fig. 9. The input crossing observationsare marked with green arrows, the input street observations are marked with red arrows. The result shows that for allstreet pairs which could not be observed directly, the algebraic closure algorithm deduces a strong constraint, i.e., preciseinformation: typically, the resulting spatial relation between street pairs comprises just one DRAfp base relation. Theexception consists of four relations between streets in which the three models differ (marked with dashed blue arrows inFig. 9). For these four relations, each model from the solution set agrees on the same DRA f base relation for a givenpair of dipoles, but the three consistent models differ on the finer granularity level of DRAfp base relations. Since therefinement of one of these four underspecified relations into a single interpretation (DRAfp base relation) as a logicalconsequence also assigns a single base relation to the other three relations, only three interpretations are valid models. Theuncertainty/indeterminacy is the result of the specific street configuration in our example. The streets in a North–Southdirection are parallel, but the streets in an East–West direction are not parallel, resulting in fewer constraint compositionresults. However, the small solution set of consistent models agrees on most of the relative position relations between streetpairs and the differences between the models are small. In our judgement, this means that the system has generated therelevant survey knowledge about the whole street network from local observations alone.2.6. Computation for the street network application with the SparQ toolIn this section, we demonstrate how to use the publicly available SparQ QSR toolbox [58] to compute the algebraic clo-sure by constraint propagation for the street network example from the previous Section 2.5. For successful relative positionreasoning, the SparQ tool has to be supplied with our newly computed DRAfp composition table which we generatedbased on our new condensed semantics for the dipole calculi (see Section 3).The local street configuration observations by the spatial agent are listed in Section 2.5. The direct translation of theselogical propositions into a SparQ spatial reasoning command looks as follows15:sparq constraint-reasoning dra-fp path-consistency "( (s7 errs s1) (s1 efbs s2) (s8errs s2) (s1 rele s8) (s2 rele s9) (s10 efbs s7) (s10 errs s3) (s7 srsl s3) (s3 efbss4) (s11 efbs s8) (s11 errs s4) (s3 ells s8) (s3 rele s11) (s8 srsl s4) (s12 efbs s9)15 For technical details of SparQ we refer the reader to the SparQ manual [58].2110R. Moratz et al. / Artificial Intelligence 175 (2011) 2099–2127(s4 ells s9) (s4 rele s12) (s10 srsl s5) (s5 efbs s6) (s5 ells s11) (s11 srsl s6) (s6ells s12) (s7 rrllP s8) (s8 rrllP s9) (s10 rrllP s11) (s11 rrllP s12) (s3 llrr- s1) (s4llrr- s2) (s3 rrll- s5) (s4 rrll- s6) )"16The result of this reasoning command is a refined network with the same solution set derived by the application ofthe algebraic closure/constraint propagation algorithm (see Section 2.4). SparQ omits the converses for a more compactpresentation.Modified network.((S5 (EFBS) S6)(S12 (LSEL) S6)(S12 (LLFL) S5)(S11 (SRSL) S6)(S11 (LSEL) S5)(S11(RRLLP) S12) (S4 (RRLL-) S6)(S4 (RRLL-) S5)(S4 (RELE) S12)(S4 (RSER) S11)(S3 (RRLL-)S6)(S3 (RRLL-) S5) (S3 (RFLL) S12)(S3 (RELE) S11)(S3 (EFBS) S4)(S10 (RRBL) S6)(S10(SRSL) S5)(S10 (RRLLP) S12) (S10 (RRLLP) S11)(S10 (RRRB) S4)(S10 (ERRS) S3)(S9 (LBLL)S6)(S9 (LLLL-) S5)(S9 (BSEF) S12) (S9 (LLRRP) S11)(S9 (LSEL) S4)(S9 (LLFL) S3)(S9(LLRRP) S10)(S8 (BRLL) S6)(S8 (LBLL) S5) (S8 (RRLLP) S12)(S8 (BSEF) S11)(S8 (SRSL)S4)(S8 (LSEL) S3)(S8 (LLRRP) S10)(S8 (RRLLP) S9) (S2 (RRLL+ RRLL- RRLLP) S6)(S2(RRLL+ RRLL- RRLLP) S5)(S2 (RRLF) S12)(S2 (RRFR) S11)(S2 (RRLL+) S4) (S2 (RRLL+)S3)(S2 (RRRR+) S10)(S2 (RELE) S9)(S2 (RSER) S8)(S1 (RRLL+ RRLL- RRLLP) S6) (S1(RRLL+ RRLL- RRLLP) S5)(S1 (RRLL+) S12)(S1 (RRLF) S11)(S1 (RRLL+) S4)(S1 (RRLL+) S3)(S1 (RRFR) S10)(S1 (RFLL) S9)(S1 (RELE) S8)(S1 (EFBS) S2)(S7 (RRLL-) S6)(S7 (BRLL) S5)(S7 (RRLLP) S12)(S7 (RRLLP) S11)(S7 (RRBL) S4)(S7 (SRSL) S3)(S7 (BSEF) S10)(S7 (RRLLP)S9) (S7 (RRLLP) S8)(S7 (RRRB) S2)(S7 (ERRS) S1))SparQ can output all path-consistent scenarios (i.e., constraint networks in base relations). For this constraint network,only three slightly different path consistent scenarios exist. They differ only in the following three relation subsets:1. (S2 (RRLLP) S6)(S2 (RRLLP) S5) (S1 (RRLLP) S6)(S1 (RRLLP) S5)2. (S2 (RRLL-) S6)(S2 (RRLL-) S5) (S1 (RRLL-) S6)(S1 (RRLL-) S5)3. (S2 (RRLL+) S6)(S2 (RRLL+) S5) (S1 (RRLL+) S6)(S1 (RRLL+) S5)All the other relations were already assigned a single base relation in the refined network which is shown above as a resultof the application of the algebraic closure algorithm. This result can be visualized with a diagram and can be interpreted interms of the goals of the reasoning task (see Section 2.5).2.7. Limits of algebraic closureWe now consider the question of whether algebraic closure decides consistency. This has been open for DRA f . Recallfrom Section 2.4 that the set of constraints between all dipoles at hand is called a constraint network. If no constraintbetween two dipoles is given, we agree that they are in the universal relation. Further recall that by a scenario, we denotea constraint network in which all constraints are base relations.17With the help of the embedding of the interval algebra into DRA f (see Proposition 1), we can show that algebraicclosure decides the consistency of DRA f scenarios that only involve images of relations of the interval algebra. Moreover,for calculi such as RCC8 [46], the interval algebra [41], etc., (maximal) tractable subsets (see [50]) have been determined, i.e.,sets of relations for which algebraic closure decides the consistency also of non-atomic constraint networks involving theserelations. We then also obtain that algebraic closure in DRA f decides the consistency of any constraint network involving(the image of) a maximal tractable subset of the interval algebra only. Similar remarks apply to DRAfp.However, the situation changes if we move to the full calculus. The scenario consistency problem for the DRA f calculusis already NP-hard, see [62], and hence algebraic closure (which is polynomial) does not decide scenario consistency in thiscase (assuming P (cid:8)= NP). This means that there are essentially no tractable subsets.To illustrate the failure of algebraic closure to decide consistency, we now construct constraint networks which aregeometrically unrealizable but still algebraically closed. This also gives some insight into the calculi: note that for the LRcalculus, such counterexamples can be extremly simple [30], which is not the case here. We obtain such a counterexampleby constructing constraint networks that are consistent and algebraically closed, and then we will change a relation in sucha way that they remain algebraically closed but become inconsistent. We follow the approach of [52] in using a simplegeometric shape for which scenarios exist, where algebraic closure fails to decide consistency. In our case, the basic shapeis a convex hexagon (see Fig. 10).16 SparQ does not accept line breaks which we have inserted here for better readability. All the data for this sample application including the newcomposition table can be obtained from the URL http://www.informatik.uni-bremen.de/~till/Oslsa.tar.gz (which also provides the composition table andother data for the GQR reasoning tool https://sfbtr8.informatik.uni-freiburg.de/R4LogoSpace/Resources/).17 In this case, a base relation between every pair of distinct dipoles has to be provided.R. Moratz et al. / Artificial Intelligence 175 (2011) 2099–21272111First we will show that algebraic closure does not decide consistency for DRA f . Consider a convex hexagon consistingof the dipoles A, B, C , D, E and F . Such an object is described asFig. 10. Convex hexagon.( A errs B)(B errs C)(C errs D)(D errs E)(E errs F )(F errs A)(F rrrr C)( A rrrr D)(B rrrr E)( A rrrr C)(F rrrr D)(B rrrr D)( A rrrr E)(C rrrr E)(B rrrr F )where the relations rrrr make sure that none of the dipoles intersect and together with the components r of the relationserrs ensure convexity, since they enforce an angle between 0 and π between the respective first and second dipole, i.e.,the endpoint of consecutive dipoles always lies to the right of the preceding dipole. Such an object is given in Fig. 10. Anyobject inside the hexagon lies to the right of all the dipoles, otherwise it is on the border or outside. To this scenario weadd dipoles G and H inside the hexagon(F rrrl H)(C rrlr G)(H efbs G)that are collinear and such that the endpoint of H is the startpoint of G. This gives us the constraint network( A errs B)(B errs C)(C errs D)(D errs E)(E errs F )(F errs A)(F rrrr C)( A rrrr D)(B rrrr E)( A rrrr C)(F rrrr D)(B rrrr D)( A rrrr E)(C rrrr E)(B rrrr F )(F rrrl H)(C rrlr G)(H efbs G)We construct an inconsistency by postulating that H (i.e., its start- and endpoint) lies to the left of E, meaning that itlies outside the hexagon by introducing the constraint (E llrr H). By applying algebraic closure, we get a refinement of ournetwork that does not contain the empty set:(H efbs G)(F rrrl G)(F rrrl H)(E llrr G)(E llrr H)(E errs F )(D (llrr rrrr) G)(D (llrr rrrr) H)(D rrrr F )(D errs E)(C rrlr G)(C rrlr H)(C rrrr F )(C rrrr E)(C errs D)(B (llll rrll) G)(B (llll rrll) H)(B rrrr F )(B rrrr E)(B rrrr D)(B errs C)( A (llll rrll) G)( A (llll rrll) H)( A rser F )( A rrrr E)( A rrrr D)( A rrrr C)( A errs B)But H has to lie to the left of E, meaning outside the convex hexagon and inside of it at the same time. This is impossiblein the Euclidean plane. In fact, we can construct similar inconsistencies for several dipoles, just check the above constraintnetwork for the relation llrr. Unfortunately algebraic closure with DRA f does not decide consistency.The constraint network can be extended to a DRAfp constraint network in a straightforward manner by replacing rrrr by{rrrr+, rrrr-, rrrrA} and llrr by {llrr+, llrr-, llrrP}. Algebraic closure with DRAfp then detects the inconsistency in the network.We drop the constraint (E (llrr+, llrr-, llrr P) H) and observe that the relation between E and H is refined to(cid:3)(cid:4)E (rrrr+ rrrr- rrrrA) H.This constraint has no component that demands H ’s being outside of the hexagon, as in the DRA f case.We have found an example that shows that algebraic closure for DRAfp finds inconsistencies in constraint networkswhere it fails for DRA f . This leads to the question: Does algebraic closure decide consistency for DRAfp? We can give anegative answer also to this question.2112R. Moratz et al. / Artificial Intelligence 175 (2011) 2099–2127Fig. 11. Construction of the counterexample as a Pappus configuration.To construct a counterexample, we begin with a point configuration with nine points A, B, . . . , I as in Fig. 11. Thisconfiguration corresponds to a Pappus configuration [5]. A Pappus configuration has nine points and nine straight lines.Eight collinearities of point triples: G H I , A BC , A D H , A E I , B DG, B F I , C E G, C F H enforce the collinearity of the ninth pointtriple D E F (by Pappus’ Hexagon Theorem [5]). We can reconstruct this arrangement with dipoles and add an inconsistencywith Pappus’ Hexagon Theorem which is not detected with the algebraic closure for DRAfp.The configuration from Fig. 11 can be described as a constraint network in the following way:(G H efbs H I)( A B efbs BC) ( A D efbs D H)( A E efbs E I) (B D efbs D G)(B F efbs F I) (C E efbs E G) (C F efbs F H) (D G errs G H)(D G rele E G)(F I lere H I) (F I lere E I)( A D srsl A E) ( A D srsl A B) (C F lsel BC)(C F slsr C E) (G H rele D H)(G H rele F H) ( A B ells B F ) ( A B ells B D)( A D ells D G)( A D rele B D) (C F errs F I) (C F lere B F ) ( A E rele C E)a dipole X Y in this description is the dipole from point X to point Y . We observe that by Pappus’ Hexagon Theorem thepoints D, E and F are collinear. We now add a constraint( A E (lrrr lrrl) D F )that states that the carrier lines of A E and D F intersect between A and E or in front of A E, but not in E. But since D, Eand F are collinear, the only possible intersection point is E, a contradiction. Any scenario based on this constraint networkcannot be consistent. But applying algebraic closure with DRAfp yields a refinement and dozens of possible scenarios, e.g.,(D G rrll- F I)(F H rser D F ) (C F rele D F ) (C F efbs F H) (E G rrrr+ D F )(E G rrll- F H) (E G brll C F )(C E rrbl F H)(C E rrlr D F )(C E srsl C F ) (C E efbs E G) (F I rser D F )(F I slsr F H)(F I rser C F ) (F I llrr+ E G) (F I rlrr C E)(B F rele D F )(B F ells F H) (B F rele C F ) (B F lllr E G)(B F rllr C E)(B F efbs F I) (D G rrrr+ D F )(D G rrllP F H) (D G rrllP C F )(D G rele E G) (D G rrlf C E)(D G brll B F )(B D rrlr D F ) (B D rrllP F H) (B D rrllP C F ) (B D rfll E G)(B D rrll+ C E) (B D rrbl F I)(B D efbs D G)(B D srsl B F )(E I lrrr D F ) (E I rllr F H)(E I slsr E G)(E I rrlr C F )(E I rser C E) (E I rele F I)(E I llrr+ D G)(E I rrlf B F )(E I rlrr B D)( A E rrll+ C F )( A E lrrr D F ) ( A E rlll F H)( A E ells E G) ( A E rele C E) ( A E rfll F I)( A E rrll+ B F )( A E lllr D G) ( A E rllr B D)(D H rrrrA D F )( A E efbs E I)(D H rele F H)(D H rrlf C F ) (D H rll E G)(D H rrlr C E)(D H rrll+ F I) (D H rrll+ B F ) (D H slsr D G) (D H rser B D)(D H rrll- E I) (D H brll A E) ( A D rrrrA D F )( A D rfll F H)( A D rrll+ C F )( A D rlll E G)( A D rrll+ C E) ( A D rrll+ F I)( A D rrll+ B F )( A D ells D G) ( A D rele B D) ( A D rrbl E I)R. Moratz et al. / Artificial Intelligence 175 (2011) 2099–21272113( A D srsl A E) ( A D efbs D H)(BC llll- D F ) (BC lllb F H)(BC ells C F ) (BC lllb E G)(BC ells C E) (BC llbr F I)(BC slsr B F ) (BC llbr D G) (BC slsr B D) (BC llrr+ E I)(BC blrr A E) (BC llrr+ D H)(BC blrr A D) ( A B llrl D F )( A B llll+ F H)( A B flll C F )( A B llll+ E G) ( A B flll C E)( A B lllb F I) ( A B ells B F ) ( A B lllb D G) ( A B ells B D)( A B llbr E I) ( A B slsr A E) ( A B llbr D H) ( A B slsr A D)( A B efbs BC)(H I lrrr D F ) (H I rser F H) (H I rrfr C F )(H I rbrr E G) (H I rrrr+ C E) (H I rele F I)(H I rrlf B F )(H I rbrr D G)(H I rrrr+ B D)(H I rele E I)(H I rrlf A E)(H I rser D H)(H I rrfr A D) (H I rrllP BC) (H I rrllP A B)(G H lrrr D F )(G H rele F H) (G H rrlf C F ) (G H rser E G)(G H rrfr C E) (G H rfll F I)(G H rrll+ B F )(G H rser D G)(G H rrfr B D)(G H rfll E I)(G H rrll+ A E)(G H rele D H)(G H rrlf A D) (G H rrllP BC) (G H rrllP A B)(G H efbs H I)For DRAfp also, algebraic closure does not decide consistency even for scenarios. This counterexample can also be used forDRA f , but the above is simpler and shows differences in the reasoning effectiveness of algebraic closure for DRAfp andDRA f .3. A condensed semantics for the dipole calculusSince the domains of most spatial calculi are infinite (e.g., the Euclidean plane), it is impossible just to enumerate allpossible configurations relative to the composition operation when deriving a composition table.18 Hence, the questionremains how a composition table can be computed in an effective and automatic way. To start, we tried generating thecomposition table of DRA f directly, using the resulting quadratic inequalities as described in [36] and derived exhaustivelyon p. 2105. However, it turned out that it is infeasible to base the reasoning on these inequalities, even with the aid ofinteractive theorem provers such as Isabelle/HOL [43] and HOL-light [20] (the latter is dedicated to proving facts about realnumbers) and Gröbner base reasoners.19 This infeasibility is probably related to the above-mentioned NP-hardness of theconsistency problem for dipole base relations.Therefore, we developed a qualitative abstraction instead which we call condensed semantics. It provides a level ofabstraction from the metrics of the underlying space. We observe the Euclidean plane with respect to all possible lineconfigurations that are distinguishable within the DRA calculi.From a more formal point of view, a key insight is that two configurations are qualitatively different if they cannot betransformed into each other by maps that keep that part of the spatial structure invariant that is essential for the calculus.In our case, these maps are the (orientation preserving) affine bijections. A set of configurations that can be transformedinto each other by appropriate maps is an orbit of a suitable automorphism group. Here, we use primarily the affine groupGA(R2) and show in detail how this leads to qualitatively different spatial configurations. The results of this analysis can bemapped onto an efficient method for computing the composition tables for DRA f and DRAfp.3.1. Seven qualitatively different configurationsFor the binary composition operation of DRA calculi, we have to consider all qualitatively different configurationsof three lines. In order to formalize “qualitatively different configurations,” we regard the DRA calculus as a first-orderstructure, with the Euclidean plane as its domain, together with all the base relations. Let us start with having a look at theautomorphism groups for DRA f and DRAfp.Definition 3. An affine map f from the Euclidean plane to itself is given by a 2× 2 transformation matrix A and a translationvector (bx, b y) such that18 It can be shown that the exhaustive inspection of a finite number of configurations in a finite grid would suffice to compute the composition tableof the dipole calculi. The size of the grid needs to be double-exponential in the number of points [17], and therefore the number of grids to consider istriple-exponential. This is practically infeasible: even for three points, already 222319 For the computation of the DRAc composition table reported in [36], Gröbner base reasoning needed to be complemented by a grid method. Ingeneral, the research history of QSR about dipoles shows that it is necessary to use methods that yield more reliable results. The dipole composition onwhich we focus in this section involves configurations of three dipoles. However, even the much simpler question about a complete list of distinguishabledipole base relations characterized by certain properties (e.g., dipole to point relations) is not trivial. This question can be answered by configurations of justtwo dipoles and how to list them exhaustively. Deriving manually the 72 base relations of DRA f , or the 80 base relations of DRAfp, is an error-proneprocedure. For this reason, the manually derived sets of base relations for the finer-grained dipole calculi described in [36,53], as well as the compositiontables, contained errors.≈ 1077 grids would need to be inspected.2114R. Moratz et al. / Artificial Intelligence 175 (2011) 2099–2127f (x, y) = A(cid:16)(cid:17)xy+ (bx, b y)fis a bijection iff det( A) is non-zero, and fis orientation preserving iff det( A) is positive.Proposition 4. All orientation preserving affine bijections are DRA f and DRAfp automorphisms.(In [39], the converse is also shown.)Proof. It suffices to show that orientation preserving affine bijections preserve the LR relations. Now, any orientationpreserving affine bijection is a product of translations, rotations, scalings and shears. It is straightforward to see that thesemappings preserve the LR relations. (cid:2)Automorphisms and their compositions form a group which acts on the set of points (and tuples of points, lines, etc.)by function application. Recall that if a group G acts on a set, an orbit consists of the set reachable from a fixed element byperforming the action of all group elements: G x = { f (x) | f ∈ G}. The importance of this notion is the following:Two configurations which are qualitatively different belong to disjoint orbits of the automorphism group.Note that while this is related to the theory of line arrangements [19], we here work in a slightly different setting. First,the theory of line arrangements uses a weaker notion of isomorphism than we do. Second, work about line arrangementsmostly uses the projective plane where there are only two configurations of three lines, instead of the Euclidean planewhere parallelism is possible. Here we are only interested in the Euclidean plane and have to distinguish the cases wheretwo or more lines are parallel or even identical. The reason is that, e.g., DRAfp distinguishes between A llrrP B ( A and Bpoint into the same direction and have distinct parallel carrier lines) and A and B being in some Allen relation ( A and Bpoint into the same direction and have the same carrier line). Third, we also consider triples of lines (later on), not just setsof three lines.Further note that Cristani’s 2DSLA calculus [6], which can be used to reason about sets of lines, is too coarse for ourpurposes: our orbits (1) and (2) introduced below cannot be distinguished in 2DSLA.We start with configurations consisting of from one up to three lines in the Euclidean plane, i.e., we consider the orbitsof all sets {l1, l2, l3} where l1, l2 and l3 are not necessarily distinct. We consider two such configurations to be isomorphic ifthey can be mapped into each other by an affine bijection. That is, we work with orbits in the group of all affine bijections(and not just the orientation preserving ones—orientations will come in at a later stage). This group is usually called theaffine group of R2 and denoted by GA(R2).A line in the Euclidean plane is given by the set of all points (x, y) for which y = mx + b. Given three lines y = mi x + bi(i = 1, 2, 3), we list their orbits by giving a defining property. In each case, it is fairly obvious that the defining property ispreserved by affine bijections. Moreover, in each case, we show a transformation property, namely that given two instancesof the defining properties, the first instance can be transformed into the second by an affine bijection. Together, this meansthat the defining property exactly specifies an orbit. The transformation property often follows from the following basicfacts about affine bijections, see [14]:1. An affine frame [14] is for an affine space what a basis is for a vector space; in particular, any point of an affine spaceis a unique affine combination of points from the frame. An affine frame for an n-dimensional affine space consists ofn + 1 points; in particular, an affine frame for the Euclidean plane is a point triple in general position. The importanceof this notion in the present context is the following: An affine bijection is uniquely determined by its action on anaffine frame, the result of which is given by another affine frame. Hence, given any two point triples in the Euclideanplane in general position, there is a unique affine bijection mapping the first point triple to the second.2. Affine maps transform lines into lines.3. Affine maps preserve parallelism of lines.That is, it suffices to show that an instance of the defining property is determined by three points in general position anddrawing lines and parallel lines.We will consider the intersection of line i with line j (i (cid:8)= j ∈ {1, 2, 3}). This is given by the system of equations{ y = mi x + bi, y = m j x + b j}This does not cover the case of the line x = 0; however, without loss of generality, we can assume that this case does notoccur: we always can apply an appropriate affine bijection mapping the three lines away from the line x = 0.For mi (cid:8)= m j , the above system of equations has a unique solution:y = mib j − m jbimi − m jx = − bi − b jmi − m j,R. Moratz et al. / Artificial Intelligence 175 (2011) 2099–21272115For mi = m j , there is either is no solution (bi (cid:8)= b j ; the lines are parallel), or there are infinitely many solutions (bi = b j ;the lines are identical).We can now distinguish seven cases:1. All mi are distinct and the three systems of equations { y = mi x + bi, y = m j x + b j} (i (cid:8)= j ∈ {1, 2, 3}) yield threedifferent solutions. Geometrically, this means that all three lines intersect with three different intersection points. Thetransformation property follows from the fact that the three intersection points determine the configuration. In thetheory of line arrangements, this is called a simple arrangement [19].2. All mi are distinct and at least two of the three systems of equations { y = mi x + bi, y = m j x + b j} (i (cid:8)= j ∈ {1, 2, 3})have a common solution. Then, obviously, the single solution is common to all three equation systems. Geometrically,this means that all three lines intersect at the same point. In the theory of line arrangements, this is called a trivialarrangement [19].Take this point and a second point on one of the lines. By drawing parallels through this second point, we obtain twomore points, one on each of the other two lines, such that the four points form a parallelogram. The transformationproperty now follows from the fact that any two non-degenerate parallelograms can be transformed into each other byan affine bijection.3. mi = m j (cid:8)= mk and bi (cid:8)= b j for distinct i, j, k ∈ {1, 2, 3}. Geometrically, this means that two lines are parallel but not coin-cident, and the third line intersects them. Such a configuration is determined by three points: the points of intersection,plus a further point on one of the parallel lines. Hence, the transformation property follows.4. mi = m j (cid:8)= mk and bi = b j for distinct i, j, k ∈ {1, 2, 3}. Geometrically, this means that two lines are equal and the thirdone intersects them. Again, such a configuration is determined by three points: the intersection point plus a furtherpoint on each of the (two) different lines. Hence, the transformation property follows.2116R. Moratz et al. / Artificial Intelligence 175 (2011) 2099–21275. All mi are equal, but the bi are distinct. Geometrically, this means that all three lines are parallel, but not coincident.We cannot show the transformation property here, which means that this case comprises several orbits. Actually, weget one orbit for each distance ratiob1 − b2b1 − b3An affine bijectionf (x, y) = A(cid:16)(cid:17)xy+ (bx, b y)transforms a line y = mx + b to y = mx + bHowever, since m = m1 = m2 = m3, this nonlinearity does not matter. This means that= b1 − b2b1 − b3= c1(m)b1 − c1(m)b2c1(m)b1 − c1(m)b3− b− b, with bbb(cid:18)(cid:18)(cid:18)1(cid:18)1(cid:18)2(cid:18)3(cid:18) = c1(m)b + c2(m), where c1 and c2 depend nonlinearly on m.i.e., the distance ratio is invariant under affine bijections (which is well-known in affine geometry). Given a fixed dis-tance ratio, we can show the transformation property: three points suffice to determine two parallel lines, and theposition of the third parallel line is then determined by the distance ratio. For a distance ratio 1, this configurationlooks as follows:Actually, for the qualitative relations between dipoles placed on parallel lines, their distance ratio does not matter.Hence, we will ignore distance ratios when computing the composition table below, and the fact that we get infinitelymany orbits does not matter.6. All mi are equal and two of the bi are equal but different from the third. Geometrically, this means that two lines arecoincident, and the third one is parallel but not coincident. Such a configuration is determined by three points: twopoints on the coincident lines and a third point on the third line. Hence, the transformation property follows.7. All mi are equal, and the bi are equal as well. This means that all three lines are equal. The transformation property isobvious.Since we have exhaustively distinguished the various possible cases based on relations between the mi and bi parameters,this describes all possible orbits of three lines under the action of the group of affine bijections. Although we get infinitelymany orbits for case (5), in contexts where the distance ratio introduced in case (5) does not matter, we will speak ofseven qualitatively different configurations, and it is understood that the infinitely many orbits for case (5) are conceptuallycombined into one equivalence class of configurations.Recall that we have considered sets of (up to) three lines. If we consider triples of lines instead, cases (3) to (6) split upinto three sub-cases, because they feature distinguishable lines. We then get 15 different configurations, which we name1, 2, 3a, 3b, 3c, 4a, 4b, 4c, 5a, 5b, 5c, 6a, 6b, 6c and 7. While 5a, 5b and 5c correspond to case (5) above and thereforecomprise infinitely many orbits, the remaining configurations comprise a single orbit.(cid:4)The next split appears at the point when we consider qualitatively different configurations of triples of unoriented lineswith respect to orientation preserving affine bijections. An affine map f (x, y) = A+ (bx, b y) is orientation preserving ifdet( A) is positive. In the above arguments, we now have to consider oriented affine frames. Let us call an affine frame(p1, p2, p3) positively (+) oriented, if the angle (cid:8) p1 p2 p3 is positive, otherwise, it is negatively (−) oriented. Two givenaffine frames with the same orientation determine a unique orientation preserving affine bijection transforming the firstone into the second. Thus, the orientation of the affine frame matters, and hence cases 1 and 2 above are split into twosub-cases each. For all the other cases, we have the freedom to choose the affine frames so that their orientations coincide.In the end, we get 17 different orbits of triples of oriented lines: 1+, 1-, 2+, 2-, 3a, 3b, 3c, 4a, 4b, 4c, 5a, 5b, 5c, 6a, 6b, 6cand 7. They are shown in Fig. 12.xy(cid:3)The structure of the orbits already gives us some insight into the nature of the dipole calculus. The fact that sub-case (1)corresponds to one orbit means that neither angles nor ratios of angles can be measured in the dipole calculus. By wayof contrast, the presence of infinitely many orbits in sub-case (5) means that ratios of distances in a specific directionR. Moratz et al. / Artificial Intelligence 175 (2011) 2099–21272117Fig. 12. The 17 qualitatively different configurations of triples of oriented lines w.r.t. orientation preserving affine bijections.(not distances themselves) can be measured in the dipole calculus. Indeed, in DRAfp, it is even possible to replicate agiven distance arbitrarily many times, as indicated in Fig. 13. That is, DRAfp can be used to generate a one-dimensionalcoordinate system. Note however that, due to the lack of well-defined angles, a two-dimensional coordinate system cannotbe constructed. The ability to “count” in the DRAfp calculus stems from the existence of relations able to capture thefeature of parallelism. Consider a sequence of parallelograms described in DRAfp as( Ai llrrP Ci) ( Ai slsr D i) ( Ai lere E i)(B i llrrP D i) (B i lsel E i)( Ai ells B i)(B i lere Ci)(Ci rser D i) (Ci srsl E i)(D i errs E i).Such a sequence is depicted in Fig. 13. The counting can be established by replicating such parallelograms by adding rela-tions(B i sese D i+1)which claim that B i and D i+1 of two consecutive parallelograms coincide. Such parallelograms can be constructed with allrelations describing parallelism. The construction for anti-parallelism is a little more involved, in this case sequences of twoparallelograms will be replicated.2118R. Moratz et al. / Artificial Intelligence 175 (2011) 2099–2127Fig. 13. Example for replication of a given distance in DRAfp.3.2. Computing the composition table with condensed semanticsFig. 14. The 17 canonical configurations.The purpose of condensed semantics is to provide a way of computing composition tables in a finite way. Therefore,we need to reduce the infinite space of possible dipole configurations to a finite one. For each of the 17 oriented orbits inFig. 12 we introduce a canonical configuration in the Euclidean plane (depicted in Fig. 14), i.e., a configuration with a suitablenumber of positions for the start and end points of the dipoles on each line that suffice to compute the compositionR. Moratz et al. / Artificial Intelligence 175 (2011) 2099–21272119table. The number of points needed is a function of the unoriented orbits, we call these points (that are displayed inFig. 14) prototypical points. We call a configuration from Fig. 14 with three assigned dipoles a prototypical configuration. Thecomputation of the composition table needs the orientation in order to be exhaustive.Algorithm 1 Composition tableComputation of composition table for DRA1: Conf := the set of prototypical configurations from Fig. 142: R := ∅3: for all configurations c ∈ Conf do4:for all dipoles d A = (s A, e A) of different prototypical points on A in c dofor all dipoles dB = (sB , eB ) of different prototypical points on B in c dofor all dipoles dC = (sC , eC ) of different prototypical points on C in c do5:6:7:8:9:compute the relations d A R1 dB , dB R2 dC , d A R3 dC by the formula on p. 2106 and add the triple (R1, R2, R3) to Rend forend forend for10:11: end for12: collect the triples in R in such a way that there is exactly one entry for every R1 and R2 having the union of all R3 as thirdcomponentThe algorithm for computing the composition table is given in Algorithm 1. We place the configurations of Fig. 14 intoan arbitrary orthogonal coordinate system. Each configuration provides a finite number of prototypical points with specificcoordinates, which serve as start and end points of prototypical dipoles. For each triple of such prototypical dipoles wecompute the DRA-relations using the atan2-method as described in Section 2.3. Each triple that is obtained in this waycorresponds to an entry in the composition table.A program has been implemented in Java that uses Algorithm 1 and on a notebook with an Intel Core 2 T7200 with1.5 Gbyte of RAM, the computation of the composition tables for DRA f and DRAfp takes approximately 14 s.3.3. Soundness and completeness of compositionBy the soundness of Algorithm 1 we mean that the computed composition table contains enough entries to make itover-approximate geometric reality (i.e., no false conclusions can be drawn by qualitative reasoning). Conversely, complete-ness means that there are not more entries than necessary, that is, the composition table does not lead to overly weakconclusions. (However note that even in case of completeness it still can be the case that algebraic closure leads to overlyweak conclusions, e.g., inconsistencies are not detected, see Section 2.7.)More specifically, completeness means that Algorithm 1 outputs only triples of dipole relations that are geometricallyrealizable, while soundness means that it outputs all such triples.20 Soundness and completeness together imply that pro-totypical dipole triples are representative for all dipole triples, at least for what concerns dipole relations.Proposition 5. Algorithm 1 is complete.Proof. Easy, since the triples of dipole relations are generated from prototypical dipole triples, which provide geometricrealizations. (cid:2)Showing the soundness of Algorithm 1 is more involved. We need to identify a lower bound of points that is needed onour oriented orbits in Fig. 12 with respect to the DRA semantics. We can identify those lower bounds for intersecting andcollinear lines separately.In a first step, we consider collinear lines. For soundness of the construction, we need to show that for two or threedipoles on the same line there is a lower bound for the number of prototypical points needed to distinguish between thepossible DRA relations on a line.Consider any configuration of collinear n ∈ {2, 3} dipoles A, B (and C ). We use an order induced by e A < s A on the line,i.e., if B points into the same direction as A, we have eB < sB , otherwise sB < eB , and the same for C . This constructionreflects the fact that dipoles always have non-zero length.We translate the 13 Allen relations and the “opposite” Allen relations componentwise into our order for two dipoles Aand B:A b _ _ _ B (cid:6)→ s A < sB ∧ e A < sBA s _ _ _ B (cid:6)→ s A = sB ∧ e A < sB20 Actually, the algorithm will output many triples more than once; these duplicates could be filtered out.2120R. Moratz et al. / Artificial Intelligence 175 (2011) 2099–2127Fig. 15. Intersecting carrier lines.A i _ _ _ B (cid:6)→ sB < s A ∧ e A < sBA e _ _ _ B (cid:6)→ sB < s A ∧ e A = sBA f _ _ _ B (cid:6)→ sB < s A ∧ sB < e Aand likewise for the other components of the relations in question.Example 6. Consider the relation ( A bbff B). Since both dipoles point into the same direction, we can derive e A < s A ∧ eB <sB . Now, we apply the translation rules for each component:s A < sB ∧ e A < sB ∧s A < eB ∧ e A < eB ∧s A < eB ∧ s A < sB ∧e A < sB ∧ e A < eBwe observe that the overall inequalities can be simplified toe A < s A ∧ eB < sB ∧s A < sB ∧ e A < sB ∧s A < eB ∧ e A < eBBy transitivity of <, we can derive e A < s A < eB < sB . Hence we need at least four points in the plane to realize this dipolerelation.By an easy induction, we can showLemma 7. For n collinear dipoles in the Euclidean plane, 2 · n points that can be the start and end points of the dipoles suffice toconstitute all possible DRA relations between those dipoles.Corollary 8. Realizing the relations between 1 (2, 3) collinear dipoles in the planes requires 2 (4, 6) prototypical points in the plane.After having considered the number of prototypical points needed for collinear dipoles, we need to do the same fordipoles with intersecting carrier lines. For this purpose we need to consider the semantics of the DRA relations. The onlycase in which a point can lie on both intersecting lines is when it is positioned on the point of intersection. This is theonly case where in this scenario relations can have a component from b, s, i, e, f , since these relations require one dipole’sbeing collinear with the start or end point of the other dipole. So we need to place a prototypical point onto the point ofintersection. On each line on each side of the point of intersection, the rules for collinear lines are applied. Fig. 15 showsthe case for no collinear lines.Lemma 9. Transforming a scenario of dipoles along an orientation preserving affine transformation preserves the DRA f (DRAfp)relations.Proof. This follows directly from Proposition 4. (cid:2)For the soundness proof, we need some preparatory lemmas.Lemma 10. Transforming a scenario in three dipoles along an orientation preserving affine transformation preserves betweenness ofpoints.R. Moratz et al. / Artificial Intelligence 175 (2011) 2099–21272121Proof. This follows from the proof of Proposition 4 for the LR-relation i. (cid:2)Fig. 16. Introduction of carrier lines.Analogously to the qualitative angle in DRAfp, we define a qualitative orientation between two dipoles.Definition 11. Given two non-parallel dipoles A and B, we say that the qualitative orientation from A to B is + if the anglefrom A to B is positive, otherwise it is −.Lemma 12. Given a fixed dipole B and a fixed intersection point S A B , the relation A R B is determined by betweenness and equalityamong {s A, e A, S A B }, and the qualitative orientation between B and A provided that R does not involve parallelism or anti-parallelism.(cid:18)be such that S A B = S A(cid:18) B and that betweenness and equality among {s A, e A, S A B }, andProof. Let A R B, and let A{s A(cid:18) , e A(cid:18) , S A B } are the same, and the qualitative orientations from B to A and from B to Aare also the same. We in-troduce carrier rays for the dipoles called l A , l A(cid:18) and lB . Without loss of generality, the rays point in the same direction asthe dipoles, and hence reflect the qualitative orientation. The rays l A and l A(cid:18) are divided into three segments by S A B andS A(cid:18) B respectively. For l A these are the segments with points x <r S A B , x =r S A B and S A B <r x, and l A(cid:18) is segmented in thesame way, where we call the order <r(cid:18) . The relation R can be decomposed into the four LR-relations:(cid:18)( A R1 sB ) ( A R2 eB ) (B R3 s A) (B R4 e A).First we will consider the relations R3 and R4. By definition of the LR-relations, the relations between B and s A ore A change if the respective point is moved into a different segment, but since the betweenness and equality among{s A, e A, S A B } are the same and the qualitative orientations also coincide, if s A <r S A B , so is s A(cid:18) <r S A(cid:18) B and the same for(cid:18)the other segments and e A and e A(cid:18) . Hence, we obtain that R3 = R4. For R1 and R2, we use a similar argumentor A and B swapped. (cid:2)with the roles of A(cid:18)3 and R4 = R(cid:18)Proposition 13. Algorithm 1 is sound.Proof. We will first give this proof for DRAfp since soundness for DRA f follows from soundness for DRAfp by unitingparticular relations. Given any triple of dipoles (d A, dB , dC ) in the Euclidean plane, we inspect their carrier lines ( A, B, C) andthe intersection points of the latter to identify their oriented orbit from Fig. 12. As an example consider the configurationof dipoles in Fig. 16 on the left-hand side. The configuration on the right-hand side shows the carrier lines and we canidentify three different points of intersection. Together with the orientation of the lines, we see that this configuration liesin orbit 1−.We can identify the relations R A B , RBC and R AC in that scenario. By S X Y we denote the point of intersection of the, and we will findcarrier lines X and Y . We call the lines in the corresponding configuration from Fig. 14 Arespective dipoles d A(cid:18) , dB(cid:18) and dC (cid:18) based on the prototypical points. We will show that the dipole relations for d A , dB , dCand d A(cid:18) , dB(cid:18) , dC (cid:18) are the same.and C, B(cid:18)(cid:18)(cid:18)Note that on collinear lines the number of minimally needed points per section has been shown in Corollary 8. In anyof the following cases of the proof, we need to consider all possible choices of points.1+ & 1−)In this orbit, three distinct points of intersection exist, denoted by S A B , S AC , S BC for the dipole configurationand S A(cid:18) B(cid:18) , S A(cid:18)C (cid:18) , S B(cid:18)C (cid:18) for the prototypical configuration. Since both triples A, B, C and Aare in the same orientedorbit, there is an orientation preserving affine bijection h between them, mapping A, B, C , S A B , S AC and S BC to theirprimed variants. By Lemma 10 the point sets {s A, e A, S AC } and {s A, e A, S A(cid:18)C (cid:18) } are ordered in corresponding ways, and soare all other all other point sets involving the start and end points of dipoles and an intersection point. The points of thedipoles d A , dB and dC are not necessarily mapped onto d A(cid:18) , dB(cid:18) and dC (cid:18) , but the order between the start and end pointsand points of intersection is the same. By Lemma 12, only order and qualitative orientation has an influence on the DRAfprelations at hand, so the mapped start and end points can be just moved onto the ones d A(cid:18) , dB(cid:18) and dC (cid:18) without changingthe DRAfp relations., B, C(cid:18)(cid:18)(cid:18)2122R. Moratz et al. / Artificial Intelligence 175 (2011) 2099–21272+ & 2−)argument stays the same.In this case all points of intersection coincide. This is the only difference between cases 1+ and 1−, but the(cid:18)(cid:18), BIn this case we have parallel lines. First we consider case 3a. Here, the line A is intersected by the parallel3a & 3b & 3c)(cid:18)lines B and C . Since A, B and C are in the same oriented orbit as A, there is an orientation preserving affinetransformation between them. By case 3 on p. 2115, choose the transformation h in such a way that it takes the affine frame{xb, S AC , S A B } to {xb(cid:18) , S A(cid:18)C (cid:18) , S A(cid:18) B(cid:18) }. The point xb is chosen as sb if sb (cid:8)= S A B and eb otherwise. xb(cid:18)is defined analogously.By Lemma 10 betweenness of {s A, e A, S AC } and {sC , eC , S AC } is preserved by h. The preservation of betweenness of therespective point-triples implies two possible orders. We introduce an order as in the proof of Lemma 12. The points s X ande X are not necessarily mapped onto s X (cid:18) and e X (cid:18) but the order with respect to the intersection points is the same. So thepoints in the image of h can be moved onto the respective prototypical points without affecting the dipole relations. Onthe parallel lines, the relation is preserved, since the direction of the dipoles is preserved (by the order with respect to thepoint of intersection). The preservation of betweenness is true for the triples {s A, e A, S AC }, {sC , eC , S AC }, {s A, e A, S A B } and{sB , eB , S A B }. By the preservation of the betweenness and orientation, the relations with respect to d A are also the same.The argument for 3b and 3c is analogous.and C4a & 4b & 4c) First we consider case 4a. We only have one point of intersection S A B = S AC = S BC = S. There is an orien-tation preserving affine transformation h that takes the scenario to the instance shown in Fig. 12, since both configurationsare in the same orbit. We need to consider several triples of points on the line: {S, s A, e A}, {S, sB , eB }, {S, s A, sB }, {S, s A, eB },{S, sB , e A}, and {S, eB , e A} as well as {S, sC , eC }. By Lemma 10 the betweenness of the triples is preserved under h. Fromthis betweenness of the triples and the orientation, we construct an order between the points. Since there are two possi-bilities to establish an order from the betweenness of a triple, we need to construct the order as in the proof of Lemma 12.If the dipoles on the coinciding line point into different directions, we can still construct an overall compatible order, byinverting one of the orders induced by A or B, which of them we invert is arbitrary. With this mapping we can determinea setup of prototypical points on this configuration and move the mapped points onto them. This does not change theinvolved DRAfp relations, since the order of the points is preserved in this operation. Since the order of points on the lineis not changed, we get in both cases the same relation and for the intersection we set the same relation by Lemma 12. Thecases 4b and 4c are proved analogously.5a & 5b & 5c) We do not have any points of intersection in this case. Without loss of generality we assume the ratio ofthe distances between the parallel lines to be 1. First, we have a look at case 5a. We intersect the lines A, B and C withan additional line orthogonal to A in such a way that no intersection points are equal to any of the start or end points ofany dipole. We call the points of intersection S A , S B and S C . There is an orientation preserving affine transformation to theinstance of 5a given in Fig. 12, since both configurations are in the same orbit. The order of the triples {S X , s X , e X } withX ∈ { A, B, C} is preserved. Again we can move the points in the image of h to the prototypical points and get in both casesthe same relations, since they just depend on the order of the points. The cases 5b and 5c are treated analogously.6a & 6b & 6c) We start with case 6a. We intersect the lines with a new one that is orthogonal to A and intersects all carrierlines in such a way that all points on A, B and C are on the same side of the new line. We call the points of intersection S A ,S B and S C . Again there is an orientation preserving affine transformation to the representative of the orbit. The respectiveorders of the start and endpoints of the dipoles and points of intersection are preserved. And the start and endpoints of thedipoles can be moved to the respective prototypical points without changing the dipole relation. As in case 5a the relationsstay the same. Cases 6b and 6c are treated analogously.7) We intersect the lines with a new one orthogonally (and do the same with the representative of the orbit) in such a waythat the point is intersection is different from all start and end points of the dipoles and call this point of intersection S.There is an orientation preserving affine transformation h that maps the configuration of the orbit. There are several triplesof points on the line we need to consider: {S, s A, e A}, {S, sB , eB }, {S, sC , eC }, {S, s A, sB }, {S, s A, sC }, {S, s A, eB }, {S, s A, eC },{S, sB , sC }, {S, sB , eC }, {S, eB , sC }, {S, eB , eC }, whose order, which is constructed as in the proof of Lemma 12. As in step 4a& 4b & 4c we can make the orders compatible, if dipoles point into different directions. From the above list, we can inferthat six prototypical points are needed to compute all dipole relations between three collinear dipoles. Again we can movethe mapped points onto the prototypical ones without any harm, since only the relative ordering of the points matters bythe definition of the DRAfp relations.For DRA f , we just take the union of the refined relations, i.e., we use the mapping{LLLL+, LLLL−, LLLL A} (cid:6)→ LLLL{LL R R+, LL R R−, LL R R P } (cid:6)→ LL R R{R R LL+, R R LL−, R R LL P } (cid:6)→ R R LL{R R R R+, R R R R−, R R R R A} (cid:6)→ R R R R.(cid:2)R. Moratz et al. / Artificial Intelligence 175 (2011) 2099–212721233.4. Algebraic properties of compositionFig. 17. DRA f weak composition.We now investigate several properties of the composition tables for DRA f and DRAfp. For both tables the propertiesid(cid:4) = id(cid:4)(cid:4) = R(cid:3)R(cid:4)id ◦ R = RR ◦ id = R(R1 ◦ R2)(cid:4) = R(cid:4)2∈ R2 ◦ R3 ⇐⇒ R(cid:4)R(cid:4)31◦ R(cid:4)1∈ R1 ◦ R2hold with R, R1, R2, R3 being any base relations and id the identical relation. These properties can be automatically testedby the GQR and SparQ qualitative reasoners. The other properties for a non-associative algebra follow trivially. Further-more, we have tested the associativity of the composition. For DRA f , we have 373,248 triples of relations to consider ofwhich 71,424 are not associative. So the composition of 19.14% of all possible triples of relations is not associative,21 e.g.,associativity is violated in the compositions:(rrrl (cid:12) rrrl) (cid:12) llrl (cid:8)= rrrl (cid:12) (rrrl (cid:12) llrl).For DRAfp all 512,000 triples of base relations are associative w.r.t. composition. Hence DRAfp is a relation algebra.3.5. DRA f composition is weakThe failure of DRA f to be associative implies that its composition is weak. We will still prove directly that DRA f hasweak composition by giving an example, since this is more illustrative:Proposition 14. The composition of DRA f is weak.Proof. Consider the DRA f composition A bfii B (cid:12) B lllb C (cid:6)→ A llll C . We show that there are dipoles A and C such thatthere is no dipole B which reflects the composition. Consider dipoles A and C as shown in Fig. 17. We observe that theyare in the DRAfp relation llll- with the dipole C pointing towards the line l A dipole A lies on. Because of A bfii B, dipole Bhas to lie on l A . But, since lC , the carrier line of C , is a straight line and lines l A and lB lie in front of C with respect to thedirection of the dipole, the endpoint of B cannot lie behind C . (cid:2)DRAfp behaves differently, as shown in the next section.3.6. Strong compositionWe are now going to prove that DRAfp has strong composition. The following lemma will be crucial; note that it doesnot hold for DRA f .Lemma 15. For DRAfp base relations R not involving parallelism or anti-parallelism, betweenness and equality among {s A, e A, S A B }for given dipoles A R B are independent of the choice of A and B, hence uniquely determined by R alone.21 In the masters thesis of one of our students, a detailed analysis of a specific non-associative dipole configuration is presented [38].2124R. Moratz et al. / Artificial Intelligence 175 (2011) 2099–2127Proof. Let R = r1r2r3r4r5, where r5 ∈ {+, −} even if r5 is omitted in the standard notation. Note that the assumption r5 ∈{+, −} implies that S A B is defined. If r3 ∈ {b, s, i, e, f }, e A (cid:8)= s A = S A B , and there is no betweenness. Analogously, s A (cid:8)= e A =S A B if r4 ∈ {b, s, i, e, f }. The remaining possibilities for r3r4r5 are:1. ll+, rr-: in these cases, e A is between s A and S A B ;2. ll-, rr+: in these cases, s A is between e A and S A B ;3. rl-, lr+: in these cases, S A B is between s A and e A .Note that cases 1 and 2 cannot be distinguished in DRA f . In particular, the pictures for xxll+ and xxll- lead to the sameDRA f relation xxll, but for xxll+, e A is between s A and S A B , while for xxll-, s A is between e A and S A B .Corollary 16. Let R be a DRAfp base relation not involving parallelism or anti-parallelism. Let A R B and A{s A (cid:6)→ s A(cid:18) ; e A (cid:6)→ e A(cid:18) ; S A B (cid:6)→ S A(cid:18) B(cid:18) } preserves betweenness and equality.(cid:18)(cid:18)R B. Then, the mapTheorem 17. Composition in DRAfp is strong.(cid:2)Proof. Obviously, strong composition ◦ is contained in weak composition (cid:12). To show the converse, let rac ∈ rab (cid:12) rbc be anentry in the composition table, with rac , rab and rbc base relations. We need to show that rac ∈ rab ◦ rbc , i.e., that for anygiven dipoles A and C with Arac C , there exists a dipole B with Arab B and Brbc C .Since rac ∈ rab (cid:12) rbc , by definition of weak composition, we know that there are dipoles Arbc C. Given dipoles X and Y , let S X Y denote the point of intersection of the lines carrying X and Y ; it is only definedand A, respectively. According to the results ofif X and Y are not parallel. Consider now the three lines carrying ASection 3.1, for the configuration of these three lines, there are seventeen qualitatively different cases 1+, 1-, 2+, 2-, 3a, 3b,3c, 4a, 4b, 4c, 5a, 5b, 5c, 6a, 6b, 6c and 7:with Aand Cand Crab Brac C, B, B, B(cid:18)(cid:18)(cid:18)(cid:18)(cid:18)(cid:18)(cid:18)(cid:18)(cid:18)(cid:18)(cid:18)(cid:18)(cid:18)(cid:18)rac C1. We consider cases 1+ and 1- simultaneously. Recall that all line configurations in the orbit 1+ have the same orientation,and the same holds for 1-. The three points of intersection S A(cid:18) B(cid:18) , S B(cid:18)C (cid:18) and S A(cid:18)C (cid:18) exist and are different. Since Arac C and, by Lemma 15, the point sets {s A, e A, S AC } and {s A(cid:18) , e A(cid:18) , S A(cid:18)C (cid:18) } are ordered in corresponding ways on their lines.AHence, it is possible to choose a point S A B on the carrier line of A in such a way that the point sets {s A, e A, S AC , S A B }and {s A(cid:18) , e A(cid:18) , S A(cid:18)C (cid:18) , S A(cid:18) B(cid:18) } are ordered in corresponding ways on their lines. In a similar way (interchanging A and C ),S BC can be chosen.Since both {S A B , S AC , S BC } and {S A(cid:18) B(cid:18) , S A(cid:18)C (cid:18) , S B(cid:18)C (cid:18) } are affine frames, there is a unique affine bijection h : R2 → R2with h(S A(cid:18) B(cid:18) ) = S A B , h(S A(cid:18)C (cid:18) ) = S AC and h(S B(cid:18)C (cid:18) ) = S BC . Since all line configurations in the orbit 1+ have the sameR. Moratz et al. / Artificial Intelligence 175 (2011) 2099–21272125orientation (and the same holds for 1-), h preserves orientation. Thus by Proposition 4 the DRAfp relations are also(cid:18)). Since the point sets {s A, e A, S A B }preserved along h. Hence, by choosing B = h(Band {s A(cid:18) , e A(cid:18) , S A(cid:18) B(cid:18) } are ordered in corresponding ways on their lines and h is an affine bijection, also {s A, e A, S A B } and{h(s A(cid:18) ), h(e A(cid:18) ), S A B } are ordered in corresponding ways on their lines, and moreover the qualitative orientation for A to(cid:18))rab B we thus get Arab B. A similarB is the same as that from Aargument shows that Brbc C .to B. Since also S A B = S A(cid:18) B , by Lemma 12, from h( A(cid:18))rab B and Brbch(C(cid:18)), we get h( A(cid:18)2. We prove cases 2+ and 2- simultaneously. The three intersection points S A(cid:18) B(cid:18) , S B(cid:18)C (cid:18) and S A(cid:18)C (cid:18) exist and coincide, i.e.,), otherwise, let x A(cid:18), x A(cid:18) , xC (cid:18) } are affine frames,(cid:18)) = S, h(x A(cid:18) ) = x A and h(xC (cid:18) ) = xC . The rest of the argument isS A(cid:18) B(cid:18) = S B(cid:18)C (cid:18) = S A(cid:18)C (cid:18) =: Sbe e A and x A(cid:18) be e A(cid:18) . xC and xC (cid:18) are chosen in a similar way. Since both {S, x A, xC } and {Sthere is a unique affine bijection h : R2 → R2 with h(Ssimilar to case (1).. Let S := S AC . Let x A be s A and x A(cid:18) be s A(cid:18) if s A (cid:8)= S (and therefore s A(cid:18) (cid:8)= S(cid:18)(cid:18)3. (Two lines are parallel and intersect with the third one.) In the sequel, we will just specify how two affine frames arechosen; the rest of the argument (as well as the choice of points on the unprimed side in such a way that qualitativerelations are preserved) is then similar to the previous cases.Subcases (3a), (3b): The lines carrying A and C intersect. Choose x A and x A(cid:18) as in case (2), and chose an appropriatepoint S BC . Then use the affine frames {x A, S AC , S BC } and {x A(cid:18) , S A(cid:18)C (cid:18) , S B(cid:18)C (cid:18) }.Subcase (3c): The lines carrying A and C are parallel. Choose appropriate points S A B and S BC and use the affine frames{s A, S A B , S BC } and {s A(cid:18) , S A(cid:18) B(cid:18) , S B(cid:18)C (cid:18) }.4. (Two lines are identical and intersect with the third one.)Subcases (4a) and (4b): The lines carrying A and C intersect. Choose x A , x A(cid:18) , xC and xC (cid:18) as in case (2) and use the affineframes {S AC , x A, xC } and {S A(cid:18)C (cid:18) , x A(cid:18) , xC (cid:18) }.Subcase (4c): The lines carrying A and C are identical. This means that S A(cid:18) B(cid:18) = S A(cid:18)C (cid:18) =: SS and x A , x A(cid:18) as in case (2). Moreover, in a similar way, choose xB(cid:18)same LR-relation to A as xB(cid:18) has to A. Choose an appropriate point, and then some corresponding xB being in the. Then use the affine frames {S, x A, xB } and {S, x A(cid:18) , xB(cid:18) }.(cid:8)= S(cid:18)(cid:18)(cid:18)5. (All three lines are distinct and parallel.) Subcases (5a), (5b) and (5c) can all be treated in the same way: Use the affineframes {s A, e A, sC } and {s A(cid:18) , e A(cid:18) , sC (cid:18) }. Note that the distance ratios may need to adjusted by a non-affine transformationwhich however preserves the dipole relations.6. (Two lines are identical and are parallel to the third one.)Subcases (6a) and (6b): The lines carrying A and C are parallel. Proceed as in case (5).Subcase (6c): The lines carrying A and C are identical. Choose some sB in the same LR-relation to A as sB(cid:18) is to AThen use the affine frames {s A, e A, sB } and {s A(cid:18) , e A(cid:18) , sB(cid:18) }.(cid:18).7. (All three lines are identical.) For this case, the result follows from the fact that Allen’s interval algebra has strongcomposition (refer to [47]). (cid:2)4. Summary and conclusionWe have presented different variants of qualitative spatial reasoning calculi about oriented straight line segments whichwe call dipoles. These spatial calculi provide a basis for representing and reasoning about qualitative position informationin intrinsic reference systems.We have computed the composition table for dipole calculi by a new method based on the algebraic semantics of thedipole relations. We have used what we have called a condensed semantics which uses the orbits of the affine group GA(R2)to provide an abstract notion of qualitative configuration of lines. This can be used to compute the composition table ina computer-assisted way, relying on prototypical dipole configurations that are located on lines as given by a qualitativeconfiguration represented by an orbit.This has been the first computation of the composition table for DRAfp. So far, the only composition tables for DRAcand DRA f that exist contain many errors [56]. We also have analyzed the algebraic features of the various dipole calculi.We have proved that DRAfp has strong composition. This is an interesting result because in this case an application-motivated calculus extension has benefits for the algebraic features of this calculus extension.We have demonstrated a prototypical application of reasoning about qualitative position information in relative referencesystems. In this scenario about cognitive spatial agents and qualitative map building, coarse locally perceived street config-uration information has to be integrated by constraint propagation in order to get survey knowledge. The well-known pathconsistency method (the more precise term in the present context is algebraic closure) which is implemented with standardQSR tools can make use of our new dipole calculus composition table and compute the desired result in polynomial time.Such concrete but generalizable application scenarios for relative position calculi are more important after the recent resultby Wolter and Lee [62] which shows that relative position calculi are intractable even in base relations. For this reason,it is necessary to gain experience as to in which application contexts the unavoidably approximate reasoning is effectiveand produces relevant inference results. With our street network example, we have a test case which puts an emphasison deriving implicit knowledge as the output of qualitative spatial reasoning based on observed data. This is a prototypicalapplication scenario which in the future can also be applied to other relative position calculi.Since the observed data in the case of error-free perception leads to consistent input constraints, the general consistencyproblem can be avoided: we instead rely on logical consequence. Now both problems are intractable and need to be ap-2126R. Moratz et al. / Artificial Intelligence 175 (2011) 2099–2127proximated using algebraic closure; however, in our setting, the losses due to approximation are less harmful, since we donot risk working with inconsistent scenarios.Our future work will address the question of how in general the quality of approximations for relative position reasoningcan also be assessed with quantitative measures. An important open question is whether the problem of the consistencyof constraint networks can be better approximated in polynomial time than through the algebraic closure algorithm. Con-cerning exponential time algorithms for consistency, our condensed semantics may be generalized to constraint networksof arbitrary size, using a suitable method for determining the possible line arrangements. Another part of our future QSRresearch will apply our new condensed semantics method to other calculi.AcknowledgementsThe authors would like to thank Diedrich Wolter, Jay Lee, Jochen Renz, Frank Dylla, Christian Freksa, Franz Kalhoff,Stefan Wölfl, Lutz Schröder, and Brandon Bennett for interesting and helpful discussions related to the topic of the paper.Special thanks to the anonymous referees, in particular for suggestions for improving the readability of the paper and fora simplified version of the condensed semantics. Our work was supported by the DFG Transregional Collaborative ResearchCenter SFB/TR 8 “Spatial Cognition” (projects I4-SPIN and R4-LogoSpace), and by the National Science Foundation (NSF)under Grant No. CDI-1028895.References[1] J.F. Allen, Maintaining knowledge about temporal intervals, Comm. ACM (1983) 832–843.[2] B. Bennett, O. Bennett, A. Isli, A.G. Cohn, When does a composition table provide a complete and tractable proof procedure for a relational constraintlanguage?, in: Proc. of the IJCAI97 Workshop on Spatial and Temporal Reasoning, 1997.[3] E. Clementini, P.D. Felice, D. Hernandez, Qualitative representation of positional information, Artificial Intelligence 95 (1997) 317–356.[4] A.G. Cohn, Qualitative spatial representation and reasoning techniques, in: G. Brewka, C. Habel, B. Nebel (Eds.), Proc. of KI-97, in: Lecture Notes inArtificial Intelligence, vol. 1303, Springer-Verlag, 1997, pp. 1–30.[5] H.S.M. Coxeter, Self-dual configurations and regular graphs, Bull. Amer. Math. Soc. 56 (1950) 413–455.[6] M. Cristani, Reasoning about qualitative relations between straight lines, Tech. rep., University of Verona, 2003.[7] F. Dylla, L. Frommberger, J.O. Wallgrün, D. Wolter, S. Wölfl, B. Nebel, SailAway: Formalizing navigation rules, in: Proc. of the AISB’07 Artificial andAmbient Intelligence Symposium on Spatial Reasoning and Communication, 2007.[8] F. Dylla, R. Moratz, Exploiting qualitative spatial neighborhoods in the situation calculus, in: C. Freksa, M. Knauff, B. Krieg-Brückner, B. Nebel, T.Barkowsky (Eds.), Proc. of Spatial Cognition 2004, 2005, pp. 304–322.[9] M. Egenhofer, R. Franzosa, Point-set topological spatial relations, Int. J. Geogr. Inform. Syst. 5 (2) (1991) 161–174.[10] A. Frank, Qualitative spatial reasoning with cardinal directions, in: H. Kaindl (Ed.), Proc. of 7th Österreichische Artificial-Intelligence-Tagung, Springer,1991, pp. 157–167.[11] C. Freksa, Conceptual neighborhood and its role in temporal and spatial reasoning, in: M.G. Singh, L. Travé-Massuyès (Eds.), Proc. of the IMACS Work-shop on Decision Support Systems and Qualitative Reasoning, 1991, pp. 181–187.[12] C. Freksa, Using orientation information for qualitative spatial reasoning, in: A.U. Frank, I. Campari, U. Formentini (Eds.), Theories and Methods ofSpatial-Temporal Reasoning in Geographic Space, Springer, 1992, pp. 162–178.[13] C. Freksa, Using orientation information for qualitative spatial reasoning, in: A.U. Frank, I. Campari, U. Formentini (Eds.), Theories and Methods ofSpatio-Temporal Reasoning in Geographic Space, in: Lecture Notes in Comput. Sci., vol. 639, Springer, 1992, pp. 162–178.[14] J.H. Gallier, Curves and Surfaces in Geometric Modeling: Theory and Algorithms, Morgan Kaufmann, 2000.[15] A. Galton, Qualitative Spatial Change, Oxford University Press, 2000.[16] Z. Gantner, M. Westphal, S. Wölfl, GQR – a fast reasoner for binary qualitative constraint calculi, in: Proc. of the AAAI-08 Workshop on Spatial andTemporal Reasoning, 2008.[17] J.E. Goodman, R. Pollack, B. Sturmfels, Coordinate representation of order types requires exponential storage, in: STOC ’89: Proceedings of the Twenty-First Annual ACM Symposium on Theory of Computing, ACM, New York, NY, USA, 1989, pp. 405–410.[18] R.K. Goyal, M.J. Egenhofer, Similarity of cardinal directions, in: Advances in Spatial and Temporal Databases, 7th International Symposium, SSTD 2001,2001, pp. 36–58.[19] B. Grünbaum, Arrangements and Spreads, Regional Conference Series in Mathematics, vol. 10, American Mathematical Society, Providence, RI, 1972.[20] J. Harrison, HOL light: An overview, in: S. Berghofer, T. Nipkow, C. Urban, M. Wenzel (Eds.), Proc. of TPHOLs-09, in: Lecture Notes in Comput. Sci.,vol. 5674, Springer, 2009, pp. 60–66.[21] E.G. Hoel, H. Samet, Efficient processing of spatial queries in line segment databases, in: O. Günter, H.-J. Schek (Eds.), Proc. of the 2nd Symp. on LargeSpatial Databases (SSD’91), Zürich, 1991, pp. 237–255.[22] A. Isli, A.G. Cohn, A new approach to cyclic ordering of 2D orientations using ternary relation algebras, Artificial Intelligence 122 (1–2) (2000) 137–187.[23] A. Isli, R. Moratz, Qualitative spatial representation and reasoning: algebraic models for relative position, Tech. rep., Universität Hamburg, FB Informatik,Hamburg, 1999.[24] P. Ladkin, R. Maddux, On binary constraint problems, J. ACM 41 (3) (1994) 435–469.[25] S.C. Levinson, Frames of reference and Molyneux’s question: Crosslinguistic evidence, in: P. Bloom, M. Peterson, L. Nadel, M. Garrett (Eds.), Languageand Space, MIT Press, 1996, pp. 109–169.[26] S. Li, M. Ying, Region connection calculus: Its models and composition table, Artificial Intelligence 145 (1–2) (2003) 121–146.[27] G. Ligozat, Qualitative triangulation for spatial reasoning, in: A.U. Frank, I. Campari (Eds.), Proc. International Conference on Spatial Information Theory,in: Lecture Notes in Comput. Sci., vol. 716, Springer, 1993, pp. 54–68.[28] G. Ligozat, Reasoning about cardinal directions, J. Vis. Lang. Comput. 9 (1) (1998) 23–44.[29] G. Ligozat, J. Renz, What is a qualitative calculus? A general framework, in: C. Zhang, H.W. Guesgen, W.-K. Yeap (Eds.), Proc. of PRICAI-04, 2004,pp. 53–64.[30] D. Lücke, T. Mossakowski, D. Wolter, Qualitative reasoning about convex relations, in: C. Freksa, N.S. Newcombe, P. Gaerdenfors (Eds.), Spatial CognitionVI 2008, in: Lecture Notes in Computer Science, vol. 5248, Springer, 2008, pp. 426–440.[31] A.K. Mackworth, Consistency in networks of relations, Artificial Intelligence 8 (1977) 99–118.[32] R. Maddux, Relation Algebras, Stud. Logic Found. Math., Elsevier Science, 2006.R. Moratz et al. / Artificial Intelligence 175 (2011) 2099–21272127[33] U. Montanari, Networks of constraints: Fundamental properties and applications to picture processing, Inform. Sci. 7 (1974) 95–132.[34] R. Moratz, Representing relative direction as a binary relation of oriented points, in: G. Brewka, S. Coradeschi, A. Perini, P. Traverso (Eds.), Proc. ofECAI-06, in: Frontiers in Artificial Intelligence and Applications, vol. 141, IOS Press, 2006, pp. 407–411.[35] R. Moratz, M. Ragni, Qualitative spatial reasoning about relative point position, J. Vis. Lang. Comput. 19 (1) (2008) 75–98.[36] R. Moratz, J. Renz, D. Wolter, Qualitative spatial reasoning about line segments, in: Proc. of ECAI 2000, 2000, pp. 234–238.[37] R. Moratz, T. Tenbrink, Spatial reference in linguistic human-robot interaction: Iterative, empirically supported development of a model of projectiverelations, Spatial Cogn. Comput. 6 (1) (2006) 63–107.[38] F. Mossakowski, Algebraische Eigenschaften qualitativer Constraint-Kalküle, Master’s thesis, Universität Bremen, 2007.[39] T. Mossakowski, S. Wölfl, An algebraic charaterisation of qualitative spatial and temporal calculi, unpublished results.[40] A. Musto, K. Stein, A. Eisenkolb, T. Röfer, Qualitative and quantitative representations of locomotion and their application in robot navigation, in: Proc.of IJCAI-99, 1999, pp. 1067–1072.[41] B. Nebel, H.-J. Bürckert, Reasoning about temporal relations: A maximal tractable subclass of Allen’s interval algebra, J. ACM 42 (1995) 43–66.[42] B. Nebel, S. Wölfl (Eds.), AAAI Spring Symposium on Benchmarking of Qualitative Spatial and Temporal Reasoning Systems, AAAI Technical ReportSS-09-02, 2009.[43] T. Nipkow, L.C.M. Paulson, M. Wenzel, Isabelle/HOL — A Proof Assistant for Higher-Order Logic, Springer, 2002.[44] D.A. Randell, A.G. Cohn, Modelling topological and metrical properties of physical processes, in: R.J. Brachman, H.J. Levesque, R. Reiter (Eds.), Proc. ofKR-89, Morgan Kaufmann, 1989, pp. 357–368.[45] D.A. Randell, Z. Cui, A.G. Cohn, A spatial logic based on regions and connection, in: B. Nebel, C. Rich, W. Swartout (Eds.), Proc. of KR-92, MorganKaufmann, 1992, pp. 165–176.[46] J. Renz, Qualitative Spatial Reasoning with Topological Information, Springer, 2002.[47] J. Renz, G. Ligozat, Weak composition for qualitative spatial and temporal reasoning, in: P. van Beek (Ed.), Proc. of CP-05, in: Lecture Notes in Comput.Sci., vol. 3709, Springer, 2005, pp. 534–548.[48] J. Renz, D. Mitra, Qualitative Direction Calculi with Arbitrary Granularity, in: C. Zhang, H.W. Guesgen, W.-K. Yeap (Eds.), Proc. of PRICAI-04, in: LectureNotes in Comput. Sci., vol. 3157, Springer, 2004, pp. 65–74.[49] J. Renz, B. Nebel, On the complexity of qualitative spatial reasoning: A maximal tractable fragment of the region connection calculus, Artificial Intelli-gence 108 (1–2) (1999) 69–123.[50] J. Renz, B. Nebel, Qualitative spatial reasoning using constraint calculi, in: M. Aiello, I. Pratt-Hartmann, J. van Benthem (Eds.), Handbook of SpatialLogics, Springer, 2007, pp. 161–215.[51] J. Renz, F. Schmid, Customizing qualitative spatial and temporal calculi, in: M.A. Orgun, J. Thornton (Eds.), Proc. of Australian Conference on ArtificialIntelligence, in: Lecture Notes in Comput. Sci., vol. 4830, Springer, 2007, pp. 293–304.[52] R. Röhrig, Representation and processing of qualitative orientation knowledge, in: G. Brewka, C. Habel, B. Nebel (Eds.), Proc. of KI-97, in: Lecture Notesin Artificial Intelligence, vol. 1303, Springer, 1997, pp. 219–230.[53] C. Schlieder, Reasoning about ordering, in: A. Frank, W. Kuhn (Eds.), Spatial Information Theory: A Theoretical Basis for GIS, in: Lecture Notes inComput. Sci., vol. 988, Springer, Berlin, 1995, pp. 341–349.[54] A. Scivos, B. Nebel, The finest of its class: The natural point-based ternary calculus for qualitative spatial reasoning, in: C. Freksa, M. Knauff, B.K.Brückner, B. Nebel, T. Barkowski (Eds.), Spatial Cognition, in: Lecture Notes in Comput. Sci., vol. 3343, Springer, 2004, pp. 283–303.[55] S. Skiadopoulos, M. Koubarakis, Composing cardinal direction relations, Artificial Intelligence 152 (2004) 143–171.[56] T. Soller, Spezifikation und Integration von qualitativem Orientierungswissen, Master’s thesis, Universität Bremen, 2005.[57] P. van Beek, D.W. Manchak, The design and experimental analysis of algorithms for temporal reasoning, J. Artificial Intelligence Res. 4 (1996) 1–18.[58] J.O. Wallgrün, L. Frommberger, F. Dylla, D. Wolter, SparQ User Manual v0.7, University of Bremen, January 2009.[59] J.O. Wallgrün, L. Frommberger, D. Wolter, F. Dylla, C. Freksa, Qualitative spatial representation and reasoning in the SparQ-Toolbox, in: T. Barkowsky,M. Knauff, G. Ligozat, D.R. Montello (Eds.), Spatial Cognition, in: Lecture Notes in Comput. Sci., vol. 4387, Springer, 2006, pp. 39–58.[60] M. Westphal, S. Wölfl, Qualitative CSP, finite CSP, and SAT: Comparing methods for qualitative constraint-based reasoning, in: C. Boutilier (Ed.), IJCAI,2009, pp. 628–633.[61] D. Wolter, L.J. Latecki, Shape matching for robot mapping, in: C. Zhang, H.W. Guesgen, W.K. Yeap (Eds.), Proc. of 8th Pacific Rim International Conferenceon Artificial Intelligence, 2004, pp. 693–702.[62] D. Wolter, J.H. Lee, On qualitative reasoning about relative point position, Artificial Intelligence 174 (2010) 1498–1507.[63] D. Wolter, L. Moshagen, Algebraic methods for analyzing qualitative spatio-temporal calculi, in: Proc. of ECAI-Workshop Spatial and Temporal Reasoning,2008.[64] M.F. Worboys, E. Clementini, Integration of imperfect spatial information, J. Vis. Lang. Comput. 12 (2001) 61–80.[65] K. Zimmermann, C. Freksa, Qualitative spatial reasoning using orientation, distance, and path knowledge, Appl. Intelligence 6 (1996) 49–58.