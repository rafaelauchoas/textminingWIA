Robust head CT image registration pipeline craniosynostosis skull correction surgery Shusil Dangi1 Hina Shah2 Antonio R Porras3 Beatriz Paniagua2 Cristian A Linte14 Marius Linguraru35 Andinet Enquobahrie2 1Chester F Carlson Center Imaging Science Rochester Institute Technology Rochester NY USA 2Kitware Inc Carrboro NC USA 3Sheikh Zayed Institute Pediatric Surgical Innovation Childrens National Health System Washington DC USA 4Biomedical Engineering Rochester Institute Technology Rochester NY USA 5School Medicine Health Sciences George Washington University Washington DC USA Email sxd7257ritedu Published Healthcare Technology Letters Received 26th July 2017 Accepted 31st July 2017 Craniosynostosis congenital malformation infant skull typically treated corrective surgery To accurately quantify extent deformation identify optimal correction strategy patientspeciﬁc skull model extracted presurgical computed tomography CT image needs registered atlas head CT images representative normal subjects Here authors present robust multi stage multiresolution registration pipeline map patientspeciﬁc CT image atlas space normal CT images The proposed registration pipeline ﬁrst performs initial optimisation low resolution yield good initial alignment subsequently reﬁned high resolution They demonstrate robustness proposed method evaluating performance 560 head CT images 320 normal subjects 240 craniosynostosis patients success rate 928 942 respectively Their method achieved mean surfacetosurface distance patient template skull 25 mm targeted skull region normal subjects patients visual 1 Introduction Craniosynostosis premature fusion sutures infant skull restricts normal growth skull brain It congenital malformation occurring 1 2500 live births 1 Early diagnosis surgical treatment essential avoid elevated intracranial pressure leads respiratory malformation 2 3 Craniosynostosis treatment involves cranial surgery provide adequate intracranial volume facilitating brain growth create aesthetically normal skull shape facial appearance While single best method treatment therapy driven philosophy institution wishes parents 4 When cranial reconstruction surgery selected treatment plan careful preoperative planning required minimise complications morbidity associated impairments Computed tomography CT imaging preferred modality diagnosis preoperative planning postsurgical assessment craniosynostosis patients 2 A highquality 3D skull model reconstructed patients CT image analyse precise skull deformation relative normal skull shape 5 Subsequently closest normal skull identiﬁed serve target skull shape corrective surgery Hence surgical plan cut reconﬁgure bones prepared computeraided design software 3Dprinted models pathological skull matches target skull shape A critical step pre surgical planning registration craniosynostotic skull normative image space Various image registration techniques proposed 6 despite exhaustive dissemination citation medical image registration seldom clinical practice 7 Of dis seminated registration methods study skull registration craniosynostotic cases The study 8 limited generating average normative pediatric skull model 103 normal infant skulls aged 812 months pointsetbased registration algo rithm 9 include pathological cases Sahilliouglu et al 10 PCA alignment point sets performed modiﬁed registration point iterative closest global ICP 174 This open access article published IET Creative Commons AttributionNoDerivs License http creativecommonsorglicensesbynd30 followed deformable volumetric registration evaluated method ﬁve craniosynostotic patients Therefore robust registration technique map pathological case normative image space useful precisely plan corrective surgery Here validate robust multistage multi resolution image registration pipeline craniosynostotic skull registration We propose clinically applicable method leverages lower skull features affected disease path ology map patient skull image space normal skulls despite induced craniosynostosis Moreover implement assess performance regis tration large number normal 320 pathological 240 cases large deformities The proposed registration pipeline focus paper serves ﬁrst step planning skull correction surgery Following patient skull mapping normative skull space normal skull closest shape craniosynostosis skull identiﬁed postsurgical target The surgery planned according estimated deformation required correct diseased skull shape desired normal shape Fig 1 shows proposed image registration pipeline ﬁts larger scope project aimed optimising pre surgical planning craniosynostotic corrective surgery 2 Methods Our workﬂow entails stages ﬁrst extract head segment skull ﬁxed adaptive thresholds respectively We employ robust ﬁvestage multiresolution registration pipeline register segmented binary skull template skull Since CT image intensities direct measure tissue density standardised Hounsﬁeld unit HU 12 good skull segmentation achieved simple adaptive thresholding We employ segmentationbased registration map normal craniosynostosis patient skulls template image space Healthcare Technology Letters 2017 Vol 4 Iss 5 pp 174178 doi 101049htl20170067 Fig 1 Craniosynostosis skull correction pipeline Normal skulls segmented CT images registered template skull create normal skull shape atlas Craniosynostosis patient skull registered atlas quan tify skull deformity determine best patientspeciﬁc target skull shape surgery perform cranial deformation analysis plan sur gical correction skull shape 11 21 Head segmentation Since Hounsﬁeld number air 1000 HU fat ranges 100 50 HU select heuristic threshold 200 HU delineate structures tissues fat bones CT image We use binary morphological opening operation separate noisy structures attached patient head followed largest connected component extraction retain head segmentation shown Fig 2 It worth noting binary obtained segmentation morphological opening operation features holes nose air tract ear regions serve landmarks subsequent image registration 22 Skull segmentation adaptive thresholding Since rely single threshold delineate bone soft tissues threshold image region head mask threshold values 60 Section 21 optimum 300 HU increment 20 HU select threshold connected components A low threshold produce high number connected components segmenting soft tissues bone high threshold split bones pieces leading higher number connected components Since largest connected component include major bones open minimum number yields sutures infant skull retain connected components comprising 95 total number segmented pixels obtain optimal skull segmentation shown Fig 2 23 Image registration To register patient head CT image normative space select 8monthold healthy patient high CT resolution adequate extent imaged anatomy serve template We segment individual bones template CT image manually generate template skull model Fig 4c Automatically segmented normal craniosynostosis skulls registered template skull space analysis The skull rigid object maintain shape proportions parameterise registration seven degree freedom similarity transformation translation rotation x y zaxes isotropic scaling We deﬁne similarity function f based sum squared difference images registered f x p 1 N cid1 Vt FM IF x IM tx p2 1 x threedimensional vector representing image space IF IM Gaussian ﬁltered ﬁxed moving images respectively t similarity transform sevenparameters p applied IM N number voxels image overlap domain Vt FM Hence image registration formulated minimisation similarity function sevendimensional parametric space p We use regularised gradient descent algorithm 13 imple mented Insight Toolkit ITK minimise function f parameter update p n1 p n h n f p p n 2 learning rate set 05 reduces relaxation factor half time gradient objective function changes abruptly facilitating convergence algorithm closest optimum The algorithm converges step size gets small parameter difference Dp dif ference cost function Df consecutive iterations small maximum number iterations reached The similarity function f highly nonlinear seven dimensional parametric space probability conver ging local minimum optimisation high To avoid convergence local minima employ ﬁvestage registra tion pipeline Fig 3 ﬁrst optimisations formed low resolution high Gaussian blurring obtain coarse alignment ﬁnal stages reﬁne registration results higher resolution The optimal transformation obtained stage initialisation subsequent stage 231 Binary head mask registration We recover initial transla tion CT images aligning centroids head masks Section 21 Next recover scaling patient template head modify similarity metric 1 IF x MHT4x IM x MHS4x Vt 1 TS FM N N1 Vt Fig 2 Input CT image thresholded cleaned obtain head seg mentation The optimum threshold resulting minimum number nected components segment skull MHT MHS Gaussian ﬁltered binary head segmenta tions template subject CT images respectively N1 number voxels image overlap domain Vt T S The 1 Healthcare Technology Letters 2017 Vol 4 Iss 5 pp 174178 doi 101049htl20170067 175 This open access article published IET Creative Commons AttributionNoDerivs License http creativecommonsorglicensesbynd30 reﬁne modifying cost function 1 IF x MST2x IM x MSS2x N N4 Vt FM Vt 4 HTHS 4 N4 number voxels image overlap domain Vt HTHS ﬁxed moving image masks MHT MHS respectively The optimisation performed half original resolution 235 Binary skull registration low region ROI Since registration algorithm targeted craniosynostosis ap plication retain robust accurate alignment despite se verely deformed skull shapes Hence use lower region landmarks skull Opisthion Nasion Left Right Dorsum Sellae 5 regis ter skulls region affected disease path ology features low shape variability normal craniosynostosis patients The ﬁnal registration stage reﬁnes skull alignment low ROI Fig 4c located anatomical IF x MSTx IM x MSSx N N5 Vt FM Vt 5 LROIHS 1 t 5 ﬁnal similarity transform subject template CT images N5 number voxels image overlap domain Vt LROIHS ﬁxed moving image masks MLROI MHS respectively The ﬁnal align ment performed image resolution 5 3 Results The proposed algorithm implemented C ITK library 24 GHz Xenon machine 72 GB RAM took 450 s average segment subject CT image register template skull model We tested registration pipeline 560 CT images age range 1 week 19 years 30 2424 months inplane slice resolution 026049 mm 06255 mm respectively We quantitatively evaluate registration accuracy comput ing mean absolute distance 95th percentile symmetric dis tance template skull model registered subject model Fig 4 shows absolute distances registered subject template model mapped subject model normal craniosynostosis cases Fig 5 shows registration accuracy successfully registered skulls compared template skull model Mean registration accuracy normal craniosynostosis skulls lower Fig 4 Absolute distance error registered subject template skulls mapped subject skull model corresponding error bar Normal skull b Craniosynostosis skull c The lower ROI mapped template skull 8 months old Highest error occurs fontanel region anatomical mismatch subject template models rely 95th percentile distance instead maximum distance The normal skull better alignment compared craniosynostosis skull Also errors larger upper region compared stable lower regions registration Healthcare Technology Letters 2017 Vol 4 Iss 5 pp 174178 doi 101049htl20170067 Fig 3 Proposed registration pipeline aligning normal craniosynos tosis skulls template skull We start aligning head centroids fol lowed stages optimisation performed lowresolution obtain coarse initial alignment alignment reﬁned higher resolution ﬁnal stages Finally use lower region reﬁne registration ﬁnal stage obtain good alignment highly deformed craniosynos tosis skulls optimisation performed onefourth original resolution parameter update 2 232 Signed distancebased head registration The anatomical extent orientation patients head varies signiﬁcantly images registered Hence use holes nose air tract ear regions landmarks recover accurate orientation head segmentations As similarity metric 1 modiﬁed IF x DTMHT4x IM x DMHS4x N N2 Vt FM Vt 2 T HS D signed distance function SDF positive values outside negative values inside binary object DT truncated SDF ﬁxed high value T 1000 assigned positive distances N number voxels image overlap domain Vt THS moving image mask MHS Assigning high values distances outside MHT restricts MHS transformed MHT forcing orientation recovery landmarks head segmentations The opti misation performed onefourth original resolution 2 233 Signed distancebased skull registration To recover appropriate scaling factor skull segmentations following rotation correction modify similarity metric 1 IF x DMST4x IM x DMSS4x N N3 Vt FM Vt 3 T S MST MSS binary skull segmentations Section 22 template subject CT images respectively D SDF operator N number voxels image overlap domain Vt T S The optimisation performed onefourth original resolution 3 registration The ﬁrst 234 Binary skull lowresolution optimisation steps yield good coarse skull alignment 176 This open access article published IET Creative Commons AttributionNoDerivs License http creativecommonsorglicensesbynd30 Table 1 Evaluation robustness registration pipeline baseline registration 5 normal craniosynostosis skulls Registration method Failed normal N 320 Failed craniosynostosis N 240 baseline method 5 proposed method percentage improvement 47 23 489 30 14 467 30 14 craniosynostosis cases leading 47 improvement registration robustness average 4 Discussion As evident Fig 1 paper addresses important difﬁcult problem robustly registering diseased patient skull normative space normal skulls Although registration algorithms exist register image normal skull reasonably unfortunately sufﬁciently robust registration methods speciﬁcally tailored registering deformed skulls normal skulls In second project currently underway following accurate recovery pose scaling linear registration perform shape analysis nonrigid registra tion algorithms quantify nature deformity associated diseased skull determine closest normal skull shape serve target corrective surgery Brieﬂy proposed strategy use nonrigid registration compute closest normal target skull shape based deform ation diseased patients skull respect unbiased average skull shape obtained coregistering normal skulls fore removing bias single subject The goal ﬁrst stage remove pose scale vari ation normal diseased patients bring coordinate space Existing alternative solutions linear registrations broadly classiﬁed pointsetbased algorithms imagebased algorithms The ICP algorithm popular pointsetbased algorithm point sets initially aligned principal component directions Due deformations induced premature fusion sutures structure skull changes signiﬁcantly rendering principal components based initial alignment highly susceptible error result ﬁnal registration result highly inaccurate unrealis tic Although imagebased linear registration algorithms computationally demanding ﬂexibility imple mentation Here alternate binary image distance maps carefully guide registration appropriate lution compare results standard imagebased registration algorithm Moreover selecting optimising registration parameters demonstrate method forms registering normal subjects diseased patients Speciﬁcally demonstrated robustness algorithm evaluating performance 360 image datasets normal sub jects 240 image datasets diseased patients The age normal subjects diseased patients summarised Table 2 Table 2 Age subjects study Subject Mean std dev Range normal months craniosynostosis months months 106 72 176 319 136 218 1 week24 1 week228 1 week228 177 This open access article published IET Creative Commons AttributionNoDerivs License http creativecommonsorglicensesbynd30 Fig 5 Median interquartile range outliers Mean absolute distance b 95th percentile surfacetosurface distance registered patients template The distance metric skull upper ROI lower ROI regions plotted left right Normal 297 craniosynostosis 226 cases shown light dark colours respectively The mean 95th percentile distances lower ROI 25 50 mm respectively ROI 129 032 179 053 mm upper ROI 334 131 495 196 mm respectively High registration accuracy lower ROI region normal craniosynostotic cases demonstrates robustness method As expected registration error upper ROI cranio synostosis patients high deformity pathological skull A small surfacetosurface distance necessary condition good registration sufﬁcient Hence perform quali tative evaluation visual inspection registration results The algorithm produced visually correct results 297 normal 320 226 craniosynostosis 240 cases shown Table 1 A general registration approach align centroids skull segmentations perform optimisations described fourth ﬁfth stages Section 23 employed 5 Here compare additional registration robustness introduced ﬁrst stages pipeline perform initial alignment low resolution baseline scheme 5 Table 1 We able reduce number registration failures 47 23 normal cases Healthcare Technology Letters 2017 Vol 4 Iss 5 pp 174178 doi 101049htl20170067 Table 3 Type craniosynostosis patients study Craniosynostosis type Number patients coronal sagittal metopic pansynostosis frontal sphenoid coronalsagittal coronallamboidal unknown total 56 105 25 15 2 7 3 27 240 normal subjects 106 72 months 1 week 24 months diseased patients 176 319 months 1 week 228 months While early diagnosis treatment patients occurs ﬁrst 2 years age considering minimal skull growth 6 years age normal subjects create atlas representative age range 1 week 24 months Nevertheless patients 84 months old underwent craniosynostosis correction surgery Childrens National Medical Center included study demonstrate registration method robust wide variety patient populations clinical data disease characteristics Table 3 Moreover radiation exposure patients mini mised CT scans acquired limited anatom ical coverage including regions affected malformation Our approach focuses registering malformed patient normal template excluding regions signiﬁcantly affected disease registration ﬁnal stage As evident registration accuracy lower stable parts skull algorithm performs reasonably malformed patients 5 Conclusion We presented robust multistage multiresolution pipeline registration normal craniosynostosis skulls conducted exhaustive evaluation 560 clinical CT images success rates 928 942 320 normal 240 craniosynostosis patients respectively We evaluated registration success surfacetosurface distance accompanied visual inspection Our method reduced registration failure normal craniosynostosis cases 47 compared baseline registration algorithm employed 5 Finally registration yielded accuracy 25 50 mm mean absolute 95th percentile surfacetosurface normal distance lower skull ROI respectively Hence craniosynostosis cases registration pipeline reliably map craniosynostotic skulls normative skull space help identify closest normal skull shape serves postprocedural target corrective surgery planning 6 Acknowledgment The content solely responsibility authors necessarily represent ofﬁcial views National Institutes Health 7 Funding Declaration interests Research reported publication supported Eunice Kennedy Shriver National Institute Of Child Health Human Development National Institutes Health Award Number R42HD081712 8 References 1 Lajeunie E Merrer ML BinaitiPellie C ET AL Genetic study nonsyndromic coronal craniosynostosis Am J Med Genet 1995 55 4 pp 500504 2 Nagaraja S Anslow P Winter B Craniosynostosis Clin Radiol 2013 68 3 pp 284292 3 Kirmi O Lo SJ Johnson D ET AL Craniosynostosis radiologic al surgical perspective In Seminars Ultrasound CT MRI 2009 vol 30 Elsevier pp 492512 4 Szpalski C Weichman K Sagebin F ET AL Need standard outcome reporting systems craniosynostosis Neurosurgical Focus 2011 31 2 pp E1 5 Mendoza CS Safdar N Okada K ET AL Personalized assessment craniosynostosis statistical shape modeling Med Image Anal 2014 18 4 pp 635646 6 Maintz JA Viergever MA A survey medical image registra tion Med Image Anal 1998 2 1 pp 136 7 Viergever MA Maintz JA Klein S ET AL A survey medical image registration review Med Image Anal 2017 33 pp 140144 8 Saber NR Phillips J Looi T ET AL Generation normative pedi atric skull models use cranial vault remodeling procedures Childs Nervous Syst 2012 28 3 pp 405410 9 Myronenko A Song X Point set registration coherent point drift 12 Intell 2010 32 IEEE Trans Pattern Anal Mach pp 22622275 10 Sahillioglu Y Kavan L Skuller volumetric shape registration algorithm modeling skull deformities Med Image Anal 2015 23 1 pp 1527 11 Porras AR Zukic D Equobahrie A ET AL Personalized optimal planning surgical correction metopic craniosynostosis In Workshop Clinical ImageBased Procedures 2016 Springer pp 6067 12 Goldman LW Principles CT CT technology J Nucl Med Technol 2007 35 3 pp 115128 13 Avants BB Tustison NJ Stauffer M ET AL The insight toolkit image registration framework Front Neuroinform 2014 8 pp 44 178 This open access article published IET Creative Commons AttributionNoDerivs License http creativecommonsorglicensesbynd30 Healthcare Technology Letters 2017 Vol 4 Iss 5 pp 174178 doi 101049htl20170067