Published online 26 September 2014 Nucleic Acids Research 2014 Vol 42 No 19 e145 doi 101093nargku702 FOAM Functional Ontology Assignments Metagenomes Hidden Markov Model HMM database environmental focus Emmanuel Prestat12 Maude M David1 Jenni Hultman1 Neslihan Tas 1 Regina Lamendella1 Jill Dvornik1 Rachel Mackelprang13 David D Myrold4 Ari Jumpponen2 Susannah G Tringe3 Elizabeth Holman1 Konstantinos Mavromatis3 Janet K Jansson13567 1Earth Sciences Division Lawrence Berkeley National Laboratory Berkeley CA 94720 USA 2Division Biology Kansas State University Manhattan Kansas 66506 USA 3DOE Joint Genome Institute Walnut Creek CA 94598 USA 4Department Crop Soil Science Oregon State University Corvallis OR 97331 USA 5DOE Joint Bioenergy Institute Emeryville CA 94608 USA 6Department Plant Microbial Biology University California Berkeley 94720 USA 7Center Permafrost CENPERM University Copenhagen Copenhagen 1017 Denmark Received February 11 2014 Revised July 11 2014 Accepted July 21 2014 ABSTRACT A new functional gene database FOAM Functional Ontology Assignments Metagenomes veloped screen environmental metagenomic se quence datasets FOAM provides new functional ontology dedicated classify gene functions rele vant environmental microorganisms based Hid den Markov Models HMMs Sets aligned protein sequences proﬁles tailored large group target KEGG Orthologs KOs HMMs trained The alignments checked curated speciﬁc targeted KO Within process sequence proﬁles en riched abundant sequences available maximize yield accurate classiﬁer models An associated functional ontology built scribe functional groups hierarchy FOAM allows user select target search space HMMbased comparison steps easily organize results different functional cate gories subcategories FOAM publicly available httpportalnerscgovprojectm1317FOAM INTRODUCTION Continuous evolution generation sequencing NGS permits acquisition increasingly large DNA RNA sequence datasets relatively low cost These NGS approaches resulted tremendous breakthroughs study humanassociated microbial communities 12 The environmental microbiology scientific commu nity applying NGS study composition phylogenetic functional genes microbial commu nities metagenomics study genes ex pressed metatranscriptomics Recent examples include understanding impact climate change carbon cycling greenhouse gas emissions soil sediment microbial communities 36 mining metagenomes genes encode novel enzymes biotech nology applications biofuel production 78 However current bottleneck metaomic analyses environmen tal microbial communities lack tools accurately assess functional information excessive computa tional time In particular soil considered grand chal lenge metagenomics sequencing projects reasons 9 First majority microorganisms soil cultivated functions known Second high diversity complexity soil microbial communities challenge metagenome assembly 10 Third annotations suffer lack ing functional assignments microorganisms originate cultivated genome sequence data exists genes functional assignment existing databases making correct gene assignments difficult This deficiency exemplified screening genes involved specific biochemical cycles methane oxidation To correspondence addressed Tel 1 509 375 3982 Fax 1 509 371 6955 Email janetjanssonpnnlgov The authors wish known opinion authors considered Joint First Authors Ccid2 The Authors 2014 Published Oxford University Press behalf Nucleic Acids Research This Open Access article distributed terms Creative Commons Attribution License httpcreativecommonsorglicensesbync40 permits noncommercial reuse distribution reproduction medium provided original work properly cited For commercial reuse contact journalspermissionsoupcom e145 Nucleic Acids Research 2014 Vol 42 No 19 PAGE 2 OF 7 methanogenesis KEGG Kyoto Encyclopedia Genes Genomes currently classified Gene Ontology 11 categories biological process metabolic process biosynthetic process cellular biosyn thetic process alkane biosynthetic process Another example KEGG Brite 12 classifies methanogenesis fourth functional sublevel methane metabolism Fi nally remain computational challenges screen ing big datasets represented gigabases Gb terabases Tb sequence data requirement access super computers excessive computational time 13 MATERIALS AND METHODS To address challenges aimed build manu ally curated validated database screening envi ronmental metagenomic metatranscriptomic sequence datasets functional genes We focused biochemical functions metabolic pathways important environ mental microbial ecology including global carbon ni trogen cycles manually selecting organizing func tional gene information database called FOAM Functional Ontology Assignments Metagenomes First KEGG orthologs KOs 12 retrieved fit hierarchical organization general features specific pathways denitrification methanogenesis KEGG KO reference set homologous genes sistent known functions benefits stability good maintenance curation party annotation The KEGG KO chosen FOAM unit qualitative dynamically maintained knowledge base associated rich tool environment available outside KEGG Additionally KEGG KO permits use visualization KEGG tools party software released Cytoscape 14 Glamm 15 Voronto 16 iPATH 17 bioconductor Pathview package 18 KEGG KO lists genes defined KEGG belong functional homologous family consequence multidomain multifunctional Here provide accurate functional annotation FOAM module constructed ideally target function The reduced size resultant FOAM database com pared nonspecific sequence databases step wards significant improvement speed specificity similarity searches In addition improve sen sitivity conventional heuristic alignment programs turned KO set Hidden Markov Models HMMs 19 fetching corresponding protein family Pfam profiles 20 described Figure 1 This step generated sizeable number conflicts Pfam KO vice versa automatically resolved functional assignments KO For remaining unresolved assig nations corresponding set sequences manually split according topology phylogenetic trees At point HMMs retrained new pool sequences By retrieving sequences corresponding Pfam selected KO addition sequences present FOAM database ensured precise tection functions potentially distant homologs With method 74 000 peptide sequence profiles specifically tailored trained predict functions fined KEGG KO This profilebased searching approach enabled identification conserved regions se quence alignments Thus method applicable searching distant homologs similar ap proach Pfam 20 TIGRFAM 21 However Pfam TIGRFAM models provide multiple KEGG KO assignments serve needs retrieval functionally specific annotations metagenomes Also Pfam TIGRFAM focus environmental processes cover functions different environmental sources Addition ally Pfam TIGRFAM based simplified align ment called SEED composed collection sequences representative protein family aim comprehensive recruitment distant homologs Recently FunGene 22 published new toolkit specialized process amplicon data functional genes focusing marker genes 100 currently available FunGene provides users HMMs marker genes tool test primers probes Moreover FunGene allows users build submit new HMMs FOAM complementary FunGene includes 3000 custom protein models obtained enriching Pfams rele vant environmental microbiology protein se quences An additional attribute FOAM KO signments screened manual calibration ensure Pfam alignments targeted KO If parts alignments targeted KOs omit ted building models manually reassigned Im portantly FOAM database complemented input user community The FOAM database means complete encourage recommenda tions future users additional categories input FOAM Ontology definition The ontology defined according following straints cover major biochemical functions path ways relevant environmental microbiology ii orga nize functional classes hierarchically simplify functional group selections search step iii use KEGG KOs refine functional classification FOAM benefits quality KEGG annotation tools use KO IDs Several KOs present functional classes pathway complete higher level To address constraints mainly drew comprehensive bacterial physiology metabolism ref erence text 23 completed KEGG BRITE tology 12 information The resulting FOAM hierarchy limited functional levels level 1 general function group definition level 5 refined level 5 corresponding KO levels The resulting FOAM ontology distributed form tabulated file FOAM website For example level 1 FOAM en try 11 refers nitrogen cycle Table 1 httpportal nerscgovprojectm1317FOAMdatarelease 1 PAGE 3 OF 7 Nucleic Acids Research 2014 Vol 42 No 19 e145 Figure 1 HMM building pipeline example KOK16157 methane monooxygenase Step 1find Pfams combination assigned KO b check redundancy Step 2fetch IMG peptide sequences hit retrieved Pfams Step 3fetch PfamA database HMM Step 4alignment hmmalign filter Pfam extra sequences obtained IMG Step 5stitch filtered alignments Step 6draw Maximum Likelihood tree fasttree Step 7find clusters tree KO Step 8split alignment step 5 output cluster step 7 output build HMM process Trusted Cutoff computation tains 52 KOs There functional groups level 2 database reduction nitrogenous compounds reductive reactions involving nitrogen compounds ni trogen fixation ammonia assimilation nitrification The FOAM level 2 group reduction nitrogenous com pounds subdivided categories den itrification assimilatory nitrate reduction dissimilatory nitrate reduction hydroxylamine reduction Subse quently FOAM level 2 group nitrification sub divided following categories ammonia hydrox ylamine hydroxylamine nitrite This example illus trates KOs hydroxylamine oxidoreductase FOAM category gene products involved biochemical pathway Database construction Approximately 74 000 HMMs generated dis tributed single file 21 HMMer 19 matted files HMM corresponded refined functional level hierarchical FOAM ontol ogy To generate models developed pipeline trig gered KO referenced FOAM Then based KEGG assignment information retrieved combinations Pfams assigned KO From combinations sequences IMG version 4 protein database containing Pfams retrieved including protein sequences annotated microbial genomes metagenomes This process enriched preexisting Pfams additional sequence information particularly metagenomic sequences The sequences aligned Pfam models hmmalign HMMer 3 suite recurring gaps removed step At stage gained num ber protein profiles defined alignment model represents group sequences serves com parison KO equal retrieved Pfams An individual Pfam usually multipleKO assignments making specific Therefore profiles grafted alignment Maximum Likelihood tree built FastTree program 24 identify clades topology consistent sequence KO annotationhere called clusters Figure 1 Grafting alignments relevant sequences present Pfams linking sequences different Pfam Figure 1 step 5 Venn diagram Supplementary Data 2 Detection KO consistent branches brows ing tree leaves ascendant nodes provided subtree gathered leaves KO signment Once completed subtree excised algorithm restarted remaining tree A consistent subtree defined largest subtree single KO annotation Due nature KO annotation possible genes KO assigned In case accepted common KO subtree Furthermore KO mapped EC numbers consistent sub tree genes assigned EC number e145 Nucleic Acids Research 2014 Vol 42 No 19 PAGE 4 OF 7 Table 1 The current FOAM database 73 969 HMMs designed target 2870 different Kos 01 Fermentation 02 Homoacetogenesis 03 Superpathway thiosulfate metabolism 04 Utililization sugar conversion pentose EMP pathway intermediates 05 Fatty acid oxidation 06 Amino acid utilization biosynthesis metabolism 07 Nucleic acid metabolism 08 Hydrocarbon degradation 09 Carbohydrate Active enzyme CAZy 10 TCA cycle 11 Nitrogen cycle 12 Transporters 13 Hydrogen metabolism 14 Methanogenesis 15 Methylotrophy 16 Embden MeyerhofParnos EMP 17 Gluconeogenesis 18 Sulfur metabolism 19 Synthesis saccharides deriviatives 20 Polymers hydrolysis 21 Cellular response stress HMM 13425 336 36 1005 11795 7773 2734 14155 23055 4785 2175 05 1945 5245 238 209 258 355 20155 2740 11647 Total 35781 KO 173 118 7 14 41 805 288 85 305 35 52 543 16 57 69 35 28 33 419 358 825 Different KOs 2870 hmmKO 776 285 514 718 2877 966 949 1665 756 1367 418 000 1216 920 345 597 921 108 481 765 1412 On average HMM alignment 81 peptide sequences 26 HMMs built KO The file size 7 GB digits EC number In scenarios reported members sub tree corresponding annotation common KO EC number A caveat approach consider quality tree treesplitting step weakly supported branches equally treated strongly supported ones producing models different qualities Nevertheless decided approach rational clas sification better classification In future groups recomputed split optimally data available KOs From cluster related KO process extracted alignment HMMs eventually built RESULTS Validation As FOAM constructed entirely protein sequences Pfam JGIIMG sourcing KEGG pep tides KEGG peptides validation Because KEGG sequence KO assignment resulting compar isons relatively straightforward We compared FOAM HMMs UNIPROTSwissprot 25 quired searching files generated KEGG link KEGG Swissprot IDs Therefore valida tion HMMs FOAM included KEGG protein se quences genuine KO assignments Swis sprot To accomplish hmmsearch program launched best hits domain score 25 kept In order compute quality metrics address multiclass problem item se quence labeled KOs To built confusion matrix val idation metrics derived Supplementary Table S1 As FOAM HMM targets multiple KOs classified sequence considered best hit true pos itive KO assigned KEGG corresponded predicted KO example confusion matrix filled metrics computed given Table 2 Validation results shown Figure 2 indicate good FOAM classification performance indices In deed KO level refined classification level precision reached 92 tests 82 Swissprot test 69 KEGG peptides test sensitivity Notably majority misclassifications KO level assigned close KOs terms ID usually means func tional similarity explaining jump values KOs gathered higher classes starting FOAM ontogeny level 4 normally gathers close KOs As specific example extracted data validation performed K02588 contains nifH gene known problematic false positives domain architecture The Swissprot database contains 70 proteins annotated K02588 Run ning HMMs able classify 68 cor rectly 0 incorrect 2 false negatives il lustrating power FOAM DISCUSSION In new era metagenomics faced growth large databases increasing numbers sequencing projects consequently large sequence datasets identified need functional gene database covers diver sity known microbial metabolic processes particu lar environmental metagenomes The resulting FOAM database present strengths user including core function models FOAM HMMs tailored KO assignments organizational struc ture based biochemical cycles environmental rele PAGE 5 OF 7 Nucleic Acids Research 2014 Vol 42 No 19 e145 Table 2 Example confusion matrix construction database validation The matrix initialized labeling rows KEGG assignment columns FOAM assignment according KO list available FOAM Then classification hmmsearch output cell matrix incremented K2 predicted K2 tp2 incremented K3 predicted K1 e31 incremented At end trace diagonal summation sums row sums column computed quality metrics calculated Here calculation performed K00001 K00002 K00010 K00200 vance The resulting HMM construction pipeline sev eral strengths including improved specificity clas sifying peptides translated readscontigs functions sequences selected according phylogenetic analyses KOspecific classifiers ii increased sensitivity crucial dealing diverse underexplored environments soil The KEGG KO chosen FOAM unit dynam ically maintained knowledge base associated rich tool set available outside KEGG KEGG ML GLAMM iPath Voronto That said FOAM aim replace existing systems MGRAST IMGM KEGG genes KO Phylo facts FATCAT 2627 Pfam metagenome annota tion Rather FOAM provides community tool precise functional annotations distant homologs obtained shotgun metagenomic sequencing We defined large set environmentally important functions gene mining organized 5 lev els resolution This enables user focus specific functional groups preselecting relevant models organizing results classified functional families As example annotated soil metagenomic datasets quality trimmingfiltering assembly Velvet The coding regions searched contigs Prodigal mode meta HMMer 19 run HMMs FOAM CarboActive enzyme ontology group The metagenome prairie soil 300 Gbp assembled 5 901 346 contigs N50 609 bp producing 7 716 071 ORFs The second metagenome adjacent cultivated soil 200 Gb assembled 4 592 072 tigs N50 548 bp 6 059 007 ORFs The annotation datasets took 200 cpu hours In ex ample FOAM database annotate 6 657 648 Miseq reads 75 bp length permafrost The sequences translated reading frames translated file run hmmsearch Dell PowerEdge R910 40 cores 1 TB RAM The hmmsearch devoted 5 cpus average given time search took 55 h run 275 cpu hours These examples demonstrate FOAM appro priate tool characterization comparison different functional genes large highly complex environmental metagenome datasets current analysis In summary environmental metagenomes challenging high di versity large proportion uncharacterized microbial taxa environmental habitats Such data require sensitive tools identify distant homologs minimizing computational cost The FOAM database rep resents useful expedient tool informative analyses data The assignment sensitivity increased HMMs trained sequence alignment profiles use HMMer 30 provided model queries expedient BLAST 2829 Additionally FOAM allows easy narrowing search specific target e145 Nucleic Acids Research 2014 Vol 42 No 19 PAGE 6 OF 7 Figure 2 Validation results For functional levels available FOAM ontology metrics computed recall sensitivity precision known positive predictive value specificity F1score harmonic mean In cases precision stays 92 KO level reach 97 level 1 21 classes Recall varies 69 KO level 98 level 1 Levels 2 3 4 gave similar performance results recall precision F1score mean range 9294 functional categories As model trained average 80 sequences FOAM screens dataset selective database 80 faster BLAST test content resulting higher sensitivity ACKNOWLEDGMENT We thank Olivia Mason help advice ganizing database Vanessa Sochat sistance MetaCyc analyses website Deliveries Results HMM files ontology available httpportal nerscgovprojectm1317FOAM FOAM ontology The ontology available tabseparated values file FOAM HMMs FOAM currently 73 969 HMMs built clas sify 2870 different KO 25 HMMs KO av erage A brief description FOAM statistics illustrated Table 1 SUPPLEMENTARY DATA Supplementary Data available NAR Online FUNDING DOEBER US Department Energy Biological Environmental Research Biological Systems Research Role Microbial Communities Carbon Cy cling Program DESC0004953 US DOE DEAC02 05CH11231 Funding open access charge DOE BER DESC0004953 Conflict statement None declared REFERENCES 1 Human Microbiome Jumpstart Reference Strains Consortium NelsonKE WeinstockGM HighlanderSK WorleyKC CreasyHH WortmanJR RuschDB MitrevaM SodergrenE et al 2010 A catalog reference genomes human microbiome Science 328 994999 2 QinJ LiR RaesJ ArumugamM BurgdorfKS ManichanhC NielsenT PonsN LevenezF YamadaT et al 2010 A human gut PAGE 7 OF 7 Nucleic Acids Research 2014 Vol 42 No 19 e145 microbial gene catalogue established metagenomic sequencing Nature 464 5965 3 JanssonJK 2011 Towards TeraTerra Terabase sequencing terrestrial metagenomes Microbe 6 309315 4 MackelprangR WaldropMP DeAngelisKM DavidMM ChavarriaKL BlazewiczSJ RubinEM JanssonJK 2011 Metagenomic analysis permafrost microbial community reveals rapid response thaw Nature 480 368371 5 LuoC RodriguezRLM JohnstonER WuL ChengL XueK TuQ DengY HeZ ShiJZ et al 2013 Soil microbial community responses decade warming revealed comparative metagenomics Appl Environ Microbiol 37 12 13 6 MasonOU HazenTC BorglinS ChainPSG DubinskyEA FortneyJL HanJ HolmanHYN HultmanJ LamendellaR et al 2012 Metagenome metatranscriptome singlecell sequencing reveal microbial response Deepwater Horizon oil spill ISME J 6 17151727 7 Van ElsasJD CostaR JanssonJ Sj olingS BaileyM NalinR VogelTM van OverbeekL 2008 The metagenomics diseasesuppressive soils experiences METACONTROL project Trends Biotechnol 26 591601 8 DeAngelisKM DhaeseleerP ChivianD SimmonsB ArkinAP MavromatisK MalfattiS TringeS HazenTC 2013 Metagenomes tropical soilderived anaerobic switchgrassadapted consortia iron Stand Genomic Sci 7 382398 9 JanssonJK NeufeldJD MoranMA GilbertJA 2012 Omics understanding microbial functional dynamics Environ Microbiol 14 13 10 PellJ HintzeA CaninoKoningR HoweA TiedjeJM BrownCT 2011 Scaling metagenome sequence assembly probabilistic Bruijn graphs PNAS 109 1327213277 11 AshburnerMM BallCAC BlakeJAJ BotsteinDD ButlerHH CherryJMJ DavisAPA DolinskiKK DwightSSS EppigJTJ et al 2000 Gene ontology tool unification biology The gene ontology consortium Nat Genet 25 2529 12 KanehisaM ArakiM GotoS HattoriM HirakawaM ItohM KatayamaT KawashimaS OkudaS TokimatsuT et al 2008 KEGG linking genomes life environment Nucleic Acids Res 36 D480D484 13 ThomasTT GilbertJJ MeyerF 2011 Metagenomics guide sampling data analysis Microb Inform Exp 2 3 14 ShannonP MarkielA OzierO BaligaNS WangJT RamageD AminN SchwikowskiB IdekerT 2003 Cytoscape software environment integrated models biomolecular interaction networks Genome Res 13 24982504 15 BatesJT ChivianD ArkinAP 2011 GLAMM genomelinked application metabolic maps Nucleic Acids Res 39 W400W405 16 SantamariaR PierreP 2012 Voronto mapper expression data ontologies Bioinformatics 28 22812282 17 YamadaT LetunicI OkudaS KanehisaM BorkP 2011 iPath20 interactive pathway explorer Nucleic Acids Res 39 W412W415 18 LuoW BrouwerC 2013 Pathview RBioconductor package pathwaybased data integration visualization Bioinformatics 29 18301831 19 EddySRS 2011 Accelerated profile HMM searches PLoS Comput Biol 7 e1002195 20 FinnRD MistryJ TateJ CoggillP HegerA PollingtonJE GavinOL GunasekaranP CericG ForslundK et al 2010 The Pfam protein families database Nucleic Acids Res 38 D211D222 21 HaftDH HaftDH SelengutJD SelengutJD WhiteO WhiteO 2003 The TIGRFAMs database protein families Nucleic Acids Res 31 371373 22 FishJA ChaiB WangQ SunY BrownCT TiedjeJM ColeJR 2013 FunGene functional gene pipeline repository Front Microbiol 4 114 23 KimBH GaddGM 2008 Bacterial Physiology Metabolism Cambridge University Press Cambridge 24 PriceMN DehalPS ArkinAP 2010 FastTree 2approximately maximumlikelihood trees large alignments PLoS One 5 e9490 25 UniProt Consortium 2008 The universal protein resource UniProt Nucleic Acids Res 36 D190D195 26 KrishnamurthyN BrownDP KirshnerD Sj olanderK 2006 PhyloFacts online structural phylogenomic encyclopedia protein functional structural classification Genome Biol 7 117 27 AfrasiabiC SamadB DineenD MeachamC Sj olanderK 2013 The PhyloFacts FATCAT web server ortholog identification function prediction fast approximate tree classification Nucleic Acids Res 41 W242W248 28 AltschulSF GishW MillerW MyersEW LipmanDJ 1990 Basic local alignment search tool J Mol Biol 215 403410 29 CamachoC CoulourisG AvagyanV MaN PapadopoulosJ BealerK MaddenTL 2009 BLAST architecture applications BMC Bioinformatics 10 19