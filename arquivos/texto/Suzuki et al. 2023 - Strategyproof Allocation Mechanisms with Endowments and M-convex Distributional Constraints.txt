Artiﬁcial Intelligence 315 2023 103825 Contents lists available ScienceDirect Artiﬁcial Intelligence journal homepage wwwelseviercomlocateartint Strategyproof Allocation Mechanisms Endowments Mconvex Distributional Constraints Takamasa Suzuki Akihisa Tamura b Kentaro Yahiro c Makoto Yokoo c Yuzhe Zhang d Gifu Shotoku Gakuen University Gifu Japan b Keio University Yokohama Japan c Kyushu University Fukuoka Japan d University Groningen Groningen Netherlands r t c l e n f o b s t r c t Article history Received 25 September 2020 Received revised form 17 April 2022 Accepted 10 November 2022 Available online 15 November 2022 Keywords Controlled school choice Mconvex set Strategyproofness Top trading cycles Deferred acceptance Distributional constraints 1 Introduction We consider allocation problem multiple types objects agents type object multiple copies multiple seats school agent endowed object distributional constraints imposed allocation minimummaximum quotas We develop mechanisms strategyproof feasible satisfy distributional constraints individually rational assuming distributional constraints represented Mconvex set One mechanism based Top Trading Cycles Pareto eﬃcient belongs mechanism class speciﬁed Kojima et al 1 satisﬁes relaxed fairness requirement The class distributional constraints consider contains situations raised realistic matching problems including individual minimummaximum quotas regional maximum quotas typespeciﬁc quotas distance constraints Finally experimentally evaluate performance mechanisms simulation 2022 The Authors Published Elsevier BV This open access article CC BY license httpcreativecommonsorglicensesby40 The objective paper develop mechanisms allocating indivisible objects agents monetary trans fers individual agent prior claim object type object multiple copies distributional constraints imposed allocation Our motivation apply mechanisms controlled school choice programs public schools deciding allocation students schools school multiple iden tical seats schools offer students opportunity attend preferred public school closest live distributional constraints capacity limits schools Our mechanisms general applied reallocation problem indivisible objects multiple sup plies For example Japanese universities undergraduate engineering students assigned laboratory This paper based conference paper 2 The following main differences extended study TTCMs axiomatic properties non bossiness group strategyproofness weak core characterization TTCM based weak consistency introduction fair mechanism DAR experimental comparison proposed mechanisms Corresponding author yokooinfkyushuuacjp M Yokoo yoezyzhangrugnl Y Zhang Email addresses tsuzukigifushotokuacjp T Suzuki akitamuramathkeioacjp A Tamura yahiroagentinfkyushuuacjp K Yahiro httpsdoiorg101016jartint2022103825 00043702 2022 The Authors Published Elsevier BV This open access article CC BY license httpcreativecommonsorglicensesby40 T Suzuki A Tamura K Yahiro et al Artiﬁcial Intelligence 315 2023 103825 conduct projects However students fail choose laboratory greatest limited familiarity A possible remedy apply following threestep procedure students assigned laboratories mechanism ii experience certain trial period iii student chance apply laboratory changes mind current laboratory fails meet expectations Our new mechanisms step iii Naturally student mandatorily reallocated laboratory worse current assignment Following seminal work Abdulkadiroglu Sönmez 3 formalized school choice problem context mechanism design approach wide range theoretical analysis conducted existing mechanisms practice1 As theory developed applied diverse types environments mechanism designers faced variety forms distributional constraints unaddressed standard model For example Biró et al 5 motivated Hungarian education higher education institutions declare minimum quotas study areas satisﬁed open courses Another example regional maximum quotas introduced Japanese government control geographical distribution medical residents countrys hospitals 6 It wellknown presence distributional constraints stable matching exist A matchings stability ﬁrst deﬁned twosided onetoone matching problems 7 In setting school choice problem stability ﬁned combination individual rationality IR fairness nonwastefulness NW 8 IR basic requirement guarantees student2 obtain seat school good initial endowment Fairness ensures student s accepted school c believes better assigned school s ranked lower student accepted c based cs preference NW eﬃciency notion rules incidents student unilaterally preferred school violating underlying distributional constraints Given incompatibility stability distributional constraints mechanism designers encounter tradeoff fairness eﬃciency In recent literature distributional constraints 916 common approach weaken stability maintaining balance eﬃciency fairness extent In paper examine eﬃciencyfairness achievable distributional constraints guaranteeing IR More speciﬁcally eﬃciency study Pareto Eﬃciency PE stronger welfare notion NW eliminates incidents students welfare improved detracting welfare satisfying distribu tional constraints For fairness study slightly relaxed requirement compatible IR called fairness NonInitial Endowment students NIEfairness examine achieved sacriﬁcing excessive eﬃ ciency It generally remained open question Pareto Eﬃcient PE mechanism mechanism guaranteed obtain PE matching satisfy fairness property distributional constraints 6 Kamada Kojima 6 studies investigating eﬃciency distributional constraints argued PE achievable der regional maximum quotas Another study Hamada et al 17 develops PE mechanism NIEfair mechanism minimum standard maximum quotas imposed school As described class distributional constraints studied work strict generalization classes We restrict attention strategyproof SP mechanisms student incentive misreport preference schools In theory restrict attention SP mechanisms loss generality wellknown revelation principle 18 certain property achieved mechanism speciﬁcally property satisﬁed dominant strategy equilibrium mechanism achieved SP mechanism An SP mechanism useful practice student need speculate actions students obtain good outcome needs truthfully report preference In paper consider class distributional constraints represented Mconvex set M stands Matroid concept introduced ﬁeld discrete mathematics discrete counterpart frame work convex analysis 1920 We Mconvexity underlying distributional constraints suﬃcient guarantee existence mechanisms satisfy desirable properties The class distributional constraints represented Mconvex set contains situations raised realistic matching problems including individual minimummaximum quotas Fragiadakis et al 9 Hamada et al 17 regional maximum quotas Goto et al 11 Kamada Kojima 6 typespeciﬁc maximum quotas Abdulkadiroglu 21 Fragiadakis Troyan 10 distance constraints Kojima et al 1 We require additional assumption student assigned initial endowment school underlying dis tributional constraints satisﬁed This innocent requirement context school choice student attend local school school choice program assuming default allocation satisﬁes distributional constraints reasonable Our mechanism achieving PE based Top Trading Cycles TTC mechanism 22 developed David Gale TTC improves students welfare trading initial endowments Our mechanism achieving NIEfairness belongs mecha nism class speciﬁed Kojima et al 1 generalization Deferred Acceptance DA mechanism 7 Both tailored handle IR distributional constraints 1 For example Sönmez Ünver 4 survey theoretical analysis existing school choice mechanisms 2 For presentation clarity rest paper described context schoolstudent allocation problem obtained results paper applicable allocation problems general 2 T Suzuki A Tamura K Yahiro et al Artiﬁcial Intelligence 315 2023 103825 Introducing controlled school choice program provoke controversy People worry schools unpopular fail operate number students small By utilizing mechanisms guarantee worse introduction school choice program student guaranteed assignment weakly better school compared default school attend school choice program distributional constraints ensure school assigned suﬃcient number students This paper organized follows In rest section examine related literature In Section 2 introduce general model allocation problem initial endowments distributional constraints deﬁne desirable prop erties In Section 3 notion Mconvex set specify domain distributional constraints focus impossibility result related PE general model Section 4 details properties Mconvex set proof main theorems In Section 5 introduce ﬁrst main mechanism called TTC Mconvex constraints TTCM satisﬁes PE desirable properties setting Furthermore restricting ﬂexibility TTCM degenerates existing mechanism called TTC Representatives TTCR 17 In Section 6 introduce DAbased mechanisms ﬁrst simple DAbased mechanism called Artiﬁcial Cap DA ACDA followed second main DA mechanism DA based ranks DAR properties Finally experimentally compare mechanisms simulation Section 7 conclude Section 8 11 Related literature Our paper located intersection discrete mathematics economics The insight discrete convex analysis particular broad range applications discrete optimization including scheduling facility location structural analysis engineering systems 2325 Recently discrete convex analysis recognized powerful tool analyzing economic game theoretic applications including exchange economies indivisible objects 2629 systems analysis 27 inventory management 3031 auctions 32 Murota 33 extensive survey recent developments As suggested long albeit partial list success stories suggests techniques literature applied variety economic problems In paper add allocation problems including school choice problems list This paper ﬁrst apply discrete convex analysis allocation problems Fujishige Tamura 3435 Murota Yokoi 36 applied study twosided matching problems Both works dealt manytomany matching problems doctoremployee work multiple hospitalsﬁrms Fujishige Tamura 3435 addressed payments well3 Kojima et al 1 applied concept twosided matching problems distributional constraints showed preferences schools represented Mconcave function4 generalized deferred acceptance mechanism 38 achieves desirable outcome Our mechanism achieving relaxed fairness based idea tailored satisfy IR Shapley Scarf 22 ﬁrst introduced TTC They investigated housing market problem objects initially owned agents strict preferences copies object market TTC generalized Hierarchical Exchange mechanism 39 Trading Cycles mechanism5 41 TTC applied school choice problem 42 problem assigning teachers schools 4344 TTC attracting attention AI researchers 4547 Abdulkadiroglu Sönmez 48 Guillen Kesten 49 investigated housing market problem existing tenants agents initially house houses initially owned agents6 The differences setting consider multiple copies object impose distributional constraints Hamada et al 17 considered individual minimum maximum quotas multiple copies object exist agents initial endowments objects initially owned agent Our work strict extension theirs When TTC applied housing market problem agents sequentially form trading cycles exchange initial endowments In allocation problem consider school seats vacant initially owned students distributional constraints imposed ﬁnal allocation The main challenge setting utilize vacant seats improve students welfare violating distributional constraints For example assume following complex distributional constraints imposed schools partitioned regions total number students allocated region exceed maximum quota called regional maximum quotas following contents Even school vacant seat allocating student school violate maximum quota region school belongs By utilizing common priority order students TTCbased mechanism Top Trading 3 See earlier contribution 37 applied matroid theory matching This analysis special case recent contribution Fujishige Tamura 35 4 More precisely concept called Mcid2convexity essentially equivalent variant Mconvexity 5 Pycia Ünver 40 extended Trading Cycles mechanism object multiple copies Our work different theirs considered standard maximum quotas deal general distributional constraints represented Mconvex set 6 We easily modify model situation students initially school seat assume student initially owns seat null school c student s ωs cid4s c holds ωs cid5 c 3 T Suzuki A Tamura K Yahiro et al Artiﬁcial Intelligence 315 2023 103825 Table 1 Properties strategyproof allocation mechanisms NIEFairness PE NW TTCM TTCR DAR ACDA NW Ex 5 yes Th 13 yes Th 12 yes Th 4 yes NIEfairness NWR yes Ex 4 yes Th 14 Th 12 GSP yes Th 6 yes Th 9 Ex 8 Ex 8 wcore yes Th 7 yes Th 9 Ex 8 Ex 8 Cycles Mconvex constraints TTCM eﬃciently use vacant seats violating underlying distributional constraints To best knowledge mechanism desirable properties identiﬁed setting We conclude section comparing properties SP mechanisms respect IR Table 1 summarizes comparison Here NWR stands nonwastefulness based ranks Deﬁnition 8 GSP stands group strategyproofness Deﬁnition 9 wcore denotes mechanisms outcome weak core Deﬁnition 10 2 Model In section introduce model desirable properties A market tuple S C ω cid4S cid4C F S s1 sn ﬁnite set n students C c1 cm ﬁnite set m schools ω S C initial endowment function ωs c denotes initial endowment school s cid4S cid4ssS proﬁle strict student preferences C cid4C cid4ccC proﬁle strict school preferences S F Zm 0 element nonnegative integer set schoolfeasible vectors We assume distributional constraints extensionally represented F ν F cid2 m i1 νi n holds cid10 cid10 cid10 We follow framework matching contracts 38 Given market M s c s S c C ﬁnite set contracts A contract s c means student s matched school c For subset contracts μ M let μs s c μ c C denote contracts μ related s let μc s c μ s S denote contracts μ related c A set contracts μ matching μs 1 holds s S s c μc holds μs s c s S c C For matching μ let μs denote school s matched μs c holds μs s c let μc denote set students matched c μc s S s c μc For pair matchings μ μcid10 write μ cid4s μcid10 μs cid4s μcid10s Additionally denote c cid11s c c cid4s c Let μ M denote initial endowment matching s S μs ωs Then matching μ individually rational IR μs cid11s ωs holds s S In words IR requires student matched school good initial endowment school Additionally student s school ranked weakly higher ωs acceptable s c c For μ let νμ denote mdimensional distribution vector μ ith element νiμ μci We i1 νiμ n write νci μ instead νiμ Matching μ schoolfeasible νμ F Note μ schoolfeasible student matched school Moreover assume μ schoolfeasible For s S let cid4s cid4s denote preference proﬁle students preference student s cid4s cid10 S let proﬁle preferences students cid4s cid4scid10 scid10Ss Furthermore set students S cid4Scid10 cid4Scid10 denote preference proﬁle students cid4Scid10 proﬁle preferences students cid10 S cid4Scid10 proﬁle preferences remaining students A mechanism ϕ function takes proﬁle student preferences cid4S input returns matching ϕcid4S Let ϕscid4S denote school s matched let ϕccid4S denote set students matched c For property deﬁned matching feasibility deﬁned later section mechanism satisﬁes property mechanism feasible returns matching satisﬁes property feasibility cid2 For brevity write k 1 k k Z0 positive integer With notations introduce m following desirable properties Deﬁnition 1 Feasibility Matching μ feasible IR schoolfeasible Next introduce strategyproofness SP intuitively requires student assigned strictly preferred school misreporting preference Deﬁnition 2 Strategyproofness SP Mechanism ϕ strategyproof SP s cid4s cid4cid10 cid4s holds s cid4s ϕscid4s cid4s cid11s ϕscid4cid10 s 4 T Suzuki A Tamura K Yahiro et al Artiﬁcial Intelligence 315 2023 103825 Note deﬁnition SP considers misreport student assume schools act strategically Pareto Eﬃciency PE natural requirement eﬃciency students welfare requires improve assignment student hurting students Deﬁnition 3 Pareto Eﬃciency PE Matching μ Pareto dominates matching μcid10 holds Schoolfeasible matching μ Pareto eﬃcient PE schoolfeasible matching Pareto dominates it7 s S μs cid11s μcid10 s holds s S μs cid4s μcid10 s Nonwastefulness requirement eﬃciency guarantees school seat wasted student requires Deﬁnition 4 Nonwastefulness NW Given matching μ student s s c μ claims seat c cid10 M μ c s c seat μ cid10 schoolfeasible Matching μ nonwasteful NW student claims cid10 cid4s c μ s c s c cid10 cid10 cid10 In words student s claim seat school c prefers c violate distributional constraints cid10 unilaterally moving c c cid10 currently matched school c Note PE implies NW NW weaker requirement terms eﬃciency PE Next introduce property called fairness deﬁned notion justiﬁed envy Deﬁnition 5 Fairness In matching μ s c μ student s justiﬁed envy student s cid10 s c c hold Matching μ fair student justiﬁed envy μ cid10 M μ c cid10 μ s cid4ccid10 s cid10 cid4s c s cid10 c cid10 cid10 C cid10 In words s justiﬁed envy student s 1 s prefers c currently matched school cid10 2 s assigned school c cid10 Fairness IR incompatible general Consider market S s1 s2 C c1 c2 ωs1 c1 ωs2 c2 F 1 1 Both students prefer c1 c2 schools prefer s2 s1 Since fair matching assign s2 c1 s1 assigned c2 However violates IR c prefers s s cid10 cid10 Thus introduce weaker version fairness called fairness noninitial endowment students Intuitively justiﬁed envy student s assigned school c deemed legitimate s initial endowment student c Deﬁnition 6 Fairness NonInitial Endowment students NIEfairness In matching μ s c μ student s cid10 M μ justiﬁed envy respecting initial endowments RIEenvy student s cid10 cid10 cid4s c s hold Matching μ fair noninitial endowment students student c justiﬁed RIEenvy μ cid10 C s c cid10 μ s cid4ccid10 s cid10 μ s c cid10 c cid10 c cid10 Unfortunately NIEfairness NW generally incompatible case exists feasible matching simultaneously satisﬁes properties This impossibility result shown following example Example 1 Consider following market S s1 s2 C c1 c2 c3 ωs1 ωs2 c1 The following preferences studentsschools s1 c2 cid4s1 c3 cid4s1 c1 s2 c3 cid4s2 c2 cid4s2 c1 c1 s1 cid4c1 s2 c2 s2 cid4c2 s1 c3 s1 cid4c3 s2 The set feasible vectors F given follows cid6 cid6 cid6 cid6 cid6 cid6 ν Z3 0 i3 νi 2 1 ν1 2 0 ν2 ν3 1 F cid2 7 Sometimes property referred constrained Pareto eﬃciency set matchings restricted set schoolfeasible matchings 5 T Suzuki A Tamura K Yahiro et al Artiﬁcial Intelligence 315 2023 103825 Set F represents situation minimum quota c1 student assigned c1 schools minimum quota To satisfy minimum quota c2 c3 accept student total By student preference proﬁle c1 popular school s1 s2 student assigned 1 ν1 2 Assume s1 assigned c1 Then s2 assigned favorite school c3 s2 claims seat c3 However s1 justiﬁed RIEenvy s2 s1 cid4c3 s2 Similarly assume s2 assigned c1 Then s1 assigned favorite school c2 s1 claims seat c2 However s2 justiﬁed RIEenvy s1 s2 cid4c2 s1 Since NIEfairness NW incompatible general introduce weaker version NW called nonwastefulness based ranks NWR To deﬁne NWR introduce concept called rank student school Deﬁnition 7 Rank For contract s c M ranks c deﬁned follows ranks c cid10 0 s cid10 S ωs cid10 cid5 c s ωs c cid10 cid4c s 1 In words ranks c denotes ranking student s school c based cid4c cs initial endowment students If ωs c ranks c 0 If student s ranked highest c students s S ωs cid5 c ranks c 1 s ranked second ranks c 2 Then NWR deﬁned follows cid10 cid10 M μ based ranks following conditions hold Deﬁnition 8 Nonwastefulness based ranks NWR Given matching μ assume contract s c μ Student s claims seat c s c ii c iii μ s c s c iv ranks c Matching μ nonwasteful based ranks student claims seat based ranks cid10 schoolfeasible cid10 ranks c cid10 cid4s c Here conditions iii equivalent conditions student claims seat Deﬁnition 4 Then based ranks ranked higher c If mechanism NW intuitively student claim seat preferred school c c obviously NWR current allocated school c valuablepreferred c cid10 cid10 cid10 Next introduce group strategyproofness GSP stronger property SP Deﬁnition 9 Group strategyproofness GSP Mechanism ϕ group strategyproof GSP cid4S group students cid10 S cid4cid10 S Scid10 cid4Scid10 cid11s ϕscid4S holds s S Scid10 cid4Scid10 cid4s ϕscid4S holds Scid10 exist s S ϕscid4cid10 ϕscid4cid10 cid10 cid10 In words property requires group students misreport preferences achieve group member assigned strictly better school worsening members allocation Next introduce property called core Deﬁnition 10 Core Schoolfeasible matching μ strong core schoolfeasible matching μcid10 cid10 ii s S cid10 S exist c C s c μcid10 s S S μcid10s cid4s μs Schoolfeasible matching μ weak core schoolfeasible matching μcid10 exist c C s c μcid10 s S cid10 s c μ s S cid10 s c μ s S cid10 ii s S cid10 group students μcid10s cid11s μs s S cid10 cid10 S group students S cid10 μcid10s cid4s μs holds In words matching strong core respectively weak core group students respectively strictly better swapping initial endowment schools group exists called blocking coalition The strong core subset weak core requirement legitimate blocking coalition weaker deﬁnition identical ii weaker ii Roth Postlewaite 50 showed matching obtained TTC unique element strong core objects assigned students completely distinct housing market In setting allocate school seats students School seats completely distinct seats school identical The following example shows strong core setting Example 2 Consider following market 6 T Suzuki A Tamura K Yahiro et al Artiﬁcial Intelligence 315 2023 103825 S s1 s2 s3 C c1 c2 ωs1 ωs2 c1 ωs3 c2 The following preferences students s1 c2 cid4s1 c1 s2 c2 cid4s2 c1 s3 c1 cid4s3 c2 The set feasible vectors F contains element 2 1 Each element strong core PE grand coalition coalition students S blocking coalition There PE matchings cid11 μ c1 s2 s3 c2 s1 cid12 cid11 μcid10 c1 s1 s3 c2 s2 cid12 For μ s2 s3 form blocking coalition swapping initial endowment schools s2 strictly better s3 indifferent Similarly μcid10 s1 s3 form blocking coalition swapping initial endowment schools s1 strictly improves s3 indifferent However matchings weak core Finally introduce notions mechanism A directed graph pair V E V set vertices E V V collection directed edges j E ordered pair vertices A sequence distinct vertices i1 ik k 2 directed path V E i1 ik ih ih1 E h k 1 A directed path cycle ﬁrst vertices coincide 3 Mconvex set class distributional constraints In section class distributional constraints considered model Let χi denote melement unit vector ith element 1 elements 0 We write χci instead χi Deﬁnition 11 Mconvex set A set melement vectors F Mconvex set ν νcid10 F m νi νcid10 j m exists ν j νcid10 j ν χi χ j F νcid10 χi χ j F hold This property characterizes Mconvex set called simultaneous exchange property 19 The notion M convex set analogous maximum elements convex set continuous domain hollow exists set Next distributional constraints introduced literature belong class Mconvex set Standard model 3 Consider market school c C maximum quota qc exists The distributional straints market expressed F F ν Zm 0 cid13 cC νc n νc qc c C veriﬁed F Mconvex Individual minimummaximum quotas 917 school c C minimum quota pc exists The distributional constraints market expressed F In addition maximum quotas standard model assume F ν Zm 0 cid13 cC νc n pc νc qc c C veriﬁed F Mconvex 7 T Suzuki A Tamura K Yahiro et al Artiﬁcial Intelligence 315 2023 103825 Regional minimummaximum quotas 611 In addition individual minimummaximum quotas capacity constraints imposed regions Set regions R 2C partitions set schools C regions r R regional minimum quota pr maximum quota qr The distributional constraints market expressed F F ν Zm 0 cid13 cC νc n pc νc qc pr cid13 cr νc qr c C r R veriﬁed F Mconvex Regional minimummaximum quotas extended case regions multiple layers cities coun ties states 1151 Assuming regions laminar structure8 distributional constraints represented Mconvex set 1 Typespeciﬁc quotas 2110 We assume student belongs exactly type A students type represent ethnicity gender socioeconomic status In addition individual maximum quotas additional type speciﬁc quotas More speciﬁcally exists set types T t1 tk Each student belongs exactly type c C t T typespeciﬁc minimum quota pct maximum quota qct deﬁned We assume distribution vector ν represented m T matrix νct denotes number type t students allocated school c The distributional constraints market expressed F F ν ZmT 0 cid13 cCtT νct n cid13 tT νct qc pct νct qct c C t T veriﬁed F Mconvex Note F 2dimensional matrix extension standard deﬁnition More speciﬁcally element νct represents number type t students assigned school c We assume school c divided T subschools distributional constraints imposed m T subschools Then model equivalent standard model distributional constraints deﬁned onedimensional vector Distance constraints 1 When allocating n students m schools suppose ideal distribution vector exists viewpoint mechanism designer considers distribution vector feasible close ideal vector More speciﬁcally distance constraints deﬁned ideal vector ν distance k describing maximum tolerable deviation ideal distribution The set feasible vectors distributional constraints expressed F F ν Zm 0 cid13 cC νc n δν ν k pair mdimensional vectors ν νcid10 Zm L1 distance deﬁned δν νcid10 deﬁned δν νcid10 maxcC νc νcid10 νc νcid10 It veriﬁed F Mconvex 0 distance function δ Manhattan distance distance ii Chebyshev distance L cC cid2 c In theorem feasibility PE SP incompatible set feasible vectors c Mconvex set Theorem 1 A market exists set feasible vectors Mconvex mechanism simultaneously satisﬁes feasi bility PE SP Proof The theorem proved simple market students schools set feasible vectors Mconvex set adding vector Consider following market S s1 s2 C c1 c2 c3 ωs1 ωs2 c1 student preferences s1 c3 cid4s1 c2 cid4s1 c1 s2 c3 cid4s2 c2 cid4s2 c1 F 2 0 0 1 1 0 0 1 1 8 R laminar structure r r cid10 R r cid5 r cid10 following conditions holds r r cid10 r cid10 r r r cid10 8 T Suzuki A Tamura K Yahiro et al Artiﬁcial Intelligence 315 2023 103825 This market interpreted follows Within school district schools c1 c2 c3 c1 larger capacity Due constraints districts logistic resources schools simultaneously operated close c1 c2 c2 c3 c1 open Note F Mconvex set following argument For ν 2 0 0 νcid10 0 1 1 consider ν3 νcid10 3 ν j νcid10 j holds j 1 ν χ3 χ1 1 0 1 F However F 1 0 1 Mconvex set In market feasible PE matchings s1 c3 s2 c2 s1 c2 s2 c3 Assume PE mech anism ϕ chooses ϕcid4S s1 c3 s2 c2 Then s2 misreport cid4cid10 c2 With misreport s2 feasible PE matching ϕcid4s1 cid4cid10 cid4s2 ϕs2 cid4s1 cid4s2 Similarly s1 incen s2 tive misreport ϕcid4S s1 c2 s2 c3 In cases student beneﬁt misreporting ϕ satisfy SP cid2 c3 cid4cid10 s2 s1 c2 s2 c3 ϕs2 cid4s1 cid4cid10 s2 c1 cid4cid10 s2 This theorem implies violation Mconvexity easily leads nonexistence feasible SP PE mechanism In Section 5 distributional constraints market represented Mconvex set mechanism exists satisﬁes SP PE We conjecture Mconvexity general classes distributional constraints mechanism desirable properties 4 Properties Mconvex set In section present properties related Mconvexity later sections These properties known literature proving straightforward To selfcontained provide proofs cid14 Lemma 1 Murota 27 Lemma 923 Fujishige 52 Lemma 45 Let F Mconvex set For ν F exist i1 j1 ir jr m distinct χ jk F χ jk F cid2 ν χih ν χih h k h k h k r 1 Then holds ν krχik χ jk F Proof The proof conducted induction r When r 1 obviously holds Assume supposition true r cid8 consider case r cid8 1 Take vectors ν χi1 χ jk It holds F assumption It holds b F induction i2 j2 ir jr 2cid8 equals 2r 1 distinct elements m satisfy Equation 1 Since i1 j1 ir jr distinct holds ai1 bi1 It holds k m ak bk j1 i2 i3 ir From Mconvexity F j j1 i2 i3 ir exist χ j χi1 ν χ j χ j1 F It follows j1 candidate ν χih χ j1 F ih h 1 It follows b χ j1 χ j1 b ν χi1 b χi1 cid2 r k2χik χ j1 ν χ jk F cid2 krχik cid2 In words Lemma 1 means unilaterally apply feasible moves reduce element simultaneously increase simultaneously sorted properly sense Lemma 2 Let F Mconvex set assume vector ν F Let J r ﬁxed q J elements i1 j1 ir jr m given i1 ir j1 jr χ jk F χ jk F χ jk F h k cid5 q h k q h k h k J ν χih ν χih ν χih hold ν cid13 χicid8 cid8 J χ jcid8 F χ jcid8 F If r q exchange property νcid10 cid2 cid8 J χicid8 νcid10 χir Proof Assume contrary νcid10 ν νcid10 ir νir i1 ir j1 jr k exists νcid10 jk F χ jk Furthermore Equation 2 k equal r Then ν assume q r Since νcid10 iq χ jk cid8 J rχicid8 νiq holds exchange property νcid10 F χ jk ν χiq χ jk ν χir νcid10 χiq ν jk cid2 However elements J equal q contradicts Equation 2 cid2 9 χ jcid8 F By repeating argument ν iq k exists νcid10 ν jk jk 2 ν ir T Suzuki A Tamura K Yahiro et al Artiﬁcial Intelligence 315 2023 103825 In words Lemma 2 states infeasible remains infeasible applying sequence feasible moves Lemma 3 Assume ν F I J m exist I J I j J following condition holds ν χi χ j F Then νcid10 F exists following condition holds m J νcid10 νi j I νcid10 j ν j 3 4 Proof Assume contrary νcid10 νi j exists νcid10 νcid10 νcid10 χi χ j ν χi χ j F j ν j exists satisﬁes Equation 4 Since F Mconvex set νcid10 ν F I By Equation 4 j belong J contradicts Equation 3 cid2 In words Lemma 3 means student J I increase number students I decreasing number students m J 5 Top Trading Cycles Mconvex constraints In section introduce SP mechanism Top Trading Cycles Mconvex constraints TTCM achieves feasible PE outcome settings Then characterization TTCM special market called compatible market 51 Mechanism description First outline TTCM It repeats rounds At beginning round k let μk1 denote matching students left market let μk1 denote initial endowment matching remaining students Then cid15μk1 μk1 μk1 denotes provisional matching beginning round k The mechanism uses school preference proﬁle cid4 Let Sk denote s s c μk1 set remaining students round k We student s Sk initial endowment school c j admissible school ci round k νcid15μk1 χi χ j F holds s ci initial endowment school c j violating distributional constraints If student admissible school c Sk school leaves market beginning round k Let C k denote set remaining schools beginning round k Note deﬁnition ωs c s admissible c round k long νcid15μk1 F holds C artiﬁcially constructed based common serial order students cid49 We assume cid4 complete strict S Based cid4 artiﬁcially constructed preference school c C cid4 c constructed basically identical cid4 initial endowment students c prioritized More speciﬁcally s cid4 c s cid10 c s cid4 s ωs ωs ii ωs cid5 c ωs iii ωs c ωs Without loss generality assume s1 cid4 s2 cid4 cid4 sn holds holds following conditions holds cid10 cid5 c s cid4 s cid10 cid5 c Now ready introduce TTCM described Mechanism 1 Intuitively assume TTC M round k school selects student gives right obtain seat Then students rights trade seats constructing trading cycles Gk standard TTC mechanism Therefore student participate trade selected school By deﬁnition cid4 c priority right school c ﬁrst given initial endowment students ties broken common serial order cid4 When initial endowment students left market school c gives right remaining student admissible unilaterally moving c initial endowment school violate distributional constraints ties broken cid4 cid10 cid10 cid10 Since student considers initial endowment school acceptable school deems admissible round long remains market guaranteed seat initial endowment school Thus student included cycle round TTCM terminates 9 In applications schools students agree order GPA If agreeable order exists rely lottery randomly decide order Such order serial dictatorship mechanism 1216 schoolfeasible SP PE IR If student initial endowment school TTCM identical serial dictatorship mechanism 10 T Suzuki A Tamura K Yahiro et al Artiﬁcial Intelligence 315 2023 103825 Mechanism 1 Top Trading Cycles Mconvex constraints TTCM Initialize μ0 μ μ0 k 1 Round k Step 1 Construct directed graph Gk follows Each school c leaves market admissible student Sk Otherwise c points admissible student ranked highest according cid4 c Sk Each student Sk points favorite school C k This creates directed graph Gk V k Ek V k Sk C k s c Ek resp c s Ek represents fact student s resp school c points school c resp student s Step 2 Let C k set directed edges form cycles Gk Since V k ﬁnite cycle exists Gk C k nonempty Step 3 μk μk1 s ωs s c C k μk μk1 s c s c C k Each student s s c C k leaves market Step 4 If μk return μk Otherwise k k 1 round s1 s2 s5 cid16 cid16 c4 s4 cid14 cid4 cid4cid5 cid14 cid14 cid2cid3 cid10 cid10 cid2 c1 cid10 cid16 cid16 cid14 cid14cid15 cid16cid16cid17 cid10cid10cid11 cid8cid8cid8cid8cid8cid8cid8cid9 cid12cid12cid12cid12cid12cid12cid12cid13 cid4 c2 c3 cid2 cid4cid6 cid2cid7 s3 Fig 1 G 1 obtained Round 1 TTCM Example 3 One particular feature TTCM deals underlying distributional constraints At round k TTCM priority right school given student based cid4 C νcid15μk1 F For instance distributional constraints individual maximum quotas school gives priority right student number allocated students fewer quota Under complex distributional constraints minimum quotas andor regional quotas looking current status quota insuﬃcient school determine student prioritize For example initially endowed seat school c decreases number students allocating student school c allocated c νccid15μk1 This decision violate distributional constraints c accept student The example describes TTCM works regional quotas cid10 cid10 Example 3 Consider following market In example student s S list cid4s acceptable schools S s1 s2 s3 s4 s5 C c1 c2 c3 c4 cid4 s1 cid4 s2 cid4 s3 cid4 s4 cid4 s5 c2 cid4s1 c1 ωs1 c3 cid4s2 c2 ωs2 c2 cid4s3 c3 ωs3 c3 cid4s4 c4 ωs4 c2 cid4s5 c4 ωs5 F ν Z4 0 cid6 cid6 cid6 cid6 cid6 cid6 cid6 cid2 i4 νi 5 0 νi 2 4 2 ν3 ν4 3 Set F represents situation schools region c3 c4 jointly subjected regional minimum maximum quotas addition individual maximum quota 2 First μ0 determined μ0 μ s1 c1 s2 c2 s3 c3 s4 c4 s5 c4 Note ν μ0 1 1 1 2 F At Step 1 Round 1 school initial endowment student market schools main market Each school c points student based cid4 c νcid15μ0 F In round school points initial endowment student ranked highest according cid4 Each student points favorite school remains market This results G 1 shown Figure 1 There cycle c2 s2 c3 s3 c2 At Step 2 C 1 c2 s2 s2 c3 c3 s3 s3 c2 At Step 3 s2 c2 s3 c3 removed μ0 s2 c3 s3 c2 added μ0 μ1 μ1 determined μ1 s1 c1 s4 c4 s5 c4 μ1 s2 c3 s3 c2 11 T Suzuki A Tamura K Yahiro et al Artiﬁcial Intelligence 315 2023 103825 s5 cid16 cid16 c4 cid16 cid16 s1 cid10cid10cid18 cid2cid3 cid10 cid10 cid10 cid10 cid2 c1 cid10 cid16 cid16cid17 cid10cid10cid11 cid10 c2 s4 cid14 cid14cid19 cid14 cid4cid5 cid14 cid14 cid14 cid14 cid4 cid14 cid14cid15 cid14 c3 Fig 2 G 2 obtained Round 2 TTCM Example 3 s5 cid4cid5 cid4 c1 cid2 cid2cid3 cid2cid7 cid2 c4 Fig 3 G 3 obtained Round 3 TTCM Example 3 Note νcid15μ1 νcid15μ0 1 1 1 2 round s2 s3 exchange seats initial endowment schools distributional vector change At Step 4 TTCM goes Round 2 μ1 cid5 At Step 1 Round 2 schools c2 c3 initial endowment students School c2 points s1 based cid4 highest remaining students allocating c2 initial endowment school c2 0 2 1 2 F admissible c2 c1 violate distributional constraints 1 1 1 2 χc2 Round 2 To school c3 s1 admissible 1 1 1 2 χc3 0 1 2 2 F maximum quota region containing c3 c4 On hand moving student c4 c3 feasible Thus c3 points s4 according cid4 Therefore G 2 determined Figure 2 There cycles c2 s1 c2 c3 s4 c3 At Step 2 C 2 c3 c2 s1 s1 c2 c3 s4 s4 c3 μ2 μ2 determined χc1 χc1 μ2 s5 c4 μ2 s2 c3 s3 c2 s1 c2 s4 c3 Observe νcid15μ2 0 2 2 1 F Note c2s decision right student s1 based fact moving s1 c1 c2 feasible 0 2 1 2 F Similarly c3s decision right student s4 based fact feasible s4 c4 c3 1 1 2 1 F The fact implementing moves gives feasible vector guaranteed Mconvexity shown proof Theorem 2 At Step 4 TTCM goes Round 3 μ2 cid5 At Step 1 Round 3 G 3 determined Figure 3 Since student admissible c2 c3 schools leave market There cycle c4 s5 c4 At Step 2 C 3 c4 s5 s5 c4 Therefore μ3 μ3 determined μ3 μ3 s2 c3 s3 c2 s1 c2 s4 c3 s5 c4 At Step 4 TTCM returns μ3 μ3 52 TTCM properties First introduce property guarantees TTCM feasible school independently makes decision Before property prove following lemma Lemma 4 In TTCM k 1 νcid15μk cid5 νcid15μk1 r 1 exists c1 ωs1 cr ωsr C k νcid15μk νcid15μk1 cid13 cid8r χccid8 χωscid8 5 s1 sr ordered s1 cid4 cid4 sr c1 cr ordered ccid8 scid8 Ek cid8 r Furthermore schools c1 ωs1 cr ωsr distinct school c1 cr initial endowment student Sk cid10 νcid15μk1 χch νcid15μk1 χch χωscid8 F χωscid8 F h cid8 h cid8 h cid8 r 12 6 T Suzuki A Tamura K Yahiro et al Artiﬁcial Intelligence 315 2023 103825 Proof In TTCM fact c s C k means school c accepts student pointing c student s moves initial endowment school ωs school s pointing Therefore νcid15μk expressed νcid15μk νcid15μk1 cid13 csC k χc χωs From expression clear moving s ωs cid15μks affect resulting distributional vector c s C k ωs c When νcid15μk cid5 νcid15μk1 r 1 exists c1 ωs1 cr ωsr C k νcid15μk νcid15μk1 νcid15μk1 νcid15μk1 cid13 χc χωs csC k cid13 χc χωs csC k ωscid5c cid13 χccid8 cid8r χωscid8 s1 sr ordered s1 cid4 cid4 sr c1 cr ordered ccid8 scid8 C k cid8 r Next elements c1 ωs1 cr ωsr distinct Since school receive student round elements c1 cr clearly distinct The elements ωs1 ωsr clearly distinct ωsi ωsh holds h ch pointed si sh according cid4 Furthermore Gk ch school c1 cr points student initial endowment students school set ωs1 ωsr points initial endowment student Therefore schools set c1 ωs1 cr ωsr distinct Besides school set c1 cr points topranked admissible student based common order cid4 Thus Equation 6 holds cid2 Now ready prove TTCM feasible Theorem 2 TTCM feasible Proof We TTCM obtains schoolfeasible IR outcome First induction k cid15μk schoolfeasible For k 0 clear assumption cid15μ0 μ schoolfeasible Then assuming νcid15μk1 F true k 1 induction completed showing νcid15μk F Since νcid15μk represented Equation 5 Equation 6 Lemma 1 νcid15μk νcid15μk1 χωscid8 F We outcome TTCM IR following claims student contained cycle exactly assigned school points formed cycle ii student points school worse initial endowment school based preference Claim clear deﬁnition TTCM Claim ii true νcid15μk χi χ j F satisﬁed k j long student market initial endowment school remains market deems admissible cid2 cid8rχccid8 cid2 To SP PE prove following lemma illustrates student s inadmissible school c round k s remains inadmissible c round k This key property proving SP PE Lemma 5 Let s remain market round k νcid15μk1 χc χωs F students s Sk s cid11 s student Sk1 c cid10 For school c C initial endowment student Sk c required νcid15μk χc χccid10 F cid10 ωs cid10 cid10 Proof If νcid15μk νcid15μk1 lemma obviously holds We assume νcid15μk cid5 νcid15μk1 By Lemma 4 r 1 c1 ωs1 cr ωsr C k exist satisfy Equations cid10 Sk1 student s1 sr included Sk1 We assume based cid4 strict cid10 cid4 sp1 cid4 cid4 sr By order consider order c1 cr c cid10 s1 cid4 cid4 sp cid4 s cid10 c1 c p c c p1 cr ωs1 ωsp ωs 5 6 Note s order s1 sr s ωs1 ωsr ωs cid10 ωsp1 ωsr We apply Lemma 2 schools following facts νcid15μk1 F Theorem 2 c1 cr c ωs1 ωsr ωs c1 ωs1 cr ωsr satisﬁes Equation 6 Lemma 4 νcid15μk1 χc χωscid10 F assumption νcid15μk1 χc χωscid8 F cid8 p assumption νcid15μk1 χch cid10 Lemma 4 χωscid10 F h p 1 r ch pointed s cid10 sh 13 T Suzuki A Tamura K Yahiro et al Artiﬁcial Intelligence 315 2023 103825 From Lemma 2 facts νcid15μk χc χccid10 νcid15μk1 F cid2 cid2 cid8rχccid8 χωscid8 χc χωscid10 contained Next TTCM satisﬁes SP PE To SP use following lemma Lemma 6 For directed path c Gk1 s c s Gk s V k1 execution TTCM c s Proof We ﬁrst following For c C s S s c Ek s c V k1 s c Ek1 holds ii For c C s S c s Ek s V k1 c V k1 c s Ek1 hold cid10 V k1 s V k1 holds iii For s s cid10 S c C s c Ek c s cid10 Ek s means s c Ek holds c best remaining school s round k s c remain market round k 1 c best choice s round k 1 This true schools left market return later round TTCM ii means s highestranked admissible student c round k c ranks s highestranked admissible student round given s remains market To prove claim suﬃcient round k 1 s admissible c s cs topranked admissible student Let ﬁrst prove s admissible c round k 1 νcid15μk χc χωs F holds If ωs c obviously holds If ωs cid5 c consider hypothetical case c favorite school s round k This case happened preference student arbitrary Note case F ω change s admissible c round k Therefore hypothetical case addition cycles formed round k original market exactly cycle c s c formed round k From Theorem 2 resulting vector end k hypothetical setting feasible νcid15μk χc χωs F This fact implies s admissible c round k 1 original market c favorite school s round k s remains market round k 1 Since c admissible student c remains market c V k1 Next s remains highestranked admissible student c k 1 If ωs c cid10 Ek implies clearly holds Assume ωs cid5 c let s νcid15μk1 χc χωscid10 F Then Lemma 5 νcid15μk1 χc χωs F holds νcid15μk χc χωscid10 F cid10 s inadmissible c round k 1 Therefore c s Ek1 iii elementary property inherited standard TTC mechanism Assume s c Ek c s cid10 Ek student s leaves market round k She leaves market s c included cycle If s c included cycle c s remains market implies s remains cid10 included cycle Then s leave market round k Thus fact s student V k1 s cid10 cid4 s The fact c s From ii iii directed path c s c s Gk s V k1 c s cid10 cid10 cid10 Gk1 cid2 Theorem 3 TTCM SP Proof From Lemma 6 directed path c s c s Gk s V k1 c s Gk1 By repeatedly applying lemma directed path student round remains later round long student remains market By construction TTCM student obtain school seat directed path school Fix s cid4s We school obtainable k s obtain seat pointing k Observe school directed path s Gk obtainable s It clear set obtainable schools s increasing k sets growth depends cid4s Since s obtain school seat obtainable schools round best strategy choose preferred school obtainable schools round Choosing based true preference cid4s gives best assignment TTCM SP cid2 Theorem 4 TTCM PE Proof Suppose run TTCM obtain feasible matching μ Consider student matched round r TTCM We matching μcid10 student assigned preferred school allocation μ student exist assigned r worse μcid10 The proof induction r When r 1 statement trivially true student assigned round 1 allocated choice Assume supposition true r k 1 k 2 We consider r k deﬁne following notations Ik C C k schools market round k J k c μk1c cid5 set schools remaining initial endowment student market round k Note J k C k holds 14 T Suzuki A Tamura K Yahiro et al Artiﬁcial Intelligence 315 2023 103825 Each ci C J k ﬁlled νicid15μk1 νiμk1 students beginning round k Without loss generality assume Ik cid5 Ik student allocated k goes choice Consider student s allocated school c round k assume c choice Then schools prefers c Ik From Lemma 5 deﬁnitions Ik J k ci Ik c j J k νcid15μk1 χi χ j F holds Lemma 3 implies feasible matching μcid10 ci C J k νiμcid10 νiμk1 ci Ik νiμcid10 νiμk1 Put differently feasible matching μcid10 s better c ci C J k νiμcid10 νiμk1 νμcid10sμcid10 νμcid10sμk1 μcid10s Ik covers feasible matchings allocation holds Whichever case student exists matched k μ different allocation μcid10 induction argument change necessarily makes matched k worse cid2 From Next prove TTCM GSP We ﬁrst introduce concept called nonbossiness 39 Deﬁnition 12 Nonbossiness Mechanism ϕ nonbossy s S cid4s cid4s cid4cid10 cid4s holds ϕcid4cid10 s cid4s ϕcid4s cid4s holds s long ϕscid4cid10 s cid4s ϕscid4s In words mechanism nonbossy student change assignments students assignment changes Theorem 5 TTCM nonbossy Proof Consider markets basically identical preference student s denoted cid4s ﬁrst market cid4cid10 denote matchings obtained TTCM ﬁrst second markets respectively Towards contradiction assume μs μcid10s holds μ μcid10 s second Let μ μcid10 different Assume s contained cycle formed round k ﬁrst market round k ii k cid5 k examine following cases k k For case ii loss generality assume k k second market We holds cid10 cid10 cid10 cid10 cid10 Case k k Since s contained cycle round k cycles formed round k identical markets Then round k μs μcid10s markets s points μs Furthermore s cid10 S s c C preferences identical markets Thus cycles formed round k identical markets cycles rounds k This implies μ μcid10 cid10 Case ii k k It clear cycles formed round k identical markets Let ﬁrst examine cycle formed round k ﬁrst market formed second market Let C denote cycle containing s round k ﬁrst market We C formed round k second market At round k s assigned μs s points μs directed path μs s ﬁrst market This path exists second second market Since μcid10s μs s points μs market round k By Lemma 6 path remains round k second market implies C formed Besides C cycles round k ﬁrst market round k formed round k second market preferences students identical markets cid10 cid10 cid10 cid10 S s Let C cid10 cid10 groups 1 2 Each group 1 student points school C Next cycles formed round k ﬁrst market formed second market We ﬁrst cycles formed round k 1 ﬁrst market formed second market Let C denote cid10 c C s cid10 c C For cycle formed round k 1 ﬁrst market set schools contained C C cid10 formed round k 1 second market inﬂuenced C include school C denote cycle We divide students Thus concentrate cycle includes school C C cid10 round k ﬁrst market points different school round k 1 according C cid10 pointed leaves market round k Group 2 students complement group 1 students At round k 1 second market C formed On hand group 2 student group 1 student continues point school C points school according C cid10 round k 1 second market Using similar argument proof Lemma 6 group 1 group 2 students continue point school C formed cid10 1 second market group 1 students point schools according C cid10 round k cid10 1 second group 2 students continue point schools according C cid10 market C formed school C second market At round k formed round k Therefore C cid10 cid10 cid10 cid10 cid10 cid10 We construct similar argument rounds k 1 complete proof cid2 15 T Suzuki A Tamura K Yahiro et al Artiﬁcial Intelligence 315 2023 103825 With Theorem 5 immediately TTCM GSP Theorem 6 TTCM GSP Proof Pápai 39 showed mechanism GSP SP nonbossy Since TTCM SP Theorem 3 nonbossy Theorem 5 TTCM GSP cid2 Recall strong core setting Example 2 We matching obtained TTCM weak core Theorem 7 TTCM yields matching weak core Moreover condition guarantees permutation σ S cid10 S exist c C s c μcid10 s S cid10 μcid10s cid4s μs Since TTCM IR μs cid11s μs s S Proof Towards contradiction assume TTCM returns matching μ weak core matching μcid10 M group students S cid10 By condition ii μcid10s cid5 μs ii s S cid10 μσ s s cid5 σ s s S ˆsi ωˆsi1 ˆS 1 cid10 s S μcid10 It implies set students ˆS ˆs1 ˆs ˆS S ˆs ˆS ωˆs1 Let ˆC denote set initial endowment schools students ˆS ˆs ˆS Consider student ˆsi ˆS ﬁrst assigned TTCM students ˆS Let ki denote round ˆsi assigned TTCM Students ˆS schools ˆC V ki ˆsi ﬁrst student assigned ˆS At round ki student ˆsi points μˆsi accepted ωˆsi1 μcid10ˆsi cid4ˆsi μˆsi holds ˆS ωˆs1 μcid10ˆsi cid4ˆsi μˆsi holds This possible ωˆsi1 ωˆs1 quit market However contradicts fact ωˆsi1 ωˆs1 remains round ki cid2 exists μcid10 ˆsi cid10 s c μ s S exists μcid10 s cid10 cid10 cid10 Finally examine time complexity TTCM Theorem 8 The time complexity TTCM O mn assumption check O 1 time ν F Mconvex set F vector ν C Proof Since cycle exists round student S leaves market allocation There fore number rounds required TTCM n At round m students cycles remaining school points exactly student ﬁnding cycles O m Furthermore school needs check student admissible By Lemma 5 student inadmissible inadmissible initial round remains inadmissible future rounds Thus school cost required check leaves market O n To precise ﬁrst round school goes cid4 c ﬁnds ﬁrst admissible student In round checks student points previous round remains market admissible If longer admissible left market goes cid4 c Thus total number checks school O n Hence overall time complexity O mn cid2 53 TTC representatives In subsection study special case TTCM restricts set feasible vectors F ν μ mechanism outputs matchings distribution vector identical initial endowment This mechanism identical mechanism called Top Trading Cycles Representatives TTCR 17 In TTCR number students assigned school ﬁxed school accepts student school initial endowment students leave At round school points topranked initial endowment student student points favorite school students caught cycles allocated favorite schools That topranked students representatives exchange seats When topranked student school c leaves market secondranked student representative school c forth Since TTCR equivalent TTCM artiﬁcially restrict set feasible vectors set containing initial endowment distribution vector TTCR remains feasible IR SP However fails satisfy eﬃciency require ments In addition nonbossy similar argument proof Theorem 5 GSP We matching obtained TTCR weak core similar argument proof Theorem 7 Theorem 9 TTCR GSP yields matching weak core 16 T Suzuki A Tamura K Yahiro et al Artiﬁcial Intelligence 315 2023 103825 However TTCR artiﬁcially restricts set feasible vectors following example easily shows TTCR NWR Example 4 Consider following market S s1 s2 s3 C c1 c2 c3 ωs1 c1 ωs2 c1 ωs3 c2 cid4S cid4C given follows s1 c1 cid4s1 c2 cid4s1 c3 s2 c3 cid4s2 c2 cid4s2 c1 s3 c1 cid4s3 c2 cid4s3 c3 c1 s1 cid4c1 s2 cid4c1 s3 c2 s3 cid4c2 s1 cid4c2 s2 c3 s2 cid4c3 s3 cid4c3 s1 The set feasible vectors given follows cid6 cid6 cid6 cid6 i3 νi 3 0 ν1 ν2 ν3 3 ν Z3 0 F cid2 cid17 cid14 Under common serial order s1 cid4 s2 cid4 s3 artiﬁcially modiﬁed schools preferences cid4 C given follows c1 s1 cid4 c1 c2 s3 cid4 c2 c3 s1 cid4 c3 s2 cid4 c1 s1 cid4 c2 s2 cid4 c3 s3 s2 s3 In TTCR set feasible vectors artiﬁcially restricted F 2 1 0 Then c3 immediately leaves market admissible student In ﬁrst round student points favorite remaining school s1 c1 s2 c2 s3 c1 According cid4 C c1 points s1 c2 points s3 forming cycle s1 c1 s1 In second round cycle s2 c2 s3 c1 s2 formed Therefore TTCR outputs matching cid11 cid12 c1 s1 s3 c2 c3 s2 Student s2 claims seat c3 based ranks ranks2 c3 1 ranks2 c2 2 Hence TTCR NWR Example 4 implies TTCR NW PE Besides TTCR NW NIEfairness hold shown following example Example 5 Consider following market S s1 s2 s3 C c1 c2 c3 ωs1 c1 ωs2 c3 ωs3 c2 cid4S cid4C given follows s1 c2 cid4s1 c1 cid4s1 c3 s2 c2 cid4s2 c3 cid4s2 c1 s3 c3 cid4s3 c2 cid4s3 c1 c1 s1 cid4c1 s2 cid4c1 s3 c2 s3 cid4c2 s1 cid4c2 s2 c3 s2 cid4c3 s3 cid4c3 s1 Set feasible vectors F given 1 1 1 That school exactly initial endowment student leaves market included cycle Thus choice common serial order affect behavior TTCR In ﬁrst round cycle s2 c2 s3 c3 s2 formed In second round schools c2 c3 leave market cycle s1 c1 s1 formed Thus obtained matching cid11 cid12 c1 s1 c2 s2 c3 s3 Observe student s1 justiﬁed RIEenvy s2 s1 cid4c2 s2 ωs2 cid5 c2 implies TTCR NIEfair 17 T Suzuki A Tamura K Yahiro et al Artiﬁcial Intelligence 315 2023 103825 54 Characterization TTCM TTCs characterization actively developed models 5355 Characterization shows mechanism satisﬁes axioms ii mechanism exists satisﬁes axioms mechanism satisﬁes axioms obtain outcome In subsection present characterization TTCM compatible markets school preferences satisfy condition called compatibility Market S C ω cid4S cid4C F compatible cid4C satisﬁes following property Deﬁnition 13 Compatibility A proﬁle school preferences compatible bijection η S n exists school c C pair students s1 s2 S following conditions hold ωs1 c ωs2 cid5 c s1 cid4c s2 ii ωs1 cid5 c ωs2 c s2 cid4c s1 iii s1 cid4c s2 ηs1 ηs2 In compatible market school prefers initial endowment students remaining students Fur thermore η bijection pair students s1 s2 S ηs1 cid5 ηs2 holds Then assuming s1 s2 pair students initial endowment respectively noninitial endowment students school c s1 cid4c s2 ηs1 ηs2 In words schools relative preference ranking pair initial endowment students respectively pair noninitial endowment students consistent η Since compatible markets lay subclass general markets TTCM satisﬁes SP IR PE applied compatible market We introduce desirable property called weak consistency WC As suggests WC weaker condition consistency widely existing literature consistency characterize mechanism house allocation market existing tenants 56 To introduce WC need additional concepts notations Given arbitrary compatible market S C ω cid4S cid4C F student s S initial endowment school c j admissible school ci ν μ χi χ j F holds School c C active admissible student S inactive For student s S let c C denote S denote topranked admissible student c cid4c For topranked active school s cid4s For active school c let s mdimensional vector x Zm 0 let F x denote set remaining vectors subtracting x element F Formally F x ν ν x F m νi 0 Note νcid10 F νcid10 x negative element νcid10 x included F x c s With concepts notations deﬁne following concept crucial WCs deﬁnition First let introduce concept called Mutually Best MB group In MB group student topranked school group vice versa Formally deﬁned follows Deﬁnition 14 Mutually Best MB group In compatible market S C ω cid4S cid4C F S mutually best group c C c c c C s S s s S s s S c hold C S C C Note S C C C S groups MB group An MB group S MB group student choice school Therefore bijection exists Notice compatible market MB group exist union MB S cid10 minimal exists S S C cid10 cid2 C cid10 cid2 S C cid10 C For given mutually best group S C The MB market deﬁned S partition original market compatible markets MB residual We assume ωs c s s holds For student c cid4s basically identical cid4s original market restricted schools C Similarly school ωc cid4c basically identical cid4c original market restricted students S x j 0 j m x identical contains vector x x j 1 c j C s S c C cid4c F vector initial endowment given ω C ω cid4S cid4C F places s On hand residual market deﬁned S ω original market Her preference identical cid4s original market For school c C cid4c basically identical cid4c original market restricted students S F x set vectors obtained subtracting feasible vector x MB market element F S cid4C F x In market S C ω cid4 S S c Now ready deﬁne WC Intuitively WC means partition original market MB residual markets apply mechanism separately partitioned markets student assigned school original partitioned markets Deﬁnition 15 Weak consistency WC Let S respectively denote matchings obtained running mechanism ϕ original MB residual markets Mechanism ϕ satisﬁes weak consistency μ μ μ MB group compatible market Let μ μ μ holds C Theorem 10 TTCM WC compatible market 18 T Suzuki A Tamura K Yahiro et al Artiﬁcial Intelligence 315 2023 103825 Proof To proof concise introduce slightly modiﬁed version TTCM choose exactly cycle round student cycle assigned school pointing students cycles remain market Since way choosing cycle multiple candidates arbitrary round original TTCM divided rounds modiﬁed TTCM It clear modiﬁed TTCM outputs matching original TTCM original TTCM satisﬁes WC First illustrate original TTC We MB group S denotes students residual market S M outputs identical matching S consists k k Z0 positive integer minimal MB groups Observe original market Assume S minimal MB group cycle exists formed ﬁrst round original TTCM Then ﬁnd instance modiﬁed TTCM cycles formed ﬁrst k cycles exactly correspond k minimal MB groups Based construct residual market procedure modiﬁed TTCM matching obtained residual market matching S original market modiﬁed TTCM identical Since modiﬁed original TTCM obtain identical matching original TTCM outputs identical matching S residual original markets C C Next TTCM outputs identical matching S MB original markets In MB market topranked active school resp admissible student student resp school consistent original market Therefore MB original markets S C s markets form identical cycles s S matched c Thus TTCM satisﬁes WC cid2 Theorem 11 In compatible markets mechanism satisﬁes SP PE WC obtains identical matching TTCM Proof The proof developed based modiﬁed TTCM simply called TTCM proof Theorem 10 We assume mechanism ϕ satisﬁes SP PE WC First prove MB market constructed students schools ﬁrst cycle round TTCM ϕ outputs identical matching TTCM Then apply similar arguments residual market proving claim MB market consists students schools ﬁrst cycle TTCM residual market By repeating process proof completed denote minimal MB group forms cycle ﬁrst round TTCM original μs s c market Additionally let μ denote matching obtained TTCM original market Note s S s student MB group assigned topranked active school Let μcid10 μ denote s c s S c μ Let S C Since MB market feasible vector x x j 1 c j C x j 0 j m Since schoolfeasible Furthermore assumption ϕ PE MB market ϕ output μcid10 νμcid10 x holds μcid10 unique PE matching MB market Next consider residual market constructed removing MB market S minimal MB group residual market S residual market Then apply similar argument MB market consists S outputs s c s S 1 s c μ 1 C 1 1 forms cycle ﬁrst round TTCM 1 ϕ Let S 1 C 1 C C We repeat process conclude MB group ϕ outputs consistent matching μ By WC original market ϕ outputs μ identical matching obtained TTCM cid2 Note require ϕ satisﬁes IR automatically satisﬁed WC satisﬁed compatible market Also note explicitly use SP Due wellknown revelation principle 57 mechanism ϕ SP long PE WC satisﬁed dominant strategy equilibrium equivalence TTCM 6 Deferred Acceptance based mechanisms In section study DAbased mechanisms First simple extension DA called Artiﬁcial Cap Deferred Acceptance ACDA mechanism Then introduce second main mechanism called DA based Ranks DAR 61 Artiﬁcial Cap Deferred Acceptance In subsection introduce Artiﬁcial Cap Deferred Acceptance ACDA Its idea Japan Residency Match ing Program JRMP 6 ACDA ﬁxes maximum quotas schoolhospital distributional constraints automatically satisﬁed For school c set artiﬁcial maximum quota qc μc number initial endowment students Therefore distribution vector output matching ACDA ν μ schoolfeasible The preference school cid4c modiﬁed cid4c initial endowment students preferred students S μc holds following conditions holds More speciﬁcally school c pair students s s cid10 cid10 s cid4c s 1 ωs c ωs cid10 cid5 c 19 T Suzuki A Tamura K Yahiro et al Artiﬁcial Intelligence 315 2023 103825 Mechanism 2 Deferred Acceptance DA Step 1 Step 2 Step 3 Each student s applies favorite school according cid4s rejected Each school c provisionally accepts students applying maximum quota based cid4c rest students rejected If student rejected return current assignment ﬁnal matching Otherwise Step 1 2 s cid4c s 3 s cid4c s cid10 cid10 ωs ωs cid10 cid5 c ωs cid10 ωs cid10 c cid10 cid5 c The mechanism performs standard DA procedure Mechanism 2 cid4ccC qccC We example illustrate ACDA works Example 6 Consider following market S s1 s2 s3 s4 C c1 c2 c3 ωs1 c1 ωs2 ωs3 c2 ωs4 c3 cid4S cid4C given follows s1 c2 cid4s1 c3 cid4s1 c1 s2 s3 s4 c1 cid4s c2 cid4s c3 c1 s1 cid4c1 s2 cid4c1 s4 cid4c1 s3 c2 s2 cid4c2 s3 cid4c2 s4 cid4c2 s1 c3 s4 cid4c3 s1 cid4c3 s2 cid4c3 s3 The set feasible vectors F given follows cid6 cid6 cid6 cid6 cid6 cid6 ν Z3 0 i3 νi 4 0 ν1 ν2 3 1 ν3 4 F cid2 Set F represents situation student assigned c3 Since ACDA sets artiﬁcial maximum quotas according initial endowment ω quotas q1 q2 q3 set 1 2 1 respectively Each student applies favorite school speciﬁcally s2 s3 s4 apply c1 s1 applies c2 Since 1 c1 accepts s2 preferred according cid4c1 students applying c1 exceeds maximum quota qc1 rejects s3 s4 Similarly c2 accepts s1 Students rejected previous step s3 s4 apply c2 Then 2 Hence c2 accepts s3 s4 rejects students s1 s3 s4 apply c2 exceeds maximum quota qc2 s1 Finally s1 applies c3 accepted All students accepted mechanism terminates The following obtained matching cid11 cid12 c1 s2 c2 s3 s4 c3 s1 We ACDA satisﬁes fundamental desiderata excessively ineﬃcient Theorem 12 ACDA feasible IR NIEfair SP NWR Proof Since qc μ cid4c constructed initial endowment student preferred non cid10 S student s initial endowment student c qc students initial endowment student S according cid4c This means s rejected c ACDA applies Thus ACDA satisﬁes IR school student s ωs Furthermore DA satisﬁes fairness according given schools preferences cid4C 7 s prefers c assigned cid10 cid4c s assigned c preferred s according cid4c This means s cid10 c holds Thus ACDA satisﬁes NIEfairness Since DA SP 5859 artiﬁcial maximum quotas determined independently students preferences cid10 ACDA SP Furthermore DA feasible given maximum quotas 7 ACDA feasible We ACDA fails satisfy NWR Example 4 It clear cid4C consistent cid4C example Since ν μ 2 1 0 artiﬁcial cap ACDA 2 1 0 Then student applies favorite school s1 s3 apply c1 s2 applies c3 However 2 0 1 violates artiﬁcial cap s2 rejected c3 applies c2 The following matching obtained cid11 cid12 c1 s1 s3 c2 c3 s2 In matching student s2 claims seat c3 based ranks ranks2 c3 1 ranks2 c2 2 Thus ACDA fails satisfy NWR cid2 20 T Suzuki A Tamura K Yahiro et al Artiﬁcial Intelligence 315 2023 103825 Mechanism 3 Deferred Acceptance based Ranks DAR Initialize μ μcid10 Re Step 1 Step 2 μ Ch S M Re μcid10 ChC μ If μ μcid10 return μ Otherwise Re Re μ μcid10 Step 1 62 Deferred Acceptance mechanism based Ranks In subsection introduce Deferred Acceptance mechanism based Ranks DAR properties Kojima et al 1 presented general abstract class mechanisms works Mconvex constraints called Generalized DA GDA That class mechanisms exploits choice functions students Ch S schools ChC Any GDA instance guaranteed satisfy SP DAR particular concrete instance belongs class We construct DAR satisﬁes IR Deﬁnition 16 Choice function students For student s let Chs denote choice function deﬁned follows Given μ M let ˆμs denote s c μs c cid11s ωs Then Chsμ returns x x ˆμs x preferred contract ˆμs s The choice function students Ch S deﬁned Ch S μ cid18 sS Chsμ Deﬁnition 17 Choice function schools Given μ M choice function schools returns set contracts ChC μ deﬁned ChC μ arg max μcid10μ f μcid10 Here f 2 We assume f M R evaluation function aggregates school preferences distributional constraints uniqueselecting μ M unique subset μcid10 μ exists maximizes f μcid10 Based choice functions DAR deﬁned Mechanism 3 Here Re represents set contracts proposed students rejected schools previous steps Students allowed propose contract Re initially Each student chooses preferred contract M Re Here μ represents set contracts proposed students Then schools choose subset μcid10 μ ChC If contract rejected mechanism terminates Otherwise rejected contracts added Re mechanism repeats procedure Kojima et al 1 concluded f satisﬁes property called Mcid2concavity GDA satisﬁes desirable prop erties Furthermore showed methods constructing f satisﬁes Mcid2concavity In paper follow expressed f cid15f cid19f cid15f represents hard distributional divide f constraints cid19f concerned soft constraints reﬂect schools preferences parts cid15f cid19f f Kojima et al 1 showed following result Lemma 7 Condition 1 1 f satisﬁes Mcid2concavity10 cid15f deﬁned based Mcid2convex set 19 ii contract x associated value vx cid19f μ deﬁned cid2 xμ vx First cid15f deﬁned For melement vectors v v cid10 write v v cid10 m v v cid10 holds Deﬁnition 18 Hard distributional constraints Given μ M cid15f μ deﬁned cid14 cid15f μ ν F exists νμ ν holds 0 Intuitively cid15f μ 0 holds ν F exists νμ smaller equal ν elementwise comparison The set νcid10 ν F st νcid10 ν Mcid2convex set F Mconvex set Thus cid15f satisﬁes requirement Next cid19f deﬁned satisﬁes condition ii represented sum contract values Deﬁnition 19 Schools preference Given μ M cid19f μ deﬁned cid19f μ cid13 xμ vx 10 These conditions correspond Condition 1 Kojima et al 1 requires family feasible matchings constitute mathematical structure called matroid In setting distributional constraints deﬁned distributional vectors This requirement satisﬁed family feasible distributional vectors constitutes Mcid2convex set 21 T Suzuki A Tamura K Yahiro et al Artiﬁcial Intelligence 315 2023 103825 Procedure 1 Procedure calculating ChC μ Initialize μcid10 Step 1 Step 2 Step 3 Remove x μ vx largest If cid15f μcid10 x 0 add x μcid10 If μ return μcid10 Otherwise Step 1 Here v M 0 function gives value contract Deﬁnition 20 Contract value function For contract si c j value vsi c j deﬁned vsi c j C1n ranksi c j C2m j n Here C1 C2 constants satisfy C1 cid20 C2 cid20 n ranksi c j ranking student si school c j Deﬁni tion 7 From deﬁnition easy v satisﬁes following properties cid10 c cid10 c cid10 ranks c ranks 1 For contracts s c s cid10 ck ranks c j ranks 2 For contracts s c j s 3 For contracts si c sk c ranksi c ranksk c k vsi c vsk c holds cid10 vs c vs cid10 ck j k vs c j vs cid10 holds cid10 c cid10 ck holds The ﬁrst property denotes higherranked contract valuable In particular contract corresponding initial endowment valuable noninitial endowment contracts The second property tiebreaking contracts ranking different schools The property guarantees pair contracts cid10 More speciﬁcally ranksi c ranksk c holds ωsi ωsk c holds cid10 x x si sk cs initial endowment students Neither contract rejected relative ordering affect ChC output When cid15f cid19f deﬁned way greedy procedure Procedure 1 obtains μcid10 μ maximizes f μcid10 ChC implies vx cid5 vx cid10 x cid5 x calculated eﬃciently 1 We execution DAR Example 7 Example 7 We consider instance Example 6 First student chooses favorite acceptable tract Thus μ s1 c2 s2 c1 s3 c1 s4 c1 Based Procedure 1 s2 c1 s4 c1 s1 c2 added μcid10 Next s3 c1 selected ν F exists 3 1 0 ν holds Thus s3 c1 included μcid10 Then μcid10 s1 c2 s2 c1 s4 c1 μ μcid10 s3 c1 rejected Student s3 chooses second favorite contract s3 c2 students choose schools fore Thus μ s1 c2 s2 c1 s3 c2 s4 c1 Based Procedure 1 s3 c2 s2 c1 s4 c1 added μcid10 Next s1 c2 selected11 ν F exists 2 2 0 ν holds Thus s1 c2 included μcid10 Then μcid10 s2 c1 s3 c2 s4 c1 μ μcid10 s1 c2 rejected Finally s1 chooses second favorite contract s1 c3 Thus μ s1 c3 s2 c2 s3 c2 s4 c1 cid15f μ 0 νμ 2 1 1 F No contract rejected mechanism terminates The following obtained matching cid11 cid12 c1 s2 s4 c2 s3 c3 s1 It satisﬁes IR NIEfairness ACDA special case DAR set feasible vectors F artiﬁcially restricted ν μ contains exactly vector identical distribution vector initial endowment We ACDA ﬂexible DAR Next theoretical properties DAR Theorem 13 DAR feasible SP NIEfair Proof Since DAR follows conditions ii Lemma 7 guaranteed schoolfeasible SP Next DAR IR schoolfeasibility leads DAR feasible Observe student s rejected cid10 μ μ initial endowment school ωs μ initial endowment μ contracts x μ μ x cid10 holds Thus contracts μ μ chosen contract μ μ Furthermore cid15f μ μ 0 vx vx ν μ F holds Hence DAR satisﬁes IR 11 Here ranks1 c2 ranks4 c1 2 vs1 c2 vs4 c1 derived second property v 22 T Suzuki A Tamura K Yahiro et al Artiﬁcial Intelligence 315 2023 103825 We DAR NIEfair Assume student s prefers c assigned school student s assigned c vs cid10 c vs c holds This means s cid10 cs initial endowment student s cid10 cid4c s holds cid2 cid10 Theorem 14 DAR NWR cid10 s c cid10 Ch S μ s c Proof Kojima et al 1 showed DAR satisﬁes property called HatﬁeldMilgrom HMstability This property means cid10 M μ exists matching μ obtained DAR μ ChC μ Ch S μ holds contract s c s c cid10 ChC μ s c cid10 Toward contradiction assume matching μ obtained DAR s claims seat c cid10 ranks c holds Furthermore μ s c s c cid10 holds Let examine ChC μ s c based ranks cid10 schoolfeasible cid10 In Procedure 1 cid10 selected s c Since μ feasible contracts cid10 school cid10 schoolfeasible subset μcid10 s c cid10 vs c holds Thus s c Since μ s c s c cid10 cid4s c clear s c cid10 ranks c vs c s c μ s c Since c ranks c selected s c feasible Thus s c ChC μ s c cid10 holds violating fact DAR HMstable cid2 cid10 cid4s c ranks c cid10 Ch S μ s c cid10 added μcid10 cid10 M μ c cid10 hold Note DAR fails satisfy NW PE NIEfair NIEfairness incompatible NW Example 1 shows Next DAR satisfy GSP obtained matching weak core following example Example 8 We use instance Example 5 Notice example cid4C identical cid4C First student chooses favorite acceptable contract Thus μ s1 c2 s2 c2 s3 c3 Based Procedure 1 s1 c2 s3 c3 added μcid10 Next s2 c2 selected ν F exists 0 2 1 ν holds The schools choose μcid10 s1 c2 s3 c1 μ μcid10 s2 c2 rejected Student s2 chooses second favorite contract s2 c3 students choose schools Next s3 c3 selected Thus μ s1 c2 s2 c3 s3 c3 By Procedure 1 s2 c3 s1 c2 added μcid10 ν F exists 0 1 2 ν holds The schools choose μcid10 s1 c2 s2 c3 μ μcid10 s3 c3 rejected Student s3 chooses second favorite contract s3 c2 students previous choices Thus Next s1 c2 selected μ s1 c2 s3 c2 s2 c3 Based Procedure 1 s3 c2 s2 c3 added μcid10 ν F exists 0 2 1 ν holds The schools choose μcid10 s2 c3 s3 c2 μ μcid10 s1 c2 rejected Finally s1 chooses second favorite contract s1 c1 Thus μ s1 c1 s3 c2 s2 c3 cid15f μ 0 νμ 1 1 1 F No contract rejected mechanism terminates The obtained matching identical initial en dowment matching μ described follows cid11 c1 s1 c2 s3 c3 s2 cid12 We assume s1 misreports preference c1 cid4s1 c2 cid4s1 c3 s2 s3 report true preferences Then DAR obtains following PE matching cid12 cid11 c1 s1 c2 s2 c3 s3 cid10 s1 s2 s3 manipulation s1s assignment unchanged This implies DAR GSP S weakly better s2 s3 strictly better Furthermore s2 s3 exchange initial endowments students strictly better μ Hence matching obtained DAR weak core In example ACDA obtains μ F ν μ Thus ACDA fails satisfy GSP matching obtained ACDA weak core Finally discuss DARs time complexity following theorem Theorem 15 The time complexity DAR O T f M2 T f denotes time required calculate f Proof According Theorem 12 previous work 1 required stages DAR O M2 time complexity DAR O T f M2 cid2 Time complexity T f depends complexity checking cid15f μcid10 x 0 holds Step 2 Procedure 1 If constant time time complexity T f O n log n calculating ChC μ μ Ch S M Re contains n contracts sorting μ based v requires O n log n time 23 T Suzuki A Tamura K Yahiro et al Artiﬁcial Intelligence 315 2023 103825 7 Experimental evaluation Fig 4 Ratio students justiﬁed RIEenvy In section conducted quantitative evaluations mechanisms including TTCbased DAbased mechanisms In previous sections theoretically showed TTCM outputs PE matchings DAR ACDA yield NIEfair matchings Although eﬃciency fairness desirable properties matching markets incompatible general Therefore conducted simulations evaluate degree eﬃciencyfairness mechanisms achieve random markets In previous sections compared proposed mechanisms TTCM TTCR ACDA DAR As benchmark performance trivial mechanism called Initial returns initial endowment matching μ We evaluated performance mechanisms comparing measurements reﬂect eﬃciency fairness ratios students claim seats justiﬁed RIEenvy matchings obtained mechanisms In experiments instances 800 students 20 schools Instances randomly generated types markets A B In Market A school individual minimummaximum quotas pc 10 qc 80 In Market B distance constraints implemented matching μ feasible Manhattan distance νμ ideal distribution ν 40 40 smaller equal 300 As described Section 3 constraints represented Mconvex sets For ACDA artiﬁcially restricted maximum quotas school set 40 markets In instances student preferences generated Mallows model 6063 strict preference cid4s student s drawn probability Prcid4s Prcid4s expθ dcid4s cid4cid15s cid2 expθ dcid4cid10 s cid4cid15s cid4cid10 s θ R spread parameter cid4cid15s central preference randomly drawn possible preferences uniform distribution dcid4s cid4cid15s denotes Kendall tau distance number pairwise inversions cid4s cid4cid15s When θ 0 Mallows model equivalent uniform distribution As θ increases student preferences quickly converge degenerate distribution preference cid4cid15s In following evaluations randomly constructed 100 instances parameter setting compared average performances ﬁve mechanisms TTCR TTCM ACDA DAR Initial 100 instances Figure 8 plots problem instance 71 Evaluation fairness To evaluate degree fairness examined ratio students justiﬁed RIEenvy matchings obtained mechanisms Since DAbased mechanisms ACDA DAR Initial NIEfair guaranteed ratio students justiﬁed RIEenvy zero Thus results TTCR TTCM Figure 4 shows average ratio students justiﬁed RIEenvy varying spread parameter θ students preferences Recall θ 0 students preferences random θ increases quickly similar Thus θ increases competition students deepens fewer students allocated ﬁrst second choice schools Since TTCbased mechanisms use schools preferences students justiﬁed RIEenvy In Markets A B θ setting ratio TTCM smaller TTCR implies TTCM outperforms TTCR terms fairness This TTCM ﬂexible TTCR number students allocated school ﬁxed 24 T Suzuki A Tamura K Yahiro et al Artiﬁcial Intelligence 315 2023 103825 Fig 5 Ratios students claiming seats 72 Evaluation eﬃciency Fig 6 Average Borda scores students To compare eﬃciency mechanisms measured ratio students claim seats Borda scores Cumulative Distribution Function CDF Figure 5 shows average ratios students claim seats varying θ Since TTCM PE NW student claims seat Thus compared mechanisms TTCR DAR ACDA Initial In terms ratio students claim seats mechanisms ranked lowestbest highestworst follows DAR TTCR ACDA Initial That ﬂexible mechanism performs better terms NW Similar Figure 4 θ increases competition students severe students claim seats Initial Next evaluated students welfare average Borda scores More speciﬁcally student matched ith choice school score given m 1 Thus students matched ﬁrst choice school average Borda score m 20 The higher Borda score eﬃcient mechanism Figure 6 shows average Borda scores students ﬁve mechanisms varying θ In terms average Borda scores mechanisms ranked largestbest smallestworst follows TTCM DAR TTCR ACDA Initial This result implies ﬂexible mechanism performs better terms students welfare ACDATTCR equivalent DARTTCM F restricted feasible distribution vector ν μ TTCM DAR F expanded fully utilize ﬂexibility allowed given constraints Similar Figures 4 5 θ increases competition students severe welfare falls Initial Another way compare students welfare check Cumulative Distribution Functions CDFs school rankings Figure 7 shows average ratios students assigned ith choice better school varying θ 03 ﬁve mechanisms If curve mechanism α mechanism β conclude mechanism α outperforms β terms students welfare Roughly speaking mechanisms ranked terms CDFs best worst follows TTCM DAR TTCR ACDA Initial Note TTCR slightly better DAR ﬁrst second rankings markets In addition DAR slightly better TTCM 7 Market B Perhaps TTCbased mechanisms welfare students slightly uneven welfare student ranked higher common serial order better welfare student ranked lower degraded Compared TTCbased mechanisms DAR balanced 25 T Suzuki A Tamura K Yahiro et al Artiﬁcial Intelligence 315 2023 103825 Fig 7 Cumulative distribution functions θ 03 73 Evaluation tradeoff fairness eﬃciency Fig 8 Tradeoff fairness eﬃciency θ 03 Finally illustrate tradeoff eﬃciency fairness plotted results obtained matchings problem instance twodimensional space Figure 8 xaxis denotes average student Borda score measurement eﬃciencystudents welfare yaxis denotes ratio students justiﬁed RIEenvy positively correlated fairness Thus points located northeast preferable Since Initial ACDA DAR NIEfair mechanisms ratios 1 In terms eﬃciency DAR clearly optimal markets On hand TTCR dominated TTCM Therefore ﬁve mechanisms TTCM DAR clear winners terms criteria TTCM best choice eﬃciency DAR best choice emphasize fairness 8 Conclusion We investigated allocation problem multiple types objects agents type object multiple copies agent endowed object distributional constraints imposed allocation A repre sentative application domain setting school choice problem student right attend nearby school transfers school prefers default school distributional constraints minimummaximum quotas regions satisﬁed schools operate We developed mechanisms feasible SP distributional constraints represented Mconvex set One mechanism called TTCM satisﬁes PE called DAR satisﬁes NIEfairness We experimentally evaluated performance mechanisms terms tradeoff fairness eﬃciency simulation Our future works include developing mechanisms work class constraints broader Mconvex sets weaker eﬃciencyfairness conditions Declaration competing The authors declare known competing ﬁnancial interests personal relationships appeared inﬂuence work reported paper 26 T Suzuki A Tamura K Yahiro et al Artiﬁcial Intelligence 315 2023 103825 Acknowledgement We grateful Hiroshi Nakahara helped experimental evaluations This work partially supported JSPS KAKENHI Grant Number JP20H00609 JP21H04979 JP22K19813 References 1 F Kojima A Tamura M Yokoo Designing matching mechanisms constraints approach discrete convex analysis J Econ Theory 176 2 T Suzuki A Tamura M Yokoo Eﬃcient allocation mechanism endowments distributional constraints Proceedings 17th Interna tional Conference Autonomous Agents MultiAgent Systems AAMAS18 2018 pp 5058 3 A Abdulkadiroglu T Sönmez School choice mechanism design approach Am Econ Rev 93 2003 729747 httpsdoi org 10 1257 4 T Sönmez MU Ünver Matching allocation exchange discrete resources A Bisin J Benhabib M Jackson Eds Handbook Social Economics NorthHolland 2011 pp 781852 httpsideas repec org p boc bocoec 717html 5 P Biró T Fleiner RW Irving DF Manlove The college admission problem lower common quotas Theor Comput Sci 411 2010 31363153 6 Y Kamada F Kojima Eﬃcient matching distributional constraints theory applications Am Econ Rev 105 2015 6799 httpsdoi org 10 7 D Gale LS Shapley College admissions stability marriage Am Math Mon 69 1962 915 httpsdoi org 10 2307 2312726 8 M Balinski T Sönmez A tale mechanisms student placement J Econ Theory 84 1999 7394 httpsdoi org 10 1006 jeth 1998 2469 9 D Fragiadakis A Iwasaki P Troyan S Ueda M Yokoo Strategyproof matching minimum quotas ACM Trans Econ Comput 4 2015 6 https 2018 803833 000282803322157061 1257 aer20101552 doi org 10 1145 2841226 publsh 2195 html 10 D Fragiadakis P Troyan Improving matching hard distributional constraints Theor Econ 12 2017 863908 httpsideas repec org 11 M Goto A Iwasaki Y Kawasaki R Kurata Y Yasuda M Yokoo Strategyproof matching regional minimum maximum quotas Artif Intell 12 M Goto F Kojima R Kurata A Tamura M Yokoo Designing matching mechanisms general distributional constraints Am Econ J Microecon 13 Y Kamada F Kojima Stability concepts matching distributional constraints J Econ Theory 168 2017 107142 httpsdoi org 10 1016 j jet 235 2016 4073 httpsdoi org 10 1016 j artint 2016 02 002 9 2017 226262 httpsdoi org 10 1257 mic 20160124 2016 12 006 14 R Kurata N Hamada A Iwasaki M Yokoo Controlled school choice soft bounds overlapping types J Artif Intell Res 58 2017 153184 15 K Yahiro Y Zhang N Barrot M Yokoo Strategyproof fair matching mechanism ratio constraints Auton Agents MultiAgent Syst 34 2020 23 httpsdoi org 10 1007 s10458 020 09448 9 16 K Yahiro M Yokoo Game theoretic analysis twosided matching resource allocation Proceedings 19th International Conference Autonomous Agents Multiagent Systems AAMAS20 2020 pp 15481556 17 N Hamada CL Hsu R Kurata T Suzuki S Ueda M Yokoo Strategyproof school choice mechanisms minimum quotas initial endowments Artif Intell 249 2017 4771 httpsdoi org 10 1016 j artint 201704 006 18 A Gibbard Manipulation voting schemes general result Econometrica 41 1973 587601 httpsdoi org 10 2307 1914083 19 K Murota Convexity Steinitzs exchange property Adv Math 124 1996 272311 20 K Murota Discrete convex analysis Math Program 83 1998 313371 21 A Abdulkadiroglu College admissions aﬃrmative action Int J Game Theory 33 2005 535549 httpsdoi org 10 1007 s00182 005 0215 7 22 LS Shapley H Scarf On cores indivisibility J Math Econ 1 1974 2337 23 K Murota Matrices Matroids Systems Analysis vol 20 Springer Science Business Media 2009 24 A Schrijver Combinatorial Optimization Polyhedra Eﬃciency Springer 2003 25 B Korte J Vygen Combinatorial Optimization Theory Algorithms ﬁfth edition Springer 2012 26 V Danilov GA Koshevoy K Murota Discrete convexity equilibria economies indivisible goods money Math Soc Sci 41 2001 251273 httpsdoi org 10 1016 S0165 489600 00071 8 27 K Murota Discrete Convex Analysis SIAM Monographs Discrete Mathematics Applications vol 10 Society Industrial Applied Mathe 28 K Murota A Tamura Application Mconvex submodular ﬂow problem mathematical economics Jpn J Ind Appl Math 20 2003 257277 29 N Sun Z Yang Equilibria indivisibilities Gross substitutes complements Econometrica 74 2006 13851402 httpswwwjstororg stable 30 WT Huh G Janakiraman On optimal policy structure serial inventory systems lost sales Oper Res 58 2010 486491 httpsdoi org 10 matics Philadelphia 2003 httpsdoi org 10 1007 BF03167422 3805929 1287 opre 1090 0716 jmi articl jmi v1i1a5 doi org 10 1016 j dam 2005 10 006 doi org 10 1287 moor2014 0679 31 P Zipkin On structure lostsales inventory models Oper Res 56 2008 937944 httpsdoi org 10 1287 opre 1070 0482 32 K Murota A Shioura Z Yang Computing Walrasian equilibrium iterative auctions multiple differentiated items Proceedings 24th International Symposium Algorithms Computation ISAAC13 Lecture Notes Computer Science vol 8283 Springer 2013 pp 468478 33 K Murota Discrete convex analysis tool economics game theory J Mech Inst Des 1 2016 151273 httpsEconPapers repec org RePEc 34 S Fujishige A Tamura A general twosided matching market discrete concave utility functions Discrete Appl Math 154 2006 950970 https 35 S Fujishige A Tamura A twosided discreteconcave market possibly bounded payments approach discrete convex analysis Math Oper Res 32 2007 136155 httpsdoi org 10 1287 moor1070 0227 36 K Murota Y Yokoi On lattice structure stable allocations twosided discreteconcave market Math Oper Res 40 2015 460473 https 37 T Fleiner A matroid generalization stable matching polytope Proceedings 8th International Conference Integer Programming Combinatorial Optimization IPCO01 Springer 2001 pp 105114 38 JW Hatﬁeld PR Milgrom Matching contracts Am Econ Rev 95 2005 913935 httpsdoi org 10 1257 0002828054825466 39 S Pápai Strategyproof assignment hierarchical exchange Econometrica 68 2000 14031433 httpswwwjstororg stable 3003994 40 M Pycia MU Ünver Trading cycles school choice SSRN 1899344 2011 Working Paper 41 M Pycia MU Ünver Incentive compatible allocation exchange discrete resources Theor Econ 12 2017 287329 httpsdoi org 10 3982 TE2201 27 T Suzuki A Tamura K Yahiro et al Artiﬁcial Intelligence 315 2023 103825 42 A Abdulkadiroglu YK Che PA Pathak AE Roth O Tercieux Minimizing Justiﬁed Envy School Choice Design New Orleans OneApp Technical Report 23265 National Bureau Economic Research 2017 Working Paper 43 J Combe O Tercieux C Terrier The design teacher assignment Theory evidence Working Paper 2020 44 C Terrier Matching practices secondary public school teachers France Working Paper 2014 45 E Fujita J Lesca A Sonoda T Todo M Yokoo A complexity approach coreselecting exchange multiple indivisible goods lexicographic 46 Z Sun H Hata T Todo M Yokoo Exchange indivisible objects asymmetry Proceedings 24th International Conference Artiﬁcial preferences J Artif Intell Res 63 2018 515555 Intelligence IJCAI15 vol 15 2015 pp 97103 AAAI17 2017 pp 684690 httpsdoi org 10 1111 j 1468 2354 2012 00710 x 47 S Sikdar S Adali L Xia Mechanism design multitype housing markets Proceedings 31st AAAI Conference Artiﬁcial Intelligence 48 A Abdulkadiroglu T Sönmez House allocation existing tenants J Econ Theory 88 1999 233260 49 P Guillen O Kesten Matching markets mixed ownership case reallife assignment mechanism Int Econ Rev 53 2012 10271046 50 AE Roth A Postlewaite Weak versus strong domination market indivisible goods J Math Econ 4 1977 131137 51 Y Kamada F Kojima Fair matching constraints theory applications Rev Econ Stud 2021 httpykamada com pdf fair _constraints pdf 52 S Fujishige Submodular Functions Optimizations 2nd ed Annals Discrete Mathematics vol 58 Elsevier Amsterdam 2005 53 A Abdulkadiroglu YK Che The Role Priorities Assigning Indivisible Objects A Characterization Top Trading Cycles 2010 54 T Morrill An alternative characterization trading cycles Econ Theory 54 2013 181197 httpsdoi org 10 1007 s00199 012 0713 3 55 U Dur A characterization trading cycles mechanism school choice problem SSRN Electron J 2012 httpsideas repec org p pra 56 T Sönmez MU Ünver House allocation existing tenants characterization Games Econ Behav 69 2010 425445 httpsdoi org 10 1016 j press mprapa 41366 html geb 2009 10 010 57 N Nisan T Roughgarden E Tardos VV Vazirani Algorithmic Game Theory Cambridge University Press 2007 58 LE Dubins DA Freedman Machiavelli GaleShapley algorithm Am Math Mon 88 1981 485494 59 AE Roth The economics matching stability incentives Math Oper Res 7 1982 617628 60 CL Mallows Nonnull ranking models I Biometrika 44 1957 114130 httpsdoi org 10 2307 2333244 61 J Tubbs Distance based binary matching Computing Science Statistics Springer 1992 pp 548550 62 J Drummond C Boutilier Elicitation approximately stable matching partial preferences Proceedings 23rd International Joint Conference Artiﬁcial Intelligence IJCAI13 2013 pp 97105 63 T Lu C Boutilier Effective sampling learning mallows models pairwisepreference data J Mach Learn Res 15 2014 39634009 28